@&#MAIN-TITLE@&#A dynamic learning algorithm for online matching problems with concave returns

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           We consider the online matching problem with concave returns. It is the core model for ad allocation.


                        
                        
                           
                           We propose a dynamic learning algorithm that achieves near-optimal performance for this problem.


                        
                        
                           
                           Our approach is primal-dual based. We overcome the difficulty that arises due to the nonlinearity.


                        
                        
                           
                           We test our algorithm using experimental data and show that it outperforms a myopic approach.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Online algorithms

Primal-dual

Dynamic price update

Random permutation model

Adwords problem

@&#ABSTRACT@&#


               
               
                  We consider an online matching problem with concave returns. This problem is a generalization of the traditional online matching problem and has vast applications in online advertising. In this work, we propose a dynamic learning algorithm that achieves near-optimal performance for this problem when the inputs arrive in a random order and satisfy certain conditions. The key idea of our algorithm is to learn the input data pattern dynamically: we solve a sequence of carefully chosen partial allocation problems and use their optimal solutions to assist with the future decisions. Our analysis belongs to the primal-dual paradigm; however, the absence of linearity of the objective function and the dynamic feature of the algorithm makes our analysis quite unique. We also show through numerical experiments that our algorithm performs well for test data.
               
            

@&#INTRODUCTION@&#

In traditional optimization models, inputs are usually assumed to be known and efficient algorithms are sought to find the optimal solutions. However, in many practical cases, data does not reveal itself at the beginning. Instead, it comes in an online fashion. For example, in many revenue management problems, customers arrive sequentially and each time a customer arrives, the decision maker has to make some irrevocable decisions (e.g., what product to sell, at what prices) for this customer without knowing any of the future inputs. Such a regime is often called online optimization. Online optimization has gained much attention in the research community in the past few decades due to its applicability in many practical problems, and much effort has been directed toward understanding the quality of solutions that can be obtained under such settings. For an overview of the online optimization literature and its recent developments, we refer the readers to Borodin and El-Yaniv (1998), Buchbinder and Naor (2009) and Devanur (2011).

In this paper, we consider a special type of online optimization problem - an online matching problem. Online matching problems are considered as fundamental problems in online optimization theory and have important applications in the online advertisement allocation problems. For a review of online matching problems, we refer the readers to Mehta (2012). In the problem we study, there is an underlying weighted bipartite graph 
                        
                           G
                           =
                           (
                           I
                           ,
                           J
                           ,
                           E
                           )
                        
                      with weights bij
                      for each edge (i, j) ∈ E. The vertices in J arrive sequentially in some order, and whenever a vertex j ∈ J arrives, the set of weights bij
                      is revealed for all i ∈ I, (i, j) ∈ E. The decision maker then has to match j to one of its neighbors i, and a value of bij
                      will be obtained from this matching. In our problem, the decision maker’s gain from each vertex i is a function of the total matched value to this vertex, and his goal is to maximize the total gain from all vertices. Mathematically, the problem can be formulated as follows (assume 
                        
                           |
                           I
                           |
                           =
                           m
                           ,
                        
                     
                     
                        
                           |
                           J
                           |
                           =
                           n
                           ,
                        
                      and let 
                        
                           
                              b
                              
                                 i
                                 j
                              
                           
                           =
                           0
                        
                      for (i, j)∉E):

                        
                           (1)
                           
                              
                                 
                                    
                                       
                                          maximize
                                          x
                                       
                                    
                                    
                                       
                                          
                                             
                                                ∑
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                m
                                             
                                             
                                                M
                                                i
                                             
                                             
                                                (
                                                
                                                   ∑
                                                   
                                                      j
                                                      =
                                                      1
                                                   
                                                   n
                                                
                                                
                                                   b
                                                   
                                                      i
                                                      j
                                                   
                                                
                                                
                                                   x
                                                   
                                                      i
                                                      j
                                                   
                                                
                                                )
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       s.t.
                                    
                                    
                                       
                                          
                                             
                                                ∑
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                m
                                             
                                             
                                                x
                                                
                                                   i
                                                   j
                                                
                                             
                                             ≤
                                             1
                                             ,
                                          
                                       
                                    
                                    
                                       
                                          ∀
                                          j
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          
                                             x
                                             
                                                i
                                                j
                                             
                                          
                                          ≥
                                          0
                                          ,
                                       
                                    
                                    
                                       
                                          ∀
                                          i
                                          ,
                                          j
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     where xij
                      denotes the fraction of vertex j that is matched to vertex i.
                        1
                     
                     
                        1
                        We allow fractional allocations in our model. However, our proposed algorithms output integer solutions. Thus all our results hold if one confines to integer solutions.
                      In (1), the coefficient 
                        
                           
                              b
                              j
                           
                           =
                           
                              
                                 {
                                 
                                    b
                                    
                                       i
                                       j
                                    
                                 
                                 }
                              
                              
                                 i
                                 =
                                 1
                              
                              m
                           
                        
                      is revealed only when vertex j arrives, and an irrevocable decision 
                        
                           
                              x
                              j
                           
                           =
                           
                              
                                 {
                                 
                                    x
                                    
                                       i
                                       j
                                    
                                 
                                 }
                              
                              
                                 i
                                 =
                                 1
                              
                              m
                           
                        
                      has to be made before observing the next input. For each i, Mi
                     (·) is a nondecreasing concave function with 
                        
                           
                              M
                              i
                           
                           
                              (
                              0
                              )
                           
                           =
                           0
                        
                     . In this paper, we assume that Mi
                     (·)s are continuously differentiable.

As mentioned earlier, online matching problems have a very important application in the online advertisement allocation problem, which we will later refer to as the Adwords problem. In the Adwords problem, there are m advertisers (which we also call the bidders). A sequence of n keywords are searched during a fixed time horizon. Based on the relevance of the keyword, the ith bidder would bid a certain amount bij
                      to show his advertisement on the result page of the jth keyword. The search engine’s decision is to allocate each keyword to one of the m bidders (we only consider a single allocation in this paper). Note that each allocation decision can only depend on the information earlier in the arrival sequence but not on any future data. As pointed out in Devanur and Jain (2012), there are several practical motivations for considering a concave function of the matched bids in the Adwords problem. Among them are convex penalty costs for under-delivery in search engine-advertiser contracts, the concavity of the click-through rate in the number of allocated bids observed in empirical data and fairness considerations. In each of the situations mentioned above, one can write the objective as a concave function. We refer the readers to Devanur and Jain (2012) for a more thorough review of the motivations for this problem. It is worth noting that there is a special case of this problem where 
                        
                           
                              M
                              i
                           
                           
                              (
                              x
                              )
                           
                           =
                           min
                           
                              {
                              x
                              ,
                              
                                 B
                                 i
                              
                              }
                           
                        
                     . In this case, one can view that the bidder has a budget Bi
                      and the revenue from each bidder is bounded by Bi
                     .

One important question when studying online algorithms is the assumptions on the input data. In this work, we adopt a random permutation model. More precisely, we assume:

                        
                           1.
                           The total number of arrivals 
                                 
                                    n
                                    =
                                    |
                                    J
                                    |
                                 
                               is known a priori.

The weights {bij
                              } can be adversarially chosen. However, the order that j arrives is uniformly distributed over all the permutations.

The random permutation model has been adopted in much recent literature in the study of online matching problems, see, e.g., Agrawal, Wang, and Ye (2014); Devanur and Hayes (2009); Feldman, Henzinger, Korula, Mirrokni, and Stein (2010), etc. It is equivalent to saying that a set of 
                        
                           B
                           =
                           {
                           
                              
                                 b
                                 ˜
                              
                              1
                           
                           ,
                           
                              
                                 b
                                 ˜
                              
                              2
                           
                           ,
                           …
                           ,
                           
                              
                                 b
                                 ˜
                              
                              n
                           
                           }
                        
                      is arbitrarily chosen beforehand (unknown to the decision maker). Then the arrivals 
                        
                           
                              b
                              1
                           
                           ,
                           
                              b
                              2
                           
                           ,
                           …
                           ,
                           
                              b
                              n
                           
                        
                      are drawn randomly without replacement from 
                        B
                     . The random permutation model is an intermediate path between using a worst-case analysis and assuming each input data is drawn independently and identically distributed (i.i.d.) from a certain distribution. On one hand, compared to the worst-case analysis (see, e.g., Buchbinder, Jain, & Naor, 2007; Devanur & Jain, 2012; Feldman, Korula, Mirrokni, Muthukrishnan, & Pal, 2009; Mehta, Saberi, Vazirani, & Vazirani, 2005), the random permutation model is practically reasonable yet much less conservative. On the other hand, the random permutation model is much less restrictive than assuming the inputs are drawn i.i.d. from a certain distribution (Devanur, 2011). Also, the assumption of the knowledge of n is necessary for any online algorithm to achieve near-optimal performance (see Devanur & Hayes, 2009). Therefore, for large problems with relatively stationary inputs, the random permutation model is a good approximation and the study of such models is of practical interest. Next we define the performance measure of an algorithm under the random permutation model:

                        Definition 1 (c-competitiveness)
                        
                           Let OPT be the optimal value for the offline problem (1). An online algorithm A is called c-competitive in the random permutation model if the expected value of the online solutions by using A is at least c times the optimal value of (1), that is

                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   E
                                                   σ
                                                
                                                
                                                   [
                                                   
                                                      ∑
                                                      
                                                         i
                                                         =
                                                         1
                                                      
                                                      m
                                                   
                                                   
                                                      M
                                                      i
                                                   
                                                   
                                                      (
                                                      
                                                         ∑
                                                         
                                                            j
                                                            =
                                                            1
                                                         
                                                         n
                                                      
                                                      
                                                         b
                                                         
                                                            i
                                                            j
                                                         
                                                      
                                                      
                                                         x
                                                         
                                                            i
                                                            j
                                                         
                                                      
                                                      
                                                         (
                                                         σ
                                                         ,
                                                         A
                                                         )
                                                      
                                                      )
                                                   
                                                   ]
                                                
                                                ≥
                                                c
                                                
                                                   O
                                                   P
                                                   T
                                                
                                                ,
                                             
                                          
                                       
                                    
                                 
                              
                           where the expectation is taken over uniformly random permutations σ of 
                              
                                 1
                                 ,
                                 …
                                 ,
                                 n
                                 ,
                              
                            and xij
                           (σ, A) is the ijth decision made by algorithm A when the inputs arrive in order σ.

In Devanur and Jain (2012), the authors propose an algorithm for the online matching problem with concave returns that has a constant competitive ratio under the worst-case model (the constant depends on the forms of each Mi
                     (·)). They also show that a constant competitive ratio is the best possible result under that model. In this paper, we propose an algorithm under the random permutation model, which achieves near-optimal performance under some conditions on the input.

Our main result is stated as follows:

                        Theorem 1
                        
                           Fix
                           
                              
                                 ϵ
                                 ∈
                                 (
                                 0
                                 ,
                                 1
                                 /
                                 2
                                 )
                              
                           
                           . There exists an algorithm (Algorithm DLA) that is
                           
                              
                                 1
                                 −
                                 ϵ
                              
                            
                           competitive for the online matching problem with concave returns Mi
                           (·)s under the random permutation model if
                           
                              
                                 (2)
                                 
                                    
                                       
                                          
                                             
                                                n
                                                ≥
                                                Ω
                                                
                                                   (
                                                   max
                                                   
                                                      {
                                                      
                                                         
                                                            log
                                                            
                                                               (
                                                               m
                                                               /
                                                               ϵ
                                                               )
                                                            
                                                         
                                                         
                                                            ϵ
                                                            
                                                               
                                                                  b
                                                                  ¯
                                                               
                                                               2
                                                            
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            
                                                               m
                                                               2
                                                            
                                                            log
                                                            
                                                               (
                                                               
                                                                  m
                                                                  2
                                                               
                                                               n
                                                               /
                                                               ϵ
                                                               )
                                                            
                                                            F
                                                            
                                                               (
                                                               M
                                                               ,
                                                               η
                                                               )
                                                            
                                                         
                                                         
                                                            
                                                               ϵ
                                                               3
                                                            
                                                            
                                                               b
                                                               ¯
                                                            
                                                         
                                                      
                                                      }
                                                   
                                                   )
                                                
                                                ,
                                             
                                          
                                       
                                    
                                 
                              
                           
                           where
                           
                              
                                 
                                    b
                                    ¯
                                 
                                 =
                                 
                                    1
                                    n
                                 
                                 
                                    min
                                    i
                                 
                                 
                                    {
                                    
                                       ∑
                                       
                                          j
                                          =
                                          1
                                       
                                       n
                                    
                                    
                                       b
                                       
                                          i
                                          j
                                       
                                    
                                    }
                                 
                                 ,
                              
                           
                           
                              
                                 η
                                 =
                                 
                                    
                                       
                                          min
                                          
                                             i
                                             ,
                                             j
                                          
                                       
                                       
                                          {
                                          
                                             b
                                             
                                                i
                                                j
                                             
                                          
                                          |
                                          
                                             b
                                             
                                                i
                                                j
                                             
                                          
                                          >
                                          0
                                          }
                                       
                                    
                                    
                                       
                                          max
                                          
                                             i
                                             ,
                                             j
                                          
                                       
                                       
                                          b
                                          
                                             i
                                             j
                                          
                                       
                                    
                                 
                                 ,
                              
                            
                           and F(M, η) is a constant that only depends on each Mi
                           (·) and η.
                        

In condition (2), 
                        
                           b
                           ¯
                        
                      can be viewed as the average bid value of a bidder over time. Given that each bidder is at least interested in some fractions of the keywords, this average will go to a certain constant as n becomes large. Also, η can be viewed as the ratio between the value of the smallest non-zero bid and the highest bid. In practice, this is often bounded below by a constant by enforcing a reserve price and a maximum price for any single bid. The exact functional form of F(M, η) is somewhat complicated, and is given in Proposition 1. Just to give an example, if we choose 
                        
                           
                              M
                              i
                           
                           
                              (
                              x
                              )
                           
                           =
                           
                              x
                              p
                           
                        
                      (0 < p < 1), then 
                        
                           F
                           
                              (
                              M
                              ,
                              η
                              )
                           
                           =
                           
                              2
                              
                                 η
                                 
                                    (
                                    2
                                    −
                                    p
                                    )
                                    /
                                    (
                                    1
                                    −
                                    p
                                    )
                                 
                              
                           
                        
                     . Therefore, condition (2) can be viewed as simply requiring the total number of inputs is large, which is often the case in practice. For example, in the Adwords problem, n is the number of keyword searches in a certain period, and for instance, Google receives more than 5 billion searches per day. Even if we focus on a specific category, the number can still be in the millions. Thus, this condition is reasonable. We note that most learning algorithms in the literature make similar requirements, see Agrawal et al. (2014); Devanur and Hayes (2009), and Molinaro and Ravi (2014). Furthermore, as we will show in our numerical tests, our algorithm performs well even for problems with sizes that are significantly smaller than the condition requires, which validates the potential usefulness of our algorithm.

To propose an algorithm that achieves near-optimal performance, the main idea is to utilize the observed data in the allocation process. In particular, since the input data arrives in a random order, using the past input data and projecting it into the future should present a good approximation for the problem. To mathematically capture this idea, we use a primal-dual approach. We obtain the dual optimal solutions to suitably constructed optimization problems and use them to assist with future allocations. We first propose a one-time learning algorithm (OLA, see Section 2) that only solves an optimization problem once at time 
                        
                           ϵ
                           n
                        
                     . By carefully examining this algorithm, we prove that it achieves near-optimal performance when the inputs satisfy certain conditions. However, the conditions are stronger than those stated in Theorem 1. To improve our algorithm, we further propose a dynamic learning algorithm (DLA, see Section 3). The dynamic learning algorithm makes better use of the observed data and updates the dual solution at a geometric pace, that is, at time 
                        
                           ϵ
                           n
                           ,
                        
                     
                     
                        
                           2
                           ϵ
                           n
                           ,
                        
                     
                     
                        
                           4
                           ϵ
                           n
                        
                      and so on. We show that these resolvings can lift the performance of the algorithm and thus prove Theorem 1. As one will see in the proof of the DLA, the choice of the resolving points perfectly balances the trade-off between exploration and exploitation, which are the main trade-offs in such types of learning algorithms.

It is worth mentioning that a similar kind of dynamic learning algorithm has been proposed in Agrawal et al. (2014) and further studied in Wang (2012) and Molinaro and Ravi (2014). However, those works only focus on linear objectives. In our analysis, the nonlinearity of the objective function presents a non-trivial hurdle since one can no longer simply analyze the revenue generated in each time segment and add them together. In this paper, we successfully work around this hurdle by a convex duality argument. We believe that our analysis is a non-trivial extension of the previous work. Moreover, the problem solved has important applications.

The remainder of the paper is organized as follows. In Section 2, we start with a one-time learning algorithm and prove that it achieves near-optimal performance under some mild conditions on the input. The one-time learning algorithm is easy to understand and shows important insights for designing this class of learning algorithms. However, it only achieves a weaker performance than what is stated in Theorem 1. In Section 3, we propose a dynamic learning algorithm which makes better use of the data and has a stronger performance. Some numerical test results of our algorithm are presented in Section 4, which validate the strength of our algorithm. Section 5 concludes this paper.

We first rewrite the offline problem (1) as follows:

                        
                           (3)
                           
                              
                                 
                                    
                                       
                                          maximize
                                          
                                             x
                                             ,
                                             u
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                ∑
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                m
                                             
                                             
                                                M
                                                i
                                             
                                             
                                                (
                                                
                                                   u
                                                   i
                                                
                                                )
                                             
                                          
                                       
                                    
                                    
                                       
                                    
                                 
                                 
                                    
                                       s.t.
                                    
                                    
                                       
                                          
                                             
                                                ∑
                                                
                                                   j
                                                   =
                                                   1
                                                
                                                n
                                             
                                             
                                                b
                                                
                                                   i
                                                   j
                                                
                                             
                                             
                                                x
                                                
                                                   i
                                                   j
                                                
                                             
                                             =
                                             
                                                u
                                                i
                                             
                                             ,
                                          
                                       
                                    
                                    
                                       
                                          ∀
                                          i
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          
                                             
                                                ∑
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                m
                                             
                                             
                                                x
                                                
                                                   i
                                                   j
                                                
                                             
                                             ≤
                                             1
                                             ,
                                          
                                       
                                    
                                    
                                       
                                          ∀
                                          j
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          
                                             x
                                             
                                                i
                                                j
                                             
                                          
                                          ≥
                                          0
                                          ,
                                       
                                    
                                    
                                       
                                          ∀
                                          i
                                          ,
                                          j
                                          .
                                       
                                    
                                 
                              
                           
                        
                     We define the following dual problem:

                        
                           (4)
                           
                              
                                 
                                    
                                       
                                          inf
                                          
                                             v
                                             ,
                                             y
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                ∑
                                                
                                                   j
                                                   =
                                                   1
                                                
                                                n
                                             
                                             
                                                y
                                                j
                                             
                                             +
                                             
                                                ∑
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                m
                                             
                                             
                                                (
                                                
                                                   M
                                                   i
                                                
                                                
                                                   (
                                                   
                                                      v
                                                      i
                                                   
                                                   )
                                                
                                                −
                                                
                                                   M
                                                   i
                                                   ′
                                                
                                                
                                                   (
                                                   
                                                      v
                                                      i
                                                   
                                                   )
                                                
                                                
                                                   v
                                                   i
                                                
                                                )
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       s.t.
                                    
                                    
                                       
                                          
                                             y
                                             j
                                          
                                          ≥
                                          
                                             b
                                             
                                                i
                                                j
                                             
                                          
                                          
                                             M
                                             i
                                             ′
                                          
                                          
                                             (
                                             
                                                v
                                                i
                                             
                                             )
                                          
                                          ,
                                          
                                          
                                          ∀
                                          i
                                          ,
                                          j
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          
                                             v
                                             i
                                          
                                          ≥
                                          0
                                          ,
                                          
                                          
                                          ∀
                                          i
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          
                                             y
                                             j
                                          
                                          ≥
                                          0
                                          ,
                                          
                                          
                                          ∀
                                          j
                                          .
                                       
                                    
                                 
                              
                           
                        
                     Let the optimal value of (3) be P
                     * and the optimal value of (4) be D
                     *. In Devanur and Jain (2012), the authors proved the weak duality between (3) and (4). In the following lemma, we prove that in fact the strong duality holds. The proof of the lemma is relegated to the Appendix.

                        Lemma 1
                        
                           
                              
                                 
                                    P
                                    *
                                 
                                 =
                                 
                                    D
                                    *
                                 
                              
                           
                           . Furthermore, the objective value of any feasible solution to (
                           
                              4
                           
                           ) is an upper bound of P
                           *
                           .
                        

Before we describe our algorithm, we define the following partial optimization problem:

                        
                           (5)
                           
                              
                                 
                                    
                                       
                                          (
                                          
                                             P
                                             ϵ
                                          
                                          )
                                       
                                    
                                    
                                       
                                          maximize
                                          
                                             x
                                             ,
                                             u
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                ∑
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                m
                                             
                                             
                                                M
                                                i
                                             
                                             
                                                (
                                                
                                                   u
                                                   i
                                                
                                                )
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                       s.t.
                                    
                                    
                                       
                                          
                                             
                                                ∑
                                                
                                                   j
                                                   =
                                                   1
                                                
                                                
                                                   ϵ
                                                   n
                                                
                                             
                                             
                                                
                                                   b
                                                   
                                                      i
                                                      j
                                                   
                                                
                                                ϵ
                                             
                                             
                                                x
                                                
                                                   i
                                                   j
                                                
                                             
                                             =
                                             
                                                u
                                                i
                                             
                                             ,
                                          
                                       
                                    
                                    
                                       
                                          ∀
                                          i
                                       
                                    
                                 
                                 
                                    
                                    
                                    
                                       
                                          
                                             
                                                ∑
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                m
                                             
                                             
                                                x
                                                
                                                   i
                                                   j
                                                
                                             
                                             ≤
                                             1
                                             ,
                                          
                                       
                                    
                                    
                                       
                                          ∀
                                          j
                                       
                                    
                                 
                                 
                                    
                                    
                                    
                                       
                                          
                                             x
                                             
                                                i
                                                j
                                             
                                          
                                          ≥
                                          0
                                          ,
                                       
                                    
                                    
                                       
                                          ∀
                                          i
                                          ,
                                          j
                                          .
                                       
                                    
                                 
                              
                           
                        
                     Now we define the one-time learning in Algorithm 1.


                     
                        
                           
                        
                     
                  

Now we provide some intuition for the algorithm. The idea of the algorithm is to use the first 
                        
                           ϵ
                           n
                        
                      inputs to learn an approximate 
                        
                           u
                           ^
                        
                      and then use it to make all the future allocations based on the complementarity conditions between the primal and dual problems ((3) and (4)). Here 
                        
                           u
                           ^
                        
                      is solved from (
                        
                           P
                           ϵ
                        
                     ) which projects the allocation in the first 
                        
                           ϵ
                           n
                        
                      inputs to the entire problem. The decision rule in (6) can be explained as choosing the i with the highest product of the nominal bid value bij
                      and the marginal contribution rate to the total projected reward 
                        
                           
                              M
                              i
                              ′
                           
                           
                              (
                              
                                 u
                                 ^
                              
                              )
                           
                        
                     . Note that a similar idea has been used to construct algorithms for an online matching problem with linear objective functions (see e.g., Agrawal et al., 2014; Devanur & Hayes, 2009; Molinaro & Ravi, 2014). However, the analyses of those algorithms all depend on the linearity of the objective function which we do not possess in this problem. Instead, an analysis with the use of concavity is required in our analysis, making it quite different from those in the prior literature. In the following, we assume without loss of generality that max 
                        i, j
                     
                     bij
                      ≤ 1 (we can always scale the inputs to make this hold). We also make a technical assumption as follows:

                        Assumption 1
                        The inputs of the problem are in a general position. That is, for any vector 
                              
                                 p
                                 =
                                 (
                                 
                                    p
                                    1
                                 
                                 ,
                                 …
                                 ,
                                 
                                    p
                                    m
                                 
                                 )
                                 ≠
                                 0
                                 ,
                              
                            there are at most m terms among argmax 
                              i
                           {bijpi
                           }, 
                              
                                 j
                                 =
                                 1
                                 ,
                                 …
                                 ,
                                 n
                                 ,
                              
                            that are not singleton sets.

The assumption says that we only need to break ties in (6) no more than m times. This assumption is not necessarily true for all inputs. However, as pointed out by Devanur and Hayes (2009) and Agrawal et al. (2014), one can always perturb bij
                      by adding a random variable ηij
                      taking uniform distribution on [0, η] for some very small η. By doing so the assumption holds with probability one and the effect to the solution can be made arbitrarily small. Given this assumption and by the complementarity conditions, we have the following lemma, whose proof is in the Appendix.

                        Lemma 2
                        
                           
                              
                                 
                                    
                                       ϵ
                                       
                                          
                                             u
                                             ^
                                          
                                          i
                                       
                                       −
                                       m
                                       ≤
                                       
                                          ∑
                                          
                                             j
                                             =
                                             1
                                          
                                          
                                             ϵ
                                             n
                                          
                                       
                                       
                                          b
                                          
                                             i
                                             j
                                          
                                       
                                       
                                          x
                                          i
                                       
                                       
                                          (
                                          
                                             u
                                             ^
                                          
                                          ,
                                          
                                             b
                                             j
                                          
                                          )
                                       
                                       ≤
                                       ϵ
                                       
                                          
                                             u
                                             ^
                                          
                                          i
                                       
                                       +
                                       m
                                       .
                                    
                                 
                              
                           
                        

We first prove the following proposition about the performance of the OLA, which relies on a condition of the solution to (
                        
                           P
                           ϵ
                        
                     ).

                        Proposition 1
                        
                           For any given
                           
                              
                                 ϵ
                                 ∈
                                 (
                                 0
                                 ,
                                 1
                                 /
                                 2
                                 )
                                 ,
                              
                            
                           if
                           
                              
                                 
                                    min
                                    i
                                 
                                 
                                    
                                       u
                                       ^
                                    
                                    i
                                 
                                 ≥
                                 Ω
                                 
                                    (
                                    
                                       
                                          m
                                          log
                                          
                                             (
                                             
                                                m
                                                2
                                             
                                             n
                                             /
                                             ϵ
                                             )
                                          
                                       
                                       
                                          ϵ
                                          3
                                       
                                    
                                    )
                                 
                                 ,
                              
                            
                           then the OLA is a
                           
                              
                                 1
                                 −
                                 ϵ
                              
                           
                           -competitive algorithm.
                        

Before we prove Proposition 1, we define some notation.

                        
                           •
                           We define the optimal offline solution to (3) by (
                                 x
                              
                              *, 
                                 u
                              
                              *) with optimal value OPT.

Define 
                                 
                                    
                                       ∑
                                       
                                          j
                                          =
                                          1
                                       
                                       n
                                    
                                    
                                       b
                                       
                                          i
                                          j
                                       
                                    
                                    
                                       x
                                       i
                                    
                                    
                                       (
                                       
                                          u
                                          ^
                                       
                                       ,
                                       
                                          b
                                          j
                                       
                                       )
                                    
                                    =
                                    
                                       
                                          u
                                          ¯
                                       
                                       i
                                    
                                    ,
                                 
                               note that 
                                 
                                    
                                       u
                                       ¯
                                    
                                    i
                                 
                               normally does not equal 
                                 
                                    
                                       u
                                       ^
                                    
                                    i
                                 
                              .

We show the following lemma:

                        Lemma 3
                        
                           For any given
                           
                              
                                 ϵ
                                 ∈
                                 (
                                 0
                                 ,
                                 1
                                 /
                                 2
                                 )
                                 ,
                              
                            
                           if
                           
                              
                                 
                                    min
                                    i
                                 
                                 
                                    
                                       u
                                       ^
                                    
                                    i
                                 
                                 ≥
                                 
                                    
                                       12
                                       m
                                       log
                                       
                                          (
                                          
                                             m
                                             2
                                          
                                          n
                                          /
                                          ϵ
                                          )
                                       
                                    
                                    
                                       ϵ
                                       3
                                    
                                 
                                 ,
                              
                            
                           then with probability
                           
                              
                                 1
                                 −
                                 ϵ
                                 ,
                              
                           
                           
                              
                                 (7)
                                 
                                    
                                       
                                          
                                             
                                                
                                                   (
                                                   1
                                                   −
                                                   ϵ
                                                   )
                                                
                                                
                                                   
                                                      u
                                                      ^
                                                   
                                                   i
                                                
                                                ≤
                                                
                                                   
                                                      u
                                                      ¯
                                                   
                                                   i
                                                
                                                ≤
                                                
                                                   (
                                                   1
                                                   +
                                                   ϵ
                                                   )
                                                
                                                
                                                   
                                                      u
                                                      ^
                                                   
                                                   i
                                                
                                                ,
                                                
                                                for
                                                
                                                all
                                                
                                                i
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           
                        

The proof will proceed as follows: For any fixed 
                              
                                 
                                    u
                                    ^
                                 
                                 ,
                              
                            we define that a random sample (the first 
                              
                                 ϵ
                                 n
                              
                            arrivals) S is bad for this 
                              
                                 u
                                 ^
                              
                            if and only if 
                              
                                 u
                                 ^
                              
                            is the optimal solution to (5) for this S, but 
                              
                                 
                                    
                                       u
                                       ¯
                                    
                                    i
                                 
                                 <
                                 
                                    (
                                    1
                                    −
                                    ϵ
                                    )
                                 
                                 
                                    
                                       u
                                       ^
                                    
                                    i
                                 
                                 ,
                              
                            or 
                              
                                 
                                    
                                       u
                                       ¯
                                    
                                    i
                                 
                                 >
                                 
                                    (
                                    1
                                    +
                                    ϵ
                                    )
                                 
                                 
                                    
                                       u
                                       ^
                                    
                                    i
                                 
                                 ,
                              
                            for some i. First, we show that the probability of a bad sample is small for every fixed 
                              
                                 u
                                 ^
                              
                            (satisfying 
                              
                                 
                                    min
                                    i
                                 
                                 
                                    
                                       u
                                       ^
                                    
                                    i
                                 
                                 ≥
                                 
                                    
                                       12
                                       m
                                       log
                                       
                                          (
                                          
                                             m
                                             2
                                          
                                          n
                                          /
                                          ϵ
                                          )
                                       
                                    
                                    
                                       ϵ
                                       3
                                    
                                 
                              
                           ) and i. Then, we take a union bound over all distinct i and 
                              
                                 
                                    u
                                    ^
                                 
                                 i
                              
                           s to prove the lemma.

To start with, we fix 
                              
                                 u
                                 ^
                              
                            and i. Define 
                              
                                 
                                    Y
                                    j
                                 
                                 =
                                 
                                    b
                                    
                                       i
                                       j
                                    
                                 
                                 
                                    x
                                    i
                                 
                                 
                                    (
                                    
                                       u
                                       ^
                                    
                                    ,
                                    
                                       b
                                       j
                                    
                                    )
                                 
                              
                           . By Lemma 2 and the condition on 
                              
                                 
                                    
                                       u
                                       ^
                                    
                                    i
                                 
                                 ,
                              
                            we have

                              
                                 
                                    
                                       
                                          (
                                          1
                                          −
                                          
                                             ϵ
                                             2
                                          
                                          )
                                       
                                       ϵ
                                       
                                          
                                             u
                                             ^
                                          
                                          i
                                       
                                       ≤
                                       ϵ
                                       
                                          
                                             u
                                             ^
                                          
                                          i
                                       
                                       −
                                       m
                                       ≤
                                       
                                          ∑
                                          
                                             j
                                             ∈
                                             S
                                          
                                       
                                       
                                          Y
                                          j
                                       
                                       ≤
                                       ϵ
                                       
                                          
                                             u
                                             ^
                                          
                                          i
                                       
                                       +
                                       m
                                       ≤
                                       
                                          (
                                          1
                                          +
                                          
                                             ϵ
                                             2
                                          
                                          )
                                       
                                       ϵ
                                       
                                          
                                             u
                                             ^
                                          
                                          i
                                       
                                       .
                                    
                                 
                              
                           Therefore, the probability of bad S is bounded by the sum of the following two terms (
                              
                                 N
                                 =
                                 {
                                 1
                                 ,
                                 2
                                 ,
                                 …
                                 ,
                                 n
                                 }
                              
                           ):

                              
                                 (8)
                                 
                                    
                                       
                                          
                                          
                                          
                                             
                                                P
                                                
                                                   (
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         S
                                                      
                                                   
                                                   
                                                      Y
                                                      j
                                                   
                                                   ≤
                                                   ϵ
                                                   
                                                      (
                                                      1
                                                      +
                                                      
                                                         ϵ
                                                         2
                                                      
                                                      )
                                                   
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                   
                                                   ,
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         N
                                                      
                                                   
                                                   
                                                      Y
                                                      j
                                                   
                                                   >
                                                   
                                                      (
                                                      1
                                                      +
                                                      ϵ
                                                      )
                                                   
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                   
                                                   )
                                                
                                             
                                          
                                       
                                       
                                          
                                          
                                          
                                             
                                                
                                                +
                                                P
                                                
                                                   (
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         S
                                                      
                                                   
                                                   
                                                      Y
                                                      j
                                                   
                                                   ≥
                                                   ϵ
                                                   
                                                      (
                                                      1
                                                      −
                                                      
                                                         ϵ
                                                         2
                                                      
                                                      )
                                                   
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                   
                                                   ,
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         N
                                                      
                                                   
                                                   
                                                      Y
                                                      j
                                                   
                                                   <
                                                   
                                                      (
                                                      1
                                                      −
                                                      ϵ
                                                      )
                                                   
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                   
                                                   )
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           For the first term, we first define 
                              
                                 
                                    Z
                                    t
                                 
                                 =
                                 
                                    
                                       
                                          (
                                          1
                                          +
                                          ϵ
                                          )
                                       
                                       
                                          
                                             u
                                             ^
                                          
                                          i
                                       
                                       
                                          Y
                                          t
                                       
                                    
                                    
                                       
                                          ∑
                                          
                                             j
                                             ∈
                                             N
                                          
                                       
                                       
                                          Y
                                          j
                                       
                                    
                                 
                              
                            and we have

                              
                                 
                                    
                                       
                                          
                                          
                                          
                                             
                                                P
                                                
                                                   (
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         S
                                                      
                                                   
                                                   
                                                      Y
                                                      j
                                                   
                                                   ≤
                                                   ϵ
                                                   
                                                      (
                                                      1
                                                      +
                                                      
                                                         ϵ
                                                         2
                                                      
                                                      )
                                                   
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                   
                                                   ,
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         N
                                                      
                                                   
                                                   
                                                      Y
                                                      j
                                                   
                                                   >
                                                   
                                                      (
                                                      1
                                                      +
                                                      ϵ
                                                      )
                                                   
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                   
                                                   )
                                                
                                             
                                          
                                       
                                       
                                          
                                          
                                          
                                             
                                                
                                                ≤
                                                P
                                                
                                                   (
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         S
                                                      
                                                   
                                                   
                                                      Z
                                                      j
                                                   
                                                   ≤
                                                   ϵ
                                                   
                                                      (
                                                      1
                                                      +
                                                      
                                                         ϵ
                                                         2
                                                      
                                                      )
                                                   
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                   
                                                   ,
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         N
                                                      
                                                   
                                                   
                                                      Z
                                                      j
                                                   
                                                   =
                                                   
                                                      (
                                                      1
                                                      +
                                                      ϵ
                                                      )
                                                   
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                   
                                                   )
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           Then we have

                              
                                 
                                    
                                       
                                          
                                          
                                          
                                             
                                                P
                                                
                                                   (
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         S
                                                      
                                                   
                                                   
                                                      Z
                                                      j
                                                   
                                                   ≤
                                                   ϵ
                                                   
                                                      (
                                                      1
                                                      +
                                                      
                                                         ϵ
                                                         2
                                                      
                                                      )
                                                   
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                   
                                                   ,
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         N
                                                      
                                                   
                                                   
                                                      Z
                                                      j
                                                   
                                                   =
                                                   
                                                      (
                                                      1
                                                      +
                                                      ϵ
                                                      )
                                                   
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                   
                                                   )
                                                
                                             
                                          
                                       
                                       
                                          
                                          
                                          
                                             
                                                
                                                ≤
                                                P
                                                
                                                   (
                                                   
                                                      |
                                                   
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         S
                                                      
                                                   
                                                   
                                                      Z
                                                      j
                                                   
                                                   −
                                                   ϵ
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         N
                                                      
                                                   
                                                   
                                                      Z
                                                      j
                                                   
                                                   
                                                      |
                                                      >
                                                   
                                                   
                                                      
                                                         
                                                            ϵ
                                                         
                                                         2
                                                      
                                                      2
                                                   
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                   
                                                   ,
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         N
                                                      
                                                   
                                                   
                                                      Z
                                                      j
                                                   
                                                   =
                                                   
                                                      (
                                                      1
                                                      +
                                                      ϵ
                                                      )
                                                   
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                   
                                                   )
                                                
                                             
                                          
                                       
                                       
                                          
                                          
                                          
                                             
                                                
                                                ≤
                                                P
                                                
                                                   (
                                                   
                                                      |
                                                   
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         S
                                                      
                                                   
                                                   
                                                      Z
                                                      j
                                                   
                                                   −
                                                   ϵ
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         N
                                                      
                                                   
                                                   
                                                      Z
                                                      j
                                                   
                                                   
                                                      |
                                                      >
                                                   
                                                   
                                                      
                                                         
                                                            ϵ
                                                         
                                                         2
                                                      
                                                      2
                                                   
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                   
                                                   
                                                      |
                                                      
                                                         ∑
                                                         
                                                            j
                                                            ∈
                                                            N
                                                         
                                                      
                                                      
                                                         Z
                                                         j
                                                      
                                                      =
                                                      
                                                         (
                                                         1
                                                         +
                                                         ϵ
                                                         )
                                                      
                                                      
                                                         
                                                            u
                                                            ^
                                                         
                                                         i
                                                      
                                                   
                                                   )
                                                
                                             
                                          
                                       
                                       
                                          
                                          
                                          
                                             
                                                
                                                ≤
                                                2
                                                exp
                                                
                                                   (
                                                   −
                                                   
                                                      
                                                         
                                                            ϵ
                                                            3
                                                         
                                                         
                                                            
                                                               u
                                                               ^
                                                            
                                                            i
                                                         
                                                      
                                                      
                                                         4
                                                         (
                                                         2
                                                         +
                                                         ϵ
                                                         )
                                                      
                                                   
                                                   )
                                                
                                                ≤
                                                
                                                   ϵ
                                                   
                                                      2
                                                      m
                                                      
                                                         
                                                            (
                                                            
                                                               m
                                                               2
                                                            
                                                            n
                                                            )
                                                         
                                                         m
                                                      
                                                   
                                                
                                                ≐
                                                δ
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           Here the second inequality follows from the Hoeffding–Bernstein’s inequality for sampling without replacement, see Lemma 8 in the Appendix. Similarly, we can get the same result for the second term in (8), which is also bounded by δ. Therefore, the probability of a bad sample is bounded by 2δ for fixed 
                              
                                 u
                                 ^
                              
                            and i.

Next, we take a union bound over all distinct 
                              
                                 u
                                 ^
                              
                           s. We call 
                              
                                 u
                                 ^
                              
                            and 
                              
                                 
                                    u
                                    ^
                                 
                                 ′
                              
                            
                           distinct if and only if they result in different allocations, i.e., 
                              
                                 
                                    x
                                    i
                                 
                                 
                                    (
                                    
                                       u
                                       ^
                                    
                                    ,
                                    
                                       b
                                       j
                                    
                                    )
                                 
                                 ≠
                                 
                                    x
                                    i
                                 
                                 
                                    (
                                    
                                       
                                          u
                                          ^
                                       
                                       ′
                                    
                                    ,
                                    
                                       b
                                       j
                                    
                                    )
                                 
                              
                            for some i, j. Denote 
                              
                                 
                                    M
                                    i
                                    ′
                                 
                                 
                                    (
                                    
                                       
                                          u
                                          ^
                                       
                                       i
                                    
                                    )
                                 
                                 =
                                 
                                    v
                                    i
                                 
                              
                           . For each j, by the definition in (6), the allocation is uniquely defined by the signs of the following terms:

                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   b
                                                   
                                                      i
                                                      j
                                                   
                                                
                                                
                                                   v
                                                   i
                                                
                                                −
                                                
                                                   b
                                                   
                                                      
                                                         i
                                                         ′
                                                      
                                                      j
                                                   
                                                
                                                
                                                   v
                                                   
                                                      i
                                                      ′
                                                   
                                                
                                                ,
                                                
                                                ∀
                                                1
                                                ≤
                                                i
                                                <
                                                
                                                   i
                                                   ′
                                                
                                                ≤
                                                m
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           There are 
                              
                                 m
                                 (
                                 m
                                 −
                                 1
                                 )
                                 /
                                 2
                              
                            such terms for each j. Therefore, the entire allocation profiles for all the n arrivals can be determined by the signs of no more than m
                           2
                           n differences. Now we find out how many different allocation profiles can arise by choosing different vs. By Orlik and Terao (1992), the total number of different profiles for the m
                           2
                           n differences cannot exceed (m
                           2
                           n)
                              m
                           . Therefore, the number of distinct 
                              
                                 u
                                 ^
                              
                           s is no more than (m
                           2
                           n)
                              m
                           . Now we take a union bound over all distinct 
                              
                                 u
                                 ^
                              
                           s and 
                              
                                 i
                                 =
                                 1
                                 ,
                                 ⋯
                                 ,
                                 m
                                 ,
                              
                            and Lemma 3
follows.□

Next we show that the OLA achieves a near-optimal solution under the condition in Proposition 1. We first construct a feasible solution to (4):

                        
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                v
                                                ^
                                             
                                             i
                                          
                                          =
                                          
                                             
                                                u
                                                ^
                                             
                                             i
                                          
                                          ,
                                          
                                          
                                          
                                             
                                                y
                                                ^
                                             
                                             j
                                          
                                          =
                                          
                                             max
                                             i
                                          
                                          
                                             {
                                             
                                                b
                                                
                                                   i
                                                   j
                                                
                                             
                                             
                                                M
                                                i
                                                ′
                                             
                                             
                                                (
                                                
                                                   
                                                      u
                                                      ^
                                                   
                                                   i
                                                
                                                )
                                             
                                             }
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     By Lemma 4, 
                        
                           
                              ∑
                              
                                 j
                                 =
                                 1
                              
                              n
                           
                           
                              
                                 y
                                 ^
                              
                              j
                           
                           +
                           
                              ∑
                              
                                 i
                                 =
                                 1
                              
                              m
                           
                           
                              (
                              
                                 M
                                 i
                              
                              
                                 (
                                 
                                    
                                       u
                                       ^
                                    
                                    i
                                 
                                 )
                              
                              −
                              
                                 M
                                 i
                                 ′
                              
                              
                                 (
                                 
                                    
                                       u
                                       ^
                                    
                                    i
                                 
                                 )
                              
                              
                                 
                                    u
                                    ^
                                 
                                 i
                              
                              )
                           
                        
                      is an upper bound of OPT. Thus, we have

                        
                           
                              
                                 
                                    
                                       
                                          
                                             O
                                             P
                                             T
                                          
                                          −
                                          
                                             ∑
                                             
                                                i
                                                =
                                                1
                                             
                                             m
                                          
                                          
                                             M
                                             i
                                          
                                          
                                             (
                                             
                                                
                                                   u
                                                   ¯
                                                
                                                i
                                             
                                             )
                                          
                                       
                                    
                                    
                                       ≤
                                    
                                    
                                       
                                          
                                             ∑
                                             
                                                i
                                                =
                                                1
                                             
                                             m
                                          
                                          
                                             (
                                             
                                                M
                                                i
                                             
                                             
                                                (
                                                
                                                   
                                                      u
                                                      ^
                                                   
                                                   i
                                                
                                                )
                                             
                                             −
                                             
                                                
                                                   u
                                                   ^
                                                
                                                i
                                             
                                             
                                                M
                                                i
                                                ′
                                             
                                             
                                                (
                                                
                                                   
                                                      u
                                                      ^
                                                   
                                                   i
                                                
                                                )
                                             
                                             )
                                          
                                          −
                                          
                                             ∑
                                             
                                                i
                                                =
                                                1
                                             
                                             m
                                          
                                          
                                             M
                                             i
                                          
                                          
                                             (
                                             
                                                
                                                   u
                                                   ¯
                                                
                                                i
                                             
                                             )
                                          
                                          +
                                          
                                             ∑
                                             
                                                j
                                                =
                                                1
                                             
                                             n
                                          
                                          
                                             
                                                y
                                                ^
                                             
                                             j
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                       =
                                    
                                    
                                       
                                          
                                             ∑
                                             
                                                i
                                                =
                                                1
                                             
                                             m
                                          
                                          
                                             (
                                             
                                                M
                                                i
                                             
                                             
                                                (
                                                
                                                   
                                                      u
                                                      ^
                                                   
                                                   i
                                                
                                                )
                                             
                                             −
                                             
                                                M
                                                i
                                             
                                             
                                                (
                                                
                                                   
                                                      u
                                                      ¯
                                                   
                                                   i
                                                
                                                )
                                             
                                             )
                                          
                                          +
                                          
                                             ∑
                                             
                                                i
                                                =
                                                1
                                             
                                             m
                                          
                                          
                                             (
                                          
                                          
                                             
                                                u
                                                ¯
                                             
                                             i
                                          
                                          
                                             M
                                             i
                                             ′
                                          
                                          
                                             (
                                             
                                                
                                                   u
                                                   ^
                                                
                                                i
                                             
                                             )
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                    
                                       
                                          −
                                          
                                             
                                                u
                                                ^
                                             
                                             i
                                          
                                          
                                             M
                                             i
                                             ′
                                          
                                          
                                             (
                                             
                                                
                                                   u
                                                   ^
                                                
                                                i
                                             
                                             )
                                          
                                          
                                             )
                                             −
                                          
                                          
                                             ∑
                                             
                                                i
                                                =
                                                1
                                             
                                             m
                                          
                                          
                                             
                                                u
                                                ¯
                                             
                                             i
                                          
                                          
                                             M
                                             i
                                             ′
                                          
                                          
                                             (
                                             
                                                
                                                   u
                                                   ^
                                                
                                                i
                                             
                                             )
                                          
                                          +
                                          
                                             ∑
                                             
                                                j
                                                =
                                                1
                                             
                                             n
                                          
                                          
                                             
                                                y
                                                ^
                                             
                                             j
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                       =
                                    
                                    
                                       
                                          
                                             ∑
                                             
                                                i
                                                =
                                                1
                                             
                                             m
                                          
                                          
                                             (
                                             
                                                M
                                                i
                                             
                                             
                                                (
                                                
                                                   
                                                      u
                                                      ^
                                                   
                                                   i
                                                
                                                )
                                             
                                             −
                                             
                                                M
                                                i
                                             
                                             
                                                (
                                                
                                                   
                                                      u
                                                      ¯
                                                   
                                                   i
                                                
                                                )
                                             
                                             +
                                             
                                                (
                                                
                                                   
                                                      u
                                                      ¯
                                                   
                                                   i
                                                
                                                −
                                                
                                                   
                                                      u
                                                      ^
                                                   
                                                   i
                                                
                                                )
                                             
                                             
                                                M
                                                i
                                                ′
                                             
                                             
                                                (
                                                
                                                   
                                                      u
                                                      ^
                                                   
                                                   i
                                                
                                                )
                                             
                                             )
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     where the last equality is because by the allocation rule (6):

                        
                           
                              
                                 
                                    
                                       
                                          
                                             ∑
                                             
                                                j
                                                =
                                                1
                                             
                                             n
                                          
                                          
                                             
                                                y
                                                ^
                                             
                                             j
                                          
                                          =
                                          
                                             ∑
                                             
                                                i
                                                =
                                                1
                                             
                                             m
                                          
                                          
                                             ∑
                                             
                                                j
                                                =
                                                1
                                             
                                             n
                                          
                                          
                                             x
                                             i
                                          
                                          
                                             (
                                             
                                                u
                                                ^
                                             
                                             ,
                                             
                                                b
                                                j
                                             
                                             )
                                          
                                          
                                             b
                                             
                                                i
                                                j
                                             
                                          
                                          
                                             M
                                             i
                                             ′
                                          
                                          
                                             (
                                             
                                                
                                                   u
                                                   ^
                                                
                                                i
                                             
                                             )
                                          
                                          =
                                          
                                             ∑
                                             
                                                i
                                                =
                                                1
                                             
                                             m
                                          
                                          
                                             
                                                u
                                                ¯
                                             
                                             i
                                          
                                          
                                             M
                                             i
                                             ′
                                          
                                          
                                             (
                                             
                                                
                                                   u
                                                   ^
                                                
                                                i
                                             
                                             )
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     
                  

Now, we claim that if condition (7) holds,

                        
                           
                              
                                 
                                    
                                       
                                          
                                             ∑
                                             
                                                i
                                                =
                                                1
                                             
                                             m
                                          
                                          
                                             (
                                             
                                                M
                                                i
                                             
                                             
                                                (
                                                
                                                   
                                                      u
                                                      ^
                                                   
                                                   i
                                                
                                                )
                                             
                                             −
                                             
                                                M
                                                i
                                             
                                             
                                                (
                                                
                                                   
                                                      u
                                                      ¯
                                                   
                                                   i
                                                
                                                )
                                             
                                             +
                                             
                                                (
                                                
                                                   
                                                      u
                                                      ¯
                                                   
                                                   i
                                                
                                                −
                                                
                                                   
                                                      u
                                                      ^
                                                   
                                                   i
                                                
                                                )
                                             
                                             
                                                M
                                                i
                                                ′
                                             
                                             
                                                (
                                                
                                                   
                                                      u
                                                      ^
                                                   
                                                   i
                                                
                                                )
                                             
                                             )
                                          
                                          ≤
                                          2
                                          ϵ
                                          
                                             ∑
                                             
                                                i
                                                =
                                                1
                                             
                                             m
                                          
                                          
                                             M
                                             i
                                          
                                          
                                             (
                                             
                                                
                                                   u
                                                   ¯
                                                
                                                i
                                             
                                             )
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     We consider the following two cases:

                        
                           •
                           Case 1: 
                                 
                                    
                                       
                                          u
                                          ¯
                                       
                                       i
                                    
                                    ≤
                                    
                                       
                                          u
                                          ^
                                       
                                       i
                                    
                                 
                              . In this case,

                                 
                                    
                                       
                                          
                                             
                                             
                                             
                                                
                                                   
                                                      M
                                                      i
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            u
                                                            ^
                                                         
                                                         i
                                                      
                                                      )
                                                   
                                                   −
                                                   
                                                      M
                                                      i
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            u
                                                            ¯
                                                         
                                                         i
                                                      
                                                      )
                                                   
                                                   +
                                                   
                                                      (
                                                      
                                                         
                                                            u
                                                            ¯
                                                         
                                                         i
                                                      
                                                      −
                                                      
                                                         
                                                            u
                                                            ^
                                                         
                                                         i
                                                      
                                                      )
                                                   
                                                   
                                                      M
                                                      i
                                                      ′
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            u
                                                            ^
                                                         
                                                         i
                                                      
                                                      )
                                                   
                                                   ≤
                                                   
                                                      M
                                                      i
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            u
                                                            ^
                                                         
                                                         i
                                                      
                                                      )
                                                   
                                                   −
                                                   
                                                      M
                                                      i
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            u
                                                            ¯
                                                         
                                                         i
                                                      
                                                      )
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                             
                                                
                                                   
                                                   ≤
                                                   
                                                      |
                                                      
                                                         
                                                            
                                                               
                                                                  u
                                                                  ^
                                                               
                                                               i
                                                            
                                                            −
                                                            
                                                               
                                                                  u
                                                                  ¯
                                                               
                                                               i
                                                            
                                                         
                                                         
                                                            
                                                               u
                                                               ¯
                                                            
                                                            i
                                                         
                                                      
                                                      |
                                                   
                                                   
                                                      M
                                                      i
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            u
                                                            ¯
                                                         
                                                         i
                                                      
                                                      )
                                                   
                                                   ≤
                                                   2
                                                   ϵ
                                                   
                                                      M
                                                      i
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            u
                                                            ¯
                                                         
                                                         i
                                                      
                                                      )
                                                   
                                                   ,
                                                
                                             
                                          
                                       
                                    
                                 
                              where the second inequality holds because of the concavity of Mi
                              (·).

Case 2: 
                                 
                                    
                                       
                                          u
                                          ¯
                                       
                                       i
                                    
                                    >
                                    
                                       
                                          u
                                          ^
                                       
                                       i
                                    
                                 
                              . In this case,

                                 
                                    
                                       
                                          
                                             
                                             
                                             
                                                
                                                   
                                                      M
                                                      i
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            u
                                                            ^
                                                         
                                                         i
                                                      
                                                      )
                                                   
                                                   −
                                                   
                                                      M
                                                      i
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            u
                                                            ¯
                                                         
                                                         i
                                                      
                                                      )
                                                   
                                                   +
                                                   
                                                      (
                                                      
                                                         
                                                            u
                                                            ¯
                                                         
                                                         i
                                                      
                                                      −
                                                      
                                                         
                                                            u
                                                            ^
                                                         
                                                         i
                                                      
                                                      )
                                                   
                                                   
                                                      M
                                                      i
                                                      ′
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            u
                                                            ^
                                                         
                                                         i
                                                      
                                                      )
                                                   
                                                   ≤
                                                   
                                                      (
                                                      
                                                         
                                                            u
                                                            ¯
                                                         
                                                         i
                                                      
                                                      −
                                                      
                                                         
                                                            u
                                                            ^
                                                         
                                                         i
                                                      
                                                      )
                                                   
                                                   
                                                      M
                                                      i
                                                      ′
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            u
                                                            ^
                                                         
                                                         i
                                                      
                                                      )
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                             
                                                
                                                   
                                                   ≤
                                                   
                                                      |
                                                      
                                                         
                                                            
                                                               
                                                                  u
                                                                  ¯
                                                               
                                                               i
                                                            
                                                            −
                                                            
                                                               
                                                                  u
                                                                  ^
                                                               
                                                               i
                                                            
                                                         
                                                         
                                                            
                                                               u
                                                               ^
                                                            
                                                            i
                                                         
                                                      
                                                      |
                                                   
                                                   
                                                      M
                                                      i
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            u
                                                            ^
                                                         
                                                         i
                                                      
                                                      )
                                                   
                                                   ≤
                                                   ϵ
                                                   
                                                      M
                                                      i
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            u
                                                            ¯
                                                         
                                                         i
                                                      
                                                      )
                                                   
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              Again, the second inequality is due to the concavity of Mi
                              (·).

Thus, under the condition that 
                        
                           
                              min
                              i
                           
                           
                              
                                 u
                                 ^
                              
                              i
                           
                           ≥
                           
                              
                                 12
                                 m
                                 log
                                 
                                    (
                                    
                                       m
                                       2
                                    
                                    n
                                    /
                                    ϵ
                                    )
                                 
                              
                              
                                 ϵ
                                 3
                              
                           
                           ,
                        
                      with probability 
                        
                           1
                           −
                           ϵ
                           ,
                        
                     
                     
                        
                           
                              
                                 
                                    
                                       
                                          
                                             O
                                             P
                                             T
                                          
                                          −
                                          
                                             ∑
                                             
                                                i
                                                =
                                                1
                                             
                                             m
                                          
                                          
                                             M
                                             i
                                          
                                          
                                             (
                                             
                                                
                                                   u
                                                   ¯
                                                
                                                i
                                             
                                             )
                                          
                                          ≤
                                          2
                                          ϵ
                                          
                                             ∑
                                             
                                                i
                                                =
                                                1
                                             
                                             m
                                          
                                          
                                             M
                                             i
                                          
                                          
                                             (
                                             
                                                
                                                   u
                                                   ¯
                                                
                                                i
                                             
                                             )
                                          
                                          ≤
                                          2
                                          ϵ
                                          
                                             O
                                             P
                                             T
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     i.e., 
                        
                           
                              ∑
                              
                                 i
                                 =
                                 1
                              
                              m
                           
                           
                              M
                              i
                           
                           
                              (
                              
                                 
                                    u
                                    ¯
                                 
                                 i
                              
                              )
                           
                           ≥
                           
                              (
                              1
                              −
                              2
                              ϵ
                              )
                           
                           
                              O
                              P
                              T
                           
                        
                     .

Lastly, we note that the actual allocation in our algorithm for i is 
                        
                           
                              
                                 u
                                 ˜
                              
                              i
                           
                           =
                           
                              ∑
                              
                                 j
                                 =
                                 ϵ
                                 n
                                 +
                                 1
                              
                              n
                           
                           
                              b
                              
                                 i
                                 j
                              
                           
                           
                              x
                              i
                           
                           
                              (
                              
                                 u
                                 ^
                              
                              ,
                              
                                 b
                                 j
                              
                              )
                           
                        
                      (since we ignore the first 
                        
                           ϵ
                           n
                        
                      arrivals). By Lemma 2, we have

                        
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                u
                                                ˜
                                             
                                             i
                                          
                                          =
                                          
                                             
                                                u
                                                ¯
                                             
                                             i
                                          
                                          −
                                          
                                             ∑
                                             
                                                j
                                                =
                                                1
                                             
                                             
                                                ϵ
                                                n
                                             
                                          
                                          
                                             b
                                             
                                                i
                                                j
                                             
                                          
                                          
                                             x
                                             i
                                          
                                          
                                             (
                                             
                                                u
                                                ^
                                             
                                             ,
                                             
                                                b
                                                j
                                             
                                             )
                                          
                                          ≥
                                          
                                             
                                                u
                                                ¯
                                             
                                             i
                                          
                                          −
                                          ϵ
                                          
                                             (
                                             1
                                             +
                                             
                                                ϵ
                                                2
                                             
                                             )
                                          
                                          
                                             
                                                u
                                                ^
                                             
                                             i
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     Thus when condition (7) holds, 
                        
                           
                              
                                 u
                                 ˜
                              
                              i
                           
                           ≥
                           
                              (
                              1
                              −
                              3
                              ϵ
                              )
                           
                           
                              
                                 u
                                 ¯
                              
                              i
                           
                        
                     . Therefore,

                        
                           
                              
                                 
                                    
                                       
                                          
                                             ∑
                                             
                                                i
                                                =
                                                1
                                             
                                             m
                                          
                                          
                                             M
                                             i
                                          
                                          
                                             (
                                             
                                                u
                                                ˜
                                             
                                             )
                                          
                                          ≥
                                          
                                             ∑
                                             
                                                i
                                                =
                                                1
                                             
                                             m
                                          
                                          
                                             M
                                             i
                                          
                                          
                                             (
                                             
                                                (
                                                1
                                                −
                                                3
                                                ϵ
                                                )
                                             
                                             
                                                
                                                   u
                                                   ¯
                                                
                                                i
                                             
                                             )
                                          
                                          ≥
                                          
                                             (
                                             1
                                             −
                                             3
                                             ϵ
                                             )
                                          
                                          
                                             ∑
                                             
                                                i
                                                =
                                                1
                                             
                                             m
                                          
                                          
                                             M
                                             i
                                          
                                          
                                             (
                                             
                                                
                                                   u
                                                   ¯
                                                
                                                i
                                             
                                             )
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     The last inequality is due to the concavity of Mi
                     (·)s and that 
                        
                           
                              M
                              i
                           
                           
                              (
                              0
                              )
                           
                           =
                           0
                        
                     . Therefore, given 
                        
                           
                              min
                              i
                           
                           
                              
                                 u
                                 ^
                              
                              i
                           
                           ≥
                           
                              
                                 12
                                 m
                                 log
                                 
                                    (
                                    
                                       m
                                       2
                                    
                                    n
                                    /
                                    ϵ
                                    )
                                 
                              
                              
                                 ϵ
                                 3
                              
                           
                           ,
                        
                      with probability 
                        
                           1
                           −
                           ϵ
                           ,
                        
                     
                     
                        
                           
                              
                                 
                                    
                                       
                                          
                                             ∑
                                             
                                                i
                                                =
                                                1
                                             
                                             m
                                          
                                          
                                             M
                                             i
                                          
                                          
                                             (
                                             
                                                
                                                   u
                                                   ˜
                                                
                                                i
                                             
                                             )
                                          
                                          ≥
                                          
                                             (
                                             1
                                             −
                                             5
                                             ϵ
                                             )
                                          
                                          
                                             O
                                             P
                                             T
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     Therefore, Proposition 1 is proved. □


                     Proposition 1 shows that the OLA is near-optimal under some conditions on 
                        
                           u
                           ^
                        
                     . However, 
                        
                           u
                           ^
                        
                      is essentially an output of the algorithm. Although such types of conditions are not uncommon in the study of online algorithms (e.g., in the result of Devanur & Hayes, 2009; Feldman et al., 2010), it is quite undesirable. In the following, we address this problem by providing a set of sufficient conditions which only depend on the input parameters (i.e., m, n, 
                        b
                     s and M(·)s). We show that our algorithm achieves near-optimal performance under these conditions. We start with the following lemma.

                        Lemma 4
                        
                           For any C > 0, suppose the following condition holds:
                           
                              
                                 (9)
                                 
                                    
                                       
                                          
                                             
                                                n
                                                ≥
                                                max
                                                
                                                   {
                                                   
                                                      
                                                         12
                                                         log
                                                         
                                                            (
                                                            m
                                                            /
                                                            ϵ
                                                            )
                                                         
                                                      
                                                      
                                                         ϵ
                                                         
                                                            
                                                               b
                                                               ¯
                                                            
                                                            2
                                                         
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         4
                                                         m
                                                         C
                                                         F
                                                         (
                                                         M
                                                         ,
                                                         η
                                                         )
                                                      
                                                      
                                                         ϵ
                                                         
                                                            b
                                                            ¯
                                                         
                                                      
                                                   
                                                   }
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                           where
                           
                              
                                 
                                    b
                                    ¯
                                 
                                 =
                                 
                                    1
                                    n
                                 
                                 
                                    min
                                    i
                                 
                                 
                                    {
                                    
                                       ∑
                                       
                                          j
                                          =
                                          1
                                       
                                       n
                                    
                                    
                                       b
                                       
                                          i
                                          j
                                       
                                    
                                    }
                                 
                                 ,
                              
                           
                           
                              
                                 η
                                 =
                                 
                                    min
                                    
                                       i
                                       ,
                                       j
                                    
                                 
                                 
                                    {
                                    
                                       b
                                       
                                          i
                                          j
                                       
                                    
                                    |
                                    
                                       b
                                       
                                          i
                                          j
                                       
                                    
                                    >
                                    0
                                    }
                                 
                              
                            
                           and F(M, η) is such that 
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   M
                                                   i
                                                   ′
                                                
                                                
                                                   (
                                                   η
                                                   F
                                                   
                                                      (
                                                      M
                                                      ,
                                                      η
                                                      )
                                                   
                                                   C
                                                   )
                                                
                                                <
                                                η
                                                
                                                   M
                                                   
                                                      i
                                                      ′
                                                   
                                                   ′
                                                
                                                
                                                   (
                                                   C
                                                   )
                                                
                                                ,
                                                ∀
                                                i
                                                ,
                                                
                                                   i
                                                   ′
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           
                           Then with probability
                           
                              
                                 1
                                 −
                                 ϵ
                                 ,
                              
                           
                           
                              
                                 
                                    
                                       u
                                       ^
                                    
                                    i
                                 
                                 ≥
                                 C
                                 ,
                              
                            
                           for all i.
                        

The proof of Lemma 4 is relegated to the Appendix (it is proved together with Lemma 7). Now combining Proposition 1 and Lemma 4, we have the following result for the OLA:

                        Proposition 2
                        
                           Fix any
                           
                              
                                 ϵ
                                 ∈
                                 (
                                 0
                                 ,
                                 1
                                 /
                                 2
                                 )
                              
                           
                           . Suppose
                           
                              
                                 (10)
                                 
                                    
                                       
                                          
                                             
                                                n
                                                ≥
                                                max
                                                
                                                   {
                                                   
                                                      
                                                         12
                                                         log
                                                         
                                                            (
                                                            m
                                                            /
                                                            ϵ
                                                            )
                                                         
                                                      
                                                      
                                                         ϵ
                                                         
                                                            
                                                               b
                                                               ¯
                                                            
                                                            2
                                                         
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         4
                                                         m
                                                         C
                                                         F
                                                         (
                                                         M
                                                         ,
                                                         η
                                                         )
                                                      
                                                      
                                                         ϵ
                                                         
                                                            b
                                                            ¯
                                                         
                                                      
                                                   
                                                   }
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                           where
                           
                              
                                 
                                    b
                                    ¯
                                 
                                 =
                                 
                                    1
                                    n
                                 
                                 
                                    min
                                    i
                                 
                                 
                                    {
                                    
                                       ∑
                                       
                                          j
                                          =
                                          1
                                       
                                       n
                                    
                                    
                                       b
                                       
                                          i
                                          j
                                       
                                    
                                    }
                                 
                                 ,
                              
                           
                           
                              
                                 η
                                 =
                                 
                                    min
                                    
                                       i
                                       ,
                                       j
                                    
                                 
                                 
                                    {
                                    
                                       b
                                       
                                          i
                                          j
                                       
                                    
                                    |
                                    
                                       b
                                       
                                          i
                                          j
                                       
                                    
                                    >
                                    0
                                    }
                                 
                              
                            
                           and F(M, η) is such that
                           
                              
                                 (11)
                                 
                                    
                                       
                                          
                                             
                                                
                                                   M
                                                   i
                                                   ′
                                                
                                                
                                                   (
                                                   η
                                                   F
                                                   
                                                      (
                                                      M
                                                      ,
                                                      η
                                                      )
                                                   
                                                   C
                                                   )
                                                
                                                <
                                                η
                                                
                                                   M
                                                   
                                                      i
                                                      ′
                                                   
                                                   ′
                                                
                                                
                                                   (
                                                   C
                                                   )
                                                
                                                ,
                                                ∀
                                                i
                                                ,
                                                
                                                   i
                                                   ′
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                           with
                           
                              
                                 C
                                 =
                                 
                                    
                                       12
                                       m
                                       log
                                       
                                          (
                                          
                                             m
                                             2
                                          
                                          n
                                          /
                                          ϵ
                                          )
                                       
                                    
                                    
                                       ϵ
                                       3
                                    
                                 
                              
                           
                           . Then the OLA is
                           
                              
                                 1
                                 −
                                 ϵ
                              
                           
                           -competitive under the random permutation model.
                        

Here we give some comments on the definition of F(M, η). The definition of F(M, η) basically ensures that we rule out the possibility that one i receives nearly all the allocation while some others receive almost none. Note that such F(M, η) always exists and is finite if 
                        
                           
                              lim
                              
                                 x
                                 →
                                 ∞
                              
                           
                           
                              M
                              i
                              ′
                           
                           
                              (
                              x
                              )
                           
                           =
                           0
                        
                      for all i. In practice, this is usually true as there is usually an upper bound on the possible reward from each bidder i. In particular, if 
                        
                           
                              M
                              i
                           
                           
                              (
                              ·
                              )
                           
                           =
                           M
                           
                              (
                              ·
                              )
                           
                        
                      for all i and 
                        
                           
                              lim
                              
                                 x
                                 →
                                 ∞
                              
                           
                           
                              M
                              ′
                           
                           
                              (
                              x
                              )
                           
                           =
                           0
                           ,
                        
                      then one can choose

                        
                           
                              
                                 
                                    
                                       
                                          F
                                          
                                             (
                                             M
                                             ,
                                             η
                                             )
                                          
                                          =
                                          
                                             
                                                
                                                   M
                                                   
                                                      ′
                                                      −
                                                      1
                                                   
                                                
                                                
                                                   (
                                                   η
                                                   
                                                      M
                                                      ′
                                                   
                                                   
                                                      (
                                                      C
                                                      )
                                                   
                                                   )
                                                
                                             
                                             η
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     where 
                        
                           
                              M
                              
                                 ′
                                 −
                                 1
                              
                           
                           
                              (
                              ·
                              )
                           
                        
                      denotes the inverse function of M′(·). For example, if one chooses 
                        
                           
                              M
                              i
                           
                           
                              (
                              x
                              )
                           
                           =
                           
                              x
                              p
                           
                        
                      (0 < p < 1), then one can further choose 
                        
                           F
                           
                              (
                              M
                              ,
                              η
                              )
                           
                           ≥
                           
                              2
                              
                                 η
                                 
                                    (
                                    2
                                    −
                                    p
                                    )
                                    /
                                    (
                                    1
                                    −
                                    p
                                    )
                                 
                              
                           
                        
                     . Therefore, in most practical situations, one can view F(M, η) as a constant. Finally, we want to remark that the conditions in Lemma 4 (or Proposition 2) are only one set of sufficient conditions which have the nice feature of only depending on the problem inputs. In practice, one can always resort to the condition in Proposition 1 (
                        
                           
                              min
                              i
                           
                           
                              
                                 u
                                 ^
                              
                              i
                           
                           ≥
                           
                              
                                 12
                                 m
                                 log
                                 
                                    (
                                    
                                       m
                                       2
                                    
                                    n
                                    /
                                    ϵ
                                    )
                                 
                              
                              
                                 ϵ
                                 3
                              
                           
                        
                     ) if they are more favorable. In addition, as we will show in our numerical tests in Section 4, our algorithm performs quite well even if some of the conditions in Lemma 4
are not satisfied. Therefore, the applicability of our algorithm could be well beyond what the conditions require.

In the previous section, we introduced the OLA that can achieve near-optimal performance. While the OLA illustrates the ideas of our approach and requires solving a convex optimization problem only once, the conditions it requires to achieve near-optimality are stricter than what we claim in Theorem 1. In this section, we propose an enhanced algorithm that lessens the conditions and thus improves the OLA.

The main idea for the enhancement is the following: In the one-time learning algorithm, we only solve a partial optimization problem once. However, it is possible that there is some error for that solution due to the random order of arrival. If we could modify the solution as we gather more data, we might be able to improve the performance of the algorithm. In the following, we introduce a dynamic learning algorithm based on this idea, which updates the allocation policy every time the history doubles; that is, it computes a new 
                        
                           u
                           ^
                        
                      at time 
                        
                           t
                           =
                           ϵ
                           n
                           ,
                           2
                           ϵ
                           n
                           ,
                           4
                           ϵ
                           n
                           ,
                           ⋯
                        
                      and uses it to perform the matching for the next time period. We define the following problem:

                        
                           
                              
                                 
                                    
                                       
                                          (
                                          
                                             P
                                             ℓ
                                          
                                          )
                                       
                                    
                                    
                                       
                                          maximize
                                          
                                             x
                                             ,
                                             u
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                ∑
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                m
                                             
                                             
                                                M
                                                i
                                             
                                             
                                                (
                                                
                                                   u
                                                   i
                                                
                                                )
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                       s.t.
                                    
                                    
                                       
                                          
                                             
                                                ∑
                                                
                                                   j
                                                   =
                                                   1
                                                
                                                ℓ
                                             
                                             
                                                n
                                                ℓ
                                             
                                             
                                                b
                                                
                                                   i
                                                   j
                                                
                                             
                                             
                                                x
                                                
                                                   i
                                                   j
                                                
                                             
                                             =
                                             
                                                u
                                                i
                                             
                                             ,
                                          
                                       
                                    
                                    
                                       
                                          ∀
                                          i
                                       
                                    
                                 
                                 
                                    
                                    
                                    
                                       
                                          
                                             
                                                ∑
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                m
                                             
                                             
                                                x
                                                
                                                   i
                                                   j
                                                
                                             
                                             ≤
                                             1
                                             ,
                                          
                                       
                                    
                                    
                                       
                                          ∀
                                          j
                                       
                                    
                                 
                                 
                                    
                                    
                                    
                                       
                                          
                                             x
                                             
                                                i
                                                j
                                             
                                          
                                          ≥
                                          0
                                          ,
                                       
                                    
                                    
                                       
                                          ∀
                                          i
                                          ,
                                          j
                                          .
                                       
                                    
                                 
                              
                           
                        
                     We further define (
                        x
                     
                     ℓ, 
                        u
                     
                     ℓ) to be the optimal solution to (Pℓ
                     ).

We define the dynamic learning algorithm as follows:


                     
                        
                           
                        
                     
                  

In the following, without loss of generality, we assume that 
                        
                           L
                           =
                           −
                           
                              log
                              2
                           
                           ϵ
                        
                      is an integer (otherwise one can just choose a smaller 
                        ϵ
                      and prove the same result). Define 
                        
                           
                              ℓ
                              k
                           
                           =
                           
                              2
                              
                                 k
                                 −
                                 1
                              
                           
                           ϵ
                           n
                           ,
                        
                     
                     
                        
                           k
                           =
                           1
                           ,
                           …
                           ,
                           L
                           ,
                        
                      and define 
                        
                           
                              
                                 u
                                 ^
                              
                              k
                           
                           =
                           
                              
                                 u
                              
                              
                                 ℓ
                                 k
                              
                           
                        
                     . We first prove the following proposition:

                        Proposition 3
                        
                           If for all k, 
                              
                                 
                                    min
                                    i
                                 
                                 
                                    
                                       u
                                       ^
                                    
                                    i
                                    k
                                 
                                 ≥
                                 Ω
                                 
                                    {
                                    
                                       
                                          m
                                          log
                                          
                                             (
                                             
                                                m
                                                2
                                             
                                             n
                                             /
                                             ϵ
                                             )
                                          
                                       
                                       
                                          ϵ
                                          2
                                       
                                    
                                    }
                                 
                                 ,
                              
                            
                           then the DLA is
                           
                              
                                 1
                                 −
                                 ϵ
                              
                           
                           -competitive under the random permutation model.
                        

Before we proceed to the proof, we first define some more notation. We define:

                        
                           
                              
                                 
                                    
                                       u
                                       ¯
                                    
                                    i
                                    k
                                 
                                 =
                                 
                                    ∑
                                    
                                       j
                                       =
                                       
                                          ℓ
                                          k
                                       
                                       +
                                       1
                                    
                                    
                                       ℓ
                                       
                                          k
                                          +
                                          1
                                       
                                    
                                 
                                 
                                    b
                                    
                                       i
                                       j
                                    
                                 
                                 
                                    x
                                    i
                                 
                                 
                                    (
                                    
                                       
                                          u
                                          ^
                                       
                                       k
                                    
                                    ,
                                    
                                       b
                                       j
                                    
                                    )
                                 
                                 ,
                                 
                                 
                                    
                                       u
                                       ˜
                                    
                                    i
                                    k
                                 
                                 =
                                 
                                    ∑
                                    
                                       j
                                       =
                                       1
                                    
                                    n
                                 
                                 
                                    b
                                    
                                       i
                                       j
                                    
                                 
                                 
                                    x
                                    i
                                 
                                 
                                    (
                                    
                                       
                                          u
                                          ^
                                       
                                       k
                                    
                                    ,
                                    
                                       b
                                       j
                                    
                                    )
                                 
                                 ,
                                 
                                 
                                    
                                       u
                                       ¯
                                    
                                    i
                                 
                                 =
                                 
                                    ∑
                                    
                                       k
                                       =
                                       1
                                    
                                    L
                                 
                                 
                                    
                                       u
                                       ¯
                                    
                                    i
                                    k
                                 
                                 .
                              
                           
                        
                     Note that in these definitions, 
                        
                           
                              u
                              ¯
                           
                           i
                           k
                        
                      is the allocated values for i in the period 
                        
                           
                              ℓ
                              k
                           
                           +
                           1
                        
                      to 
                        
                           ℓ
                           
                              k
                              +
                              1
                           
                        
                      using 
                        
                           
                              
                                 u
                                 ^
                              
                              k
                           
                           ,
                        
                      which is the actual allocation in that period. 
                        
                           
                              u
                              ˜
                           
                           i
                           k
                        
                      is the allocation for i in all periods if 
                        
                           
                              u
                              ^
                           
                           k
                        
                      is used. 
                        
                           
                              u
                              ¯
                           
                           i
                        
                      is the actual allocation for i during the entire algorithm. We first prove the following lemma bounding the differences between 
                        
                           
                              
                                 u
                                 ¯
                              
                              i
                              k
                           
                           ,
                        
                     
                     
                        
                           
                              u
                              ˜
                           
                           i
                           k
                        
                      and 
                        
                           
                              u
                              ^
                           
                           i
                           k
                        
                     .

                        Lemma 5
                        
                           If
                           
                              
                                 
                                    min
                                    i
                                 
                                 
                                    
                                       u
                                       ^
                                    
                                    i
                                    k
                                 
                                 ≥
                                 
                                    
                                       16
                                       m
                                       log
                                       
                                          (
                                          
                                             m
                                             2
                                          
                                          n
                                          /
                                          ϵ
                                          )
                                       
                                    
                                    
                                       ϵ
                                       2
                                    
                                 
                                 ,
                              
                            
                           then with probability
                           
                              
                                 1
                                 −
                                 ϵ
                                 ,
                              
                            
                           for all i,

                              
                                 (12)
                                 
                                    
                                       
                                          
                                             
                                                
                                                   (
                                                   1
                                                   −
                                                   ϵ
                                                   
                                                      
                                                         n
                                                         
                                                            ℓ
                                                            k
                                                         
                                                      
                                                   
                                                   )
                                                
                                                
                                                   
                                                      u
                                                      ^
                                                   
                                                   i
                                                   k
                                                
                                                ≤
                                                
                                                   n
                                                   
                                                      ℓ
                                                      k
                                                   
                                                
                                                
                                                   
                                                      u
                                                      ¯
                                                   
                                                   i
                                                   k
                                                
                                                ≤
                                                
                                                   (
                                                   1
                                                   +
                                                   ϵ
                                                   
                                                      
                                                         n
                                                         
                                                            ℓ
                                                            k
                                                         
                                                      
                                                   
                                                   )
                                                
                                                
                                                   
                                                      u
                                                      ^
                                                   
                                                   i
                                                   k
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                           and
                           
                              
                                 (13)
                                 
                                    
                                       
                                          
                                             
                                                
                                                   (
                                                   1
                                                   −
                                                   ϵ
                                                   
                                                      
                                                         n
                                                         
                                                            ℓ
                                                            k
                                                         
                                                      
                                                   
                                                   )
                                                
                                                
                                                   
                                                      u
                                                      ^
                                                   
                                                   i
                                                   k
                                                
                                                ≤
                                                
                                                   
                                                      u
                                                      ˜
                                                   
                                                   i
                                                   k
                                                
                                                ≤
                                                
                                                   (
                                                   1
                                                   +
                                                   ϵ
                                                   
                                                      
                                                         n
                                                         
                                                            ℓ
                                                            k
                                                         
                                                      
                                                   
                                                   )
                                                
                                                
                                                   
                                                      u
                                                      ^
                                                   
                                                   i
                                                   k
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           
                        


                     Lemma 5 shows that with high probability, 
                        
                           
                              n
                              
                                 ℓ
                                 k
                              
                           
                           
                              
                                 u
                                 ¯
                              
                              i
                              k
                           
                           ,
                        
                     
                     
                        
                           
                              u
                              ˜
                           
                           i
                           k
                        
                      and 
                        
                           
                              u
                              ^
                           
                           i
                           k
                        
                      are close to each other. In particular, when k is small, the factor 
                        
                           (
                           1
                           ±
                           ϵ
                           
                              
                                 n
                                 /
                                 
                                    ℓ
                                    k
                                 
                              
                           
                           )
                        
                      is relatively loose while as k increases, the factor becomes tight. The proof of Lemma 5 is similar to that of Lemma 3 and is relegated to the Appendix. The next lemma gives a bound on the revenue obtained by the DLA.

                        Lemma 6
                        
                           If
                           
                              
                                 
                                    
                                       u
                                       ^
                                    
                                    i
                                    k
                                 
                                 ≥
                                 
                                    
                                       16
                                       m
                                       log
                                       
                                          (
                                          
                                             m
                                             2
                                          
                                          n
                                          /
                                          ϵ
                                          )
                                       
                                    
                                    
                                       ϵ
                                       2
                                    
                                 
                              
                            
                           for all i and k, then with probability
                           
                              
                                 1
                                 −
                                 ϵ
                                 ,
                              
                           
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ∑
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   m
                                                
                                                
                                                   M
                                                   i
                                                
                                                
                                                   (
                                                   
                                                      n
                                                      
                                                         ℓ
                                                         i
                                                      
                                                   
                                                   
                                                      
                                                         u
                                                         ¯
                                                      
                                                      i
                                                      k
                                                   
                                                   )
                                                
                                                ≥
                                                
                                                   (
                                                   1
                                                   −
                                                   6
                                                   ϵ
                                                   
                                                      
                                                         n
                                                         
                                                            l
                                                            k
                                                         
                                                      
                                                   
                                                   )
                                                
                                                
                                                   O
                                                   P
                                                   T
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           
                        

The proof of Lemma 6 can be found in the Appendix.

Finally, we prove Proposition 3. We bound the objective value of the actual allocation. Note that the actual allocation for each i can be written as

                        
                           
                              
                                 
                                    
                                       
                                          
                                             ∑
                                             
                                                k
                                                =
                                                1
                                             
                                             L
                                          
                                          
                                             
                                                u
                                                ¯
                                             
                                             i
                                             k
                                          
                                          =
                                          
                                             ∑
                                             
                                                k
                                                =
                                                1
                                             
                                             L
                                          
                                          
                                             α
                                             k
                                          
                                          
                                             n
                                             
                                                ℓ
                                                k
                                             
                                          
                                          
                                             
                                                u
                                                ¯
                                             
                                             i
                                             k
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     where 
                        
                           
                              α
                              k
                           
                           =
                           
                              
                                 ℓ
                                 k
                              
                              n
                           
                        
                     . By the property of concave functions, we have

                        
                           
                              
                                 
                                    
                                       
                                          
                                             ∑
                                             
                                                i
                                                =
                                                1
                                             
                                             m
                                          
                                          
                                             M
                                             i
                                          
                                          
                                             (
                                             
                                                ∑
                                                
                                                   k
                                                   =
                                                   1
                                                
                                                L
                                             
                                             
                                                
                                                   u
                                                   ¯
                                                
                                                i
                                                k
                                             
                                             )
                                          
                                       
                                    
                                    
                                       =
                                    
                                    
                                       
                                          
                                             ∑
                                             
                                                i
                                                =
                                                1
                                             
                                             m
                                          
                                          
                                             M
                                             i
                                          
                                          
                                             (
                                             
                                                ∑
                                                
                                                   k
                                                   =
                                                   1
                                                
                                                L
                                             
                                             
                                                α
                                                k
                                             
                                             
                                                n
                                                
                                                   ℓ
                                                   k
                                                
                                             
                                             
                                                
                                                   u
                                                   ¯
                                                
                                                i
                                                k
                                             
                                             +
                                             
                                                (
                                                1
                                                −
                                                
                                                   ∑
                                                   
                                                      k
                                                      =
                                                      1
                                                   
                                                   L
                                                
                                                
                                                   α
                                                   k
                                                
                                                )
                                             
                                             ·
                                             0
                                             )
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                       ≥
                                    
                                    
                                       
                                          
                                             ∑
                                             
                                                i
                                                =
                                                1
                                             
                                             m
                                          
                                          
                                             ∑
                                             
                                                k
                                                =
                                                1
                                             
                                             L
                                          
                                          
                                             α
                                             k
                                          
                                          
                                             M
                                             i
                                          
                                          
                                             (
                                             
                                                n
                                                
                                                   ℓ
                                                   k
                                                
                                             
                                             
                                                
                                                   u
                                                   ¯
                                                
                                                i
                                                k
                                             
                                             )
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     By Lemma 6, with probability 
                        
                           1
                           −
                           ϵ
                        
                     
                     
                        
                           
                              
                                 
                                    
                                       
                                          
                                             ∑
                                             
                                                i
                                                =
                                                1
                                             
                                             m
                                          
                                          
                                             ∑
                                             
                                                k
                                                =
                                                1
                                             
                                             L
                                          
                                          
                                             α
                                             k
                                          
                                          
                                             M
                                             i
                                          
                                          
                                             (
                                             
                                                n
                                                
                                                   ℓ
                                                   k
                                                
                                             
                                             
                                                
                                                   u
                                                   ¯
                                                
                                                i
                                                k
                                             
                                             )
                                          
                                       
                                    
                                    
                                       ≥
                                    
                                    
                                       
                                          
                                             ∑
                                             
                                                k
                                                =
                                                1
                                             
                                             L
                                          
                                          
                                             
                                                ℓ
                                                k
                                             
                                             n
                                          
                                          
                                             (
                                             1
                                             −
                                             6
                                             ϵ
                                             
                                                
                                                   n
                                                   
                                                      ℓ
                                                      k
                                                   
                                                
                                             
                                             )
                                          
                                          
                                             O
                                             P
                                             T
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                       =
                                    
                                    
                                       
                                          
                                             (
                                             1
                                             −
                                             ϵ
                                             )
                                          
                                          
                                             O
                                             P
                                             T
                                          
                                          −
                                          6
                                          ϵ
                                          
                                             ∑
                                             
                                                k
                                                =
                                                1
                                             
                                             L
                                          
                                          
                                             
                                                
                                                   ℓ
                                                   k
                                                
                                                n
                                             
                                          
                                          
                                             O
                                             P
                                             T
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                       ≥
                                    
                                    
                                       
                                          (
                                          1
                                          −
                                          16
                                          ϵ
                                          )
                                          
                                             O
                                             P
                                             T
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     where the last inequality is because

                        
                           
                              
                                 
                                    
                                       
                                          
                                             ∑
                                             
                                                k
                                                =
                                                1
                                             
                                             L
                                          
                                          
                                             
                                                
                                                   ℓ
                                                   k
                                                
                                                n
                                             
                                          
                                          =
                                          
                                             
                                                1
                                                2
                                             
                                          
                                          +
                                          
                                             
                                                1
                                                4
                                             
                                          
                                          ⋯
                                          ≤
                                          1
                                          +
                                          
                                             2
                                          
                                          ≤
                                          2.5
                                          .
                                       
                                    
                                 
                              
                           
                        
                     Therefore, Proposition 3 is proved. □

Similar to Lemma 4, we have the following conditions on the input parameters such that with high probability, the conditions in Proposition 3 hold.

                        Lemma 7
                        
                           For any C > 0, suppose the following condition holds:
                           
                              
                                 (14)
                                 
                                    
                                       
                                          
                                             
                                                n
                                                ≥
                                                max
                                                
                                                   {
                                                   
                                                      
                                                         24
                                                         log
                                                         
                                                            (
                                                            m
                                                            /
                                                            ϵ
                                                            )
                                                         
                                                      
                                                      
                                                         ϵ
                                                         
                                                            
                                                               b
                                                               ¯
                                                            
                                                            2
                                                         
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         4
                                                         m
                                                         C
                                                         F
                                                         (
                                                         M
                                                         ,
                                                         η
                                                         )
                                                      
                                                      
                                                         ϵ
                                                         
                                                            b
                                                            ¯
                                                         
                                                      
                                                   
                                                   }
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                           where
                           
                              
                                 
                                    b
                                    ¯
                                 
                                 =
                                 
                                    1
                                    n
                                 
                                 
                                    min
                                    i
                                 
                                 
                                    {
                                    
                                       ∑
                                       
                                          j
                                          =
                                          1
                                       
                                       n
                                    
                                    
                                       b
                                       
                                          i
                                          j
                                       
                                    
                                    }
                                 
                                 ,
                              
                           
                           
                              
                                 η
                                 =
                                 
                                    min
                                    
                                       i
                                       ,
                                       j
                                    
                                 
                                 
                                    {
                                    
                                       b
                                       
                                          i
                                          j
                                       
                                    
                                    |
                                    
                                       b
                                       
                                          i
                                          j
                                       
                                    
                                    >
                                    0
                                    }
                                 
                              
                            
                           and F(M, η) is such that 
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   M
                                                   i
                                                   ′
                                                
                                                
                                                   (
                                                   η
                                                   F
                                                   
                                                      (
                                                      M
                                                      ,
                                                      η
                                                      )
                                                   
                                                   C
                                                   )
                                                
                                                <
                                                η
                                                
                                                   M
                                                   
                                                      i
                                                      ′
                                                   
                                                   ′
                                                
                                                
                                                   (
                                                   C
                                                   )
                                                
                                                ,
                                                ∀
                                                i
                                                ,
                                                
                                                   i
                                                   ′
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           
                           Then with probability
                           
                              
                                 1
                                 −
                                 ϵ
                                 ,
                              
                           
                           
                              
                                 
                                    
                                       u
                                       ^
                                    
                                    i
                                    k
                                 
                                 ≥
                                 C
                                 ,
                              
                            
                           for all i.
                        

The proof of Lemma 7 is given in the Appendix. Finally, we combine Proposition 3 and Lemma 7, and Theorem 1 follows.

The same remark after Lemma 4 applies here. In particular, the conditions in Lemma 7 is only one set of sufficient conditions for our algorithm to achieve the target performance. However, one may also use the conditions in Proposition 3 if they turn out to hold in practice. In the next section, we show that the DLA works well even if the conditions in Lemma 7 are not satisfied.

In this section, we report some numerical test results for our algorithms (both the OLA and the DLA). The objective is to validate the strength of our approaches and investigate the relationship between the performance of our algorithms and the input parameters.

In our numerical tests, we consider the Adwords problem. We assume there are m advertisers (bidders), n keywords arriving sequentially, and bij
                      is the amount bidder i would like to pay to display his advertisement on keyword search j. We introduce a base problem in which we set 
                        
                           m
                           =
                           50
                           ,
                        
                     
                     
                        
                           n
                           =
                           10
                           ,
                           000
                        
                      and 
                        
                           
                              M
                              i
                           
                           
                              (
                              x
                              )
                           
                           =
                           
                              x
                              p
                           
                        
                      with 
                        
                           p
                           =
                           0.9
                        
                     . The bidding values bij
                      are generated in the following way:

                        
                           1.
                           Assume there are 
                                 
                                    k
                                    =
                                    100
                                 
                               categories of keywords. For each category k, there is a base valuation of bidder i, denoted by 
                                 
                                    
                                       
                                          b
                                          ¯
                                       
                                       
                                          i
                                          k
                                       
                                    
                                    ,
                                 
                               which is generated according to the following distribution:

                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         b
                                                         ¯
                                                      
                                                      
                                                         i
                                                         k
                                                      
                                                   
                                                   =
                                                   
                                                      {
                                                      
                                                         
                                                            
                                                               0
                                                            
                                                            
                                                               
                                                                  with
                                                                  
                                                                  probability
                                                                  
                                                                  0.7
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  U
                                                                  [
                                                                  0.2
                                                                  ,
                                                                  1
                                                                  ]
                                                               
                                                            
                                                            
                                                               
                                                                  with
                                                                  
                                                                  probability
                                                                  
                                                                  0.3
                                                                  ,
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              where U[a, b] denotes a uniformly distributed random variable on [a, b].

For each arriving keyword, we first randomly choose a category. The probability for each category i, denoted by ρi
                              , is randomly chosen on the simplex 
                                 
                                    {
                                    
                                       ρ
                                       i
                                    
                                    |
                                    
                                       ∑
                                       
                                          i
                                          =
                                          1
                                       
                                       k
                                    
                                    
                                       ρ
                                       i
                                    
                                    =
                                    1
                                    ,
                                    
                                       ρ
                                       i
                                    
                                    ≥
                                    0
                                    }
                                 
                              . Then if category k
                              0 is chosen, the final bid value for bidder i will be 
                                 
                                    
                                       
                                          b
                                          ¯
                                       
                                       
                                          i
                                          
                                             k
                                             0
                                          
                                       
                                    
                                    ·
                                    U
                                    
                                       [
                                       0.9
                                       ,
                                       1.1
                                       ]
                                    
                                 
                              .

Although the way bij
                      is chosen seems arbitrary, we believe it reflects some major features of the bid values in practice. In the Adwords problem, each bidder is interested in certain categories of keywords. For example, a sport product company is interested in keywords related to sports. The 
                        
                           
                              b
                              ¯
                           
                           
                              i
                              k
                           
                        
                     s represent such interest levels. Then the bidder i’s actual bid on such a keyword is the base value 
                        
                           
                              b
                              ¯
                           
                           
                              i
                              k
                           
                        
                      multiplied by a random number, which reflects some level of idiosyncrasies of each keyword arrival. We also tested other ways to generate bij
                     , and the test results are similar. We will report those test results in the end of this section.

To evaluate the performance of our algorithms, we introduce the notion of relative loss (RL) defined as follows:

                        
                           
                              
                                 
                                    
                                       
                                          RL
                                          =
                                          1
                                          −
                                          
                                             
                                                Actual
                                                
                                                Revenue
                                             
                                             
                                                Offline
                                                
                                                Optimal
                                                
                                                Revenue
                                             
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     
                  

In the numerical experiment, there is one key parameter we need to set in both of our algorithms: 
                        ϵ
                     . In Theorem 1 and Proposition 1, we gave sufficient conditions on the inputs such that the algorithms will have expected RL less than 
                        ϵ
                     . However, the theoretical results are asymptotic and thus may not represent the best practical choice of 
                        ϵ
                     . In Table 1
                      and Fig. 1
                     , we first test both our OLA and DLA with different choices of 
                        ϵ
                     . We have the following observations from Table 1 and Fig. 1 (each number in Table 1 is the average RL of 100 independent runs, the standard deviations of the results are insignificant compared to the average value):
                     
                     
                        
                           •
                           For the DLA, choosing a smaller 
                                 ϵ
                               improves its performance. There are two reasons for that. First, choosing a smaller 
                                 ϵ
                               reduces the loss due to ignoring the first 
                                 
                                    ϵ
                                    n
                                 
                               bids. Second, it increases the number of price updates which help the decision maker to refine the decision policy and achieve better performance. Therefore one should choose a smaller 
                                 ϵ
                               in the DLA.

For the OLA, the optimal choice of 
                                 ϵ
                               is more subtle. There are two countervailing forces when one chooses a smaller 
                                 ϵ
                              . On one hand, by choosing a smaller 
                                 
                                    ϵ
                                    ,
                                 
                               the loss due to the failure to allocate any bid during period 1 to 
                                 
                                    ϵ
                                    n
                                 
                               becomes smaller, which benefits the algorithm. On the other hand, if 
                                 ϵ
                               is too small, the learned price may not be accurate enough which may lead to poor allocation in the remaining periods. In the test example, the optimal choice is 
                                 
                                    ϵ
                                    =
                                    0.02
                                 
                              .

The DLA outperforms the OLA for all choices of 
                                 ϵ
                              .

Next we focus ourselves on the DLA. As shown in Table 1, we prefer to choose a smaller 
                        ϵ
                      in the DLA. In the following experiments, we will choose 
                        
                           ϵ
                           =
                           0.001
                        
                     . Next we compare the performance of the DLA to a myopic allocation method which simply allocates each incoming keyword to the bidder with the highest bij
                      value. We also study the impact of the two parameters, n and p, on the performance of our algorithm. We generate 100 instances of the input bij
                      and compare the average performance. The results of the average RL are shown in Table 2 (the standard deviations are shown in the parentheses) as well as in Figs. 2 a and b.

From Table 2, we can see that the DLA consistently performs better than the myopic approach. In particular, the performance of the DLA gradually improves when n increases, while the performance of the myopic approach seems to be insensitive to the size n of the problem. Moreover, even for small values of n, the performance of the DLA is still very good. This means that the DLA works well even for problems whose size is much smaller than what Theorem 1 requires. For the parameter p, we can see that both the DLA and the myopic algorithm deteriorate when p decreases, but the DLA deteriorates much slower. Finally, we comment that these results are computed when we ignore the first 
                        
                           ϵ
                           n
                        
                      bids. In practice, one does not need to do that and the performance of the DLA would be even better.

Finally, we repeat the above test for different setups of the inputs. We fix the parameters 
                        
                           m
                           =
                           50
                           ,
                           n
                           =
                           10
                           ,
                           000
                           ,
                        
                      and 
                        
                           
                              M
                              i
                           
                           
                              (
                              x
                              )
                           
                           =
                           
                              x
                              p
                           
                        
                      with 
                        
                           p
                           =
                           0.9
                        
                      in the base problem and generate bij
                     s in the following ways:

                        
                           1.
                           
                              bij
                               follows a normal distribution (truncated at 0 and 1). The parameters of each normal distribution (mean μ and standard deviation σ) are randomly generated from a uniform distribution on [0, 1].


                              bij
                               follows a Beta distribution. The parameters (α, β) of the Beta distribution are generated from a uniform distribution on [0, 1].


                              bij
                               follows a mixed normal and Beta distribution. That is, with probability 0.5, bij
                               follows a truncated normal distribution with mean 0.5 and standard deviation 0.5, and with probability 0.5, bij
                               follows a Beta distribution with 
                                 
                                    α
                                    =
                                    β
                                    =
                                    1
                                    /
                                    2
                                 
                              .

Next, we compare the performance of the DLA (choose 
                        
                           ϵ
                           =
                           0.001
                        
                     ) and the myopic algorithm. For each case, we generate 100 instances of the input bij
                      and compare the average RL. The results are shown in Table 3
                     .

From Table 3, we can see that the DLA outperforms the myopic approach under all the above three setups. The RL of the DLA decreases as the problem size grows, while the RL of the myopic policy is not sensitive to n. Also, as p changes, the performance of the DLA is rather stable, while the performance of the myopic algorithm varies a lot. The overall trend of the DLA and the myopic algorithm resembles that in the experiment in the beginning of this section. Finally, we observe that the DLA seems robust toward various problem setups, while the myopic approach does not.

@&#CONCLUSION@&#

In this paper, we propose a dynamic learning algorithm for an online matching problem with concave returns. We show that our algorithm achieves near-optimal performance when the data arrives in a random order and satisfies some conditions. The analysis is primal-dual based, however, the nonlinear objective function requires us to work around nontrivial hurdles that do not exist in previous work. Numerical experiment results show that our algorithm works well in test problems.

@&#ACKNOWLEDGMENT@&#

We thank the anonymous referees for their insightful comments. The research of both authors is supported by National Science Foundation under research grant CMMI-1434541.

In our proofs, we will frequently use the following Hoeffding–Bernstein’s Inequality for sampling without replacement:

                        Lemma 8
                        Theorem 2.14.19 in van der Vaart and Wellner, 1996:


                        
                           Let
                           
                              
                                 
                                    u
                                    1
                                 
                                 ,
                                 
                                    u
                                    2
                                 
                                 ,
                                 …
                                 ,
                                 
                                    u
                                    r
                                 
                              
                            
                           be random samples without replacement from real numbers
                           
                              
                                 {
                                 
                                    c
                                    1
                                 
                                 ,
                                 
                                    c
                                    2
                                 
                                 ,
                                 …
                                 ,
                                 
                                    c
                                    R
                                 
                                 }
                              
                           
                           . Then for every t > 0,

                              
                                 
                                    
                                       
                                          
                                             
                                                P
                                                
                                                   (
                                                   
                                                      |
                                                      
                                                         ∑
                                                         
                                                            i
                                                            =
                                                            1
                                                         
                                                         r
                                                      
                                                      
                                                         u
                                                         i
                                                      
                                                      −
                                                      r
                                                      
                                                         c
                                                         ¯
                                                      
                                                      |
                                                   
                                                   ≥
                                                   t
                                                   )
                                                
                                                ≤
                                                2
                                                exp
                                                
                                                   (
                                                   −
                                                   
                                                      
                                                         t
                                                         2
                                                      
                                                      
                                                         2
                                                         r
                                                         
                                                            σ
                                                            R
                                                            2
                                                         
                                                         +
                                                         t
                                                         
                                                            Δ
                                                            R
                                                         
                                                      
                                                   
                                                   )
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                           where
                           
                              
                                 
                                    Δ
                                    R
                                 
                                 =
                                 
                                    max
                                    i
                                 
                                 
                                    c
                                    i
                                 
                                 −
                                 
                                    min
                                    i
                                 
                                 
                                    c
                                    i
                                 
                                 ,
                              
                           
                           
                              
                                 
                                    c
                                    ¯
                                 
                                 =
                                 
                                    1
                                    R
                                 
                                 
                                    ∑
                                    
                                       i
                                       =
                                       1
                                    
                                    R
                                 
                                 
                                    c
                                    i
                                 
                                 ,
                              
                            
                           and
                           
                              
                                 
                                    σ
                                    R
                                    2
                                 
                                 =
                                 
                                    1
                                    R
                                 
                                 
                                    ∑
                                    
                                       i
                                       =
                                       1
                                    
                                    R
                                 
                                 
                                    
                                       (
                                       
                                          c
                                          i
                                       
                                       −
                                       
                                          c
                                          ¯
                                       
                                       )
                                    
                                    2
                                 
                              
                           
                           .
                        

We first write down the Lagrangian dual of (3). By associating pi
                            to the first set of constraints and yj
                            to the second set of constraints, the Lagrangian dual of (3) is:

                              
                                 (15)
                                 
                                    
                                       
                                          
                                             
                                                inf
                                                
                                                   p
                                                   ,
                                                   y
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      ∑
                                                      
                                                         j
                                                         =
                                                         1
                                                      
                                                      n
                                                   
                                                   
                                                      y
                                                      j
                                                   
                                                   +
                                                   
                                                      sup
                                                      
                                                         
                                                            u
                                                            i
                                                         
                                                         ≥
                                                         0
                                                      
                                                   
                                                   
                                                      ∑
                                                      
                                                         i
                                                         =
                                                         1
                                                      
                                                      m
                                                   
                                                   
                                                      (
                                                      
                                                         M
                                                         i
                                                      
                                                      
                                                         (
                                                         
                                                            u
                                                            i
                                                         
                                                         )
                                                      
                                                      −
                                                      
                                                         p
                                                         i
                                                      
                                                      
                                                         u
                                                         i
                                                      
                                                      )
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             s.t.
                                          
                                          
                                             
                                                
                                                   y
                                                   j
                                                
                                                ≥
                                                
                                                   b
                                                   
                                                      i
                                                      j
                                                   
                                                
                                                
                                                   p
                                                   i
                                                
                                                ,
                                                
                                                
                                                ∀
                                                i
                                             
                                          
                                       
                                       
                                          
                                          
                                             
                                                
                                                   y
                                                   j
                                                
                                                ≥
                                                0
                                                ,
                                                
                                                
                                                ∀
                                                j
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           Since the primal problem is convex and only has linear constraints, Slater’s condition holds, thus the strong duality theorem holds and (3) and (15) have the same optimal value. Next we show that (4) and (15) are equivalent. To show this, assume the range of 
                              
                                 
                                    M
                                    i
                                    ′
                                 
                                 
                                    (
                                    ·
                                    )
                                 
                              
                            on [0, ∞) is (ai, bi
                           ] or [ai, bi
                           ] (by the assumption that M(·)s are continuously differentiable, it must be either one of these two forms). Now we argue that the optimal pi
                            must be within [ai, bi
                           ] in (15). First we must have pi
                            ≥ ai
                           , otherwise the term 
                              
                                 
                                    sup
                                    
                                       
                                          u
                                          i
                                       
                                       ≥
                                       0
                                    
                                 
                                 
                                    {
                                    
                                       M
                                       i
                                    
                                    
                                       (
                                       
                                          u
                                          i
                                       
                                       )
                                    
                                    −
                                    
                                       p
                                       i
                                    
                                    
                                       u
                                       i
                                    
                                    }
                                 
                              
                            goes to infinity as ui
                            increases and it cannot be the optimal solution to (15). On the other hand, if pi
                            > bi
                           , then the optimal ui
                            must be 0, and one can always set 
                              
                                 
                                    p
                                    i
                                 
                                 =
                                 
                                    b
                                    i
                                 
                              
                            and achieves a smaller value of the objective function. Therefore, pi
                            ∈ [ai, bi
                           ] at optimality.

Now if pi
                            ∈ (ai, bi
                           ] at optimality, then one can always find one vi
                            such that 
                              
                                 
                                    M
                                    i
                                    ′
                                 
                                 
                                    (
                                    
                                       v
                                       i
                                    
                                    )
                                 
                                 =
                                 
                                    p
                                    i
                                 
                                 ,
                              
                            and that vi
                            must be the optimal solution to 
                              
                                 
                                    sup
                                    
                                       u
                                       i
                                    
                                 
                                 
                                    {
                                    
                                       M
                                       i
                                    
                                    
                                       (
                                       
                                          u
                                          i
                                       
                                       )
                                    
                                    −
                                    
                                       p
                                       i
                                    
                                    
                                       u
                                       i
                                    
                                    }
                                 
                              
                            (the optimal solution must be attainable in this case). Therefore, each feasible solution of (15) will correspond to a feasible solution of (4) and vice versa. The only case left now is when 
                              
                                 
                                    p
                                    i
                                 
                                 =
                                 
                                    a
                                    i
                                 
                              
                            at optimality. In this case, 
                              
                                 
                                    sup
                                    
                                       u
                                       i
                                    
                                 
                                 
                                    {
                                    
                                       M
                                       i
                                    
                                    
                                       (
                                       
                                          u
                                          i
                                       
                                       )
                                    
                                    −
                                    
                                       a
                                       i
                                    
                                    
                                       u
                                       i
                                    
                                    }
                                 
                                 =
                                 
                                    lim
                                    
                                       x
                                       →
                                       ∞
                                    
                                 
                                 
                                    {
                                    
                                       M
                                       i
                                    
                                    
                                       (
                                       x
                                       )
                                    
                                    −
                                    
                                       a
                                       i
                                    
                                    x
                                    }
                                 
                              
                           . Also, we know that 
                              
                                 
                                    lim
                                    
                                       x
                                       →
                                       ∞
                                    
                                 
                                 
                                    M
                                    i
                                    ′
                                 
                                 
                                    (
                                    x
                                    )
                                 
                                 =
                                 
                                    a
                                    i
                                 
                                 ,
                              
                            therefore, there exists a sequence of feasible solution of (4) such that the limit of the objective value equals the objective obtained when 
                              
                                 
                                    p
                                    i
                                 
                                 =
                                 
                                    a
                                    i
                                 
                              
                            in (15). Therefore, the lemma is proved.□

To prove this lemma, it suffices to show that for each fixed i, 
                              
                                 
                                    x
                                    i
                                 
                                 
                                    (
                                    
                                       u
                                       ^
                                    
                                    ,
                                    
                                       b
                                       j
                                    
                                    )
                                 
                              
                            and 
                              
                                 
                                    x
                                    ^
                                 
                                 
                                    i
                                    j
                                 
                              
                            (recall that 
                              
                                 
                                    x
                                    ^
                                 
                                 =
                                 
                                    {
                                    
                                       
                                          x
                                          ^
                                       
                                       
                                          i
                                          j
                                       
                                    
                                    }
                                 
                              
                            is the optimal solution to (5)) differ by no more than m terms. If this is true, then note that 
                              
                                 
                                    ∑
                                    
                                       j
                                       =
                                       1
                                    
                                    
                                       ϵ
                                       n
                                    
                                 
                                 
                                    b
                                    
                                       i
                                       j
                                    
                                 
                                 
                                    
                                       x
                                       ^
                                    
                                    
                                       i
                                       j
                                    
                                 
                                 =
                                 ϵ
                                 
                                    
                                       u
                                       ^
                                    
                                    i
                                 
                              
                            and 0 ≤ bij
                            ≤ 1, the lemma holds.

To show that 
                              
                                 
                                    x
                                    i
                                 
                                 
                                    (
                                    
                                       u
                                       ^
                                    
                                    ,
                                    
                                       b
                                       j
                                    
                                    )
                                 
                              
                            and 
                              
                                 
                                    x
                                    ^
                                 
                                 
                                    i
                                    j
                                 
                              
                            differ by no more than m terms, we first construct the dual problem of (5) (according to (4)):

                              
                                 
                                    
                                       
                                          
                                             
                                                inf
                                                
                                                   v
                                                   ,
                                                   y
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      ∑
                                                      
                                                         j
                                                         =
                                                         1
                                                      
                                                      
                                                         ϵ
                                                         n
                                                      
                                                   
                                                   
                                                      y
                                                      j
                                                   
                                                   +
                                                   
                                                      ∑
                                                      
                                                         i
                                                         =
                                                         1
                                                      
                                                      m
                                                   
                                                   
                                                      (
                                                      
                                                         M
                                                         i
                                                      
                                                      
                                                         (
                                                         
                                                            v
                                                            i
                                                         
                                                         )
                                                      
                                                      −
                                                      
                                                         M
                                                         i
                                                         ′
                                                      
                                                      
                                                         (
                                                         
                                                            v
                                                            i
                                                         
                                                         )
                                                      
                                                      
                                                         v
                                                         i
                                                      
                                                      )
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             s.t.
                                          
                                          
                                             
                                                
                                                   
                                                      y
                                                      j
                                                   
                                                   ≥
                                                   
                                                      
                                                         b
                                                         
                                                            i
                                                            j
                                                         
                                                      
                                                      ϵ
                                                   
                                                   
                                                      M
                                                      i
                                                      ′
                                                   
                                                   
                                                      (
                                                      
                                                         v
                                                         i
                                                      
                                                      )
                                                   
                                                   ,
                                                   
                                                   
                                                   ∀
                                                   i
                                                   ,
                                                   j
                                                
                                             
                                          
                                       
                                       
                                          
                                          
                                             
                                                
                                                   v
                                                   i
                                                
                                                ≥
                                                0
                                                ,
                                                
                                                
                                                ∀
                                                i
                                             
                                          
                                       
                                       
                                          
                                          
                                             
                                                
                                                   y
                                                   j
                                                
                                                ≥
                                                0
                                                ,
                                                
                                                
                                                ∀
                                                j
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           By Lemma 2.1, strong duality holds and thus any optimal solution should satisfy the complementarity conditions. Among them we should have 
                              
                                 
                                    
                                       x
                                       ^
                                    
                                    
                                       i
                                       j
                                    
                                 
                                 
                                    (
                                    
                                       y
                                       j
                                    
                                    −
                                    
                                       
                                          b
                                          
                                             i
                                             j
                                          
                                       
                                       ϵ
                                    
                                    
                                       M
                                       i
                                       ′
                                    
                                    
                                       (
                                       
                                          v
                                          i
                                       
                                       )
                                    
                                    )
                                 
                                 =
                                 0
                              
                           . Therefore, if there is no tie when we defined 
                              
                                 
                                    x
                                    i
                                 
                                 
                                    (
                                    
                                       u
                                       ^
                                    
                                    ,
                                    
                                       b
                                       j
                                    
                                    )
                                 
                                 ,
                              
                            we must have 
                              
                                 
                                    x
                                    i
                                 
                                 
                                    (
                                    
                                       u
                                       ^
                                    
                                    ,
                                    
                                       b
                                       j
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       x
                                       ^
                                    
                                    
                                       i
                                       j
                                    
                                 
                              
                           . By Assumption 1, there are no more than m ties. Thus, Lemma 2 is proved.□

We first prove (12). The idea is similar to the proof of the one-time learning case. For any fixed 
                              
                                 
                                    
                                       u
                                       ^
                                    
                                    k
                                 
                                 ,
                              
                            we define that a random sample S (a sequence of arrival) is bad if and only if 
                              
                                 
                                    u
                                    ^
                                 
                                 k
                              
                            is the optimal solution to (
                              
                                 P
                                 
                                    ℓ
                                    k
                                 
                              
                           ) but 
                              
                                 
                                    u
                                    ¯
                                 
                                 k
                              
                            does not satisfy (12) for some i. First, we show that the probability of a bad sample is small for any fixed 
                              
                                 
                                    u
                                    ^
                                 
                                 k
                              
                            and fixed i. Then we take a union bound over all distinct 
                              
                                 
                                    u
                                    ^
                                 
                                 k
                              
                           s and is to show the result.

Fix 
                              
                                 
                                    u
                                    ^
                                 
                                 k
                              
                            and i. We define 
                              
                                 
                                    Y
                                    j
                                 
                                 =
                                 
                                    b
                                    
                                       i
                                       j
                                    
                                 
                                 
                                    x
                                    i
                                 
                                 
                                    (
                                    
                                       
                                          u
                                          ^
                                       
                                       k
                                    
                                    ,
                                    
                                       b
                                       j
                                    
                                    )
                                 
                              
                           . By Lemma 2 and the assumption on 
                              
                                 
                                    
                                       u
                                       ^
                                    
                                    i
                                    k
                                 
                                 ,
                              
                            we have

                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      ℓ
                                                      k
                                                   
                                                   n
                                                
                                                
                                                   
                                                      u
                                                      ^
                                                   
                                                   i
                                                   k
                                                
                                                −
                                                
                                                   ϵ
                                                   2
                                                
                                                
                                                   
                                                      u
                                                      ^
                                                   
                                                   i
                                                   k
                                                
                                                ≤
                                                
                                                   ∑
                                                   
                                                      j
                                                      =
                                                      1
                                                   
                                                   
                                                      ℓ
                                                      k
                                                   
                                                
                                                
                                                   Y
                                                   j
                                                
                                                ≤
                                                
                                                   
                                                      ℓ
                                                      k
                                                   
                                                   n
                                                
                                                
                                                   
                                                      u
                                                      ^
                                                   
                                                   i
                                                   k
                                                
                                                +
                                                
                                                   ϵ
                                                   2
                                                
                                                
                                                   
                                                      u
                                                      ^
                                                   
                                                   i
                                                   k
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           Therefore, the probability of a bad sample is bounded by the following two terms:

                              
                                 (16)
                                 
                                    
                                       
                                          
                                          
                                          
                                             
                                                P
                                                
                                                   (
                                                   
                                                      ∑
                                                      
                                                         j
                                                         =
                                                         1
                                                      
                                                      
                                                         ℓ
                                                         k
                                                      
                                                   
                                                   
                                                      Y
                                                      j
                                                   
                                                   ≤
                                                   
                                                      
                                                         ℓ
                                                         k
                                                      
                                                      n
                                                   
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                      k
                                                   
                                                   +
                                                   
                                                      ϵ
                                                      2
                                                   
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                      k
                                                   
                                                   ,
                                                   
                                                      ∑
                                                      
                                                         j
                                                         =
                                                         
                                                            ℓ
                                                            k
                                                         
                                                         +
                                                         1
                                                      
                                                      
                                                         ℓ
                                                         
                                                            k
                                                            +
                                                            1
                                                         
                                                      
                                                   
                                                   
                                                      Y
                                                      j
                                                   
                                                   >
                                                   
                                                      
                                                         ℓ
                                                         k
                                                      
                                                      n
                                                   
                                                   
                                                      (
                                                      1
                                                      +
                                                      
                                                         
                                                            n
                                                            
                                                               ℓ
                                                               k
                                                            
                                                         
                                                      
                                                      ϵ
                                                      )
                                                   
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                      k
                                                   
                                                   )
                                                
                                             
                                          
                                       
                                       
                                          
                                          
                                          
                                             
                                                
                                                +
                                                P
                                                
                                                   (
                                                   
                                                      ∑
                                                      
                                                         j
                                                         =
                                                         1
                                                      
                                                      
                                                         ℓ
                                                         k
                                                      
                                                   
                                                   
                                                      Y
                                                      j
                                                   
                                                   ≥
                                                   
                                                      
                                                         ℓ
                                                         k
                                                      
                                                      n
                                                   
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                      k
                                                   
                                                   −
                                                   
                                                      ϵ
                                                      2
                                                   
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                      k
                                                   
                                                   ,
                                                   
                                                      ∑
                                                      
                                                         j
                                                         =
                                                         
                                                            ℓ
                                                            k
                                                         
                                                         +
                                                         1
                                                      
                                                      
                                                         ℓ
                                                         
                                                            k
                                                            +
                                                            1
                                                         
                                                      
                                                   
                                                   
                                                      Y
                                                      j
                                                   
                                                   <
                                                   
                                                      
                                                         ℓ
                                                         k
                                                      
                                                      n
                                                   
                                                   
                                                      (
                                                      1
                                                      −
                                                      
                                                         
                                                            n
                                                            
                                                               ℓ
                                                               k
                                                            
                                                         
                                                      
                                                      ϵ
                                                      )
                                                   
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                      k
                                                   
                                                   )
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           
                        

For the first term, we have

                              
                                 
                                    
                                       
                                          
                                          
                                          
                                             
                                                P
                                                
                                                   (
                                                   
                                                      ∑
                                                      
                                                         j
                                                         =
                                                         1
                                                      
                                                      
                                                         ℓ
                                                         k
                                                      
                                                   
                                                   
                                                      Y
                                                      j
                                                   
                                                   ≤
                                                   
                                                      
                                                         ℓ
                                                         k
                                                      
                                                      n
                                                   
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                      k
                                                   
                                                   +
                                                   
                                                      ϵ
                                                      2
                                                   
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                      k
                                                   
                                                   ,
                                                   
                                                      ∑
                                                      
                                                         j
                                                         =
                                                         
                                                            ℓ
                                                            k
                                                         
                                                         +
                                                         1
                                                      
                                                      
                                                         ℓ
                                                         
                                                            k
                                                            +
                                                            1
                                                         
                                                      
                                                   
                                                   
                                                      Y
                                                      j
                                                   
                                                   >
                                                   
                                                      
                                                         ℓ
                                                         k
                                                      
                                                      n
                                                   
                                                   
                                                      (
                                                      1
                                                      +
                                                      
                                                         
                                                            n
                                                            
                                                               ℓ
                                                               k
                                                            
                                                         
                                                      
                                                      ϵ
                                                      )
                                                   
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                      k
                                                   
                                                   )
                                                
                                             
                                          
                                       
                                       
                                          
                                          
                                          
                                             
                                                
                                                =
                                                P
                                                
                                                   (
                                                   
                                                      ∑
                                                      
                                                         j
                                                         =
                                                         1
                                                      
                                                      
                                                         ℓ
                                                         k
                                                      
                                                   
                                                   
                                                      Y
                                                      j
                                                   
                                                   ≤
                                                   
                                                      
                                                         ℓ
                                                         k
                                                      
                                                      n
                                                   
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                      k
                                                   
                                                   +
                                                   
                                                      ϵ
                                                      2
                                                   
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                      k
                                                   
                                                   ,
                                                   
                                                      ∑
                                                      
                                                         j
                                                         =
                                                         1
                                                      
                                                      
                                                         ℓ
                                                         
                                                            k
                                                            +
                                                            1
                                                         
                                                      
                                                   
                                                   
                                                      Y
                                                      j
                                                   
                                                   >
                                                   
                                                      
                                                         ℓ
                                                         k
                                                      
                                                      n
                                                   
                                                   
                                                      (
                                                      2
                                                      +
                                                      
                                                         
                                                            n
                                                            
                                                               ℓ
                                                               k
                                                            
                                                         
                                                      
                                                      ϵ
                                                      )
                                                   
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                      k
                                                   
                                                   )
                                                
                                             
                                          
                                       
                                       
                                          
                                          
                                          
                                             
                                                
                                                ≤
                                                P
                                                
                                                   (
                                                   
                                                      |
                                                      
                                                         ∑
                                                         
                                                            j
                                                            =
                                                            1
                                                         
                                                         
                                                            ℓ
                                                            k
                                                         
                                                      
                                                      
                                                         Y
                                                         j
                                                      
                                                      −
                                                      
                                                         1
                                                         2
                                                      
                                                      
                                                         ∑
                                                         
                                                            j
                                                            =
                                                            1
                                                         
                                                         
                                                            ℓ
                                                            
                                                               k
                                                               +
                                                               1
                                                            
                                                         
                                                      
                                                      
                                                         Y
                                                         j
                                                      
                                                      |
                                                   
                                                   >
                                                   
                                                      ϵ
                                                      4
                                                   
                                                   
                                                      
                                                         n
                                                         
                                                            ℓ
                                                            k
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         ℓ
                                                         k
                                                      
                                                      n
                                                   
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                      k
                                                   
                                                
                                                
                                                   
                                                      |
                                                      
                                                         ∑
                                                         
                                                            j
                                                            =
                                                            1
                                                         
                                                         
                                                            ℓ
                                                            
                                                               k
                                                               +
                                                               1
                                                            
                                                         
                                                      
                                                      
                                                         Y
                                                         j
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                          
                                          
                                             
                                                
                                                
                                                   >
                                                   
                                                      
                                                         ℓ
                                                         k
                                                      
                                                      n
                                                   
                                                   
                                                      (
                                                      2
                                                      +
                                                      
                                                         
                                                            n
                                                            
                                                               ℓ
                                                               k
                                                            
                                                         
                                                      
                                                      ϵ
                                                      )
                                                   
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                      k
                                                   
                                                   )
                                                
                                                ≤
                                                2
                                                exp
                                                
                                                   (
                                                   −
                                                   
                                                      
                                                         
                                                            ϵ
                                                            2
                                                         
                                                         
                                                            
                                                               u
                                                               ^
                                                            
                                                            i
                                                            k
                                                         
                                                      
                                                      16
                                                   
                                                   )
                                                
                                             
                                          
                                       
                                       
                                          
                                          
                                          
                                             
                                                
                                                ≤
                                                
                                                   ϵ
                                                   
                                                      2
                                                      m
                                                      
                                                         
                                                            (
                                                            
                                                               m
                                                               2
                                                            
                                                            n
                                                            )
                                                         
                                                         m
                                                      
                                                   
                                                
                                                ≐
                                                δ
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           Here the second inequality follows from Lemma 8, and the third inequality is due to the condition of 
                              
                                 
                                    u
                                    ^
                                 
                                 i
                                 k
                              
                           . Similarly, we can get the bound for the second term in (16). Therefore, the probability of a bad sample is bounded by 2δ.

Now we take union bound over all distinct 
                              
                                 
                                    u
                                    ^
                                 
                                 k
                              
                            and i. Similar to the proof of Lemma 3, we call 
                              u
                           s to be distinct if they result in different allocations. As argued earlier, there are no more than (m
                           2
                           n)
                              m
                            distinct 
                              u
                           s. Therefore, we know that with probability 
                              
                                 1
                                 −
                                 ϵ
                                 ,
                              
                            
                           (12) holds.

Next we prove (13). The idea is similar. Fix 
                              
                                 
                                    u
                                    ^
                                 
                                 k
                              
                            and i. We define 
                              
                                 
                                    Y
                                    j
                                 
                                 =
                                 
                                    b
                                    
                                       i
                                       j
                                    
                                 
                                 
                                    x
                                    i
                                 
                                 
                                    (
                                    
                                       
                                          u
                                          ^
                                       
                                       k
                                    
                                    ,
                                    
                                       b
                                       j
                                    
                                    )
                                 
                              
                           . Applying Lemma 8, we get

                              
                                 
                                    
                                       
                                          
                                          
                                          
                                             
                                                P
                                                
                                                   (
                                                   
                                                      ∑
                                                      
                                                         j
                                                         =
                                                         1
                                                      
                                                      
                                                         ℓ
                                                         k
                                                      
                                                   
                                                   
                                                      Y
                                                      j
                                                   
                                                   ≤
                                                   
                                                      
                                                         ℓ
                                                         k
                                                      
                                                      n
                                                   
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                      k
                                                   
                                                   +
                                                   
                                                      ϵ
                                                      2
                                                   
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                      k
                                                   
                                                   ,
                                                   
                                                      ∑
                                                      
                                                         j
                                                         =
                                                         1
                                                      
                                                      n
                                                   
                                                   
                                                      Y
                                                      j
                                                   
                                                   >
                                                   
                                                      (
                                                      1
                                                      +
                                                      ϵ
                                                      
                                                         
                                                            n
                                                            
                                                               ℓ
                                                               k
                                                            
                                                         
                                                      
                                                      )
                                                   
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                      k
                                                   
                                                   )
                                                
                                             
                                          
                                       
                                       
                                          
                                          
                                          
                                             
                                                
                                                ≤
                                                P
                                                
                                                   (
                                                   
                                                      |
                                                      
                                                         ∑
                                                         
                                                            j
                                                            =
                                                            1
                                                         
                                                         
                                                            ℓ
                                                            k
                                                         
                                                      
                                                      
                                                         Y
                                                         j
                                                      
                                                      −
                                                      
                                                         
                                                            ℓ
                                                            k
                                                         
                                                         n
                                                      
                                                      
                                                         ∑
                                                         
                                                            j
                                                            =
                                                            1
                                                         
                                                         n
                                                      
                                                      
                                                         Y
                                                         j
                                                      
                                                      |
                                                   
                                                   >
                                                   
                                                      ϵ
                                                      4
                                                   
                                                   
                                                      
                                                         
                                                            ℓ
                                                            k
                                                         
                                                         n
                                                      
                                                   
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                      k
                                                   
                                                
                                                
                                                   
                                                      |
                                                      
                                                         ∑
                                                         
                                                            j
                                                            =
                                                            1
                                                         
                                                         n
                                                      
                                                      
                                                         Y
                                                         j
                                                      
                                                      >
                                                      
                                                         (
                                                         1
                                                         +
                                                         ϵ
                                                         
                                                            
                                                               n
                                                               
                                                                  ℓ
                                                                  k
                                                               
                                                            
                                                         
                                                         )
                                                      
                                                   
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                      k
                                                   
                                                   )
                                                
                                             
                                          
                                       
                                       
                                          
                                          
                                          
                                             
                                                
                                                ≤
                                                exp
                                                
                                                   (
                                                   −
                                                   
                                                      
                                                         
                                                            ϵ
                                                            2
                                                         
                                                         
                                                            
                                                               u
                                                               ^
                                                            
                                                            i
                                                            k
                                                         
                                                      
                                                      16
                                                   
                                                   )
                                                
                                                ≐
                                                δ
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           Using the same argument as above, Lemma 5 holds.□

The proof consists of two main steps. First we show that with probability 
                              
                                 1
                                 −
                                 ϵ
                                 ,
                              
                            the following is true for all k:

                              
                                 (17)
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ∑
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   m
                                                
                                                
                                                   M
                                                   i
                                                
                                                
                                                   (
                                                   
                                                      
                                                         u
                                                         ˜
                                                      
                                                      i
                                                      k
                                                   
                                                   )
                                                
                                                ≥
                                                
                                                   (
                                                   1
                                                   −
                                                   2
                                                   ϵ
                                                   
                                                      
                                                         n
                                                         
                                                            l
                                                            k
                                                         
                                                      
                                                   
                                                   )
                                                
                                                
                                                   O
                                                   P
                                                   T
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           To show this, we follow a similar step when we prove the optimality of the one-time learning algorithm. Define

                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      v
                                                      ^
                                                   
                                                   i
                                                   k
                                                
                                                =
                                                
                                                   
                                                      u
                                                      ^
                                                   
                                                   i
                                                   k
                                                
                                                
                                                and
                                                
                                                
                                                   
                                                      y
                                                      ^
                                                   
                                                   i
                                                   k
                                                
                                                =
                                                
                                                   max
                                                   i
                                                
                                                
                                                   {
                                                   
                                                      b
                                                      
                                                         i
                                                         j
                                                      
                                                   
                                                   
                                                      M
                                                      i
                                                      ′
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            u
                                                            ^
                                                         
                                                         i
                                                         k
                                                      
                                                      )
                                                   
                                                   }
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           Since 
                              
                                 (
                                 
                                    v
                                    i
                                    k
                                 
                                 ,
                                 
                                    y
                                    i
                                    k
                                 
                                 )
                              
                            is a feasible solution to (4), we know that

                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ∑
                                                   
                                                      j
                                                      =
                                                      1
                                                   
                                                   n
                                                
                                                
                                                   
                                                      y
                                                      ^
                                                   
                                                   j
                                                   k
                                                
                                                +
                                                
                                                   ∑
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   m
                                                
                                                
                                                   (
                                                   
                                                      M
                                                      i
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            u
                                                            ^
                                                         
                                                         i
                                                         k
                                                      
                                                      )
                                                   
                                                   −
                                                   
                                                      M
                                                      i
                                                      ′
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            u
                                                            ^
                                                         
                                                         i
                                                         k
                                                      
                                                      )
                                                   
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                      k
                                                   
                                                   )
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           is an upper bound of OPT. Therefore, by using the same argument as in (12), we know that

                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   O
                                                   P
                                                   T
                                                
                                                −
                                                
                                                   ∑
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   m
                                                
                                                
                                                   M
                                                   i
                                                
                                                
                                                   (
                                                   
                                                      
                                                         u
                                                         ˜
                                                      
                                                      i
                                                      k
                                                   
                                                   )
                                                
                                                ≤
                                                
                                                   ∑
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   m
                                                
                                                
                                                   (
                                                   
                                                      M
                                                      i
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            u
                                                            ^
                                                         
                                                         i
                                                         k
                                                      
                                                      )
                                                   
                                                   −
                                                   
                                                      M
                                                      i
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            u
                                                            ˜
                                                         
                                                         i
                                                         k
                                                      
                                                      )
                                                   
                                                   +
                                                   
                                                      (
                                                      
                                                         
                                                            u
                                                            ˜
                                                         
                                                         i
                                                         k
                                                      
                                                      −
                                                      
                                                         
                                                            u
                                                            ^
                                                         
                                                         i
                                                         k
                                                      
                                                      )
                                                   
                                                   
                                                      M
                                                      i
                                                      ′
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            u
                                                            ^
                                                         
                                                         i
                                                         k
                                                      
                                                      )
                                                   
                                                   )
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           Now for each term above, we consider two cases. If 
                              
                                 
                                    
                                       u
                                       ^
                                    
                                    i
                                    k
                                 
                                 ≥
                                 
                                    
                                       u
                                       ˜
                                    
                                    i
                                    k
                                 
                                 ,
                              
                            then

                              
                                 
                                    
                                       
                                          
                                          
                                          
                                             
                                                
                                                   M
                                                   i
                                                
                                                
                                                   (
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                      k
                                                   
                                                   )
                                                
                                                −
                                                
                                                   M
                                                   i
                                                
                                                
                                                   (
                                                   
                                                      
                                                         u
                                                         ˜
                                                      
                                                      i
                                                      k
                                                   
                                                   )
                                                
                                                +
                                                
                                                   (
                                                   
                                                      
                                                         u
                                                         ˜
                                                      
                                                      i
                                                      k
                                                   
                                                   −
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                      k
                                                   
                                                   )
                                                
                                                
                                                   M
                                                   i
                                                   ′
                                                
                                                
                                                   (
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                      k
                                                   
                                                   )
                                                
                                                ≤
                                                
                                                   M
                                                   i
                                                
                                                
                                                   (
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                      k
                                                   
                                                   )
                                                
                                                −
                                                
                                                   M
                                                   i
                                                
                                                
                                                   (
                                                   
                                                      
                                                         u
                                                         ˜
                                                      
                                                      i
                                                      k
                                                   
                                                   )
                                                
                                             
                                          
                                       
                                       
                                          
                                          
                                          
                                             
                                                
                                                ≤
                                                
                                                   
                                                      
                                                         M
                                                         i
                                                      
                                                      
                                                         (
                                                         
                                                            
                                                               u
                                                               ˜
                                                            
                                                            i
                                                            k
                                                         
                                                         )
                                                      
                                                   
                                                   
                                                      
                                                         u
                                                         ˜
                                                      
                                                      i
                                                      k
                                                   
                                                
                                                
                                                   (
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                      k
                                                   
                                                   −
                                                   
                                                      
                                                         u
                                                         ˜
                                                      
                                                      i
                                                      k
                                                   
                                                   )
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           and with probability 
                              
                                 1
                                 −
                                 ϵ
                                 ,
                              
                            this is less than 
                              
                                 2
                                 ϵ
                                 
                                    
                                       n
                                       
                                          ℓ
                                          k
                                       
                                    
                                 
                                 
                                    M
                                    i
                                 
                                 
                                    (
                                    
                                       
                                          u
                                          ˜
                                       
                                       i
                                       k
                                    
                                    )
                                 
                              
                           ; if 
                              
                                 
                                    
                                       u
                                       ^
                                    
                                    i
                                    k
                                 
                                 <
                                 
                                    
                                       u
                                       ˜
                                    
                                    i
                                    k
                                 
                                 ,
                              
                            then

                              
                                 
                                    
                                       
                                          
                                          
                                          
                                             
                                                
                                                   M
                                                   i
                                                
                                                
                                                   (
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                      k
                                                   
                                                   )
                                                
                                                −
                                                
                                                   M
                                                   i
                                                
                                                
                                                   (
                                                   
                                                      
                                                         u
                                                         ˜
                                                      
                                                      i
                                                      k
                                                   
                                                   )
                                                
                                                +
                                                
                                                   (
                                                   
                                                      
                                                         u
                                                         ˜
                                                      
                                                      i
                                                      k
                                                   
                                                   −
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                      k
                                                   
                                                   )
                                                
                                                
                                                   M
                                                   i
                                                   ′
                                                
                                                
                                                   (
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                      k
                                                   
                                                   )
                                                
                                                ≤
                                                
                                                   (
                                                   
                                                      
                                                         u
                                                         ˜
                                                      
                                                      i
                                                      k
                                                   
                                                   −
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                      k
                                                   
                                                   )
                                                
                                                
                                                   M
                                                   i
                                                   ′
                                                
                                                
                                                   (
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                      k
                                                   
                                                   )
                                                
                                             
                                          
                                       
                                       
                                          
                                          
                                          
                                             
                                                
                                                ≤
                                                
                                                   
                                                      
                                                         M
                                                         i
                                                      
                                                      
                                                         (
                                                         
                                                            
                                                               u
                                                               ^
                                                            
                                                            i
                                                            k
                                                         
                                                         )
                                                      
                                                   
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                      k
                                                   
                                                
                                                
                                                   (
                                                   
                                                      
                                                         u
                                                         ˜
                                                      
                                                      i
                                                      k
                                                   
                                                   −
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                      k
                                                   
                                                   )
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           Again, with probability 
                              
                                 1
                                 −
                                 ϵ
                                 ,
                              
                            this is less than 
                              
                                 2
                                 ϵ
                                 
                                    
                                       n
                                       
                                          ℓ
                                          k
                                       
                                    
                                 
                                 
                                    M
                                    i
                                 
                                 
                                    (
                                    
                                       
                                          u
                                          ˜
                                       
                                       i
                                       k
                                    
                                    )
                                 
                              
                           . Therefore, with probability 
                              
                                 1
                                 −
                                 ϵ
                                 ,
                              
                           
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ∑
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   m
                                                
                                                
                                                   (
                                                   
                                                      M
                                                      i
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            u
                                                            ^
                                                         
                                                         i
                                                         k
                                                      
                                                      )
                                                   
                                                   −
                                                   
                                                      M
                                                      i
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            u
                                                            ˜
                                                         
                                                         i
                                                         k
                                                      
                                                      )
                                                   
                                                   +
                                                   
                                                      (
                                                      
                                                         
                                                            u
                                                            ˜
                                                         
                                                         i
                                                         k
                                                      
                                                      −
                                                      
                                                         
                                                            u
                                                            ^
                                                         
                                                         i
                                                         k
                                                      
                                                      )
                                                   
                                                   
                                                      M
                                                      i
                                                      ′
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            u
                                                            ^
                                                         
                                                         i
                                                         k
                                                      
                                                      )
                                                   
                                                   )
                                                
                                                ≤
                                                2
                                                ϵ
                                                
                                                   
                                                      n
                                                      
                                                         ℓ
                                                         k
                                                      
                                                   
                                                
                                                
                                                   O
                                                   P
                                                   T
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           Therefore, (17) is proved. Next we show that

                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ∑
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   m
                                                
                                                
                                                   M
                                                   i
                                                
                                                
                                                   (
                                                   
                                                      
                                                         u
                                                         ˜
                                                      
                                                      i
                                                      k
                                                   
                                                   )
                                                
                                                −
                                                
                                                   ∑
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   m
                                                
                                                
                                                   M
                                                   i
                                                
                                                
                                                   (
                                                   
                                                      n
                                                      
                                                         ℓ
                                                         k
                                                      
                                                   
                                                   
                                                      
                                                         u
                                                         ¯
                                                      
                                                      i
                                                      k
                                                   
                                                   )
                                                
                                                ≤
                                                4
                                                ϵ
                                                
                                                   
                                                      n
                                                      
                                                         ℓ
                                                         k
                                                      
                                                   
                                                
                                                
                                                   O
                                                   P
                                                   T
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           To see this, by Lemma 5, we know that with probability 
                              
                                 1
                                 −
                                 ϵ
                                 ,
                              
                           
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      u
                                                      ˜
                                                   
                                                   i
                                                   k
                                                
                                                −
                                                
                                                   n
                                                   
                                                      ℓ
                                                      k
                                                   
                                                
                                                
                                                   
                                                      u
                                                      ¯
                                                   
                                                   i
                                                   k
                                                
                                                ≤
                                                2
                                                ϵ
                                                
                                                   
                                                      n
                                                      
                                                         ℓ
                                                         k
                                                      
                                                   
                                                
                                                
                                                   
                                                      u
                                                      ^
                                                   
                                                   i
                                                   k
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           Therefore, for each i, we have

                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            u
                                                            ˜
                                                         
                                                         i
                                                         k
                                                      
                                                      −
                                                      
                                                         n
                                                         
                                                            ℓ
                                                            k
                                                         
                                                      
                                                      
                                                         
                                                            u
                                                            ¯
                                                         
                                                         i
                                                         k
                                                      
                                                   
                                                   
                                                      
                                                         u
                                                         ˜
                                                      
                                                      i
                                                      k
                                                   
                                                
                                                ≤
                                                
                                                   
                                                      2
                                                      ϵ
                                                      
                                                         
                                                            n
                                                            
                                                               ℓ
                                                               k
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            u
                                                            ^
                                                         
                                                         i
                                                         k
                                                      
                                                   
                                                   
                                                      
                                                         (
                                                         1
                                                         −
                                                         ϵ
                                                         
                                                            
                                                               n
                                                               
                                                                  ℓ
                                                                  k
                                                               
                                                            
                                                         
                                                         )
                                                      
                                                      
                                                         
                                                            u
                                                            ^
                                                         
                                                         i
                                                         k
                                                      
                                                   
                                                
                                                ≤
                                                4
                                                ϵ
                                                
                                                   
                                                      n
                                                      
                                                         l
                                                         k
                                                      
                                                   
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           Now we analyze 
                              
                                 
                                    M
                                    i
                                 
                                 
                                    (
                                    
                                       
                                          u
                                          ˜
                                       
                                       i
                                       k
                                    
                                    )
                                 
                                 −
                                 
                                    M
                                    i
                                 
                                 
                                    (
                                    
                                       n
                                       
                                          ℓ
                                          k
                                       
                                    
                                    
                                       
                                          u
                                          ¯
                                       
                                       i
                                       k
                                    
                                    )
                                 
                              
                            for each i. We only need to focus on the case when 
                              
                                 
                                    
                                       u
                                       ˜
                                    
                                    i
                                    k
                                 
                                 >
                                 
                                    n
                                    
                                       ℓ
                                       k
                                    
                                 
                                 
                                    
                                       u
                                       ¯
                                    
                                    i
                                    k
                                 
                              
                            (otherwise the difference is less than 0). In this case, by the concavity of Mi
                           (·), we have

                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   M
                                                   i
                                                
                                                
                                                   (
                                                   
                                                      
                                                         u
                                                         ˜
                                                      
                                                      i
                                                      k
                                                   
                                                   )
                                                
                                                −
                                                
                                                   M
                                                   i
                                                
                                                
                                                   (
                                                   
                                                      n
                                                      
                                                         ℓ
                                                         k
                                                      
                                                   
                                                   
                                                      
                                                         u
                                                         ¯
                                                      
                                                      i
                                                      k
                                                   
                                                   )
                                                
                                                ≤
                                                
                                                   
                                                      
                                                         M
                                                         i
                                                      
                                                      
                                                         (
                                                         
                                                            
                                                               u
                                                               ˜
                                                            
                                                            i
                                                            k
                                                         
                                                         )
                                                      
                                                   
                                                   
                                                      
                                                         u
                                                         ˜
                                                      
                                                      i
                                                      k
                                                   
                                                
                                                
                                                   (
                                                   
                                                      
                                                         u
                                                         ˜
                                                      
                                                      i
                                                      k
                                                   
                                                   −
                                                   
                                                      n
                                                      
                                                         ℓ
                                                         k
                                                      
                                                   
                                                   
                                                      
                                                         u
                                                         ¯
                                                      
                                                      i
                                                      k
                                                   
                                                   )
                                                
                                                ≤
                                                4
                                                ϵ
                                                
                                                   
                                                      n
                                                      
                                                         ℓ
                                                         k
                                                      
                                                   
                                                
                                                
                                                   M
                                                   i
                                                
                                                
                                                   (
                                                   
                                                      
                                                         u
                                                         ˜
                                                      
                                                      i
                                                      k
                                                   
                                                   )
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           Therefore, we have

                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ∑
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   m
                                                
                                                
                                                   M
                                                   i
                                                
                                                
                                                   (
                                                   
                                                      
                                                         u
                                                         ˜
                                                      
                                                      i
                                                      k
                                                   
                                                   )
                                                
                                                −
                                                
                                                   ∑
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   m
                                                
                                                
                                                   M
                                                   i
                                                
                                                
                                                   (
                                                   
                                                      n
                                                      
                                                         ℓ
                                                         k
                                                      
                                                   
                                                   
                                                      
                                                         u
                                                         ¯
                                                      
                                                      i
                                                      k
                                                   
                                                   )
                                                
                                                ≤
                                                4
                                                ϵ
                                                
                                                   
                                                      n
                                                      
                                                         ℓ
                                                         k
                                                      
                                                   
                                                
                                                
                                                   ∑
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   m
                                                
                                                
                                                   M
                                                   i
                                                
                                                
                                                   (
                                                   
                                                      
                                                         u
                                                         ˜
                                                      
                                                      i
                                                      k
                                                   
                                                   )
                                                
                                                ≤
                                                4
                                                ϵ
                                                
                                                   
                                                      n
                                                      
                                                         ℓ
                                                         k
                                                      
                                                   
                                                
                                                
                                                   O
                                                   P
                                                   T
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           Together with (17), Lemma 6
holds.□

First, we note that Lemma 7 implies Lemma 4 (except for the constant part, which can be strengthened easily by only considering one ℓ
                              k
                            in the following proof). Therefore, it suffices to prove Lemma 7.

We first prove for each k, with probability 
                              
                                 1
                                 −
                                 ϵ
                                 /
                                 log
                                 
                                    (
                                    1
                                    /
                                    ϵ
                                    )
                                 
                                 ,
                              
                           
                           
                              
                                 
                                    min
                                    i
                                 
                                 
                                    
                                       u
                                       ^
                                    
                                    i
                                    k
                                 
                                 >
                                 C
                              
                           . Then we take a union bound to prove Lemma 7. To show that for each k, with probability 
                              
                                 1
                                 −
                                 ϵ
                                 /
                                 log
                                 
                                    (
                                    1
                                    /
                                    ϵ
                                    )
                                 
                                 ,
                              
                           
                           
                              
                                 
                                    min
                                    i
                                 
                                 
                                    
                                       u
                                       ^
                                    
                                    i
                                    k
                                 
                                 >
                                 C
                                 ,
                              
                            first we show that with probability 
                              
                                 1
                                 −
                                 ϵ
                                 /
                                 log
                                 
                                    (
                                    1
                                    /
                                    ϵ
                                    )
                                 
                                 ,
                              
                           
                           
                              
                                 
                                    ∑
                                    
                                       j
                                       =
                                       1
                                    
                                    
                                       ℓ
                                       k
                                    
                                 
                                 
                                    b
                                    
                                       i
                                       j
                                    
                                 
                                 ≥
                                 
                                    ℓ
                                    k
                                 
                                 
                                    b
                                    ¯
                                 
                                 /
                                 2
                              
                            for all i. To see this, we use Lemma 8, we have for any i,

                              
                                 
                                    
                                       
                                          
                                          
                                          
                                             
                                                P
                                                
                                                   (
                                                   
                                                      |
                                                      
                                                         ∑
                                                         
                                                            j
                                                            =
                                                            1
                                                         
                                                         
                                                            ℓ
                                                            k
                                                         
                                                      
                                                      
                                                         b
                                                         
                                                            i
                                                            j
                                                         
                                                      
                                                      −
                                                      
                                                         
                                                            ℓ
                                                            k
                                                         
                                                         n
                                                      
                                                      
                                                         ∑
                                                         
                                                            j
                                                            =
                                                            1
                                                         
                                                         n
                                                      
                                                      
                                                         n
                                                         
                                                            i
                                                            j
                                                         
                                                      
                                                      |
                                                   
                                                   ≥
                                                   
                                                      ℓ
                                                      k
                                                   
                                                   
                                                      b
                                                      ¯
                                                   
                                                   /
                                                   2
                                                   )
                                                
                                             
                                          
                                       
                                       
                                          
                                          
                                          
                                             
                                                
                                                ≤
                                                2
                                                exp
                                                
                                                   (
                                                   −
                                                   
                                                      ℓ
                                                      k
                                                   
                                                   
                                                      
                                                         b
                                                         ¯
                                                      
                                                      2
                                                   
                                                   /
                                                   12
                                                   )
                                                
                                                <
                                                
                                                   ϵ
                                                   
                                                      m
                                                      log
                                                      
                                                         (
                                                         1
                                                         /
                                                         ϵ
                                                         )
                                                      
                                                   
                                                
                                                ,
                                             
                                          
                                       
                                    
                                 
                              
                           where the last inequality is due to condition (14). Next we show that given 
                              
                                 
                                    ∑
                                    
                                       j
                                       =
                                       1
                                    
                                    
                                       ℓ
                                       k
                                    
                                 
                                 
                                    b
                                    
                                       i
                                       j
                                    
                                 
                                 ≥
                                 ℓ
                                 
                                    b
                                    ¯
                                 
                                 /
                                 2
                                 ,
                              
                            there cannot exist an i such that 
                              
                                 
                                    
                                       u
                                       ^
                                    
                                    i
                                    k
                                 
                                 <
                                 C
                              
                            in the optimal solution to the partial program (
                              
                                 P
                                 
                                    ℓ
                                    k
                                 
                              
                           ). We prove by contradiction. Let 
                              
                                 K
                                 =
                                 η
                                 
                                    
                                       ϵ
                                       n
                                       
                                          b
                                          ¯
                                       
                                       −
                                       2
                                       ϵ
                                       C
                                    
                                    
                                       2
                                       m
                                       C
                                    
                                 
                              
                           . If there exists i such that 
                              
                                 
                                    
                                       u
                                       ^
                                    
                                    i
                                    k
                                 
                                 <
                                 C
                              
                            in the optimal solution, then we argue that there must exist 1 ≤ j ≤ ℓ
                              k
                            such that

                              
                                 1.
                                 
                                    
                                       
                                          j
                                          ∈
                                          
                                             S
                                             k
                                          
                                          =
                                          
                                             {
                                             j
                                             :
                                             
                                                x
                                                
                                                   i
                                                   j
                                                
                                             
                                             <
                                             1
                                             ,
                                             
                                                b
                                                
                                                   i
                                                   j
                                                
                                             
                                             >
                                             η
                                             }
                                          
                                          ,
                                       
                                     and

There exists i′ such that 
                                       
                                          
                                             x
                                             
                                                
                                                   i
                                                   ′
                                                
                                                j
                                             
                                          
                                          >
                                          0
                                       
                                     and 
                                       
                                          
                                             
                                                u
                                                ^
                                             
                                             
                                                
                                                   i
                                                   ′
                                                
                                             
                                             k
                                          
                                          ≥
                                          K
                                          C
                                       
                                    .

Here these two conditions mean that there must exist a keyword j such that we allocated it (at least partially) to bidder i′ whose total allocation had already exceeded KC when we could have allocated it to bidder i whose final allocation is less than C.

To see this, we note that we have proved with probability 
                              
                                 1
                                 −
                                 ϵ
                                 /
                                 log
                                 
                                    (
                                    1
                                    /
                                    ϵ
                                    )
                                 
                                 ,
                              
                           
                           
                              
                                 
                                    ∑
                                    
                                       j
                                       =
                                       1
                                    
                                    
                                       ℓ
                                       k
                                    
                                 
                                 
                                    b
                                    
                                       i
                                       j
                                    
                                 
                                 ≥
                                 
                                    ℓ
                                    k
                                 
                                 
                                    b
                                    ¯
                                 
                                 /
                                 2
                              
                           . However, by the definition of i, 
                              
                                 
                                    u
                                    i
                                    k
                                 
                                 <
                                 C
                                 ,
                              
                            thus we also have 
                              
                                 
                                    ∑
                                    
                                       j
                                       =
                                       1
                                    
                                    
                                       ℓ
                                       k
                                    
                                 
                                 
                                    b
                                    
                                       i
                                       j
                                    
                                 
                                 
                                    x
                                    
                                       i
                                       j
                                    
                                 
                                 ≤
                                 
                                    ℓ
                                    k
                                 
                                 C
                                 /
                                 n
                              
                           . Therefore, combined with the assumption that max 
                              i, j
                           
                           bij
                            ≤ 1, there must exist at least 
                              
                                 
                                    ℓ
                                    k
                                 
                                 
                                    b
                                    ¯
                                 
                                 /
                                 2
                                 −
                                 
                                    ℓ
                                    k
                                 
                                 C
                                 /
                                 n
                              
                            
                           js between 1 and ℓ
                              k
                            such that xij
                            < 1 but bij
                            ≥ η, i.e., 
                              
                                 
                                    |
                                 
                                 
                                    S
                                    k
                                 
                                 
                                    |
                                    ≥
                                 
                                 
                                    ℓ
                                    k
                                 
                                 
                                    b
                                    ¯
                                 
                                 /
                                 2
                                 −
                                 
                                    ℓ
                                    k
                                 
                                 C
                                 /
                                 n
                              
                           .

Next we show that among j ∈ Sk
                           , there exists at least one j such that 
                              
                                 
                                    x
                                    
                                       
                                          i
                                          ′
                                       
                                       j
                                    
                                 
                                 >
                                 0
                              
                            while 
                              
                                 
                                    
                                       u
                                       ^
                                    
                                    
                                       
                                          i
                                          ′
                                       
                                    
                                    k
                                 
                                 ≥
                                 K
                                 C
                              
                            for some i′. We define 
                              
                                 
                                    T
                                    k
                                 
                                 =
                                 
                                    {
                                    i
                                    :
                                    
                                       
                                          u
                                          ^
                                       
                                       i
                                       k
                                    
                                    <
                                    K
                                    C
                                    }
                                 
                              
                           . We have

                              
                                 (18)
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ∑
                                                   
                                                      i
                                                      ∈
                                                      T
                                                      ,
                                                      j
                                                      ∈
                                                      
                                                         S
                                                         k
                                                      
                                                   
                                                
                                                
                                                   x
                                                   
                                                      i
                                                      j
                                                   
                                                
                                                ≤
                                                
                                                   1
                                                   η
                                                
                                                
                                                   ∑
                                                   
                                                      i
                                                      ∈
                                                      T
                                                      ,
                                                      j
                                                      ∈
                                                      
                                                         S
                                                         k
                                                      
                                                   
                                                
                                                
                                                   b
                                                   
                                                      i
                                                      j
                                                   
                                                
                                                
                                                   x
                                                   
                                                      i
                                                      j
                                                   
                                                
                                                <
                                                
                                                   
                                                      m
                                                      K
                                                      C
                                                   
                                                   η
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           
                        

Here the second inequality is because |T| < m. However, we also have

                              
                                 (19)
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ∑
                                                   
                                                      i
                                                      ,
                                                      j
                                                      ∈
                                                      
                                                         S
                                                         k
                                                      
                                                   
                                                
                                                
                                                   x
                                                   
                                                      i
                                                      j
                                                   
                                                
                                                ≥
                                                
                                                   
                                                      
                                                         ℓ
                                                         k
                                                      
                                                      
                                                         b
                                                         ¯
                                                      
                                                   
                                                   2
                                                
                                                −
                                                
                                                   
                                                      
                                                         ℓ
                                                         k
                                                      
                                                      C
                                                   
                                                   n
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           This is because Mi
                           (·)s are increasing, thus each ∑
                              i
                           
                           xij
                            must equal 1 at optimality. Then, by taking the difference between (18) and (19), we have that

                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ∑
                                                   
                                                      i
                                                      ∉
                                                      T
                                                      ,
                                                      j
                                                      ∈
                                                      
                                                         S
                                                         k
                                                      
                                                   
                                                
                                                
                                                   x
                                                   
                                                      i
                                                      j
                                                   
                                                
                                                >
                                                
                                                   
                                                      
                                                         ℓ
                                                         k
                                                      
                                                      
                                                         b
                                                         ¯
                                                      
                                                   
                                                   2
                                                
                                                −
                                                
                                                   
                                                      
                                                         ℓ
                                                         k
                                                      
                                                      C
                                                   
                                                   n
                                                
                                                −
                                                
                                                   
                                                      m
                                                      K
                                                      C
                                                   
                                                   η
                                                
                                                ≥
                                                0
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           The last inequality is by the definition of K and that 
                              
                                 
                                    ℓ
                                    k
                                 
                                 ≥
                                 ϵ
                                 n
                              
                            for all k. Therefore, there exists j ∈ Sk
                            such that the bid is allocated to some i′ with 
                              
                                 
                                    
                                       u
                                       ^
                                    
                                    
                                       
                                          i
                                          ′
                                       
                                    
                                    k
                                 
                                 ≥
                                 K
                                 C
                              
                           . We denote such j by j
                           *.

Finally, we consider another allocation that increases the allocation of j
                           * to i while decreasing the allocation to i′. The local change of the objective function at this point is:

                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   M
                                                   i
                                                   ′
                                                
                                                
                                                   (
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      i
                                                      k
                                                   
                                                   )
                                                
                                                
                                                   b
                                                   
                                                      i
                                                      j
                                                   
                                                
                                                −
                                                
                                                   M
                                                   
                                                      i
                                                      ′
                                                   
                                                   ′
                                                
                                                
                                                   (
                                                   
                                                      
                                                         u
                                                         ^
                                                      
                                                      
                                                         
                                                            i
                                                            ′
                                                         
                                                      
                                                      k
                                                   
                                                   )
                                                
                                                
                                                   b
                                                   
                                                      
                                                         i
                                                         ′
                                                      
                                                      j
                                                   
                                                
                                                ≥
                                                
                                                   M
                                                   i
                                                   ′
                                                
                                                
                                                   (
                                                   C
                                                   )
                                                
                                                η
                                                −
                                                
                                                   M
                                                   
                                                      i
                                                      ′
                                                   
                                                   ′
                                                
                                                
                                                   (
                                                   K
                                                   C
                                                   )
                                                
                                                >
                                                0
                                             
                                          
                                       
                                    
                                 
                              
                           where the first inequality is due to the concavity of Mi
                           (·)s and the last inequality is due to condition (14). However, this contradicts the assumption that the solution is optimal. Thus, Lemma 7 is proved.□

@&#REFERENCES@&#

