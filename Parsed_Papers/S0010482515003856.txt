@&#MAIN-TITLE@&#Estimating the parameters of multi-state models with time-dependent covariates through likelihood decomposition

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           Currently, various successive treatments are offered to people with ESRD.


                        
                        
                           
                           The demand increase requires modelling these treatments for provisional purposes.


                        
                        
                           
                           Modeling should allow for several treatments as for time-dependent covariates.


                        
                        
                           
                           We present and test an approach that allows for an unlimited number of treatments.


                        
                        
                           
                           This approach may be extended to allow for various other management constraints.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

End-stage renal disease

Transition rates

Markov models

Multi-state models

Time-dependent covariates

@&#ABSTRACT@&#


               
               
                  Background
                  Multi-state models become complex when the number of states is large, when back and forth transitions between states are allowed, and when time-dependent covariates are inevitable. However, these conditions are sometimes necessary in the context of medical issues. For instance, they were needed for modelling the future treatments of patients with end-stage renal disease according to age and to various treatments.
               
               
                  Methods
                  The available modelling tools do not allow an easy handling of all issues; we designed thus a specific multi-state model that takes into account the complexity of the research question. Parameter estimation relied on decomposition of the likelihood and separate maximisations of the resulting likelihoods. This was possible because there were no interactions between patient treatment courses and because all exact times of transition from any state to another were known. Poisson likelihoods were calculated using the time spent at risk in each state and the observed transitions between each state and all others. The likelihoods were calculated on short time intervals during which age was considered as constant.
               
               
                  Results
                  The method was not limited by the number of parameters to estimate; it could be applied to a multi-state model with 10 renal replacement therapies. Supposing the parameters of the model constant over each of seven time intervals, this method was able to estimate one hundred age-dependent transitions.
               
               
                  Conclusions
                  The method is easy to adapt to any disease with numerous states or grades as long as the disease does not imply interactions between patient courses.
               
            

@&#INTRODUCTION@&#

Multi-state models have already been widely used in medicine. These models are of great interest in studying chronic diseases with several grades and/or treatments [1]. When the number of states is large, when back and forth transitions between states are allowed, and when time-dependent covariates (such as age) have to be taken into account, the resulting model can become quite complex. We faced all these difficulties when we designed a model to describe the successive treatments offered to patients with end-stage renal disease (ESRD).

ESRD is a life-threatening condition but, in the sixties, renal replacement therapies (RRTs) radically changed patients׳ prognoses and led to longer survivals, especially in renal transplant patients. Currently, ESRD patients may experience several switches between various RRTs [2,3], and, in several countries, registries have been established to collect data on these switches [4–7]. These switches can be described using the rates of transition between different RRTs.

Various solutions have been proposed to solve the specific problems of multi-state models in medical research [1,8,9]. These solutions are extensions of survival data analyses applied to settings with multiple transitions and competing risks [10–16]. In fact, several authors succeeded in using these solutions to analyse ESRD datasets, but their models used small numbers of transitions (only the main RRTs were studied), and they considered only age as a categorical variable (i.e., the estimates of the parameters were made for age classes) [17–19].

In France, 10 different RRT modalities are used and all of them should be considered to model the successive treatments a patient may undergo; this requires the estimation of a high number of transition rates. Moreover, the transitions to renal transplantation or death depend on the patients׳ age which should be integrated into the model.

The data recorded in the French ESRD registry [4] have two features that helped us overcome these difficulties. First, the patients׳ treatment courses are independent (that is, the switch of a patient from one treatment to another does not depend on the treatments the other patients are undergoing). Second, the exact times of all transitions from any treatment to another are known. These two features make it possible to decompose a multi-state model into sub-models whose likelihoods can be separately maximised [8,10].

In this paper, we explain the way we solved a complex problem with a simple implementation of likelihood decomposition. This decomposition greatly facilitates the theoretical analysis and the numerical solution. Afterwards, considering short time intervals during which the time-dependent covariates are supposed constant led to the estimation of these covariate effects on the transition rates.

Several studies on ESRD patients are longitudinal studies with possible state changes [17,18,20]: the RRT may change over time during the disease. The three main RRTs are haemodialysis (HD), peritoneal dialysis (PD), and renal transplantation (TX). These RRTs may be subdivided further according to the technique, the type of facility, the type of assistance, and the type of renal graft.

The French Renal Epidemiology and Information Network (REIN) registry [4] collects data on patients with ESRD who might undergo one to ten different RRTs. REIN registry contains data on patients registered since ESRD onset (incident patients) and data on patients registered late after ESRD onset (but whose date of ESRD onset is available: prevalent patients). At registration, the mean time since ESRD onset in prevalent patients was 6.1 years (SD: 6.2 years). Overall, the dataset studied here includes 67,258 patients, 206,401 person-years of follow-up, and 56,084 transitions (between 10 RRTs+state “death”). 
                        Table 1 presents the main characteristics of REIN registry population. The complexity of ESRD data is due to the high number of possible transitions (100 possibilities including back and forth transitions) and to the dataset structure that includes left-truncated, interval-censored, and right-censored observations. One advantage of REIN registry is that, as soon as a patient is registered, all changes in RRT are recorded with the exact time of transition from any state to another.

From ESRD onset to death, the patients may undergo several of 10 different RRTs. A multi-state model may then be used to describe the transitions between RRTs and between each RRT and death. This leads to a model with 20 different states: 10 for the RRTs and 10 to indicate the RRT at patient death. No impossible transition between RRTs was considered, including back and forth transitions. Being in a given treatment, a patient may be switched to any other treatment whatever the treatments he/she had previously undergone. Here, for simplicity, the figures and equations present a model with one state for peritoneal dialysis instead of four, one state for haemodialysis instead of four, one state for transplantation instead of two, and three states for death instead of 10 (
                        Fig. 1).

The time of interest was the time since ESRD onset in each patient because the transition rates from one state to another depends on the time elapsed since ESRD onset.

Formally, this multi-state model may be written in terms of rates of transition between states. The process of patients moving between states was assumed to be Markovian: i.e., any change for a given patient depends only on the current state, not on the time spent in the current state. A proportional hazard model was chosen to take into account various covariates. Thus, the rate of transition from a given state i to another state j at time t (the delay since ESRD onset) for all patients whose characteristics are Z(t) at time t may be written [14]:
                           
                              
                                 
                                    
                                       
                                          λ
                                       
                                       
                                          i
                                          j
                                       
                                    
                                    (
                                    t
                                    ,
                                    Z
                                    (
                                    t
                                    )
                                    )
                                    =
                                    
                                       
                                          λ
                                       
                                       
                                          i
                                          j
                                          ,
                                          0
                                       
                                    
                                    (
                                    t
                                    )
                                    *
                                    exp
                                    (
                                    
                                       
                                          β
                                       
                                       
                                          i
                                          j
                                       
                                       
                                          T
                                       
                                    
                                    Z
                                    (
                                    t
                                    )
                                    )
                                 
                              
                           
                        where 
                           
                              
                                 
                                    λ
                                 
                                 
                                    i
                                    j
                                    ,
                                    0
                                 
                              
                              (
                              t
                              )
                           
                         represents the baseline transition rate between states i and j at time t and 
                           
                              
                                 β
                              
                              
                                 i
                                 j
                              
                           
                         the vector of regression parameters that represents the effect of characteristics 
                           
                              Z
                              (
                              t
                              )
                           
                         on the transition rate. A log-linear model for the effects of the covariates on the rates was considered.

The classical inference method with Markov models on individual data was already described by Kay [8]. The likelihood is calculated from the matrix of transition probabilities obtained from the above-described transition rates. This method allows for the complexity induced by truncation and censoring through writing a specific contribution to the likelihood of those patients concerned by truncation and/or censoring. The method allows also having non-homogenous Markov models by defining time intervals over which the transition rates are supposed constant. The maximisation of the likelihood could have been obtained with msm package of R software [21,22], a package developed with panel observations [23]. Here, the data are less complex and do not justify the use of the sophisticated msm. Moreover, with this package, when using a time-dependent covariate, this covariate is considered constant between two observations. When studying ESRD data, the observations correspond to the times at which the patients change from one state to another. For some patients, the time spent in a given state can be quite long (the case of transplanted patients); thus, the hypothesis of constant age between two observations is too strong. This means that the data have to be split along the age scale using, for example, the Lexis class of Epi package [24,25] before using msm package.

In REIN registry, despite the presence of truncation and censoring (described above), as soon as a patient is registered – that is, he/she becomes at risk of switching from one state to another – every transition and its exact time is known. In this case, mstate package of R [26] can be used and the preparation of the data can be done using the Lexis class of Epi package [25] that was especially designed for mstate package. The preparation of the data and the specification of the model using this package can be quite cumbersome when the number of transitions is high and when different covariates are considered. Indeed, for every transition studied and every level of a covariate, a column has to be added to the data. For ESRD data, modelling the ten RRT states requires one hundred transitions. If every transition depends on several covariates, the number of columns to add becomes quite high and handling the R object becomes very difficult. To simplify the formulation of the model and the manipulation of the dataset, we developed in SAS and R software a tool based on the decomposition of the likelihood.

When the exact times of transition are known and the transition rates considered constant over the studied time interval (
                              
                                 
                                    
                                       λ
                                    
                                    
                                       i
                                       j
                                    
                                 
                                 (
                                 t
                                 ,
                                 Z
                                 (
                                 t
                                 )
                                 )
                                 =
                                 
                                    
                                       λ
                                    
                                    
                                       i
                                       j
                                    
                                 
                              
                           ), the formula of the likelihood becomes quite simple [10]; it reduces to:
                              
                                 
                                    
                                       
                                          ∏
                                          
                                             i
                                             ≠
                                             j
                                          
                                       
                                       
                                          
                                             ∏
                                             j
                                          
                                          
                                             
                                                
                                                   λ
                                                
                                                
                                                   i
                                                   j
                                                
                                                
                                                   
                                                      
                                                         N
                                                      
                                                      
                                                         i
                                                         j
                                                      
                                                   
                                                
                                             
                                             *
                                             exp
                                             (
                                             −
                                             
                                                
                                                   λ
                                                
                                                
                                                   i
                                                   j
                                                
                                             
                                             *
                                             
                                                
                                                   Y
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                          
                                       
                                    
                                 
                              
                           where 
                              
                                 
                                    Y
                                 
                                 
                                    i
                                 
                              
                            is the total time spent in state i by all individuals during the studied time interval and 
                              
                                 
                                    N
                                 
                                 
                                    i
                                    j
                                 
                              
                            the number of transitions from a state i to another state j. In this expression, the competing risks are taken into account by calculating the time spent at risk in each transient state.

From this formula, the number of transitions 
                              
                                 
                                    N
                                 
                                 
                                    i
                                    j
                                 
                              
                            can be modelled as a Poisson process [8,10,27] whose expectation 
                              
                                 
                                    μ
                                 
                                 
                                    i
                                    j
                                 
                              
                            may be written:
                              
                                 
                                    
                                       
                                          
                                             μ
                                          
                                          
                                             i
                                             j
                                          
                                       
                                       =
                                       
                                          
                                             Y
                                          
                                          
                                             i
                                          
                                       
                                       *
                                       
                                          
                                             λ
                                          
                                          
                                             i
                                             j
                                          
                                       
                                    
                                 
                              
                           
                        

Thus, it is possible to decompose the likelihood of the complete multi-state model into separate independent likelihoods, one for each transition.

As every transition from each state depends on the total time spent in this state, we chose, for simplification, to split the total likelihood according to the transient states. This allows the different transition rates from a given state to share common parameters. 
                           Fig. 2 shows the decomposition of the model displayed in Fig. 1 into three sub-models, each focusing on a given transient state.

To allow the introduction of time-dependent covariates into the model, each individual course since ESRD onset was split into one-month periods, the time-dependent covariate being supposed constant over each period. Then, within each period, the time spent at risk in each transient state and the number of observed transitions between states were calculated.

Now, to better describe the introduction of time-dependent covariates, let us consider, for example, the sub-model relative to state TX (state 3). During a given month k, for a patient whose characteristics 
                              
                                 Z
                                 (
                                 t
                                 )
                                 =
                                 
                                    
                                       Z
                                    
                                    
                                       k
                                    
                                 
                              
                            are supposed constant during this short period, Y
                           3k
                            is the time spent at risk of transition out of state TX and N
                           31k
                           
                           , N
                           32k
                           , and N
                           36k
                           , the respective observed transitions from state TX to states PD, HD, and death. Each N
                           3jk
                            (j in {1,2,6}) may be modelled as a realisation of a Poisson process whose expectation 
                              
                                 
                                    μ
                                 
                                 
                                    3
                                    j
                                    k
                                 
                              
                            
                           
                              
                                 (
                                 
                                    
                                       Z
                                    
                                    
                                       k
                                    
                                 
                                 )
                              
                            may be written:
                              
                                 
                                    
                                       
                                          
                                             μ
                                          
                                          
                                             3
                                             j
                                             k
                                          
                                       
                                       (
                                       
                                          
                                             Z
                                          
                                          
                                             k
                                          
                                       
                                       )
                                       =
                                       
                                          
                                             Y
                                          
                                          
                                             3
                                             k
                                          
                                       
                                       *
                                       
                                          
                                             λ
                                          
                                          
                                             3
                                             j
                                          
                                       
                                       (
                                       
                                          
                                             Z
                                          
                                          
                                             k
                                          
                                       
                                       )
                                    
                                 
                              
                           
                        

For example, when we suppose an effect of age on each transition rate; Z
                           
                              k
                            is equal to agek
                            which is supposed constant over the time interval k of one month. The baseline intensity rate and the effect of age are also considered constant over each month period. The transition rate from state TX to state j can be written:
                              
                                 
                                    
                                       
                                          
                                             λ
                                          
                                          
                                             3
                                             j
                                          
                                       
                                       (
                                       a
                                       g
                                       
                                          
                                             e
                                          
                                          
                                             k
                                          
                                       
                                       )
                                       =
                                       
                                          
                                             λ
                                          
                                          
                                             3
                                             j
                                             ,
                                             0
                                          
                                       
                                       *
                                       exp
                                       (
                                       
                                          
                                             β
                                          
                                          
                                             3
                                             j
                                          
                                       
                                       *
                                       a
                                       g
                                       
                                          
                                             e
                                          
                                          
                                             k
                                          
                                       
                                       )
                                       
                                       f
                                       o
                                       r
                                       
                                       j
                                       
                                       i
                                       n
                                       
                                       
                                          {
                                          
                                             1
                                             ,
                                             2
                                             ,
                                             6
                                          
                                          }
                                       
                                    
                                 
                              
                           
                        

A Poisson likelihood was written to estimate the baseline intensity rates (λ
                           31,0, λ
                           32,0, λ
                           36,0
                           ) and the effects of age (β
                           31,β
                           32, β
                           36
                           ).

This decomposition of the likelihood with introduction of time-dependent covariates is described here for three transient states but it can be easily applied to several transient states; the whole model is then decomposed into as many sub-models as there are transient states.

Tools are available in SAS and R software to split the data (Lexis expansion) according to the time since ESRD onset and age [25,28]. For the application on ESRD data, this likelihood was maximised using the Newton–Raphson option of PROC NLP of SAS 9.2 software. The confidence intervals were calculated with Wald method. Maximisation was also developed in R software using Newton-type algorithm through function nlm. The R code consists of three main functions: the first allows preparing the data for the calculation of separated likelihoods, the second estimates the parameters through maximisation of the likelihood, and the third predicts the number of patients in the different states according to the estimated parameters. All these functions, as well as an example of their use on simulated data, are available on request from the authors.

Within the ESRD context, the clinicians are interested in the marginal distributions [29] of the patients over the different states; i.e., the number of patients that will be present in each state according to the time since ESRD onset. The graphical assessment consists in comparing the observed probabilities of being in each state with the predicted probabilities. A monthly count of the patients in each state was used to generate an observed proportion of patients in each state. First, the survival function was estimated using this count and an actuarial method, then the probability of being in each state during each month was obtained by multiplying the survival function by the proportion of patients present in this state among live patients. This observed repartition of the patients was finally compared with the one predicted from solving the system of differential equations stemming from the multi-state model [30]. Indeed, because the whole transition process was supposed Markovian, the multi-state model may be written using a system of differential equations [30]. This approach is used for prediction then the cumulative observed and predicted probabilities of being in each state [26] were plotted in function of the time elapsed since ESRD onset. This graph allows checking the predicted marginal distributions.

@&#RESULTS@&#

First, the method was used with only three RRTs (Fig. 1). In this application, each transition rate was considered dependent on age and the effect of age on the transition rate from TX to PD considered equal to the effect on the transition rate from TX to HD. 
                        Table 2 presents the estimated parameters obtained with this model. As expected, the parameters relative to age were positive and significant at 5% for the transition rates to death whereas they were negative and significant at 5% for the transition rates to transplantation.


                        
                        Fig. 3A presents the predicted and the observed repartitions of the patients over the various states. The predicted marginal distribution obtained was close to the observed one.

The simple model described above was further improved by considering the parameters constant over six time intervals: [0–6], ]6‐12], ]12‐18], ]18‐24], ]24‐36], and ]36‐60] months after ESRD onset. For each transient state, the likelihood was separately maximised over each time interval. As above, each transition rate was considered dependent on age and the effect of age on the transition rate from TX to PD considered equal to the effect on the transition rate from TX to HD. The results are shown in Fig. 3B. As expected, the predicted and observed repartitions are close and the fit is improved versus the previous case where only one time interval of 60 months was considered.

To answer the clinical question (i.e., prediction of the probability of undergoing each RRT according to the delay since ESRD onset), all ESRD treatments used in France had to be considered. Moreover the treatment courses had to be studied over the first 15 years of ESRD. A model with 10 RRTs led to the modelling of 100 transition rates, each of which depended on age and sex. The effect of age was supposed log-linear and the parameters were supposed constant over each of seven time intervals: [0–6], ]6‐12], ]12‐18], ]18‐24], ]24‐36], ]36‐60], and ]60‐180] months after ESRD onset. For each transient state, the likelihood was separately maximised over each time interval. For transplantation-related states, the effects of age and sex were considered equal in the calculation of the transition rates to the four PD-related states and to the four HD-related states.

Here, we should note that the hypothesis of a log-linear effect of age on the various transition rates is true when the age distribution is not too large. Moreover, diabetes is frequent within the context of ESRD and the RRT strategy differs between patients with and without diabetes. For these two reasons, the parameters were estimated for various patient subgroups defined by age-group and diabetic status at ESRD onset. Three classes of age were then considered (18–44, 45–69, and over 70 years). 
                        Fig. 4 shows the predicted repartition of non-diabetic patients aged 45–69 years old over the ten RRTs on the basis of the estimations obtained on this subgroup and considering the observed age distribution of this subgroup at ESRD onset. 
                        Fig. 5 presents the transition rates for which a significant effect of age was found. As expected, among the 27 transition rates for which a positive effect of age was found, 22 (81%) were transition rates to state “death”. Among the 43 transition rates for which a negative effect of age was found, 19 (44%) were transition rates to “cadaveric renal transplant” and 25 (58%) transitions from “in-centre HD” state. The predicted repartitions relative to the other five subgroups of patients are presented in Fig. A1 of the Supplementary Material.

@&#DISCUSSION AND CONCLUSION@&#

The follow-up of the treatment courses of ESRD patients requires the use of complex models with high numbers of states to allow for all RRTs [3]. In this study, estimating the transition rates with individual data and considering effects of time-dependent covariates with the available tools in R software [21,26] was quite complicated to program. The alternative method presented here simplified the handling of the data and was easily reproducible.

The method is based on the decomposition of the likelihood. The complete model is decomposed into several simple, easy-to-implement, and fast-to-converge sub-models. This decomposition is possible when the patients׳ courses are independent and when, as soon as the patients are at risk of switching from one state to another, all transitions are examined and their times exactly known. This method handled very simply all incomplete observations. No specific contribution to the likelihood had to be allocated to patients with incomplete follow-ups. Instead, these incomplete follow-ups were taken into account by calculating the duration of stay in each state (i.e., the time spent at risk in each state). Moreover, the data have to be split in short time-intervals (here, one-month intervals). This required a step of data preparation according to Lexis expansion but, once this step is done, the tool becomes easy to use.

As shown by Putter et al. [15], multi-state models are of great interest because of their flexibility. For example, the present study used a non-homogeneous Markov Model (constant rate per time interval); however, a semi-Markov model could have been used (with variable rates according to the time spent in a given state) [10]. This consists in using a “clock-reset” time scale (time since entry in each state) [13] instead of the time since ESRD onset. This development will be of great interest because the probability of obtaining a renal graft from a deceased donor for a patient put on a waiting list does not depend only on the time since ESRD onset but also on the time since registration on the waiting list [31].

The model presented here may be improved by considering a few additional states to reflect more precisely the history of every patient. This would lead to a partial progressive model. For example, distinguishing the patients who are on HD since ESRD onset from those put on HD because of a graft loss would improve the fit of the model. As the present method allows a simultaneous estimation of a great number of parameters, these additional states would not introduce further computational difficulties.

This method has already been applied in epidemiology to simulate the impact of different treatment strategies on patient trajectories [32] and costs [33] according to the delay since ESRD onset. The same method may be extended to a calendar time scale. This extension aims at predicting the number of patients in different RRTs over a calendar time and would allow the introduction into the model of potential changes in clinical practices, at the population level, over this calendar time.

Because the French medical practices regarding RRT may greatly differ from one Region to another and because of renal graft shortage, it would be useful to implement this method on Region-specific data. A Region per Region study may be a way of testing whether the method yields good prediction results with smaller samples than whole French territory data. Working at a small spatial scale leads to take into account the constraints linked to the healthcare system at this scale; e.g., the presence of local recommendations, the number of patients each centre is able to manage, or the number of grafts available at a given time point. Within this context, the hypothesis of independent treatment courses should be more closely checked.

This method is easily reproducible but not in all situations. Indeed, the method requires the knowledge of the exact times of transition and the transitions to be independent. For example, it cannot be applied: (i) to panel observation data where the patients׳ states are known at fixed time points (say, yearly) but the times of event occurrence unknown (in this case msm would be more suitable); and (ii) to infectious diseases because patients׳ courses are not independent; “interactions – here, contamination – between subjects play role” [29].

In conclusion, the problems raised by the collective follow-up of ESRD patients have led to the development of the present method that proved to be very efficient in estimating the high number of parameters inherent to complex multi-state models. This method can be successfully applied to the treatment courses of various diseases whenever these courses are independent [30]. It will also prove useful for the analysis of data in oncology and chronic diseases with multiple events.

The authors declare that they have no conflicts of interest.

Agence de la Biomédecine and Haute Autorité de Santé.

@&#ACKNOWLEDGEMENTS@&#

We thank the Agence de la Biomédicine and the Haute Autorité de Santé for their financial support as well as the nephrologists and the professionals who collected and controlled the quality of REIN registry data.

We also thank Jean Iwaz, Ph.D. and scientific advisor, for several comments and suggestions that improved this manuscript.

Supplementary data associated with this article can be found in the online version at doi:10.1016/j.compbiomed.2015.11.016.


                     
                        
                           
                              Supplementary material
                           
                           
                        
                     
                  

@&#REFERENCES@&#

