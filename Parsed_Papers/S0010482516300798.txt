@&#MAIN-TITLE@&#Automatic iterative segmentation of multiple sclerosis lesions using Student's t mixture models and probabilistic anatomical atlases in FLAIR images

@&#HIGHLIGHTS@&#


               
                  
                  
                     
                        
                           
                           Automatic MS lesion segmentation in FLAIR images using Student's t mixture models.


                        
                        
                           
                           Segmentation performed in an iterative manner allowing successive lesion refinement.


                        
                        
                           
                           Very good spatial and volumetric agreement with raters.


                        
                        
                           
                           Results comparable and, in some cases, better than the current state-of-the-art.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Image segmentation

Multiple sclerosis

Mixture models

Student's t distribution

Probabilistic anatomical atlases

@&#ABSTRACT@&#


               
               
                  Multiple sclerosis (MS) is a demyelinating autoimmune disease that attacks the central nervous system (CNS) and affects more than 2 million people worldwide. The segmentation of MS lesions in magnetic resonance imaging (MRI) is a very important task to assess how a patient is responding to treatment and how the disease is progressing. Computational approaches have been proposed over the years to segment MS lesions and reduce the amount of time spent on manual delineation and inter- and intra-rater variability and bias. However, fully-automatic segmentation of MS lesions still remains an open problem. In this work, we propose an iterative approach using Student's t mixture models and probabilistic anatomical atlases to automatically segment MS lesions in Fluid Attenuated Inversion Recovery (FLAIR) images. Our technique resembles a refinement approach by iteratively segmenting brain tissues into smaller classes until MS lesions are grouped as the most hyperintense one. To validate our technique we used 21 clinical images from the 2015 Longitudinal Multiple Sclerosis Lesion Segmentation Challenge dataset. Evaluation using Dice Similarity Coefficient (DSC), True Positive Ratio (TPR), False Positive Ratio (FPR), Volume Difference (VD) and Pearson's r coefficient shows that our technique has a good spatial and volumetric agreement with raters' manual delineations. Also, a comparison between our proposal and the state-of-the-art shows that our technique is comparable and, in some cases, better than some approaches, thus being a viable alternative for automatic MS lesion segmentation in MRI.
               
            

@&#INTRODUCTION@&#

Multiple sclerosis (MS) is a demyelinating autoimmune disease that attacks the central nervous system (CNS) and affects more than 2 million people worldwide [1]. It is mainly characterized by the presence of white matter (WM) lesions [2], which are visible on magnetic resonance imaging (MRI) scans and appear hyper-intense on T2-weighted and Fluid Attenuated Inversion Recovery (FLAIR) images. Segmentation of MS lesions is usually done by a radiologist, who has to visually assess and manually delineate them when measuring total lesion volume. Since MRI brain scans are usually volumetric, the manual delineation procedure is done in a slice-by-slice manner, which is time consuming and suffers from large intra- and inter-rater variability and bias [3].

Clinical trials have shown that lesion volumes are meaningful outcomes for assessing disease burden in multiple sclerosis (MS) [4], and thus accurately measuring such volumes is of considerable interest in clinical practice [5]. In this scenario, an automated technique to segment MS lesions and measure their volumes would reduce the time needed from the rater and decrease the observer dependency as well. However, automatic segmentation of MS lesions is challenging, since a number of variables such as partial volume effect (PVE), bias field, acquisition parameters and different scanner magnetic field strengths may directly influence the segmentation outcome. There have been many proposals over the years regarding automatic MS lesion segmentation, but no single one appears to be widely used at the present time. The proposed techniques range from a myriad of approaches such as dictionary learning [6], logistic regression [7,8], patch-based [9], random decision forest [10] and mixture models [11,12].

In this paper, we propose a new fully-automatic technique for MS lesions' segmentation in MR FLAIR images using an iterative approach based on Student's t mixture models and probabilistic anatomical atlases. Our technique resembles a refinement approach by iteratively segmenting brain tissue classes into subclasses until MS lesions are grouped as the most hyperintense one. Since our segmentation technique is intensity-based, we use probabilistic anatomical atlases to constrain the iterative process to the WM region, thus avoiding misclassification of voxels that have similar intensities to lesion voxels but are outside the WM tissue class.

To validate our technique we used 21 images from the 2015 Longitudinal Multiple Sclerosis Lesion Segmentation Challenge (also known as 2015 ISBI Longitudinal Challenge) and assessed its performance using the Dice Similarity Coefficient (DSC), True Positive Ratio (TPR), False Positive Ratio (FPR), Volume Difference (VD) and Pearson's r coefficient on our results and rater manual delineations. It is important to note that each case in the dataset had 2 lesion delineations, each one done by a different rater, and we compared our results to both of them. Also, in some cases the manual delineations did not have a good agreement rate between themselves, which confirms the inter-variability and bias between observers.

We also compared our findings with proposals that took part in the 2015 ISBI Longitudinal Challenge. Since they used the same database as we did, a direct comparison was possible. We briefly describe the works that presented quantitative results in the following.

In [13], an automatic hierarchical framework for the segmentation of healthy tissues and lesions in brain MRI was proposed. The authors used a Markov Random Field segmentation framework that leveraged spatial prior probabilities for 9 healthy tissues through multi-atlas fusion and then used a random forest classifier to provide region level lesion refinement.

In [14], lesions were segmented using a fast patch matching approach, which was extended to multimodal data. To do so, the authors registered all available modalities to a common space and stacked them to form a 4D volume of multimodal intensities. Patches were defined and used to segment MS lesions.

An approach using random forest and local context intensity features was proposed in [15] to segment MS lesions. The authors extracted features from the images such as voxel intensity values (before and after image smoothing) and local histogram features and trained a random forest with supervised learning to segment MS lesions.

In [16], the authors proposed a 3D convolutional neural network (CNN) using a voxel-wise classifier with multi-channel 3D patches of MRI volumes as input. For each ground truth, a CNN was trained and the final segmentation was obtained by combining the probability outputs of these CNNs.

Finally, in [17] the authors used an estimation of spatially global within-the-subject intensity distribution and a spatially local intensity distribution derived from a healthy reference population to segment MS lesions. Using this approach, the authors aimed to distinguish locations in the brain with abnormal intensity levels when compared to the expected value at the same location in a healthy population.

All the works previously described are intensity-based methods and tried to use spatial information or patches to improve the segmentation results. The DSC, TPR and FPR values for these works are summarized in Table 10. These three metrics were the ones used by all authors, allowing a direct comparison of our approach to theirs. Along with DSC, TPR and FPR, we also used VD and Pearson's r coefficient metrics when comparing our proposal results to the raters' ground truths.

This paper is divided in the following manner. In Section 2 we explain the methodology of our work, including details about the dataset, metrics used to evaluate our model, preprocessing, our segmentation technique and post-processing stages. Results and discussions are presented in Section 3, where we compare results from our technique to each rater delineation and other proposals and also analyze how well the manual delineations for each image agree with each other. Finally, Section 4 concludes our paper.

@&#METHODOLOGY@&#

This section provides information about the dataset used in this work, along with the description of the metrics used to evaluate our results. It also presents information regarding our segmentation technique and pre- and post-processing steps.

The dataset used to validate our technique consisted of longitudinal images from 5 patients obtained from the 2015 Longitudinal MS Lesion Segmentation Challenge
                              1
                           
                           
                              1
                              
                                 http://iacl.ece.jhu.edu/MSChallenge
                              
                            conducted at the 2015 International Symposium on Biomedical Imaging in New York, NY, April 16--19. Each longitudinal dataset included T1-, T2-, PD-weighted and FLAIR MR images with 4–5 time points acquired on a 3T MR scanner. Every longitudinal dataset had two manual lesion delineations provided by rater 1 and rater 2. Considering all longitudinal dataset cases, 21 time points were provided in total. T1-weighted images had approximately 1mm3 voxel resolution, while the other weighted images had a resolution of 1mm2 in plane with 3mm thickness. To minimize the dependency of the results on registration performance and brain extraction, all images were already rigidly registered to the baseline T1-weighted image with automatically computed skull stripping masks. After registration, image dimensions were 
                              
                                 181
                                 ×
                                 217
                                 ×
                                 181
                              
                            for every image.

Three probabilistic anatomical atlases, corresponding to gray matter (GM), white matter (WM) and cerebrospinal fluid (CSF), were used to provide spatial information to our algorithm. They were obtained from the ICBM
                              2
                           
                           
                              2
                              
                                 http://www.bic.mni.mcgill.ca/ServicesAtlases/ICBM152NLin2009
                              
                            project [18]. Their spatial resolution was 
                              
                                 1
                                 ×
                                 1
                                 ×
                                 1
                                 
                                 mm
                              
                            and their dimensions were 
                              
                                 256
                                 ×
                                 256
                                 ×
                                 256
                              
                           .

To evaluate our technique, we used the Dice Similarity Coefficient (DSC) [19], True Positive Rate (TPR), False Positive Rate (FPR) Volume Difference (VD) and Pearson's r coefficient.

The DSC is defined as the ratio between the number of voxels where both the automatic and rater reference segmentation (ground truth) agree (true positives) and the sum of the total number of voxels labeled as lesion by both methods (manual and automatic). Also, according to Bartko [20], DSC values of 0.7 or higher suggest good agreement between two delineations. The TPR, FPR and VD metrics were calculated taking into account only the lesion voxels.

The Pearson's r coefficient [21] was used to assess the volumetric correlation between our segmentation and the ground truths from the raters. It is given by
                           
                              (1)
                              
                                 
                                    r
                                    =
                                    
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                i
                                                =
                                                1
                                             
                                             
                                                n
                                             
                                          
                                          (
                                          
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             −
                                             
                                                
                                                   x
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                          )
                                          (
                                          
                                             
                                                
                                                   y
                                                
                                                
                                                   i
                                                
                                             
                                             −
                                             
                                                
                                                   y
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                          )
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   
                                                      n
                                                   
                                                
                                                
                                                   
                                                      (
                                                      
                                                         
                                                            
                                                               x
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                         −
                                                         
                                                            
                                                               x
                                                            
                                                            
                                                               ¯
                                                            
                                                         
                                                      
                                                      )
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   
                                                      n
                                                   
                                                
                                                
                                                   
                                                      (
                                                      
                                                         
                                                            
                                                               y
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                         −
                                                         
                                                            
                                                               y
                                                            
                                                            
                                                               ¯
                                                            
                                                         
                                                      
                                                      )
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                    
                                    ,
                                 
                              
                           
                        where n is the number of time points, x
                        
                           i
                         and y
                        
                           i
                         are the absolute volumes of the ground truth and the automatic segmentation for a particular time point and 
                           
                              
                                 x
                              
                              
                                 ¯
                              
                           
                         and 
                           
                              
                                 y
                              
                              
                                 ¯
                              
                           
                         are their respective means. Pearson's r coefficient values lie inside the interval 
                           
                              [
                              +
                              1
                              ,
                              −
                              1
                              ]
                           
                        .

The DSC, TPR, FPR and VD metrics are summarized in Table 1
                        . For DSC and TPR, the closer their values are to 1, the better. On the other hand, for FPR and VD, the closer their values are to 0, the better.

A number of well known preprocessing techniques were applied to the dataset images before segmentation. These techniques included noise reduction, bias field correction and registration of probabilistic anatomical atlases to the clinical data (MRI scans), as shown in Fig. 1
                        .

Although the term noise in MRI can have different meanings depending on the context, the main source of noise in MR images is the thermal noise from the patients' body. Thermal noise may negatively affect the segmentation by increasing the number of misclassified voxels. To minimize noise effect, the Non-Local Means (NLM) [22] technique was applied to all images in the dataset. This filtering technique works by smoothing small grayscale variations in an adaptive manner, reducing the amount of blur on edge regions and increasing it otherwise. The NLM also takes into account the fact that some features in an image may occur not only locally, but globally, and therefore takes the weighted mean from all image voxels to estimate the value of a voxel v. In other words, the filter does not take into account just the neighborhood of a voxel, but rather all regions that are similar to that neighborhood (hence the non-local name). In [22], the authors compared their proposal, both quantitatively and qualitatively, to other well-known noise reduction algorithms such as the Gaussian filter [23] and the anisotropic diffusion filter [24,25] and showed the superiority of the NLM approach.

The bias field effect is a phenomenon that causes similar regions to appear with different intensities in MR images. MRI bias field is caused by a range of factors such as poor radio frequency (RF) energy distribution, static magnetic field variations and RF coil sensitivity. According to Arnold et al. [26], if these issues are not corrected, they may substantially degrade results of automatic brain tissue segmentation techniques in MR images. In this work, the N4 (Nick's Nonparametric Nonuniform Intensity Normalization) proposed by Tustison and Gee [27] is used to correct the MRI bias field effect. Advantages of this technique are the non-requirement for pre-segmentation image, independence of pulse frequency and robustness to pathologies (which are desired in the case of images with MS lesions).

An important step in the preprocessing pipeline is the spatial alignment between the clinical data and the probabilistic anatomical atlases, which are used to spatially constrain the segmentation area and eliminate classification ambiguities. In order to preserve meta-data information (such as origin, spacing and orientation) of the clinical images and to avoid sub-pixel image registration artifacts, the atlases were registered to the clinical image instead of the other way around. A T1-weighted image originally registered to the atlases was used as the moving image (T1
                           
                              mov
                           ), and for each patient time point its corresponding T1-weighted image was used as the reference image (T1
                           
                              ref
                           ). T1
                           
                              mov
                            was registered to T1
                           
                              ref
                            and the registration information was then applied to the atlases, aligning them to each patient scan. In this work, the NiftyReg
                              3
                           
                           
                              3
                              
                                 http://sourceforge.net/projects/niftyreg/
                              
                            tool was used with free-form B-Spline deformation model and multi-resolution approach for non-rigid registration [28].

Our technique focuses on segmenting MS lesions in WM. Since they can occur anywhere in the WM region [29], we decided to use the registered probabilistic anatomical atlases to constrain our segmentation region to WM. Given a voxel v, its corresponding probabilities in WM, v
                           
                              WM
                           , GM, v
                           
                              GM
                            and CSF, v
                           
                              CSF
                            and a set 
                              
                                 S
                                 =
                                 {
                                 v
                                 :
                                 
                                    
                                       v
                                    
                                    
                                       WM
                                    
                                 
                                 >
                                 
                                    
                                       v
                                    
                                    
                                       GM
                                    
                                 
                                 
                                 
                                 and
                                 
                                 
                                 
                                    
                                       v
                                    
                                    
                                       CSF
                                    
                                 
                                 >
                                 
                                    
                                       v
                                    
                                    
                                       GM
                                    
                                 
                                 }
                              
                           , a binary mask was created using the voxels in S. By doing so, we constrained the segmentation region to WM and also reduced the number of voxels to be clustered by our algorithm.

In this work, an iterative Student's t mixture model intensity-based segmentation algorithm is proposed to continuously refine the resulting segmented tissue sub-classes in FLAIR MR images until all MS lesions are grouped as one simple class. We call this approach Iterative Student's t Mixture Model (SMM-iter).

A mixture model is a stochastic model commonly used to represent subpopulations [30]. Different brain tissues – such as MS lesions, white matter (WM), gray matter (GM) and cerebrospinal fluid (CSF) – can be thought of as subpopulations (or classes) in a brain MR image. One way to distinguish one class from the other is to look at their voxels' intensities. The use of Student's t distribution to cluster brain tissues using intensity information has been proposed in some works [31,32]. The main advantage of the Student's t distribution over other distributions, such as Gaussian Mixture Models (GMM), is that it has a “heavy” tail, which makes it more robust to outliers
                           4
                        
                        
                           4
                           We define an outlier as a data sample that is far too distant from all image clusters.
                         
                        [33] and, therefore, less susceptible to noise.

Formally, let 
                           X
                         be a random variable, with Student's t distribution probability density function (pdf) 
                           
                              p
                              (
                              X
                              )
                           
                        . Let 
                           μ
                         be a mean vector, 
                           Σ
                         be a covariance matrix (positive, definite and real) with dimension d×d, where d is the data dimension, and ν is the degrees of freedom, 
                           
                              ν
                              ∈
                              [
                              0
                              ,
                              ∞
                              )
                           
                        . Then, 
                           
                              p
                              (
                              X
                              )
                           
                         can be written as [34]
                        
                           
                              (2)
                              
                                 
                                    p
                                    (
                                    X
                                    ;
                                    μ
                                    ,
                                    Σ
                                    ,
                                    ν
                                    )
                                    =
                                    
                                       
                                          Γ
                                          (
                                          
                                             
                                                
                                                   ν
                                                   +
                                                   d
                                                
                                                
                                                   2
                                                
                                             
                                          
                                          )
                                          
                                             
                                                |
                                                
                                                   Σ
                                                
                                                |
                                             
                                             
                                                −
                                                
                                                   
                                                      1
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                (
                                                
                                                   π
                                                   ν
                                                
                                                )
                                             
                                             
                                                
                                                   
                                                      d
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                          Γ
                                          (
                                          
                                             
                                                
                                                   ν
                                                
                                                
                                                   2
                                                
                                             
                                          
                                          )
                                          
                                             
                                                [
                                                
                                                   1
                                                   +
                                                   
                                                      
                                                         ν
                                                      
                                                      
                                                         −
                                                         1
                                                      
                                                   
                                                   δ
                                                   (
                                                   
                                                      X
                                                      ;
                                                      μ
                                                      ,
                                                      Σ
                                                   
                                                   )
                                                
                                                ]
                                             
                                             
                                                
                                                   
                                                      ν
                                                      +
                                                      d
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                    
                                    ,
                                 
                              
                           
                        where 
                           
                              δ
                              (
                              X
                              ;
                              μ
                              ,
                              Σ
                              )
                              =
                              
                                 
                                    (
                                    
                                       X
                                       −
                                       μ
                                    
                                    )
                                 
                                 
                                    T
                                 
                              
                              
                                 
                                    Σ
                                 
                                 
                                    −
                                    1
                                 
                              
                              (
                              
                                 X
                                 −
                                 μ
                              
                              )
                           
                         represents the Mahalanobis distance and Γ is the Gamma function.

The Student's t distribution is equivalent to a Gaussian distribution with a stochastic covariance matrix [35]. Consider a weight u following a Gamma distribution parameterized by ν:
                           
                              (3)
                              
                                 
                                    u
                                    ∼
                                    Γ
                                    (
                                    
                                       
                                          
                                             ν
                                          
                                          
                                             2
                                          
                                       
                                       ,
                                       
                                          
                                             ν
                                          
                                          
                                             2
                                          
                                       
                                    
                                    )
                                    .
                                 
                              
                           
                        Given that, a variable 
                           X
                         follows a multivariate normal distribution with mean 
                           μ
                         and covariance 
                           
                              
                                 Σ
                              
                              
                                 u
                              
                           
                         as:
                           
                              (4)
                              
                                 
                                    X
                                    |
                                    μ
                                    ,
                                    Σ
                                    ,
                                    ν
                                    ,
                                    u
                                    ∼
                                    N
                                    (
                                    
                                       μ
                                       ,
                                       
                                          
                                             Σ
                                          
                                          
                                             u
                                          
                                       
                                    
                                    )
                                    .
                                 
                              
                           
                        We can write a mixture of K Student's t distribution components as
                           
                              (5)
                              
                                 
                                    ϕ
                                    (
                                    
                                       X
                                    
                                    ,
                                    
                                       Ψ
                                    
                                    )
                                    =
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          K
                                       
                                    
                                    
                                       
                                          π
                                       
                                       
                                          i
                                       
                                    
                                    p
                                    (
                                    
                                       
                                          X
                                       
                                       ;
                                       
                                          
                                             μ
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             Σ
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             ν
                                          
                                          
                                             i
                                          
                                       
                                    
                                    )
                                    ,
                                 
                              
                           
                        where 
                           
                              
                                 
                                    π
                                 
                                 
                                    1
                                 
                              
                              ...
                              
                                 
                                    π
                                 
                                 
                                    K
                                 
                              
                           
                         represent the weights for each component and
                           
                              (6)
                              
                                 
                                    Ψ
                                    =
                                    
                                       
                                          (
                                          
                                             
                                                
                                                   π
                                                
                                                
                                                   1
                                                
                                             
                                             ,
                                             …
                                             ,
                                             
                                                
                                                   π
                                                
                                                
                                                   K
                                                
                                             
                                             ;
                                             
                                                
                                                   μ
                                                
                                                
                                                   1
                                                
                                             
                                             ,
                                             …
                                             ,
                                             
                                                
                                                   μ
                                                
                                                
                                                   K
                                                
                                             
                                             ;
                                             
                                                
                                                   Σ
                                                
                                                
                                                   1
                                                
                                             
                                             ,
                                             …
                                             ,
                                             
                                                
                                                   Σ
                                                
                                                
                                                   K
                                                
                                             
                                             ;
                                             …
                                             ;
                                             
                                                
                                                   ν
                                                
                                                
                                                   1
                                                
                                             
                                             ,
                                             …
                                             ,
                                             
                                                
                                                   ν
                                                
                                                
                                                   K
                                                
                                             
                                          
                                          )
                                       
                                       
                                          T
                                       
                                    
                                 
                              
                           
                        are the mixture model components' parameters.

The estimation of our model parameters was performed using the Expectation Maximization (EM) algorithm [31]. In this sense, consider the complete data vector
                           
                              (7)
                              
                                 
                                    
                                       
                                          X
                                       
                                       
                                          c
                                       
                                    
                                    =
                                    
                                       
                                          (
                                          
                                             
                                                
                                                   X
                                                
                                                
                                                   1
                                                
                                             
                                             ,
                                             …
                                             ,
                                             
                                                
                                                   X
                                                
                                                
                                                   N
                                                
                                             
                                             ,
                                             
                                             
                                                
                                                   z
                                                
                                                
                                                   1
                                                
                                             
                                             ,
                                             …
                                             ,
                                             
                                                
                                                   z
                                                
                                                
                                                   N
                                                
                                             
                                             ,
                                             
                                             
                                                
                                                   u
                                                
                                                
                                                   1
                                                
                                             
                                             ,
                                             …
                                             ,
                                             
                                                
                                                   u
                                                
                                                
                                                   N
                                                
                                             
                                          
                                          )
                                       
                                       
                                          T
                                       
                                    
                                    ,
                                 
                              
                           
                        where 
                           
                              
                                 
                                    z
                                 
                                 
                                    1
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    z
                                 
                                 
                                    N
                                 
                              
                           
                         are the component-label vectors and 
                           
                              
                                 
                                    z
                                 
                                 
                                    ij
                                 
                              
                              =
                              
                                 
                                    (
                                    
                                       
                                          z
                                       
                                       
                                          j
                                       
                                    
                                    )
                                 
                                 
                                    i
                                 
                              
                           
                         is either one or zero, depending on whether the observation 
                           
                              
                                 X
                              
                              
                                 j
                              
                           
                         is generated by the ith component or not. In this case, 
                           
                              
                                 X
                              
                              
                                 j
                              
                           
                         is an intensity sample from the region to be segmented. Note that, following the definition of the Student's t distribution in Eqs. (2)–(4), the observed data augmented by 
                           
                              
                                 
                                    z
                                 
                                 
                                    j
                                 
                              
                              ,
                              
                              j
                              =
                              1
                              ,
                              …
                              ,
                              N
                           
                         are still incomplete since the component covariance matrix depends on the degrees of freedom ν. Due to that, the complete data vector also includes the additional missing data 
                           
                              
                                 
                                    u
                                 
                                 
                                    1
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    u
                                 
                                 
                                    N
                                 
                              
                           
                        .

The EM algorithm is divided into two main stages: the E-step (expectation) and M-step (maximization). The E-step on the 
                           
                              (
                              t
                              +
                              1
                              )
                           
                        th iteration requires the calculation of the posterior probability of 
                           
                              
                                 X
                              
                              
                                 j
                              
                           
                         belonging to the ith component of the mixture [35], calculated as
                           
                              (8)
                              
                                 
                                    
                                       
                                          z
                                       
                                       
                                          ij
                                       
                                       
                                          t
                                          +
                                          1
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                w
                                             
                                             
                                                i
                                             
                                             
                                                t
                                             
                                          
                                          p
                                          (
                                          
                                             
                                                
                                                   X
                                                
                                                
                                                   j
                                                
                                             
                                             ;
                                             
                                                
                                                   μ
                                                
                                                
                                                   i
                                                
                                                
                                                   t
                                                
                                             
                                             ,
                                             
                                                
                                                   Σ
                                                
                                                
                                                   i
                                                
                                                
                                                   t
                                                
                                             
                                             ,
                                             
                                                
                                                   ν
                                                
                                                
                                                   i
                                                
                                                
                                                   t
                                                
                                             
                                          
                                          )
                                       
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                m
                                                =
                                                1
                                             
                                             
                                                K
                                             
                                          
                                          
                                             
                                                w
                                             
                                             
                                                m
                                             
                                             
                                                t
                                             
                                          
                                          p
                                          (
                                          
                                             
                                                
                                                   X
                                                
                                                
                                                   j
                                                
                                             
                                             ;
                                             
                                                
                                                   μ
                                                
                                                
                                                   m
                                                
                                                
                                                   t
                                                
                                             
                                             ,
                                             
                                                
                                                   Σ
                                                
                                                
                                                   m
                                                
                                                
                                                   t
                                                
                                             
                                             ,
                                             
                                                
                                                   ν
                                                
                                                
                                                   m
                                                
                                                
                                                   t
                                                
                                             
                                          
                                          )
                                       
                                    
                                    ,
                                 
                              
                           
                        as well as the expectation of the weights for each observation [36]
                        
                           
                              (9)
                              
                                 
                                    
                                       
                                          u
                                       
                                       
                                          ij
                                       
                                       
                                          t
                                          +
                                          1
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                ν
                                             
                                             
                                                i
                                             
                                             
                                                t
                                             
                                          
                                          +
                                          d
                                       
                                       
                                          
                                             
                                                ν
                                             
                                             
                                                i
                                             
                                             
                                                t
                                             
                                          
                                          +
                                          δ
                                          (
                                          
                                             x
                                             ;
                                             
                                                
                                                   μ
                                                
                                                
                                                   i
                                                
                                                
                                                   t
                                                
                                             
                                             ,
                                             
                                                
                                                   Σ
                                                
                                                
                                                   i
                                                
                                                
                                                   t
                                                
                                             
                                          
                                          )
                                       
                                    
                                    .
                                 
                              
                           
                        
                     

We also incorporated neighborhood information in our model as proposed by [11,37,12] in the following way. Let v be a voxel and let N
                        
                           V
                         be the neighborhood of v with radius r and size 
                           
                              s
                              =
                              
                                 
                                    (
                                    2
                                    ×
                                    r
                                    +
                                    1
                                    )
                                 
                                 
                                    dim
                                 
                              
                           
                        , where dim is the number of dimensions in the image (in this context, using 3D images, dim=3). Then, in Eq. (8), w
                        
                           i
                        
                        
                           t
                         is calculated as
                           
                              (10)
                              
                                 
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                       
                                          t
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                π
                                             
                                             
                                                i
                                             
                                             
                                                t
                                             
                                          
                                          +
                                          
                                             
                                                n
                                             
                                             
                                                iq
                                             
                                             
                                                t
                                             
                                          
                                       
                                       
                                          2
                                       
                                    
                                    ,
                                 
                              
                           
                        where
                           
                              (11)
                              
                                 
                                    
                                       
                                          n
                                       
                                       
                                          iq
                                       
                                       
                                          t
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                π
                                             
                                             
                                                i
                                             
                                             
                                                t
                                             
                                          
                                          p
                                          (
                                          
                                             
                                                
                                                   X
                                                
                                                
                                                   q
                                                
                                             
                                             ;
                                             
                                                
                                                   μ
                                                
                                                
                                                   i
                                                
                                                
                                                   t
                                                
                                             
                                             ,
                                             
                                                
                                                   Σ
                                                
                                                
                                                   i
                                                
                                                
                                                   t
                                                
                                             
                                             ,
                                             
                                                
                                                   ν
                                                
                                                
                                                   i
                                                
                                                
                                                   t
                                                
                                             
                                          
                                          )
                                       
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                m
                                                =
                                                1
                                             
                                             
                                                K
                                             
                                          
                                          
                                             
                                                π
                                             
                                             
                                                m
                                             
                                             
                                                t
                                             
                                          
                                          p
                                          (
                                          
                                             
                                                
                                                   X
                                                
                                                
                                                   q
                                                
                                             
                                             ;
                                             
                                                
                                                   μ
                                                
                                                
                                                   m
                                                
                                                
                                                   t
                                                
                                             
                                             ,
                                             
                                                
                                                   Σ
                                                
                                                
                                                   m
                                                
                                                
                                                   t
                                                
                                             
                                             ,
                                             
                                                
                                                   ν
                                                
                                                
                                                   m
                                                
                                                
                                                   t
                                                
                                             
                                          
                                          )
                                       
                                    
                                 
                              
                           
                        and 
                           
                              
                                 
                                    X
                                 
                                 
                                    q
                                 
                              
                              ∈
                              
                                 
                                    N
                                 
                                 
                                    v
                                 
                              
                           
                        . This is the mean field approximation of a Markov Random Field [38]. In other words, for each sample 
                           
                              
                                 X
                              
                              
                                 j
                              
                           
                        , w
                        
                           i
                        
                        
                           t
                         was calculated as the average between the ith component weight and the posterior probability of the neighborhood of 
                           
                              
                                 X
                              
                              
                                 j
                              
                           
                         belonging to the ith component as well.

Maximizing the log-likelihood of the complete data provides the update equations of the mixture model parameters:
                           
                              (12)
                              
                                 
                                    
                                       
                                          π
                                       
                                       
                                          i
                                       
                                       
                                          t
                                          +
                                          1
                                       
                                    
                                    =
                                    
                                       
                                          1
                                       
                                       
                                          N
                                       
                                    
                                    
                                       
                                          ∑
                                       
                                       
                                          j
                                          =
                                          1
                                       
                                       
                                          N
                                       
                                    
                                    
                                       
                                          z
                                       
                                       
                                          ij
                                       
                                       
                                          t
                                       
                                    
                                    ,
                                 
                              
                           
                        
                        
                           
                              (13)
                              
                                 
                                    
                                       
                                          μ
                                       
                                       
                                          i
                                       
                                       
                                          t
                                          +
                                          1
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                j
                                                =
                                                1
                                             
                                             
                                                N
                                             
                                          
                                          
                                             
                                                z
                                             
                                             
                                                ij
                                             
                                             
                                                t
                                             
                                          
                                          
                                             
                                                u
                                             
                                             
                                                ij
                                             
                                             
                                                t
                                             
                                          
                                          
                                             
                                                X
                                             
                                             
                                                j
                                             
                                          
                                       
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                j
                                                =
                                                1
                                             
                                             
                                                N
                                             
                                          
                                          
                                             
                                                z
                                             
                                             
                                                ij
                                             
                                             
                                                t
                                             
                                          
                                          
                                             
                                                u
                                             
                                             
                                                ij
                                             
                                             
                                                t
                                             
                                          
                                       
                                    
                                    ,
                                 
                              
                           
                        
                        
                           
                              (14)
                              
                                 
                                    
                                       
                                          Σ
                                       
                                       
                                          i
                                       
                                       
                                          t
                                          +
                                          1
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                j
                                                =
                                                1
                                             
                                             
                                                N
                                             
                                          
                                          
                                             
                                                z
                                             
                                             
                                                ij
                                             
                                             
                                                t
                                             
                                          
                                          
                                             
                                                u
                                             
                                             
                                                ij
                                             
                                             
                                                t
                                             
                                          
                                          (
                                          
                                             
                                                
                                                   X
                                                
                                                
                                                   j
                                                
                                             
                                             −
                                             
                                                
                                                   μ
                                                
                                                
                                                   i
                                                
                                                
                                                   t
                                                   +
                                                   1
                                                
                                             
                                          
                                          )
                                          
                                             
                                                (
                                                
                                                   
                                                      
                                                         X
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   −
                                                   
                                                      
                                                         μ
                                                      
                                                      
                                                         i
                                                      
                                                      
                                                         t
                                                         +
                                                         1
                                                      
                                                   
                                                
                                                )
                                             
                                             
                                                T
                                             
                                          
                                       
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                j
                                                =
                                                1
                                             
                                             
                                                N
                                             
                                          
                                          
                                             
                                                z
                                             
                                             
                                                ij
                                             
                                             
                                                t
                                             
                                          
                                       
                                    
                                    .
                                 
                              
                           
                        
                     

The degrees of freedom 
                           
                              
                                 ν
                              
                              
                                 i
                              
                              
                                 t
                                 +
                                 1
                              
                           
                         for the ith component are computed as the solution to the equation (adapted from [12])
                           
                              (15)
                              
                                 
                                    log
                                    (
                                    
                                       
                                          
                                             
                                                
                                                   ν
                                                
                                                
                                                   i
                                                
                                                
                                                   t
                                                   +
                                                   1
                                                
                                             
                                          
                                          
                                             2
                                          
                                       
                                    
                                    )
                                    −
                                    ψ
                                    (
                                    
                                       
                                          
                                             
                                                
                                                   ν
                                                
                                                
                                                   i
                                                
                                                
                                                   t
                                                   +
                                                   1
                                                
                                             
                                          
                                          
                                             2
                                          
                                       
                                    
                                    )
                                    +
                                    1
                                    −
                                    log
                                    (
                                    
                                       
                                          
                                             
                                                
                                                   ν
                                                
                                                
                                                   i
                                                
                                                
                                                   t
                                                
                                             
                                             +
                                             d
                                          
                                          
                                             2
                                          
                                       
                                    
                                    )
                                    +
                                    
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                j
                                                =
                                                1
                                             
                                             
                                                N
                                             
                                          
                                          
                                             
                                                z
                                             
                                             
                                                ij
                                             
                                             
                                                t
                                             
                                          
                                          (
                                          
                                             
                                             log
                                             
                                             
                                                
                                                   u
                                                
                                                
                                                   ij
                                                
                                                
                                                   t
                                                
                                             
                                             −
                                             
                                                
                                                   u
                                                
                                                
                                                   ij
                                                
                                                
                                                   t
                                                
                                             
                                          
                                          )
                                       
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                j
                                                =
                                                1
                                             
                                             
                                                N
                                             
                                          
                                          
                                             
                                                z
                                             
                                             
                                                ij
                                             
                                             
                                                t
                                             
                                          
                                       
                                    
                                    +
                                    ψ
                                    (
                                    
                                       
                                          
                                             
                                                
                                                   ν
                                                
                                                
                                                   i
                                                
                                                
                                                   t
                                                
                                             
                                             +
                                             d
                                          
                                          
                                             2
                                          
                                       
                                    
                                    )
                                    =
                                    0
                                    ,
                                 
                              
                           
                        where 
                           
                              ψ
                              (
                              x
                              )
                              =
                              
                                 
                                    ∂
                                    (
                                    
                                       
                                       ln
                                       
                                       Γ
                                       (
                                       
                                          x
                                       
                                       )
                                    
                                    )
                                 
                                 
                                    ∂
                                    x
                                 
                              
                           
                         is the digamma function. In this work, the degrees of freedom were calculated using the NLopt non-linear optimization library.
                           5
                        
                        
                           5
                           
                              http://ab-initio.mit.edu/wiki/index.php/NLopt
                           
                        
                     

After the parameters' estimation, we use the maximum a posteriori (MAP) classification rule. The classification of each voxel in its respective z label is done by associating it with the class that maximizes the posterior probability 
                           
                              P
                              (
                              
                                 
                                    
                                       z
                                    
                                    
                                       k
                                    
                                 
                                 |
                                 X
                              
                              )
                           
                        . Formally, the classification stage follows the Bayesian MAP decision given by
                           
                              (16)
                              
                                 
                                    P
                                    (
                                    
                                       
                                          
                                             z
                                          
                                          
                                             i
                                          
                                       
                                       |
                                       X
                                    
                                    )
                                    >
                                    P
                                    (
                                    
                                       
                                          
                                             z
                                          
                                          
                                             j
                                          
                                       
                                       |
                                       X
                                    
                                    )
                                    ,
                                 
                              
                           
                        where 
                           
                              i
                              =
                              1
                              ,
                              2
                              ,
                              …
                              ,
                              k
                           
                        , 
                           
                              j
                              =
                              1
                              ,
                              2
                              ,
                              …
                              ,
                              k
                           
                         and 
                           
                              i
                              ≠
                              j
                           
                        .

Both sides of the decision rule in Eq. (16) follow the Bayes theorem as [39]:
                           
                              (17)
                              
                                 
                                    P
                                    (
                                    
                                       
                                          z
                                       
                                       
                                          i
                                       
                                    
                                    |
                                    
                                       X
                                    
                                    )
                                    =
                                    
                                       
                                          p
                                          (
                                          
                                             
                                                X
                                             
                                             |
                                             
                                                
                                                   z
                                                
                                                
                                                   i
                                                
                                             
                                             ;
                                             
                                                μ
                                             
                                             ,
                                             
                                                Σ
                                             
                                             ,
                                             ν
                                          
                                          )
                                          p
                                          (
                                          
                                             
                                                
                                                   z
                                                
                                                
                                                   i
                                                
                                             
                                          
                                          )
                                       
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                j
                                                =
                                                1
                                             
                                             
                                                K
                                             
                                          
                                          p
                                          (
                                          
                                             X
                                          
                                          |
                                          
                                             
                                                z
                                             
                                             
                                                j
                                             
                                          
                                          ;
                                          
                                             μ
                                          
                                          ,
                                          
                                             Σ
                                          
                                          ,
                                          ν
                                          )
                                          p
                                          (
                                          
                                             
                                                z
                                             
                                             
                                                j
                                             
                                          
                                          )
                                       
                                    
                                    ,
                                 
                              
                           
                        where 
                           
                              p
                              (
                              
                                 
                                    
                                       z
                                    
                                    
                                       i
                                    
                                 
                              
                              )
                           
                         represents the a priori probability of class i, 
                        
                           
                              p
                              (
                              
                                 X
                                 |
                                 
                                    
                                       z
                                    
                                    
                                       i
                                    
                                 
                                 ;
                                 μ
                                 ,
                                 Σ
                                 ,
                                 ν
                              
                              )
                           
                         
                        is the pdf of class i and the parameter K represents the number of mixture components.
                     

In the context of this work, the random variable 
                           X
                         represents the gray level intensities in FLAIR images. Since we did not use other image weights (such as T2, for instance), d=1 and the mean vector 
                           μ
                         becomes simply the univariate mean and the covariance matrix 
                           Σ
                         becomes the standard deviation.

Classifying MS lesions using an intensity-based clustering technique often suffers from a large amount of false positives [29]. This is due to the fact that MS lesions may have pdf of the intensity levels close to those of other normal brain tissues. Given that, we decided to use an iterative approach to successively approximate the lesion segmentation (hence the iter in SMM-iter). This approach allows a segmentation refinement in a way that on each iteration the differences between lesions and other tissues increase, hence reducing the number of false positives.

The iterative approach, shown in Fig. 2
                           , is composed of the following steps:
                              
                                 1.
                                 Define a preprocessed image I
                                    
                                       seg
                                     to be segmented and a binary mask BM to spatially constrain the image segmentation.

Define the number of iterations 
                                       
                                          (
                                          
                                             
                                                
                                                   N
                                                
                                                
                                                   iter
                                                
                                             
                                          
                                          )
                                       
                                     and the number of clusters 
                                       
                                          (
                                          
                                             
                                                
                                                   N
                                                
                                                
                                                   clusters
                                                
                                             
                                          
                                          )
                                       
                                     for each iteration.

Segment I
                                    
                                       seg
                                     using Student's t mixture model explained in Section 2.4 with BM and N
                                    
                                       clusters
                                     defined for that iteration.

For each cluster, calculate its mean intensity.

Use the regions of the 
                                       
                                          (
                                          
                                             
                                                
                                                   N
                                                
                                                
                                                   clusters
                                                
                                             
                                             −
                                             1
                                          
                                          )
                                       
                                     highest mean intensity clusters of that iteration as the new BM for the next iteration.

Loop to step 3 until the number of iterations reaches zero.

In this work, we used 
                              
                                 
                                    
                                       N
                                    
                                    
                                       iter
                                    
                                 
                                 =
                                 5
                              
                           , 
                              
                                 
                                    
                                       N
                                    
                                    
                                       clusters
                                    
                                 
                                 =
                                 3
                              
                            for the first four iterations and 
                              
                                 
                                    
                                       N
                                    
                                    
                                       clusters
                                    
                                 
                                 =
                                 2
                              
                            for the last iteration. These parameters were empirically determined using a training image dataset where they have shown to provide the best trade-off between processing time and lesion segmentation accuracy.

The initial binary mask 
                              
                                 (
                                 
                                    
                                       BM
                                    
                                    
                                       (
                                       
                                          
                                             N
                                          
                                          
                                             iter
                                          
                                       
                                       )
                                    
                                 
                                 )
                              
                            was created using the anatomical probabilistic atlases. The idea was to constrain the segmentation region to the WM area. It is a fact that the alignment between the atlases and the clinical images is not perfect. The registered WM atlas may not adequately represent the real WM area in the clinical image. In this scenario, due to misalignments, some lesion voxels located in the clinical WM area may have low probabilities in the WM atlas. To circumvent this problem, a threshold T=0.20 was defined and all voxels in the GM atlas with a probability smaller than T were given as input to create 
                              
                                 
                                    BM
                                 
                                 
                                    (
                                    
                                       
                                          N
                                       
                                       
                                          iter
                                       
                                    
                                    )
                                 
                              
                           . Voxels with low GM probability have higher probabilities of belonging either to CSF of WM. Therefore, the initial binary mask covered voxels from both these classes. CSF voxels appear hypointense in FLAIR images, being discarded from the lesion cluster during the iterative segmentation. On the other hand, hyperintense voxels that would be left out in the initial binary mask if we used only the WM atlas are taken into account using this approach.

Note that on each iteration we discard the lowest mean intensity cluster and update the binary mask with the remaining clusters of that iteration. The binary mask update is done in this manner because MS lesions appear hyperintense in FLAIR images. Therefore we wanted to preserve the high mean intensity clusters while refining our segmentation.

This iterative approach makes the assumption that MS lesions are the most hyperintense class in FLAIR images. The successive refinement eliminates classes that do not follow such assumption, thus reducing the number of false positives. However, a limitation of this approach lies in the fact that it may also reduce the number of true positives in images where there is a significant intensity variability among MS lesions.

The output of this iterative approach is a binary mask BM
                           
                              lesions
                            representing all MS lesions segmented by our technique in image I
                           
                              seg
                           .

Post-processing techniques, including mid-sagittal plane detection to help eliminate in-between ventricles (third ventricle – TV) voxels and a residue removal method, were used to remove false positives from the resulting lesion binary mask.

Since the TV region in FLAIR images commonly has an intensity overlap with MS lesions [29], voxels located in this region are mistakenly clustered together with lesions and increase the number of false positives. Since MS lesions located close to the TV region are quite rare, we used the technique proposed in [40] to detect the mid-sagittal plane (MSP), defined a distance threshold d
                           
                              threshold
                            and removed all voxels in which distance to the plane was smaller or equal to d
                           
                              threshold
                           . In other words, given a voxel v and its distance to the mid-sagittal plane 
                              
                                 d
                                 (
                                 v
                                 )
                                 =
                                 
                                    
                                       d
                                    
                                    
                                       msp
                                    
                                 
                              
                           , we removed v from the image if 
                              
                                 
                                    
                                       d
                                    
                                    
                                       msp
                                    
                                 
                                 ≤
                                 
                                    
                                       d
                                    
                                    
                                       plane
                                    
                                 
                              
                           . This approach was effective in removing misclassified voxels in the TV region while keeping the lesion voxels intact. A comparison between images before and after using this technique is shown in Fig. 3
                           .

The final post-processing step was to remove residual voxels. We defined residual voxels as follows: given a voxel v and a neighborhood N
                           
                              v
                            with radius r around v and size 
                              
                                 s
                                 =
                                 
                                    
                                       (
                                       
                                          2
                                          ×
                                          r
                                          +
                                          1
                                       
                                       )
                                    
                                    
                                       dim
                                    
                                 
                              
                           , v is a residual voxel if its neighborhood has less than 
                              
                                 
                                    s
                                 
                                 
                                    3
                                 
                              
                            active voxels (by active voxels we mean voxels with values equal to 1 in the binary mask). In other words, we aimed to remove isolated voxels that were unlikely to belong to the MS lesion cluster.

Granted, this approach is prone to remove small lesions from the segmentation, and that is a limitation of our technique. However, as shown in Table 2
                           , the DSC improved with the use of residue removal.

@&#RESULTS AND DISCUSSION@&#

In this section, the results of our segmentation algorithm are presented and discussed. An analysis of inter-specialist agreement is also provided.

We used the preprocessing, segmentation and post-processing stages explained in Sections 2.3–2.5, respectively, to automatically segment MS lesions in our image dataset. As previously mentioned, each time point had two manual delineations performed by two different raters. We compared our segmentation to both of them. An example of the iterative segmentation followed by the post processing stage is shown in Fig. 4
                        .

For qualitative analysis purposes, two automatic segmentation results along with the ground truths from both raters are shown in Figs. 5 and 6
                        
                        .

For each patient, we took the mean and standard deviation of DSC, TPR, FPR and VD metrics for all patient's scans. Results are shown in Table 3 and 4
                        
                        . We also took one time point from each patient and extracted their corresponding DSC value on each iteration (using rater 1 as ground truth) to offer an overview regarding the iterative approach progress; the results are shown in Table 5
                        .

The greatest differences on the metrics values between rater 1 and rater 2 ground truths were observed in patient 4 time points. As shown in Table 6
                        , the agreement between the raters' delineations for this case 
                           
                              (
                              DSC
                              =
                              0.612
                              ±
                              0.019
                              )
                           
                         presented the smallest DSC value among all patients, indicating a high rater inter-variability. Also for comparison, all lesion absolute volumes of all time points from patient 4 are presented in Table 7
                        . Patient 4 had the smallest lesion load among all other patients. In this case, it is reasonable to expect the automatic segmentation to perform rather poorly, hence the variability in volume and low spatial agreement with raters.

The results in Table 5 show that the iterative approach is able to refine the segmentation in a successive manner, improving the DSC on each step. The post-processing stage is then used to remove false positives, improving the spatial agreement between the rater and the automatic segmentation.

Lesion volumes in this study ranged from 1.95ml to 34.71ml. Given the DSC, TPR and FPR values, our technique was able to maintain a good segmentation consistency in this range.

However, as mentioned in Section 2.4.1, our technique chooses the most hyperintense class in the end of the iterative approach as the MS lesion class. This may exclude lesion voxels that do not comply with the hyperintense assumption, thus decreasing the TPR and increasing the VD. A comparison among ground truths 1, 2 and the automatic segmentation regarding the mean and standard deviation of MS lesions for all time points from patient 1 are shown in Table 8
                        .

It can be seen that our technique has the smallest standard deviation in all time points, which indicates that our algorithm segmented a narrower portion of MS lesions. Also, except for time point 2, our technique had the biggest mean among all cases. The combination of a big mean and a small standard deviation is an indication that our proposed technique indeed segmented MS lesions, but it was not able to include some lesion voxels located in the “low end” of the lesion intensity profile. The same behavior was observed in all other time points from all other patients.

In Section 2.4, we mentioned that the Student's t distribution has a heavy tail, which makes it more robust to outliers and offers an advantage over GMM. Many works in the literature propose the use of GMM to perform image segmentation [41–43]. For the sake of comparison, we used the same methodology explained in Sections 2.3–2.5 to perform the segmentation of all time points from patient 1 using GMM and then compared the results with SMM-iter. The DSC values of the results are shown in Table 9
                        . It can be seen that the SMM-iter had slightly better results than the GMM.

We also used Pearson's r coefficient to assess the volumetric correlation between our segmentation and the ground truths. For rater 1, r=0.8813, and for rater 2, r=0.8871. For the sake of comparison, we also calculated the volumetric correlation between raters. In this scenario, r=0.9841. For all cases, p value 
                        
                           
                              <
                              0.00001
                           
                        . The scatter plots for this data are shown in Figs. 7–9
                        
                        
                        .

The results for the Pearson's r coefficient indicated a strong positive correlation between the volumes of our automatic segmentation and the ground truths from both raters. Considering these results along with the ones presented in Tables 3 and 4 we can observe that our segmentation proposal had good spatial and volumetric agreement with the ground truths. Comparatively, the correlation between raters was higher than both correlations from the automatic segmentation and raters 1 and 2. This difference can be explained by the fact that our technique segmented a narrower portion of MS lesions, leaving out the ones in the low end of the intensity profile.

An advantage of our technique compared to the works described in Section 1 is that we do not use any training stage. Each segmentation is done in a stand-alone manner, and while the number of iterations and clusters is empirically defined, this process does not require the same level of training as other techniques such as a random forest or a neural network. In [13, 15–17], the authors' proposals either needed training or healthy subjects scans (or both) to perform the segmentation. This can be a setback when dealing with images from different centers, since they would have to go through a normalization stage which may lead to biased results because the training dataset does not take into account anatomical and physiological variability between different subjects [44].

In [14], the authors used patches and multimodal information to segment MS lesions. This approach did not require a training stage and was able to obtain a high TPR and low FPR. However, the DSC was relatively low 
                           
                              (
                              0.55
                              ±
                              0.14
                              )
                           
                         and the authors did not use spatial information to distinguish similar intensity voxels.

The winner of the 2015 Longitudinal Multiple Sclerosis Lesion Segmentation Challenge was Vaidya et al. [16]. The authors used neural networks and patches to segment MS lesions. The neural networks had to be trained before the segmentation could take place. Since in [16] the authors presented their results on just a few time points from one patient, it is not possible to fully compare their approach to our proposal. But even though their DSC values for the presented time points were higher than ours, our approach had a higher TPR in some time points and lower FPR for some others. This indicates that our technique had a smaller misclassification ratio. It also shows that analysis using different metrics is important to obtain a good overview of automatic segmentation proposals.

The mean DSC, TPR and FPR values for the works described in Section 1 and our proposal are presented in Table 10
                        . GT 1 and GT 2 are the ground truths from raters 1 and 2, respectively. The metric values were calculated taking into account every time point, except when stated otherwise.

Overall, our technique showed a good agreement with the manual delineations (especially the ones from rater 1) and was able to keep segmentation consistency among images with different lesion volumes. Regarding processing time, the average time to go through the preprocessing, segmentation and post-processing stages for each time point in the 2015 ISBI Longitudinal Challenge was around 20min (Core i7 with 16GB RAM). Also, the fact that our technique does not require any training stage is an advantage when images from different centers (or with different parameters acquisition) have to be segmented because there is no bias introduced from training images.

@&#CONCLUSIONS AND FUTURE WORK@&#

This paper presented an automatic iterative approach to segment MS lesions in FLAIR images. Our technique uses probabilistic anatomical atlases to constrain the segmentation process to the WM region (thus reducing the number of false positives and voxels to cluster) and segment the image using Student's t mixture models. Our method is performed in a refinement manner by iteratively segmenting brain tissues into smaller classes until MS lesions are grouped as the most hyperintense one.

We compared the results from our automatic technique to 2 raters' manual delineations and to other works that used the same dataset using the DSC, TPR, FPR and VD metrics. Results indicated that our technique successfully segments MS lesions in FLAIR images and provides consistent results on images with a different lesion volume.

A difficulty faced during the development of our proposed technique regarded the high inter-variability between the raters. This fact created difficulties in providing a solid foundation that could help us work on the adjustment of the parameters of our algorithm.

One limitation of our technique lies in the image registration stage. Since the alignment between fixed and moving images is not perfect, lesions located in areas that are not well aligned are likely to be pruned in the image segmentation constraint stage. On the other hand, this constraint also reduces the number of false positives by eliminating voxels that have intensity profiles close to those of MS lesions but are outside the WM region.

Another drawback of our technique is that lesion voxels that are on the “low end” of the MS lesion intensity profile are likely to be left out of the MS cluster. This happens because our proposal follows the assumption that MS lesions are the most hyperintense class in FLAIR images. If the lesions have a significant intensity variability, the less intense ones are prone not to be included in the cluster.

In future works, we aim to extend the approach presented in this paper to other MRI weights such as T2 and also to develop a model to automatically select the best number of clusters and iterations for our algorithm and circumvent the “low end” intensity problem. We also intend to apply our segmentation proposal to different field strengths and data acquired on different scanners to assess its performance in different scenarios.

None declared.

@&#ACKNOWLEDGMENTS@&#

The authors would like to thank the Fundação de Amparo à Pesquisa do Estado de São Paulo (FAPESP) for the financial support of this research (Grant nos. 2014/00019-6, 2012/16546-0 and 2012/03100-3).

@&#REFERENCES@&#

