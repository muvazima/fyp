@&#MAIN-TITLE@&#A nonhomogeneous hidden Markov model of response dynamics and mailing optimization in direct marketing

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           Allowing firms to address the dynamic implications of mailing decisions.


                        
                        
                           
                           Maximizing the long-term value generated by the customers.


                        
                        
                           
                           Endogeneity of mailings which may result in biased parameter estimates is corrected.


                        
                        
                           
                           Uncertainty in the parameters is considered in optimizing the mailing decisions.


                        
                        
                           
                           Captures the season-changing effects on state transition.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

OR in marketing

HMM

POMDP

Customer lifetime value

Mailing optimization

@&#ABSTRACT@&#


               
               
                  Catalog firms mail billions of catalogs each year. To stay competitive, catalog managers need to maximize the return on these mailings by deciding who should receive a mail-order catalog. In this paper, we propose a two-step approach that allows firms to address the dynamic implications of mailing decisions, and to make efficient mailing decisions by maximizing the long-term value generated by customers. Specifically, we first propose a nonhomogeneous hidden Markov model (HMM) to capture the interactive dynamics between customers and mailings. In the second step, we use the parameters obtained from the HMM to determine the optimal mailing decisions using the Partial Observable Markov Decision Process (POMDP). Both the immediate and the long-term effects of mailings are accounted for. The mailing endogeneity that may result in biased parameter estimates is also corrected. We conduct an empirical study using six years of quarterly solicitation data derived from the well-known DMEF donation data set. All metrics used suggest that the proposed model fits the data well in terms of correct predictions and outperforms all other benchmark models. The simulative experimental results show that the proposed method for optimizing total accrued benefits outperforms the usual targeted-marketing methodology for optimizing each promotion in isolation. We also find that the sequential targeting rules acquired by our proposed methods are more cost-containment oriented in nature compared with the corresponding single-event targeting rules.
               
            

@&#INTRODUCTION@&#

Catalog firms mail billions of catalogs each year. To stay competitive, catalog managers need to maximize the return on these mailings by deciding who should receive a mail-order catalog. Traditional methods only attempt to maximize the benefit (equivalently, minimize the cost) of a single period mailing decision, and customers are typically selected for promotional mailings on the basis of the profits or revenues they are expected to generate on each mailing when viewed in isolation (Bult & Wansbeek, 2005). However, making a selection for only one period neglects the dynamics in the response to a mailing. For example, the expected profits obtained by mailing the current promotion to a certain customer might exceed the current cost of the mailing and might increase the profits generated by that customer in future mailings. More generally, marketing actions that are desirable from the perspective of maximizing customer value over time may sacrifice immediate rewards in anticipation of larger future revenues (DeSarbo & Ramaswamy, 1994).

We propose a two-step approach that allows firms to address the dynamic implications of mailing decisions and to make efficient mailing decisions by maximizing the long-term value generated by customers. Specifically, we first use a non-homogenous hidden Markov model (HMM) to capture the interactive dynamics between customers and mailings; the mailing endogeneity that may result in biased parameter estimates is corrected. Then, in the second step, to optimize the mailing decisions, we apply the Partial Observable Markov Decision Process (POMDP) to dynamically determine mailing numbers across customers and to maximize customer lifetime value (CLV). Seasonality is also considered in both HMM and the succeeding optimization model. In the proposed modeling framework, the customer is assumed to be in unobservable and unknown behavior states at any given point in time. These states represent a customer's latent psychological preference on keeping or ceasing doing business with the company. When the company sends mailings, the customer then makes a probabilistic transition to another state, possibly generating a reward by responding to the mailings. This process continues throughout the life of the customer's relationship with the company. By incorporating mailing intervention data into the procedure for estimating the transition matrices, one can obtain direct assessments of an intervention's effectiveness.

To gain evidence for this concept, we test our approach on a donation data set from the Direct Marketing Educational Foundation (DMEF). The results of our experiments show that the proposed model fit the data well in terms of correct predictions and outperformed all other benchmark models. In terms of the cumulative profits obtained, our approach outperformed repeated applications of single-event targeting rules. We also observe that the sequential targeting rules acquired by our proposed methods were more effective with cost-containment when compared with the corresponding single-event targeting rules.

The remainder of this paper is organized as follows. Section 2 introduces existing studies on mailing optimization. Section 3 describes the proposed model and the estimation approach for mailing optimization. Section 4 provides an empirical study of the proposed modeling framework, including a summary of the parameter estimates and predictive validation, a discussion of the effects of the mailings, other covariates in terms of the transition probabilities of the HMM, and the results of the mailing optimization simulative experiments. Lastly, Section 5 provides a conclusion.

Traditional methods for mailing decisions are based on response models that calculate the response probability for every customer in the database. The goal of response modeling is to identify customers who are likely to purchase a product on the basis of their purchase history and other information (Kang, Cho, & MacLachlan, 2012). Based on model predictions, catalog firms attempt to induce higher potential buyers to purchase the campaigned product using their mailed catalog. A large number of studies have been conducted with the objective of increasing response rate by improving the prediction algorithms used in response modeling (see Schröder and Hruschka, 2012
 for a comprehensive review). Logistic regression has been widely employed as a base model because of its simplicity and availability (Kang et al., 2012). In addition to logistic regression, independent component analysis (Ahn, Choi, & Han, 2007), artificial neural networks (Baesens, Viaene, Van den Poel, Vanthienen, & Dedene, 2002; Kaefer, Heilman, & Ramenofsky, 2005), novelty detection (Lee & Cho, 2007), support vector machines (Shin & Cho, 2006), and decision trees (Coenen, Swinnen, Vanhoof, & Wets, 2000) were proposed from pattern recognition and data mining researchers.

In traditional methods, customers are selected for promotional mailings on the basis of the profits or revenues they are expected to generate on each mailing when viewed in isolation (Bose & Chen, 2009; Bult & Wansbeek, 2005). To maximize the expected profits for a given promotion, mailings should be sent only to customers whose predicted expected profits is positive when considering mailing costs. However, making a selection for only one period neglects the dynamics associated with the response to a mailing (Abe et al., 2002). For example, the expected profits obtained by mailing the current promotion to a certain customer might exceed the current cost of the mailing and might increase the profits generated by that customer in future mailings. More generally, marketing actions that are desirable from the perspective of maximizing customer value over time may sacrifice immediate rewards in anticipation of larger future revenues (DeSarbo & Ramaswamy, 1994).

A variety of optimal mailing models that address multiple solicitation problems have been proposed, beginning with the pioneering work of Bitran and Mondschein (1996) and continuing with important contributions by Elsner, Krafft, and Huchzermeier (2003, 2004), Gönül and Shi (1998), Pednault, Abe, and Zadrozny (2002), Piersma and Jonker (2004), Simester et al. (2006), and Neslin et al. (2013). All of these papers make significant contributions to a burgeoning literature on optimal mailing models. However, for most of these models, the definition of consumer behavior states is based on some variations of RFM segmentation. For example, Bitran and Mondschein (1996) and Gonul and Shi (1998) used Markov chain models to represent the evolution of customers’ status characterized by their RFM values. Simester et al. (2006) proposed a classification and regression tree algorithm to segment the RFM state space and to determine whether to mail catalogs to all customers in a given state.

Despite RFM analysis often being used to identify customers to whom marketing should be targeted, this analysis usually simply shows who purchased from the company in the past. RFM states nothing about what is driving customers to make purchases and cannot be used to predict changes in customer behavior over time (e.g., seasonality). The method using RFM as representatives of customer relationships usually yields a large number of states and observations are often unevenly distributed across these states, making the state transition matrixes unreliably estimated. Additionally, customers are clustered into different groups assuming independent observations; transition matrices are then estimated assuming that each customer belongs to a cluster with probability 1. This procedure prevents uncertainty about cluster membership and transition probabilities from correctly propagating through the model.

We address the limitations by modeling the customer dynamics using a nonhomogeneous HMM. Because HMMs directly model the temporal aspect of the data, they can borrow strength across nearby observations when estimating model parameters and classifying observations to states. The Bayesian methods employed in this paper allow arbitrary functions of HMM parameters to be estimated when automatically accounting for parameter uncertainty. Our model can be applied to past, current, and new customers, and enables marketers to clearly identify the factors that drive spending decisions, thus enabling the marketer to identify new or up-and-coming markets. Our HMM can also be used to predict changes in customer behavior over time, thus enabling the marketer to respond quickly to an evolving market. Compared with the traditional Tobit response model (e.g., Van Diepen, Donkers, & Franses, 2009), HMM provides a more flexible modeling framework. The coefficients in the response function of a HMM are allowed to be state dependent.

Among the small but growing number of HMM applications in marketing (Kumar et al. 2011; Mark et al. 2013; Montoya, Netzer, & Jedidi, 2010; Netzer, Lattin, & Srinivasan, 2008; Romero, van der Lans, & Wierenga, 2013; Schweidel, Bradlow, & Fader, 2011), our approach is methodologically similar to Netzer et al. (2008) and Montoya et al. (2010). Netzer et al. (2008) was the first study to use the HMM framework to capture the dynamic interactions between marketing interventions and the state of customer relationships; however, their paper was not concerned with the problem of optimal marketing intervention. The key similarity of our study and Montoya et al. (2010) is that both studies further consider the optimal allocation of marketing resources. At the same time, some important differences exist. First, our application context differs from these two studies in that we look at the situation of a non-profit charity's optimal mailing decision. We consider the dynamic interactions between soliciting mailings and a donor's latent behavior state. All of the components of the HMM need to be designed according to this specific situation. For example, the state-dependent response functions in the HMM are deliberately designed for the sparse mailing responses using a binomial distribution model. We also need to consider seasonality in the model, which both Netzer et al. (2008) and Montoya et al. (2010) did not consider. Our substantive findings also enhance our understanding of the short-term and long-term effects of mailings in this research area. Second, we explicitly account for the endogeneity of mailings in our application, which both Netzer et al. (2008) and Montoya et al. (2010) did not integrate into their hidden Markov model-based analysis. Third, our optimal mailing allocation problem involves time-varying uncontrollable variables (seasonality dummies). We propose a method to transform it into a standard POMDP problem.

Our paper is also linked to CLV measurement and optimization studies. CLV is rapidly gaining acceptance as a metric to measure the impact of marketing interventions. Researchers have suggested various methods for using customer-level data to measure the CLV (Ascarza & Hardie, 2013; Borle, Singh, & Jain, 2008; Fader, Hardie, & Lee, 2005; Romero et al. 2013; Rust, Zeithaml, & Lemon, 2004). However, this study is one of few linking marketing intervention to CLV maximization (Blattberg & Deighton, 1996; Ma, Tan, & Fang, 2015; Montoya et al., 2010; Rust et al., 2004). Marketing actions influence CLV, which in turn affects the type of marketing actions to select. However, in most existing measuring models, CLV is viewed as an exogenous variable, which does not depend on marketing actions. This approach is similar to Rust and Verhoef (2005), who proposed that the general marketing interventions problem in CRM should be viewed as follows: determine fully personalized levels of marketing interventions using multiple marketing interventions over time in such a way that maximizes CLV.

In this section, we describe the use of a nonhomogeneous HMM to capture customer dynamics in response behavior and the short- and long-term effects of mailings.

The HMM is a stochastic process model that is not directly observable but that can be observed only through another set of stochastic processes that produces a set of observations. In our application, the hidden states represent a finite set of behavior states. These states represent customers’ latent psychological preferences on continuing to or ceasing to do business with the company. The higher the states in which customers stay, the more likely they respond to a company's solicitation. The transition between the latent states is characterized by a multi-state Markov process. This stochastic process is then transformed into observed response behavior through the stochastic response process.

The probability that customer i is in state s at the beginning of the observation is πis
                           
                           =P(Si
                           
                           1
                           =
                           s). Note that it is common in applications of HMMs to model the initial state distribution as the stationary distribution of the hidden Markov chain. This is true partly because most of applications of HMMs involve a single longtime series; however, in this study, multiple time series are needed to empirically estimate πis
                           . We model πis
                            as a separate parameter because we expect the distribution of customers among states to evolve over time. Specifically, πis
                            is modeled as

                              
                                 (1)
                                 
                                    
                                       
                                          
                                          
                                          
                                             
                                                
                                                   π
                                                   
                                                      i
                                                      1
                                                   
                                                
                                                =
                                                Φ
                                                
                                                   (
                                                   
                                                      δ
                                                      
                                                         i
                                                         1
                                                      
                                                   
                                                   )
                                                
                                                ,
                                             
                                          
                                       
                                       
                                          
                                          
                                          
                                             
                                                
                                                   π
                                                   
                                                      i
                                                      2
                                                   
                                                
                                                =
                                                Φ
                                                
                                                   (
                                                   
                                                      δ
                                                      
                                                         i
                                                         2
                                                      
                                                   
                                                   )
                                                
                                                −
                                                Φ
                                                
                                                   (
                                                   
                                                      δ
                                                      
                                                         i
                                                         1
                                                      
                                                   
                                                   )
                                                
                                                ,
                                             
                                          
                                       
                                       
                                          
                                          
                                          
                                             
                                                
                                                
                                                
                                                
                                                ⋮
                                             
                                          
                                       
                                       
                                          
                                          
                                          
                                             
                                                
                                                   π
                                                   
                                                      i
                                                      N
                                                   
                                                
                                                =
                                                1
                                                −
                                                Φ
                                                
                                                   (
                                                   
                                                      δ
                                                      
                                                         i
                                                         ,
                                                         N
                                                         −
                                                         1
                                                      
                                                   
                                                   )
                                                
                                                ,
                                             
                                          
                                       
                                    
                                 
                              
                           where N is the number of states, δis
                            is the s ordered thresholds for individual i in state s, s∈ [1, …, N
                           −1], and 
                              
                                 
                                    δ
                                    
                                       i
                                       1
                                    
                                 
                                 ≤
                                 
                                    δ
                                    
                                       i
                                       2
                                    
                                 
                                 ≤
                                 ⋯
                                 ≤
                                 
                                    δ
                                    
                                       i
                                       ,
                                       N
                                       −
                                       1
                                    
                                 
                              
                            is imposed. Φ(.) is the standard normal cumulative distribution function. To account for the unobserved heterogeneity among customers, we assume that 
                              
                                 
                                    δ
                                    
                                       i
                                       1
                                    
                                 
                                 =
                                 
                                    
                                       δ
                                       ^
                                    
                                    
                                       i
                                       1
                                    
                                 
                              
                           , 
                              
                                 
                                    δ
                                    
                                       i
                                       k
                                    
                                 
                                 =
                                 
                                    δ
                                    
                                       i
                                       k
                                       −
                                       1
                                    
                                 
                                 +
                                 
                                    
                                       δ
                                       ^
                                    
                                    
                                       i
                                       k
                                    
                                 
                              
                           , k
                           =2, …, N
                           −1, and 
                              
                                 
                                    
                                       δ
                                       ^
                                    
                                    
                                       i
                                       k
                                    
                                 
                                 ∼
                                 Γ
                                 
                                    (
                                    
                                       a
                                       
                                          δ
                                          k
                                       
                                    
                                    ,
                                    
                                       b
                                       
                                          δ
                                          k
                                       
                                    
                                    )
                                 
                              
                           .

We assume that the customer's propensity for transition is affected by the mailings. The probability that a customer transitions from state s at time t
                           
                           −
                           1 to state s’ at time t when receiving x mailings at time t
                           −1 is P(Sit
                           
                           =
                           s’|Sit
                           
                           
                           −
                           
                           1
                           =
                           s, Xit
                           
                           
                              −
                           
                           1
                           =
                           x)=
                           pits,s
                           
                           ’(x). Similar to Netzer et al. (2008) and Montoya et al. (2010), we model the transitions between the states as an ordered probit model, in which a discrete transition occurs if the propensity for transition passes a threshold level. Putting this process in mathematical terms, we assume that the unobserved part of the propensity for transition is independently and identically distributed (i.i.d.) of the normal type. Specifically, the term pits,s
                           
                           ’ (x) could be written as

                              
                                 (2)
                                 
                                    
                                       
                                          
                                          
                                          
                                             
                                                
                                                   p
                                                   
                                                      i
                                                      t
                                                      s
                                                      ,
                                                      1
                                                   
                                                
                                                
                                                   (
                                                   x
                                                   )
                                                
                                                =
                                                Φ
                                                
                                                   (
                                                   
                                                      
                                                         α
                                                         
                                                            i
                                                            s
                                                            ,
                                                            1
                                                         
                                                      
                                                      −
                                                      
                                                         β
                                                         
                                                            i
                                                            s
                                                         
                                                      
                                                      h
                                                      
                                                         (
                                                         x
                                                         )
                                                      
                                                      −
                                                      
                                                         
                                                            
                                                               η
                                                            
                                                         
                                                         ′
                                                      
                                                      
                                                         Q
                                                         t
                                                      
                                                   
                                                   )
                                                
                                                ,
                                             
                                          
                                       
                                       
                                          
                                          
                                          
                                             
                                                
                                                   p
                                                   
                                                      i
                                                      t
                                                      s
                                                      ,
                                                      2
                                                   
                                                
                                                
                                                   (
                                                   x
                                                   )
                                                
                                                =
                                                Φ
                                                
                                                   (
                                                   
                                                      
                                                         α
                                                         
                                                            i
                                                            s
                                                            ,
                                                            2
                                                         
                                                      
                                                      −
                                                      
                                                         β
                                                         
                                                            i
                                                            s
                                                         
                                                      
                                                      h
                                                      
                                                         (
                                                         x
                                                         )
                                                      
                                                      −
                                                      
                                                         
                                                            
                                                               η
                                                            
                                                         
                                                         ′
                                                      
                                                      
                                                         Q
                                                         t
                                                      
                                                   
                                                   )
                                                
                                                −
                                                Φ
                                                
                                                   (
                                                   
                                                      
                                                         α
                                                         
                                                            i
                                                            s
                                                            1
                                                         
                                                      
                                                      −
                                                      
                                                         β
                                                         
                                                            i
                                                            s
                                                         
                                                      
                                                      h
                                                      
                                                         (
                                                         x
                                                         )
                                                      
                                                      −
                                                      
                                                         
                                                            
                                                               η
                                                            
                                                         
                                                         ′
                                                      
                                                      
                                                         Q
                                                         t
                                                      
                                                   
                                                   )
                                                
                                                ,
                                             
                                          
                                       
                                       
                                          
                                          
                                          
                                             
                                                
                                                
                                                
                                                
                                                ⋮
                                             
                                          
                                       
                                       
                                          
                                          
                                          
                                             
                                                
                                                   p
                                                   
                                                      i
                                                      t
                                                      s
                                                      ,
                                                      N
                                                   
                                                
                                                
                                                   (
                                                   x
                                                   )
                                                
                                                =
                                                1
                                                −
                                                Φ
                                                
                                                   (
                                                   
                                                      
                                                         α
                                                         
                                                            i
                                                            s
                                                            ,
                                                            N
                                                            −
                                                            1
                                                         
                                                      
                                                      −
                                                      
                                                         β
                                                         
                                                            i
                                                            s
                                                         
                                                      
                                                      h
                                                      
                                                         (
                                                         x
                                                         )
                                                      
                                                      −
                                                      
                                                         
                                                            
                                                               η
                                                            
                                                         
                                                         ′
                                                      
                                                      
                                                         Q
                                                         t
                                                      
                                                   
                                                   )
                                                
                                                ,
                                             
                                          
                                       
                                    
                                 
                              
                           where αisj
                            is the s ordered threshold for individual i in state s, s∈ [1, …, N], j∈ [1, …, N
                           −1], and 
                              
                                 
                                    α
                                    
                                       i
                                       s
                                       1
                                    
                                 
                                 ≤
                                 
                                    α
                                    
                                       i
                                       s
                                       2
                                    
                                 
                                 ≤
                                 ⋯
                                 ≤
                                 
                                    α
                                    
                                       i
                                       s
                                       ,
                                       N
                                       −
                                       1
                                    
                                 
                              
                            is imposed by setting 
                              
                                 
                                    α
                                    
                                       i
                                       s
                                       1
                                    
                                 
                                 =
                                 
                                    
                                       α
                                       ^
                                    
                                    
                                       
                                       
                                          i
                                          s
                                          1
                                       
                                    
                                 
                              
                           , 
                              
                                 
                                    α
                                    
                                       i
                                       s
                                       k
                                    
                                 
                                 =
                                 
                                    α
                                    
                                       i
                                       s
                                       ,
                                       k
                                       −
                                       1
                                    
                                 
                                 +
                                 exp
                                 
                                    (
                                    
                                       
                                          α
                                          ^
                                       
                                       
                                          i
                                          s
                                          k
                                       
                                    
                                    )
                                 
                              
                            
                           k=2, …, N
                           −
                           1. 
                              β
                           
                           
                              is
                            are regression weights intended to capture the effect of mailings on the propensity of transitions. The vector Q
                           
                              t
                            includes dummy variables, indicating the quarters of the year at time t. η is a vector of parameters capturing the effect of seasons on transition. We log-transform the number of mailings by setting h(x)=log(x
                           +1) to capture the potentially diminishing returns of their effectiveness. We define the first state as an absorbing state (‘death state’), which indicates that 
                              
                                 
                                    α
                                    
                                       i
                                       11
                                    
                                 
                                 =
                                 +
                                 ∞
                              
                           . By this relationship, we simplify the model and make the hidden states easier to explain and identify.


                           Fig. 1
                            illustrates the principle of our state transition model when the number of states is N
                           =3. Two thresholds α
                           
                              is1 and α
                           
                              is2 separate the standard normal density area into three parts. The area of each part is the respective transition probability. When 
                              β
                           
                           
                              is
                            is positive, mailings increase the probability of transiting to higher states.

The probability distribution that the number of responses given by customer i at time t conditioned on his or her state and the mailings received is P(Yit
                           
                           =
                           y|Sit
                           
                           =
                           s, Xit
                           
                           =
                           x)=
                           qitsy
                           (x), where Yit
                            is the number of responses made by customer i at time t. Given the customer's state, the responses are assumed to be conditionally independent. Specifically, we model the distribution of responses in time t with a hierarchical binomial model:

                              
                                 
                                    
                                       
                                          q
                                          
                                             i
                                             t
                                             s
                                             y
                                          
                                       
                                       
                                          (
                                          x
                                          )
                                       
                                       =
                                       
                                          
                                             
                                                
                                                   y
                                                   ˜
                                                
                                                i
                                             
                                             !
                                          
                                          
                                             y
                                             !
                                             (
                                             
                                                
                                                   y
                                                   ˜
                                                
                                                i
                                             
                                             −
                                             y
                                             )
                                             !
                                          
                                       
                                       
                                          λ
                                          
                                             i
                                             t
                                             s
                                          
                                          y
                                       
                                       
                                          
                                             (
                                             1
                                             −
                                             
                                                λ
                                                
                                                   i
                                                   t
                                                   s
                                                
                                             
                                             )
                                          
                                          
                                             
                                                
                                                   y
                                                   ˜
                                                
                                                i
                                             
                                             −
                                             y
                                          
                                       
                                    
                                 
                              
                           
                           
                              
                                 (3)
                                 
                                    
                                       logit
                                       
                                          (
                                          
                                             λ
                                             
                                                i
                                                t
                                                s
                                             
                                          
                                          )
                                       
                                       =
                                       
                                          γ
                                          
                                             0
                                             i
                                             s
                                          
                                       
                                       +
                                       
                                          γ
                                          
                                             i
                                             s
                                          
                                       
                                       x
                                       +
                                       
                                          ξ
                                          
                                             1
                                             i
                                             t
                                          
                                       
                                       ,
                                    
                                 
                              
                           where 
                              
                                 
                                    y
                                    ˜
                                 
                                 i
                              
                            is the ceiling number of responses in one period for customer i; γ
                           0 represents the intrinsic rate of response without any mailings (delayed response on previous mailings), and γis
                            is the state-specific response coefficient. To ensure identification of the states, we impose the restriction that the response probabilities are non-decreasing in the behavioral states, or γi
                           
                           ,
                           
                              k
                           
                           
                           −
                           
                           1
                           <
                           γi,k,
                            for k
                           =2, … , n. We set 
                              
                                 
                                    λ
                                    
                                       i
                                       t
                                       1
                                    
                                 
                                 =
                                 0
                              
                            to define the first state as a ‘dead’ state. Finally, ξ1it
                            is an additive random error term, accounting for any other customer- and time-varying factors that are not observed or not measurable by the researcher. Note that we simultaneously model a customer's response to mailings and the firm's strategic mailing decision at the individual level, and the model can accommodate correlations between ξ1it
                            and Xit
                            (we subsequently return to this issue). We assume that the random shock ξ1it
                            follows a normal distribution.

We do not employ traditional count regression models, such as Poisson regression or NBD regression. Instead, we use binomial models to describe response behavior, primarily because the responses are usually sparse and the maximum number of responses in one period is usually low. For example, in our empirical data, 92 percent of the individuals provided a maximum number of responses of just one. For 98 percent of the individuals, the maximum number of the responses in one period is no more than two. These response characteristics obviously violate the distribution assumptions in traditional count regression models.

Direct marketers often use target selection techniques to decide on the people to which they will send a direct mailing. They do not send mailings randomly or to everyone; rather, they estimate the likelihood that each prospect will respond and select prospects with high response probabilities (Hruschka, 2010; Manchanda, Rossi, & Chintagunta, 2004). The concept behind target selection techniques is that past behavior predicts future behavior, indicating that people who have frequently responded in the past have a high probability of being selected again in the future. In other words, good customers receive more mailings. The problem is that the researcher cannot observe how the company determines the number of mailings for a customer in a certain period. This problem may result in a correlation between the error terms and the mailings in Eq. (3). Thus, this targeting approach may lead to an endogenous relationship between response behavior and mailing efforts. As Elsner, Krafft, and Huchzermeier (2004) showed, ignoring the endogeneity of mailings results in biased parameter estimates.

To solve this problem, we proceed by defining a model for the mailing selection variable that is linked to the primary response model through a common latent structure. Our method for controlling endogeneity is a Simultaneous Equation Model approach, also used in Park and Gupta (2009) and a recent paper by Zhang, Netzer, and Ansari (2014). We assume that the mailing selection variable, x, is conditioned by a selection-specific latent effect, say μit
                        , a binomial random variable with canonical parameter described through the following mixed effect logistic model:

                           
                              (4)
                              
                                 
                                    p
                                    
                                       (
                                       
                                          X
                                          
                                             i
                                             t
                                          
                                       
                                       =
                                       x
                                       )
                                    
                                    =
                                    
                                       
                                          
                                             x
                                             ˜
                                          
                                          !
                                       
                                       
                                          x
                                          !
                                          (
                                          
                                             x
                                             ˜
                                          
                                          −
                                          x
                                          )
                                          !
                                       
                                    
                                    
                                       μ
                                       
                                          i
                                          t
                                       
                                       x
                                    
                                    
                                       
                                          (
                                          1
                                          −
                                          
                                             μ
                                             
                                                i
                                                t
                                             
                                          
                                          )
                                       
                                       
                                          
                                             x
                                             ˜
                                          
                                          −
                                          x
                                       
                                    
                                    ,
                                 
                              
                           
                        
                        
                           
                              (5)
                              
                                 
                                    logit
                                    
                                       (
                                       
                                          μ
                                          
                                             i
                                             t
                                          
                                       
                                       )
                                    
                                    =
                                    
                                       φ
                                       
                                          i
                                          0
                                       
                                    
                                    +
                                    
                                       φ
                                       
                                          i
                                          1
                                       
                                    
                                    
                                       Z
                                       
                                          i
                                          t
                                       
                                    
                                    +
                                    
                                       ξ
                                       
                                          2
                                          i
                                          t
                                       
                                    
                                    ,
                                 
                              
                           
                        where 
                           
                              x
                              ˜
                           
                         is the ceiling number of mailings sent in one period andμit
                         is the mailing rate for customer i at time t. To obtain consistent estimates of the parameters, the instrument Zit
                         must be correlated with the mailings Xit
                         and independent of the errors in the response model (Eq. (3)), in particular, independent of ξ1it
                        . To satisfy these two conditions, we use the number of mailings sent in the same period a year ago, i.e., Xt
                        
                        
                        −
                        
                        4, as the instrument for mailings.

                           1
                        
                        
                           1
                           Theoretically, the mailings sent in a year ago are less likely to affect current response because of the effects of forgetting. Many existing literatures on charity donation behavior have proved this. For example, Van Diepen et al. (2009) estimated a decay parameter for mailing effect and found that after a year, a direct mailing is almost completely forgotten, and its effect is negligible. The correlation between the current mailing and the mailings sent in the same quarter a year ago comes mainly from seasonality in mailing series. Empirically, as a preliminary test, we did a full first stage regression of the reduced form (Eqs. (4) and (5)). The F statistics of the first stage regression is 131.4 which indicate the instrument is not weak (Stock and Yogo, 2005).
                         To account for unobservable endogeneity, we assume that ξ2it
                         is distributed in a jointly bivariate normal manner with ξ1it
                        :

                           
                              
                                 
                                    
                                       (
                                       
                                          ξ
                                          
                                             1
                                             i
                                             t
                                          
                                       
                                       ,
                                       
                                          ξ
                                          
                                             2
                                             i
                                             t
                                          
                                       
                                       )
                                    
                                    ∼
                                    M
                                    V
                                    N
                                    
                                       (
                                       
                                          0
                                          ,
                                          Σ
                                       
                                       )
                                    
                                    ,
                                 
                              
                           
                        
                        
                           
                              
                                 
                                    Σ
                                    =
                                    
                                       (
                                       
                                          
                                             
                                                
                                                   
                                                      σ
                                                      1
                                                      2
                                                   
                                                   
                                                   
                                                   ρ
                                                   
                                                      σ
                                                      1
                                                   
                                                   
                                                      σ
                                                      2
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ρ
                                                   
                                                      σ
                                                      1
                                                   
                                                   
                                                      σ
                                                      2
                                                   
                                                   
                                                   
                                                   
                                                      σ
                                                      2
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                       )
                                    
                                    ,
                                 
                              
                           
                        where σ1
                        2 is the variance of ξ1it
                        , σ2
                        2 is the variance for the random shock ξ2it
                        , and ρ is the covariance between ξ1it
                         and ξ2it
                        .

Let 
                           
                              
                                 Y
                                 
                                    i
                                    t
                                 
                                 T
                              
                              =
                              
                                 (
                                 
                                    Y
                                    
                                       i
                                       t
                                    
                                 
                                 ,
                                 
                                    Y
                                    
                                       i
                                       t
                                       +
                                       1
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    Y
                                    
                                       i
                                       T
                                    
                                 
                                 )
                              
                           
                         denote a sequence of T observations for customer i (i
                        =1, ..., M) and similarly 
                           
                              
                                 X
                                 
                                    i
                                    t
                                 
                                 T
                              
                              =
                              
                                 (
                                 
                                    X
                                    
                                       i
                                       t
                                    
                                 
                                 ,
                                 
                                    X
                                    
                                       i
                                       t
                                       +
                                       1
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    X
                                    
                                       i
                                       T
                                    
                                 
                                 )
                              
                           
                        . Let θ
                        
                           i
                        
                        
                        =
                        
                        {
                        
                           
                              
                                 δ
                                 ^
                              
                              
                                 i
                                 k
                              
                           
                        , 
                           
                              
                                 α
                                 ^
                              
                              
                                 i
                                 s
                                 k
                              
                           
                        , βi
                        
                        s, γis, k
                        =1, …, N
                        −
                        1} be the set of individual level parameters and ϒ={γ
                        
                           0, η, φ0, φ1, ρ, σ
                        1, σ
                        2} the set of fixed parameters. Given the HMM structure, the likelihood function for customer i can be written as

                           
                              (6)
                              
                                 
                                    
                                       
                                          
                                             L
                                             i
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             p
                                             (
                                             
                                                Y
                                                
                                                   i
                                                   1
                                                
                                                T
                                             
                                             ,
                                             
                                                X
                                                
                                                   i
                                                   1
                                                
                                                T
                                             
                                             |
                                             
                                                
                                                   θ
                                                
                                                i
                                             
                                             ,
                                             Y
                                             )
                                          
                                       
                                    
                                    
                                       
                                       
                                          =
                                       
                                       
                                          
                                             
                                                ∑
                                                
                                                   S
                                                   ∈
                                                   
                                                      
                                                         S
                                                      
                                                      N
                                                   
                                                
                                             
                                             
                                                
                                                   π
                                                   
                                                      i
                                                      
                                                         S
                                                         1
                                                      
                                                   
                                                
                                                p
                                                
                                                   (
                                                   
                                                      Y
                                                      
                                                         i
                                                         1
                                                      
                                                   
                                                   ,
                                                   
                                                      X
                                                      
                                                         i
                                                         1
                                                      
                                                   
                                                   |
                                                   
                                                      S
                                                      1
                                                   
                                                   ,
                                                   
                                                      
                                                         θ
                                                      
                                                      i
                                                   
                                                   ,
                                                   Y
                                                   )
                                                
                                                
                                                   ∏
                                                   
                                                      t
                                                      =
                                                      2
                                                   
                                                   T
                                                
                                                
                                                   
                                                      p
                                                      
                                                         i
                                                         t
                                                         
                                                            S
                                                            t
                                                         
                                                         
                                                            S
                                                            
                                                               t
                                                               +
                                                               1
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         X
                                                         
                                                            i
                                                            t
                                                            −
                                                            1
                                                         
                                                      
                                                      )
                                                   
                                                   p
                                                   
                                                      (
                                                      
                                                         Y
                                                         
                                                            i
                                                            t
                                                         
                                                      
                                                      ,
                                                      
                                                         X
                                                         
                                                            i
                                                            t
                                                         
                                                      
                                                      |
                                                      
                                                         S
                                                         t
                                                      
                                                      ,
                                                      
                                                         
                                                            θ
                                                         
                                                         i
                                                      
                                                      ,
                                                      Y
                                                      )
                                                   
                                                
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Considering the endogeneity of mailings, the mailing-response part of the likelihood function in Eq. (6) is

                           
                              (7)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             p
                                             (
                                             
                                                Y
                                                
                                                   i
                                                   t
                                                
                                             
                                             ,
                                             
                                                X
                                                
                                                   i
                                                   t
                                                
                                             
                                             |
                                             
                                                S
                                                
                                                   i
                                                   t
                                                
                                             
                                             ,
                                             
                                                
                                                   θ
                                                
                                                i
                                             
                                             ,
                                             Y
                                             )
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             
                                             =
                                             ∫
                                             
                                                g
                                                
                                                   (
                                                   
                                                      Y
                                                      
                                                         i
                                                         t
                                                      
                                                   
                                                   |
                                                   
                                                      X
                                                      
                                                         i
                                                         t
                                                      
                                                   
                                                   ,
                                                   
                                                      S
                                                      
                                                         i
                                                         t
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         θ
                                                      
                                                      i
                                                   
                                                   ,
                                                   Y
                                                   ,
                                                   
                                                   
                                                      ɛ
                                                      
                                                         i
                                                         t
                                                      
                                                   
                                                   )
                                                
                                                g
                                                
                                                   (
                                                   
                                                      X
                                                      
                                                         i
                                                         t
                                                      
                                                   
                                                   |
                                                   
                                                      
                                                         θ
                                                      
                                                      i
                                                   
                                                   ,
                                                   Y
                                                   ,
                                                   
                                                   
                                                      ɛ
                                                      
                                                         i
                                                         t
                                                      
                                                   
                                                   )
                                                
                                                ϕ
                                                
                                                   (
                                                   
                                                      ɛ
                                                      
                                                         i
                                                         t
                                                      
                                                   
                                                   |
                                                   0
                                                   ,
                                                   Σ
                                                   )
                                                
                                                d
                                                
                                                   ɛ
                                                   
                                                      i
                                                      t
                                                   
                                                
                                             
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        where g(.) is the binomial mass function and 
                           ε
                        
                        
                           it
                        
                        =(ξ1it, ξ2it
                        )’ and Φ are the two-variate normal density functions.

We work within a hierarchical Bayesian framework and use Winbugs to fit the proposed model to the data. The joint posterior is broken into the full conditional posterior distribution with respect to each parameter and the Gibbs sampler is used. Within the Bayesian framework, the MCMC technique and the Metropolis-Hastings algorithms can be used to sample from the posterior distribution of the parameters (Montoya et al., 2010; Netzer et al., 2008). Scott (2002) pointed out that the MCMC methods for HMM could also be improved by incorporating the forward–backward, likelihood, and Viterbi recursive algorithms into the MCMC algorithm to improve convergence and computational efficiency. Whereas these algorithms can be incorporated to improve the computational efficiency of the MCMC, it is important to note that the direct Gibbs sampling approach for the HMM is computationally very straightforward and intuitive. The details of the algorithm and the setting of priors are provided in the appendix.

After using the proposed HMM to learn customer dynamics, we are left with the problem of finding optimized mailing policies. This problem can be formulated as a Partially Observable Markov Decision Process (POMDP). Using the posterior distribution of the parameters in the proposed HMM, our mailing policy optimization procedure operates at an individual level; therefore, for notational simplicity, subscript i is dropped in the following discussion.
                     

At first glance, the mapping of the proposed HMM to a POMDP is not straightforward. The main difficulty is that our model includes time-varying variables, i.e., seasons. However, by defining the hidden process with state space {(s, Q), s∈(1…N), Q∈(1…4)}, we see that our model does, in fact, conform to the definition of a POMDP with 4*N states. Let pss’
                        (x, q) be the probability of transitioning from state s to state s’ conditional on mailing level x and current season q. Then, we infer the transition probabilities on the basis of the HMM parameters using Eq. (2). The new state transition matrix for the new state space is shown in Table 1.

The timing of the mailing allocation decision is as follows. At the beginning of each period, the decision maker estimates the probability that a customer stays in each of the behavior states and observes the season variables. The manager makes his or her mailing decisions on the basis of the values of these state variables and observes the number of responses. Conditioned on state s and the level of mailings x, the customer responds y times in the period with probability qsy
                        (x). Expressing the probability distribution that the customer stays in each of the behavior states at time t as b
                        
                           t
                        
                        =(bt
                        (1,Qt
                        ), ..., bt
                        (N, Qt
                        )), then given mailing level x and observed response level y, the manager can determine the next belief state by:

                           
                              (8)
                              
                                 
                                    
                                       b
                                       
                                          t
                                          +
                                          1
                                       
                                    
                                    
                                       (
                                       
                                          s
                                          ′
                                       
                                       ,
                                       
                                          Q
                                          
                                             t
                                             +
                                             1
                                          
                                       
                                       )
                                    
                                    =
                                    
                                       
                                          
                                             ∑
                                             s
                                          
                                          
                                             
                                                b
                                                t
                                             
                                             
                                                (
                                                s
                                                ,
                                                
                                                   Q
                                                   t
                                                
                                                )
                                             
                                             
                                                q
                                                
                                                   s
                                                   y
                                                
                                             
                                             
                                                (
                                                x
                                                )
                                             
                                             
                                                p
                                                
                                                   s
                                                   
                                                      s
                                                      ′
                                                   
                                                
                                             
                                             
                                                (
                                                x
                                                ,
                                                
                                                
                                                   Q
                                                   t
                                                
                                                ,
                                                
                                                   Q
                                                   
                                                      t
                                                      +
                                                      1
                                                   
                                                
                                                )
                                             
                                          
                                       
                                       
                                          
                                             ∑
                                             
                                                s
                                                ,
                                                
                                                   s
                                                   ′
                                                
                                             
                                          
                                          
                                             
                                                b
                                                t
                                             
                                             
                                                (
                                                s
                                                ,
                                                
                                                   Q
                                                   t
                                                
                                                )
                                             
                                             
                                                q
                                                
                                                   s
                                                   y
                                                
                                             
                                             
                                                (
                                                x
                                                )
                                             
                                             
                                                p
                                                
                                                   s
                                                   
                                                      s
                                                      ′
                                                   
                                                
                                             
                                             
                                                (
                                                x
                                                ,
                                                
                                                
                                                   Q
                                                   t
                                                
                                                ,
                                                
                                                   Q
                                                   
                                                      t
                                                      +
                                                      1
                                                   
                                                
                                                )
                                             
                                          
                                       
                                    
                                    ,
                                 
                              
                           
                        where qss’
                        (x, Q
                        t, 
                           Q
                        
                        
                           t+
                        
                        1) is the probability of transitioning from state s to state s’ conditioned on the mailing level x and the season changing from Qt
                         to 
                           Q
                        
                        
                           t+
                        
                        1, which can be inferred from the proposed HMM.

The expected immediate reward for decision Xt
                        
                        =
                        x when the state at period t is St
                        
                        =
                        s is defined as

                           
                              (9)
                              
                                 
                                    
                                       R
                                       t
                                    
                                    
                                       (
                                       s
                                       ,
                                       x
                                       )
                                    
                                    =
                                    
                                       [
                                       
                                          
                                             ∑
                                             y
                                          
                                          
                                             
                                                q
                                                
                                                   s
                                                   y
                                                
                                             
                                             
                                                (
                                                x
                                                )
                                             
                                             ×
                                             y
                                          
                                          
                                             z
                                             ¯
                                          
                                          −
                                          c
                                          x
                                       
                                       ]
                                    
                                    ,
                                 
                              
                           
                        where 
                           
                              z
                              ¯
                           
                         is the expected amount of a response, which is the ratio of the total amount of donations to the total number of responses in the calibration period, and c is the average cost of a mailing. Let A
                        
                        =
                        {0, …, M} represent the set of feasible mailings. The problem may now be described as one of finding the controls or decision policies δ (b
                        
                           t
                        )∈A for all stages. The objective, CLV

                           
                              (10)
                              
                                 
                                    C
                                    L
                                    
                                       V
                                       δ
                                    
                                    
                                       (
                                       
                                          b
                                          0
                                       
                                       ,
                                       ψ
                                       )
                                    
                                    =
                                    
                                       ∑
                                       
                                          t
                                          =
                                          0
                                       
                                       T
                                    
                                    
                                       
                                          ψ
                                          t
                                       
                                       
                                          ∑
                                          s
                                       
                                       
                                          
                                             b
                                             t
                                          
                                          
                                             (
                                             s
                                             )
                                          
                                       
                                       
                                          R
                                          t
                                       
                                    
                                    
                                       (
                                       s
                                       ,
                                       δ
                                       
                                          (
                                          
                                             b
                                             t
                                          
                                          )
                                       
                                       )
                                    
                                    ,
                                 
                              
                           
                        is maximized, where ψ is the discount rate. We write the dynamic programming algorithm for mailing decision making of Eq. (10) as the recursive function

                           
                              (11)
                              
                                 
                                    C
                                    L
                                    
                                       V
                                       t
                                    
                                    
                                       (
                                       
                                          b
                                          t
                                       
                                       ,
                                       ψ
                                       )
                                    
                                    =
                                    
                                       max
                                       
                                          x
                                          ∈
                                          A
                                       
                                    
                                    
                                       [
                                       
                                          ∑
                                          s
                                       
                                       
                                          
                                             b
                                             t
                                          
                                          
                                             (
                                             s
                                             )
                                          
                                       
                                       
                                          R
                                          t
                                       
                                       
                                          (
                                          s
                                          ,
                                          δ
                                          
                                             (
                                             
                                                b
                                                t
                                             
                                             )
                                          
                                          )
                                       
                                       +
                                       ψ
                                       E
                                       
                                          [
                                          C
                                          L
                                          
                                             V
                                             
                                                t
                                                +
                                                1
                                             
                                          
                                          
                                             (
                                             
                                                b
                                                
                                                   t
                                                   +
                                                   1
                                                
                                             
                                             ,
                                             ψ
                                             )
                                          
                                          ]
                                       
                                       ]
                                    
                                    .
                                 
                              
                           
                        
                     

A solution to a POMDP is computed using the belief state MDP – an MDP over the belief space of the POMDP. A value function for a POMDP can be described using a set of |S| dimensional vectors that define the expected utility, where each vector, v
                        
                           x,
                         corresponds to a mailing level x (Sondik, 1978). Using such a value function, we define a policy δ (b) over the belief state:

                           
                              (12)
                              
                                 
                                    δ
                                    
                                       (
                                       b
                                       )
                                    
                                    =
                                    arg
                                    
                                       max
                                       x
                                    
                                    
                                       v
                                       x
                                    
                                    ·
                                    b
                                    .
                                 
                              
                           
                        
                     

Because the parameters in the mailing optimization model are estimated from data, random noise in the model parameter estimates is inevitable. Our Bayesian estimation procedure provides a full posterior distribution for each individual-level parameter. These distributions reflect the uncertainty in the estimation. We incorporate the uncertainty in the optimization procedure by integrating out the parameters’ distribution over the MCMC draws (Ansari & Mela, 2003). Specifically, given the estimation results, the optimal policy is calculated as

                           
                              (13)
                              
                                 
                                    δ
                                    
                                       (
                                       b
                                       )
                                    
                                    =
                                    arg
                                    
                                       max
                                       x
                                    
                                    
                                       (
                                       
                                          1
                                          G
                                       
                                       
                                          ∑
                                          
                                             g
                                             =
                                             1
                                          
                                          G
                                       
                                       
                                          v
                                          x
                                          
                                             (
                                             g
                                             )
                                          
                                       
                                       ·
                                       b
                                       )
                                    
                                    ,
                                 
                              
                           
                        where G is the number of retained MCMC draws.

Our data come from a non-profit organization in the United States and were provided by the Direct Marketing Educational Foundation (DMEF dataset 7). The dataset contains information on the donation behavior of almost one million individuals for a charity during the period 1991–2006. For each individual in the database, a record exists of the date of mailing, the date of donation, and the amount of the donation in dollars. We draw a random sample from these data, yielding a set of 1200 donors. We estimate the model using 28 quarters (1998.1–2004.12) of data from the sample. We validate the model using the next six quarters of the data for the calibration cohort. On average, each individual received 15.67 mailings during the period of model fitting, and the average response rate of a donor in the sample is approximately 4.19 percent. The overall frequencies of the dependent variable are as follows: zero donations (94.4 percent), one donation (4.93 percent), two donations (0.51 percent), and more than three donations (0.15 percent).

A sample series for one of the donors is plotted in Fig. 2
                        . Next, we examine the donation rates that occurred in each quarter, as depicted in Fig. 3
                        . An increase in the donation rate seems to occur during the second and the fourth quarters in each year. As mailings occur throughout the year, the data and proposed model should distinguish between increases in donation behavior attributable to direct marketing and to seasonality, the latter of which recurs each year. Finally, we consider how the organization targets mailings to donors following their most recent donation. Fig. 4
                         shows the number of mailings that donors received after a given number of quarters elapsed since their last donation. The observed mailing decisions indicate that the organization sends fewer mailings to donors who have not made a recent donation, which suggests that the firm prunes its mailing list to divert resources from potentially inactive donors. As such, the organization's mailing decisions may be non-random and need to be considered simultaneously with donors’ inter-donation times. Our mailing model is consistent with and builds on this observation.

In essence, we are attempting to obtain a model which provides a reasonable and interpretable fit to the data. The first task in developing a latent state model is choosing N, the number of hidden states, using empirical evidence. We only fit the two- and three-state HMM models to the data because more states may not be well separated in a one-dimensional response space, and more states may result in exponential growth of the number of model parameters and the fitting time.

We use both Bayesian Factor (BF) and posterior predictive checks for the validation periods to compare the models and combine these analyses with existing background knowledge to motivate our model choice. The log marginal density (LMD) and BF are calculated using a harmonic mean of the individual likelihoods across iterations (Newton & Raftery, 1994) from the output of the Gibbs sampler. For each donor in the sample, the last six quarters of possible donation given in the data are saved for validation. This validation data are used to assess the prediction ability of the proposed model and compare it to benchmark models. Model 1 is a three-state HMM that considers endogenous mailings, denoted hereafter as HMME(3). Model 2 is identical to Model 1 except that mailings are considered exogenous. Model 3 is a two-state HMM that considers endogenous mailings. In addition to the HMMs (Models 1–3), we also estimate Models 4 and 5 on the calibration period. Model 4 is a latent class model which can be regarded as a special case of HMM, but it cannot capture the dynamics because donors cannot transit among segments. We estimate the three-segment latent class model for comparison purposes. Model 5 is a four-state first-order Markov model, in which the outcome for individual i at time t
                        +1, Yi,t
                        
                        
                        +
                        
                        1, depends on the previous observation for that individual Yit, Yit
                        ∈(0,1,2,3+). The transition matrix is defined according to the same model described in Eq. (2).

We run the MCMC algorithm for 200,000 burn-in iterations and then keep an additional 100,000 iterations. The parameters estimated on the basis of the calibration period are used to predict the 1200 (donors) * 6 (quarters)=7200 observations of possible donations in the validation period. We assess convergence by running three parallel chains starting from widely varied starting positions and plot the results for a visual graphical assessment. We use this method to check whether the MCMC chains converge to assess how long we should set the burn-in period and to calculate Gelman's R statistic (Gelman & Rubin, 1992). Across three parallel chains, the scale reduction estimate for all parameters estimated is lower than 1.2, suggesting that convergence has been achieved.

We compare the prediction ability of the alternative models using Bayesian Predictive Likelihood (BPL), Predictive Bayes Factors (PBF), Mean Absolute Error (MAE), Root Mean Squared Error (RMSE), and Area Under Curve (AUC). Let τ be the length of the validation period. Then the Bayesian Predictive Likelihood is a real number

                           
                              (14)
                              
                                 
                                    
                                       
                                          
                                             B
                                             P
                                             
                                                L
                                                M
                                             
                                             
                                                (
                                                τ
                                                )
                                             
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             p
                                             (
                                             
                                                Y
                                                
                                                   T
                                                   +
                                                   1
                                                
                                                
                                                   T
                                                   +
                                                   τ
                                                
                                             
                                             |
                                             
                                                Y
                                                1
                                                T
                                             
                                             ,
                                             M
                                             )
                                          
                                       
                                    
                                    
                                       
                                       
                                          =
                                       
                                       
                                          
                                             
                                                ∫
                                                
                                                   Θ
                                                   M
                                                
                                             
                                             
                                                p
                                                (
                                                
                                                   Y
                                                   
                                                      T
                                                      +
                                                      1
                                                   
                                                   
                                                      T
                                                      +
                                                      τ
                                                   
                                                
                                                |
                                                
                                                   Y
                                                   1
                                                   T
                                                
                                                ,
                                                
                                                   
                                                      θ
                                                   
                                                   M
                                                
                                                ,
                                                M
                                                )
                                             
                                             p
                                             
                                                (
                                                
                                                   
                                                      θ
                                                   
                                                   M
                                                
                                                |
                                                
                                                   Y
                                                   1
                                                   T
                                                
                                                ,
                                                M
                                                )
                                             
                                             d
                                             
                                                
                                                   θ
                                                
                                                M
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                          ≈
                                       
                                       
                                          
                                             
                                                1
                                                G
                                             
                                             
                                                ∑
                                                
                                                   g
                                                   =
                                                   1
                                                
                                                G
                                             
                                             
                                                p
                                                (
                                                
                                                   Y
                                                   
                                                      T
                                                      +
                                                      1
                                                   
                                                   
                                                      T
                                                      +
                                                      τ
                                                   
                                                
                                                |
                                                
                                                   Y
                                                   1
                                                   T
                                                
                                                ,
                                                
                                                   
                                                      θ
                                                   
                                                   M
                                                   
                                                      (
                                                      g
                                                      )
                                                   
                                                
                                                ,
                                                M
                                                )
                                             
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        for model M with a vector of parameters 
                           θ
                        
                        
                           M
                         ∈ ΘM
                        , using the retained MCMC draws {
                           
                              
                                 θ
                              
                              M
                              
                                 (
                                 g
                                 )
                              
                           
                        } from the Gibbs sampler. The BPLM1
                        /BPLM2
                         is the predictive Bayes factor in favour of M
                        1 over M
                        2 (Geweke & Amisano, 2010). The AUC is equal to the probability that a classifier ranks a randomly chosen positive instance higher than a randomly chosen negative instance (Fawcett, 2006). We define donations as a positive instance and no donation as a negative instance. We predict a donation if the predicted probability of a donation is larger than a certain threshold. To draw the receiver operating characteristic (ROC) curve, we need to calculate the true positive rate (TPR) and the false positive rate (FPR). The TPR and FPR are defined as follows, providing more information:

                           
                              TPR=donations correctly predicted/total donations,

FPR=non-donations incorrectly classified/total non-donations.


                        Table 2 reports the Bayesian factors and the prediction checks for the holdout dataset. Fig. 5
                         shows the receiver operating characteristic (ROC) classification performance of the five models. This measure enables control over whether the targeted segment of donors indeed contains actual ones. All of the metrics suggest that HMME(3) fits the data well in terms of correct prediction and outperforms all of the other models. The improvement in the prediction ability of the HMME(3) relative to the alternative models is consistent across all measures used. On the basis of the Bayesian factors and the predictive results, we select HMME(3) as our final model for further analysis and mailing optimization.


                        Table 3
                         reports the posterior means, posterior standard deviations, and the 95 percent posterior intervals for HMME(3). The results in Table 3 show that mailings have significant positive effects in switching donors from less active states to higher active states. The effect of mailings on switching a donor from state 2 to state 3 is significantly positive. We also find that the effect of mailings on keeping a donor in state 3 is significantly positive. Thus, each extra mailing that the organization sends positively affects the probability that a person will respond to future mailings. Thus, sending mailings is not only a short-term marketing activity, it also affects the window of time in which donors may contribute to the organization in the long run. We can take advantage of this behavior when optimizing the mailing decision.

To further investigate whether our HMME(3) can truly capture the dynamics between mailings and donations, we implement a simulative analysis. We use the set of parameters obtained from the HMME(3) to simulate the donations of historical mailings in the dataset. In Fig. 6
                        
                        
                        , we show a scatter plot of the totals of the simulative donations across time for each donor in the sample and compare them with real donations. All evidence indicates that the proposed model works well, which gives us confidence in using the model for further mailing optimization.

Using the selected sample of individuals, we set their initial belief states to correspond to their posterior mean of state distributions at the end of the calibration period. We then use the POMDP procedure and the posterior distribution of the individual-level HMM parameter estimates to optimize the mailing policy for each donor in our sample. We derive optimal mailing strategies using two time horizons (one period and infinite periods) for each individual. The one-period horizon policy is a myopic policy because it only considers rewards from the current period. The infinite period policy is a forward-looking policy which considers rewards in the long run. In solving the optimization problem, we make the following assumptions: the cost of one mailing is $2, the quarter discount rate γ is 0.95, and the action choice set is 
                           
                              {
                              0
                              .
                              .
                              .
                              
                                 A
                                 
                                    max
                                 
                                 i
                              
                              }
                           
                         mailings. 
                           
                              A
                              
                                 max
                              
                              i
                           
                         is the maximum mailings sent to donor i in the calibration period. We then throw all of these individuals into the HMMs and use the output of POMDP to optimally decide on how many mailings to make for each individual in each quarter. Utilizing the HMM models, we simulate the resulting rewards and compute the next belief states. We record the rewards thus obtained, and then go on to the next period. We repeat this procedure six times, simulating a sequence of six virtual periods (quarters). We evaluate our proposed approach with respect to a number of performance measures, including the total profits obtained, number of mailings per individual, number of responses per individual, response rate, and the profits obtained per mailing.

We use the measures to compare the forward-looking policy to the myopic policy and the current mailing policy of the charity. Table 4 summarizes the results. All expected profits provided in Table 4 are computed for the same number of quarters. The highest expected profits are achieved when the optimization horizon is infinite (16,985, entry 1 in Table 4). The 22 percent improvement in profits for the forward-looking policy relative to the myopic policy stresses the importance of accounting for the long-term effect of mailing and the firm's forward-looking behavior. A comparison of the results of the forward-looking policy with the actual donations in the validation periods indicates a significant improvement with the forward-looking model. Fewer mailing are sent and the response is higher, hence the mailings are more efficient. Total profits more than quadrupled and higher revenues are generated by sending fewer mailings.

In Fig. 7, we compare the differences according to Recency, Frequency and Monetary between the optimum forward-looking mailing policy and that actually implemented. First, both optimum and actual policies tend to mail donors with small recency. However, many actual mailings are also sent to donors who have been dormant for a long time (recency=5), whereas mailings are rarely sent to them in the optimum policy. Second, the distribution of actual mailings is similar to optimum mailings regarding frequency, with the main difference being that the actual policy sends 1000 more mailings than the optimum policy to donors who rarely donate. Third, very significant differences in mailing distributions exist for monetary between the actual and the optimum policy. The optimum policy suggests sending more mailings to donors with high monetary value and rarely suggests sending mailings to low monetary donors. However, the actual policy sends half of the mailings to donors with the lowest monetary value.

@&#CONCLUSIONS@&#

In this paper, we propose a nonhomogeneous Hidden Markov model to describe the dynamic relationship between response behavior and mailings. With the assistance of the model, one can estimate the type of effect that the mailings have on the state of the relationship. Through the model, we further regard the mailing allocation as a multi-stage and delayed reward decision problem. By maximizing the CLV, the model selects the optimized mailing policies for each customer. Using data from DMEF, we illustrate how the proposed model works. Our analysis reveals two ways in which mailing activity affects donation behavior. First, when donors are active, receiving a mailing increases the immediate donation rate. Second, we find that mailings also serve to reduce the rate at which donors become inactive, thereby increasing the duration of a donor's relationship with the organization. Thus, sending mailings operates as a short-term marketing activity by increasing the window of time in which donors may contribute to the organization in the long run. In the future, large-scale, real-world field experiments should be conducted to further examine the effectiveness of the proposed approach and to assess its practicality in different application domains.

@&#ACKNOWLEDGMENTS@&#

The first author acknowledges the ongoing support of the National Natural Science Foundation of China under Grant nos. 71571089, 71171100, and the support of State Scholarship Fund for overseas studies. The fourth author acknowledges the support of the National Natural Science Foundation of China under Grant no. 71273121. The authors also acknowledge the anonymous reviewers for their valuable comments and suggestions, which were helpful in improving the paper.

We employ the following weakly informative subjective priors in our analysis:

                        
                           
                              
                                 
                                    
                                       θ
                                    
                                    i
                                 
                                 ∼
                                 M
                                 V
                                 N
                                 
                                    (
                                    
                                       
                                          
                                             θ
                                          
                                          ¯
                                       
                                       ,
                                       
                                          Σ
                                          θ
                                       
                                    
                                    )
                                 
                                 ,
                              
                           
                        
                     
                     
                        
                           
                              
                                 
                                    
                                       θ
                                    
                                    ¯
                                 
                                 ∼
                                 
                                    (
                                    0
                                    ,
                                    0.5
                                    ·
                                    
                                       I
                                       
                                          n
                                          θ
                                       
                                    
                                    )
                                 
                                 ,
                              
                           
                        
                     
                     
                        
                           
                              
                                 
                                    Σ
                                    θ
                                 
                                 ∼
                                 I
                                 W
                                 
                                    (
                                    
                                       n
                                       θ
                                    
                                    +
                                    5
                                    ,
                                    
                                       I
                                       
                                          n
                                          θ
                                       
                                    
                                    )
                                 
                                 ,
                              
                           
                        
                     
                     
                        
                           
                              
                                 Y
                                 ∼
                                 M
                                 V
                                 N
                                 
                                    (
                                    
                                       0
                                       ,
                                       10
                                       ·
                                       
                                          I
                                          
                                             n
                                             Y
                                          
                                       
                                    
                                    )
                                 
                                 ,
                              
                           
                        
                     where n
                     
                        
                           θ
                        
                      and nϒ
                      are the number of parameters in θ and ϒ, respectively. The Gibbs sampler includes the following steps.

                        
                           (1)	Provide initial values for 
                                 
                                    
                                       
                                          θ
                                       
                                       ¯
                                    
                                    ,
                                    
                                       Σ
                                       θ
                                    
                                    ,
                                    Y
                                    ,
                                    
                                       {
                                       
                                          
                                             θ
                                          
                                          i
                                       
                                       }
                                    
                                    ,
                                    
                                       {
                                       
                                          ɛ
                                          
                                             i
                                             t
                                          
                                       
                                       }
                                    
                                 
                               and {Sit
                              } randomly from their prior distribution.

(2)	For the ith individual (i
                              =1, 2, …, n):

For t
                              =2, … , T
                              −1, sample 
                                 
                                    S
                                    
                                       i
                                       t
                                    
                                    ′
                                 
                               given (θ
                                    i
                                 
                              , ϒ, Sit
                              
                              
                                 −
                              
                              1, Sit
                              
                              
                              +
                              
                              1) with posterior probability
                                 
                                    
                                       
                                          p
                                          
                                             (
                                             
                                                S
                                                
                                                   i
                                                   t
                                                
                                             
                                             =
                                             s
                                             |
                                             
                                                S
                                                
                                                   i
                                                   t
                                                   −
                                                   1
                                                
                                             
                                             ,
                                             
                                                S
                                                
                                                   i
                                                   t
                                                   +
                                                   1
                                                
                                             
                                             ,
                                             
                                                
                                                   θ
                                                
                                                i
                                             
                                             ,
                                             Y
                                             )
                                          
                                          ∝
                                          
                                             p
                                             
                                                i
                                                t
                                                
                                                   S
                                                   
                                                      i
                                                      t
                                                      −
                                                      1
                                                   
                                                
                                                ,
                                                s
                                             
                                          
                                          ×
                                          
                                             p
                                             
                                                i
                                                t
                                                +
                                                1
                                                ,
                                                s
                                                ,
                                                
                                                   S
                                                   
                                                      i
                                                      t
                                                      +
                                                      1
                                                   
                                                
                                             
                                          
                                          ×
                                          
                                             q
                                             
                                                i
                                                t
                                                s
                                                
                                                   Y
                                                   t
                                                
                                             
                                          
                                          .
                                       
                                    
                                 
                              
                           

For t
                              =1, sample 
                                 
                                    S
                                    
                                       i
                                       1
                                    
                                    ′
                                 
                               given (θ
                                    i
                                 
                              , ϒ, Si
                              
                              2) with posterior probability
                                 
                                    
                                       
                                          p
                                          
                                             (
                                             
                                                S
                                                
                                                   i
                                                   1
                                                
                                             
                                             =
                                             s
                                             |
                                             
                                                S
                                                
                                                   i
                                                   2
                                                
                                             
                                             ,
                                             
                                                
                                                   θ
                                                
                                                i
                                             
                                             ,
                                             Y
                                             )
                                          
                                          ∝
                                          
                                             π
                                             
                                                i
                                                s
                                             
                                          
                                          ×
                                          
                                             p
                                             
                                                i
                                                2
                                                s
                                                ,
                                                
                                                   S
                                                   
                                                      i
                                                      2
                                                   
                                                
                                             
                                          
                                          ×
                                          
                                             q
                                             
                                                i
                                                2
                                                s
                                                
                                                   Y
                                                   1
                                                
                                             
                                          
                                          .
                                       
                                    
                                 
                              
                           

For t
                              =T, sample 
                                 
                                    S
                                    
                                       i
                                       T
                                    
                                    ′
                                 
                               given (θ
                                    i
                                 
                              , ϒ, SiT
                              
                              −
                              1) with posterior probability
                                 
                                    
                                       
                                          p
                                          
                                             (
                                             
                                                S
                                                
                                                   i
                                                   T
                                                
                                             
                                             =
                                             s
                                             |
                                             
                                                S
                                                
                                                   i
                                                   T
                                                   −
                                                   1
                                                
                                             
                                             ,
                                             
                                                
                                                   θ
                                                
                                                i
                                             
                                             ,
                                             Y
                                             )
                                          
                                          ∝
                                          
                                             p
                                             
                                                i
                                                T
                                                
                                                   S
                                                   
                                                      i
                                                      T
                                                      −
                                                      1
                                                   
                                                
                                                ,
                                                s
                                             
                                          
                                          ×
                                          
                                             q
                                             
                                                i
                                                T
                                                s
                                                
                                                   Y
                                                   T
                                                
                                             
                                          
                                          .
                                       
                                    
                                 
                              
                           

Sample 
                                 
                                    ɛ
                                    
                                       i
                                       t
                                    
                                    ′
                                 
                               given (
                                 
                                    
                                       S
                                       
                                          i
                                          1
                                       
                                       T
                                    
                                    ,
                                    
                                       
                                          θ
                                       
                                       i
                                    
                                    ,
                                    Y
                                 
                              ) from
                                 
                                    
                                       
                                          
                                             ∏
                                             
                                                t
                                                =
                                                1
                                             
                                             T
                                          
                                          
                                             g
                                             
                                                (
                                                
                                                   Y
                                                   
                                                      i
                                                      t
                                                   
                                                
                                                |
                                                
                                                   X
                                                   
                                                      i
                                                      t
                                                   
                                                
                                                ,
                                                
                                                   S
                                                   
                                                      i
                                                      t
                                                   
                                                
                                                ,
                                                
                                                   
                                                      θ
                                                   
                                                   i
                                                
                                                ,
                                                Y
                                                ,
                                                
                                                
                                                   ɛ
                                                   
                                                      i
                                                      t
                                                   
                                                
                                                )
                                             
                                             g
                                             
                                                (
                                                
                                                   X
                                                   
                                                      i
                                                      t
                                                   
                                                
                                                |
                                                
                                                   
                                                      θ
                                                   
                                                   i
                                                
                                                ,
                                                Y
                                                ,
                                                
                                                
                                                   ɛ
                                                   
                                                      i
                                                      t
                                                   
                                                
                                                )
                                             
                                          
                                          ϕ
                                          
                                             (
                                             
                                                ɛ
                                                
                                                   i
                                                   t
                                                
                                             
                                             |
                                             0
                                             ,
                                             Σ
                                             )
                                          
                                          .
                                       
                                    
                                 
                              
                           

Sample 
                                 
                                    
                                       θ
                                    
                                    i
                                    ′
                                 
                               given (
                                 
                                    
                                       S
                                       
                                          i
                                          1
                                       
                                       T
                                    
                                    ,
                                    
                                       
                                          θ
                                       
                                       i
                                       −
                                    
                                    ,
                                    Y
                                    ,
                                    
                                       
                                          θ
                                       
                                       ¯
                                    
                                    ,
                                    
                                       Σ
                                       θ
                                    
                                 
                              ,
                                 ɛ
                              
                              
                                 it
                              ) from
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      π
                                                      
                                                         i
                                                         
                                                            S
                                                            1
                                                         
                                                      
                                                   
                                                   g
                                                   
                                                      (
                                                      
                                                         Y
                                                         
                                                            i
                                                            1
                                                         
                                                      
                                                      |
                                                      
                                                         X
                                                         
                                                            i
                                                            1
                                                         
                                                      
                                                      ,
                                                      
                                                         S
                                                         
                                                            i
                                                            1
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            θ
                                                         
                                                         i
                                                      
                                                      ,
                                                      Y
                                                      ,
                                                      
                                                      
                                                         ɛ
                                                         
                                                            i
                                                            1
                                                         
                                                      
                                                      )
                                                   
                                                   g
                                                   
                                                      (
                                                      
                                                         X
                                                         
                                                            i
                                                            1
                                                         
                                                      
                                                      |
                                                      
                                                         
                                                            θ
                                                         
                                                         i
                                                      
                                                      ,
                                                      Y
                                                      ,
                                                      
                                                      
                                                         ɛ
                                                         
                                                            i
                                                            1
                                                         
                                                      
                                                      )
                                                   
                                                   ×
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                   
                                                   
                                                   
                                                   
                                                   
                                                   
                                                   
                                                      ∏
                                                      
                                                         t
                                                         =
                                                         2
                                                      
                                                      T
                                                   
                                                   
                                                      
                                                         p
                                                         
                                                            i
                                                            t
                                                            
                                                               S
                                                               t
                                                            
                                                            
                                                               S
                                                               
                                                                  t
                                                                  +
                                                                  1
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         (
                                                         
                                                            X
                                                            
                                                               i
                                                               t
                                                               −
                                                               1
                                                            
                                                         
                                                         )
                                                      
                                                      g
                                                      
                                                         (
                                                         
                                                            Y
                                                            
                                                               i
                                                               t
                                                            
                                                         
                                                         |
                                                         
                                                            X
                                                            
                                                               i
                                                               t
                                                            
                                                         
                                                         ,
                                                         
                                                            S
                                                            
                                                               i
                                                               t
                                                            
                                                         
                                                         ,
                                                         
                                                            
                                                               θ
                                                            
                                                            i
                                                         
                                                         ,
                                                         Y
                                                         ,
                                                         
                                                         
                                                            ɛ
                                                            
                                                               i
                                                               t
                                                            
                                                         
                                                         )
                                                      
                                                      g
                                                      
                                                         (
                                                         
                                                            X
                                                            
                                                               i
                                                               t
                                                            
                                                         
                                                         |
                                                         
                                                            
                                                               θ
                                                            
                                                            i
                                                         
                                                         ,
                                                         Y
                                                         ,
                                                         
                                                         
                                                            ɛ
                                                            
                                                               i
                                                               t
                                                            
                                                         
                                                         )
                                                      
                                                   
                                                   p
                                                   
                                                      (
                                                      
                                                         
                                                            θ
                                                         
                                                         i
                                                      
                                                      )
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

where p(
                                 θ
                              
                              
                                 i
                              ) is a prior of 
                                 θ
                              
                              
                                 i
                              .

(3)	Sample Y′ given (
                                 
                                    
                                       {
                                       
                                          S
                                          
                                             i
                                             1
                                          
                                          T
                                       
                                       }
                                    
                                    ,
                                    
                                       {
                                       
                                          
                                             θ
                                          
                                          i
                                       
                                       }
                                    
                                    ,
                                    
                                       {
                                       
                                          ɛ
                                          
                                             i
                                             t
                                          
                                       
                                       }
                                    
                                 
                              ) from
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      ∏
                                                      
                                                         i
                                                         =
                                                         1
                                                      
                                                      
                                                         N
                                                         I
                                                      
                                                   
                                                   
                                                      {
                                                      
                                                         π
                                                         
                                                            i
                                                            
                                                               S
                                                               1
                                                            
                                                         
                                                      
                                                      g
                                                      
                                                         (
                                                         
                                                            Y
                                                            
                                                               i
                                                               1
                                                            
                                                         
                                                         |
                                                         
                                                            X
                                                            
                                                               i
                                                               1
                                                            
                                                         
                                                         ,
                                                         
                                                            S
                                                            
                                                               i
                                                               1
                                                            
                                                         
                                                         ,
                                                         
                                                            
                                                               θ
                                                            
                                                            i
                                                         
                                                         ,
                                                         Y
                                                         ,
                                                         
                                                         
                                                            ɛ
                                                            
                                                               i
                                                               1
                                                            
                                                         
                                                         )
                                                      
                                                      g
                                                      
                                                         (
                                                         
                                                            X
                                                            
                                                               i
                                                               1
                                                            
                                                         
                                                         |
                                                         
                                                            
                                                               θ
                                                            
                                                            i
                                                         
                                                         ,
                                                         Y
                                                         ,
                                                         
                                                         
                                                            ɛ
                                                            
                                                               i
                                                               1
                                                            
                                                         
                                                         )
                                                      
                                                   
                                                   ×
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                   
                                                   
                                                   
                                                   
                                                   
                                                   
                                                   
                                                   
                                                      ∏
                                                      
                                                         t
                                                         =
                                                         2
                                                      
                                                      T
                                                   
                                                   
                                                      
                                                         p
                                                         
                                                            i
                                                            t
                                                            
                                                               S
                                                               t
                                                            
                                                            
                                                               S
                                                               
                                                                  t
                                                                  +
                                                                  1
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         (
                                                         
                                                            X
                                                            
                                                               i
                                                               t
                                                               −
                                                               1
                                                            
                                                         
                                                         )
                                                      
                                                      g
                                                      
                                                         (
                                                         
                                                            Y
                                                            
                                                               i
                                                               t
                                                            
                                                         
                                                         |
                                                         
                                                            X
                                                            
                                                               i
                                                               t
                                                            
                                                         
                                                         ,
                                                         
                                                            S
                                                            
                                                               i
                                                               t
                                                            
                                                         
                                                         ,
                                                         
                                                            
                                                               θ
                                                            
                                                            i
                                                         
                                                         ,
                                                         Y
                                                         ,
                                                         
                                                         
                                                            ɛ
                                                            
                                                               i
                                                               t
                                                            
                                                         
                                                         )
                                                      
                                                      g
                                                      
                                                         (
                                                         
                                                            X
                                                            
                                                               i
                                                               t
                                                            
                                                         
                                                         |
                                                         
                                                            
                                                               θ
                                                            
                                                            i
                                                         
                                                         ,
                                                         Y
                                                         ,
                                                         
                                                         
                                                            ɛ
                                                            
                                                               i
                                                               t
                                                            
                                                         
                                                         )
                                                      
                                                   
                                                   
                                                      p
                                                      
                                                         (
                                                         Y
                                                         )
                                                      
                                                      }
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

where p(Y) is a prior of Y and NI
                               is the number of individuals.

(4) Sample 
                                 
                                    
                                       θ
                                    
                                    i
                                    ′
                                 
                               given ({
                                 θ
                              
                              
                                 i
                              }, Σθ
                              ) and sample Σθ
                               given (
                                 
                                    
                                       {
                                       
                                          
                                             θ
                                          
                                          i
                                       
                                       }
                                    
                                    ,
                                    
                                       
                                          θ
                                       
                                       ¯
                                    
                                 
                              ) from their posterior distributions. See Bayesian textbooks for details on the multi-variate normal regression update (e.g. Rossi, Allenby, & McCulloch, 2005).

(5)	Take 
                                 
                                    {
                                    
                                       S
                                       
                                          i
                                          t
                                       
                                       ′
                                    
                                    }
                                 
                              ,
                                 
                                    {
                                    
                                       
                                          θ
                                       
                                       i
                                       ′
                                    
                                    }
                                 
                               and Y′ to be the updated values and go back to step 2 until the chain converges.

For steps (2) and (3), given the priors of the parameters, the full conditional posterior distribution of these parameters can be derived analytically or can be simulated using the Metropolis–Hastings algorithm.

@&#REFERENCES@&#

