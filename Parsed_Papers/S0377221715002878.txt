@&#MAIN-TITLE@&#Revenue management under customer choice behaviour with cancellations and overbooking

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           We propose a revenue management model that takes into account both cancellations and customer choice behaviour.


                        
                        
                           
                           We develop efficient heuristic solution methods to optimise revenue.


                        
                        
                           
                           We propose a method to estimate the parameters of the model from real data.


                        
                        
                           
                           Numerical results show that the heuristics perform very well.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Revenue management

Dynamic pricing

Customer choice models

Cancellations

Overbooking

@&#ABSTRACT@&#


               
               
                  In many application areas such as airlines and hotels a large number of bookings are typically cancelled. Explicitly taking into account cancellations creates an opportunity for increasing revenue. Motivated by this we propose a revenue management model based on Talluri and van Ryzin (2004) that takes cancellations into account in addition to customer choice behaviour. Moreover, we consider overbooking limits as these are influenced by cancellations. We model the problem as a Markov decision process and propose three dynamic programming formulations to solve the problem, each appropriate in a different setting. We show that in certain settings the problem can be solved exactly using a tractable solution method. For other settings we propose tractable heuristics, since the problem faces the curse of dimensionality. Numerical results show that the heuristics perform almost as good as the exact solution. However, the model without cancellations can lead to a revenue loss of up to 20 percent. Lastly we provide a parameter estimation method based on Newman et al. (2014). This estimation method is fast and provides good parameter estimates. The combination of the model, the tractable and well-performing solution methods, and the parameter estimation method ensures that the model can efficiently be applied in practice.
               
            

@&#INTRODUCTION@&#

Revenue management is the practice of deciding which products to sell to which customers at what price under capacity constraints. Classic examples can be found in the aviation industry and the hotel industry, where a limited number of aircraft seats and hotel rooms are available, respectively (e.g., Vinod, 2004; Clarke, 2004). However, the revenue management models can be applied to a wide range of fields, including but not limited to the car rental industry (Geraghty & Johnson, 1997), theatres (Langeveld, 2006), golf courses (Kimes, 2000), restaurants (Guerriero, Miglionico, & Olivito, 2014), and cruise ships (Maddag, Moussawi-Haidar, El-Taha, & Rida, 2010). All application areas have in common that a limited number of perishable goods is sold, whether it is a hotel room, a seat on an aircraft, a rental car, a seat in the theatre, or a timeslot on a golf course. The revenue management models that have been developed exploit this fact such that the price of a product is dynamically adjusted according to the demand and availability of the products. Littlewood (1972) is considered a pioneer in the field. He introduced a capacity control model for two fare-classes on a single flight leg. The natural extension of this model to multiple fare-classes is intractable, but Belobaba (1987a); 1987b); 1989) introduced two effective heuristics EMSR-a and EMSR-b that are still used in practice. Since then several extensions have been made; see McGill and van Ryzin (1999) for an overview.

All applications also have in common that customers choose a product among different products. For example, a customer who is looking for a hotel room may compare rooms of different hotels before making a decision. The seminal paper by Talluri and van Ryzin (2004) incorporates customer choice behaviour in revenue management models. Their idea lay the foundation for a new theory in revenue management: customer choice models. Since then the theory of customer choice models has been enriched with among others better solution methods (Meissner & Strauss, 2012; Strauss & Talluri, 2012), network models to take into account multiple night stays or multiple flight legs (Liu & van Ryzin, 2008), and outstanding methods to estimate the parameters of the model (Newman, Garrow, Ferguson, Jacobs, & Purnomo, 2014). However, an extension to a model including cancellations has not been made. Modelling cancellations by taking into account customer choice behaviour has been studied by Iliescu, Garrow, and Parker (2008), but the cancellation process is not integrated with the decision process. Examples of studies on models that include cancellations but do not take into account customer choice behaviour are Lautenbacher, Stidham, and Subramanian (1999), Aydin, Birbil, Frenk, and Noyan (2012), and Bertsimas and Popescu (2003). Lautenbacher et al. (1999) provide an analysis of a revenue management model with cancellations and overbooking, but customer choice behaviour is not considered. Moreover, a satisfactory solution method for their intractable problem is not provided. Recently, Aydin et al. (2012) proposed a revenue management model with cancellations, but they also do not take customer choice behaviour into account. Erdelyi and Topaloglu (2010) and, more recently, Kunnumkal, Talluri, and Topaloglu (2012) provide customer choice models that take into account overbooking but no cancellations.

The main contribution of this paper is including cancellations and overbooking in a revenue management model that also takes customer choice behaviour into account. Two other key contributions of this paper are well-performing tractable solution methods and an accurate parameter estimation method with low computation time. The combination of these three contributions makes the customer choice cancellation model very suitable for practitioners.

Taking cancellations into account in the decision making process has a big impact on revenue. Numerical results (see Section 5) show that policies that do not take cancellations into account can lead to a substantial revenue loss of 20 percent. So far the customer choice models in existing literature do not take into account cancellations. However, in practice it is common that for example seats on an aircraft are cancelled, hotel rooms are cancelled, theatre tickets are cancelled, reservations for rental cars are cancelled, and reservations for spots on a golf course are cancelled. Therefore we stress that effective revenue management systems should take cancellation into account in the decision making process. Moreover, overbooking makes more sense when taking cancellations into account.

We model the problem as a continuous-time Markov decision process and solve it using dynamic programming. Some instances of the problem are too large to solve exactly because of the curse of dimensionality. To overcome this problem we propose three tractable methods, each appropriate under different assumption. First we show that if the cancellation rates are equal and linear with respect to the number of reservations the problem can be reduced to a one-dimensional problem and thus it can be solved exactly. Second we propose an efficient heuristic which is appropriate in the case that the cancellation rates are linear with respect to the number of reservations, but not equal. Third we propose a heuristic that can be applied to general cancellation rates, under the only assumption that cancellations occur independent from each other. We also provide a heuristic which can be applied if we do not assume that all our resources are identical. This occurs if we have multiple room types in a hotel or multiple seat classes in a theatre. Numerical results show that the heuristics perform well.

To apply this model in practice it is essential to estimate the parameters of the model accurately. The estimation of parameters of customer choice models can be challenging. A common attempt is to use variations of the expectation maximisation algorithm. The basic version of Talluri and van Ryzin (2004), but also more sophisticated methods (e.g., van Ryzin & Vulcano, 2013) have the drawback of long computation time and bad parameter estimates. Recently Newman et al. (2014) proposed a different parameter estimation method that shows great potential. The parameter estimation method that we propose for our customer choice cancellation model is based on this model. We estimate the parameters of the continuous-time Markov chain, in contrast to most literature (e.g., van Ryzin & Vulcano, 2013), which estimate the parameters of the discretised Markov chain. Our estimation method has the advantage that it has low computation time and it gives good estimates. The combination of the three effective solution methods and the efficient estimation method ensures that the customer choice cancellation model is well applicable in practice.

The remainder of this paper is organised as follows. First we describe the customer choice cancellation model in Section 2. In this section we also describe several solution methods: a dynamic programming formulation, which solves the problem exactly but is intractable; two heuristics, which are appropriate in different settings; and a heuristic to solve the problem for a hotel with different room types. Then in Section 4 describe methods to estimate the parameters of the model. Numerical results of the model are presented in Section 5. Finally, in Section 7 we make some concluding remarks and propose topics for further research.

In this section we introduce the customer choice cancellation model. It is an extension of the customer choice base model by Talluri and van Ryzin (2004), which does not consider cancellations. First we provide the model with no assumptions on the cancellation behaviour. Second we provide a first reformulation based on the assumption that cancellations only depend on the current number of reservations. Third we provide a reformulation based on the additional assumption that cancellation rates are linear. Finally we provide a reformulation based on the additional assumption that all cancellation rates are equal. In Section 3 we provide effective solution methods for the models.

Consider a hotel with 
                        
                           C
                           ∈
                           N
                        
                      identical rooms. We sell the rooms for customer check-in at a fixed future time-unit such that revenue is maximised. The customer check-in is in T time units. A common time unit is days, but some hotels sell rooms for a few hours to accommodate for short stays (e.g., at airport hotels, see Hopman, 2013). We allow overbooking up to C
                     max  rooms. A rate or fare product j is a room in combination with a certain price rj
                     , also called the reward for product j, and certain conditions, e.g. cancellation conditions. Typical conditions in a hotel environment are refundable/non-refundable rooms, where a refundable room can be cancelled free of charge and a non-refundable cannot; or breakfast could be included or excluded from the fare product. Let N be the set of all fare products. We assume that there is a finite amount n of fare products, such that w.l.o.g. N = {1, …, n}. Let cj
                     (t) be the costs if product j gets cancelled in time period t. Note that cj
                     (t) depends on the cancellation conditions.

We assume that cancellations only depend on the current number of reservations. This model can also be used with time of booking dependent cancellations by including more fare products. We model this problem as a finite-horizon continuous time Markov decision process over T time units. Define the state space by

                        
                           
                              
                                 
                                    
                                       
                                          X
                                          :
                                          =
                                          
                                             {
                                             x
                                             ∈
                                             
                                                N
                                                n
                                             
                                             
                                                |
                                                x
                                                ≥
                                                0
                                                ,
                                                
                                                   ∑
                                                   
                                                      j
                                                      ∈
                                                      N
                                                   
                                                
                                                
                                                   x
                                                   j
                                                
                                                ≤
                                                
                                                   C
                                                   max
                                                
                                             
                                             }
                                          
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     Each entry xj
                      of x ∈ X corresponds to the pickup (number of reservations) for product j.

There is a penalty q(x) involved if at the arrival day we are in state x and we have more reservations than capacity, i.e.,

                        
                           
                              
                                 
                                    
                                       
                                          
                                             ∑
                                             
                                                j
                                                ∈
                                                N
                                             
                                          
                                          
                                             x
                                             j
                                          
                                          >
                                          C
                                          .
                                       
                                    
                                 
                              
                           
                        
                     Customers arrive according to a Poisson process with parameter λ. Continuously in time we decide which subset S⊂N of products we offer. S is called an offer set. If S is offered the probability that an arriving customer buys product j equals Pj
                     (S). Furthermore, the probability that an arriving customer buys nothing under offer set S equals P
                     0(S). Finally, for all products j the cancellations of reservations for product j are exponentially distributed with parameter γj
                     (x). In accordance with Markov decision process literature we call a feasible solution π to our problem a policy. A policy π that optimises total revenue is called an optimal policy. See Fig. 1
                      for a visualisation of this model.

To solve the customer choice cancellation model we consider the discretised Markov decision process. We divide time into T time periods, where the length of the intervals is such that the probability that more than one event occurs is very small. Therefore we assume that only one event occurs per time period, where an event is either an arrival, a cancellation, or neither arrival nor cancellation. We denote λ as the probability that a customer arrives in a time period; and γj
                        (x) as the probability that product j is cancelled in state x. The probability that no purchase occurs in a time period equals the sum of the probability that neither an arrival and nor a cancellation occurs, and the probability that an arrival occurs but the arriving customer makes no purchase. This is equal to

                           
                              
                                 
                                    
                                       
                                          
                                             
                                                (
                                                1
                                                −
                                                λ
                                                −
                                                
                                                   ∑
                                                   
                                                      j
                                                      ∈
                                                      N
                                                   
                                                
                                                
                                                   γ
                                                   j
                                                
                                                
                                                   (
                                                   x
                                                   )
                                                
                                                )
                                             
                                             +
                                             λ
                                             
                                                P
                                                0
                                             
                                             
                                                (
                                                S
                                                )
                                             
                                             =
                                             1
                                             −
                                             λ
                                             
                                                ∑
                                                
                                                   j
                                                   ∈
                                                   S
                                                
                                             
                                             
                                                P
                                                j
                                             
                                             
                                                (
                                                S
                                                )
                                             
                                             −
                                             
                                                ∑
                                                
                                                   j
                                                   ∈
                                                   N
                                                
                                             
                                             
                                                γ
                                                j
                                             
                                             
                                                (
                                                x
                                                )
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        In each time period we decide which set S we offer. Note that time has to be scaled such that

                           
                              
                                 
                                    
                                       
                                          
                                             λ
                                             +
                                             
                                                max
                                                
                                                   x
                                                   ∈
                                                   X
                                                
                                             
                                             
                                                {
                                                
                                                   ∑
                                                   
                                                      j
                                                      ∈
                                                      N
                                                   
                                                
                                                
                                                   γ
                                                   j
                                                
                                                
                                                   (
                                                   x
                                                   )
                                                
                                                }
                                             
                                             ≤
                                             1
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        otherwise the probabilities are not well defined. This is possible as X is finite.

                           Remark
                           It is possible to incorporate no-shows and walk-ins into this model. Subramanian et al. (Lautenbacher et al., 1999) do this by incorporating it in the penalty q(x). However, it is also possible to incorporate the walk-in probability in the arrival probability and the no-show probability in the cancellation probability in the last time step(s). We choose the latter method.

It is reasonable to assume that cancellations occur independent of each other. Assumption 2.1 below states that the probability that product j is cancelled only depends on the current number of reservations xj
                         for product j. The assumption is equivalent to Assumption 1 in Subramanian et al. (Lautenbacher et al., 1999).

                           Assumption 2.1
                           
                              Independence of Cancellations (Assumption 1 in 
                              
                                 Lautenbacher et al., 1999
                              
                              )
                           


                              γj
                              (x) = γj
                              (xj
                              ) for all x ∈ X, for some function
                              
                                 
                                    
                                       γ
                                       j
                                    
                                    :
                                    N
                                    →
                                    
                                       R
                                       +
                                    
                                 
                              
                           

To emphasize the fact that we work under the independence of cancellations assumption we write γj
                        (xj
                        ) instead of γj
                        (x). Note that x is a vector and xj
                         is a scalar.


                        Assumption 2.2 below is even stronger than Assumption 2.1.

                           Assumption 2.2
                           
                              Linear Cancellation Rates
                              
                                 
                                    1.
                                    
                                       γj
                                       (xj
                                       ) = γjxj, for
                                       
                                          
                                             
                                                γ
                                                j
                                             
                                             ∈
                                             
                                                R
                                                +
                                             
                                             ,
                                          
                                        
                                       for all j ∈ N
                                    


                                       q(x
                                       1) = q(x
                                       2) for all x
                                       1, x
                                       2 ∈ X with
                                       
                                          
                                             
                                                ∑
                                                
                                                   j
                                                   ∈
                                                   N
                                                
                                             
                                             
                                                x
                                                j
                                                1
                                             
                                             =
                                             
                                                ∑
                                                
                                                   j
                                                   ∈
                                                   N
                                                
                                             
                                             
                                                x
                                                j
                                                2
                                             
                                          
                                       .

The second part of Assumption 2.2 states that the penalty for overbooking only depends on the total number of products that are sold and is independent from the types of products that are sold. This assumption is realistic because we are dealing with identical rooms, so relocation to a similar hotel induces the same costs. This is also a very convenient step if we only want to keep track of the total number of reservations instead of the number of reservations per fare product. For x ∈ X, let y denote the total number of reservations, i.e.,

                           
                              
                                 
                                    
                                       
                                          
                                             y
                                             =
                                             
                                                ∑
                                                
                                                   j
                                                   ∈
                                                   N
                                                
                                             
                                             
                                                x
                                                j
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        Then under the linear cancellation rates assumption we write q(y) = q(x) for all x with ∑
                           j ∈ N
                        
                        xj
                         = y.


                        Assumption 2.3 below states that the cancellation probability is independent from the product j, but it still depends on the number of reservations of product j.

                           Assumption 2.3
                           
                              Linear and equal cancellation rates
                              
                                 
                                    1.
                                    
                                       γj
                                       (x) = γxj, for
                                       
                                          
                                             γ
                                             ∈
                                             R
                                          
                                        
                                       and for all j ∈ N
                                    


                                       q(x) = q(y) with y = ∑
                                          j ∈ N
                                       
                                       xj
                                       
                                    

Under the linear and equal cancellation rates assumption the state space of the problem is significantly reduced, as is shown in Theorem 3.1 in Section 3. However, this assumption is not realistic. Different fare products are likely to have different cancellation probabilities. For example, a refundable room is more likely to get cancelled than a non-refundable room.

An illustration of the model can be found in Example 2.1 below. This example is used throughout the paper.

                           Example 2.1
                           
                              
                                 1
                              
                              
                                 1
                                 This example is based on Example 1 from Talluri and van Ryzin (2004). We scaled the rewards to be representative values for hotels. Moreover, we added cancellation conditions, cancellation probabilities, and an overbooking policy.
                              
                           

Consider a hotel with 
                                 
                                    C
                                    ∈
                                    N
                                 
                               rooms which offers three fare products. The reward for these products is given by

                                 
                                    
                                       
                                          
                                             
                                                
                                                   r
                                                   =
                                                   
                                                      (
                                                      
                                                         r
                                                         1
                                                      
                                                      ,
                                                      
                                                         r
                                                         2
                                                      
                                                      ,
                                                      
                                                         r
                                                         3
                                                      
                                                      )
                                                   
                                                   =
                                                   
                                                      (
                                                      160
                                                      ,
                                                      100
                                                      ,
                                                      90
                                                      )
                                                   
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              Both fare product 2 and 3 need to be purchased at least 21 days ahead. Furthermore, the cancellation conditions are as follows: if a product of type j is cancelled, the customer receives a refund of

                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      c
                                                      j
                                                   
                                                   =
                                                   
                                                      {
                                                      
                                                         
                                                            
                                                               
                                                                  r
                                                                  1
                                                               
                                                            
                                                            
                                                               
                                                                  if
                                                                  
                                                                  j
                                                                  =
                                                                  1
                                                                  ,
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  
                                                                     1
                                                                     2
                                                                  
                                                                  
                                                                     r
                                                                     2
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  if
                                                                  
                                                                  j
                                                                  =
                                                                  2
                                                                  ,
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               0
                                                            
                                                            
                                                               
                                                                  if
                                                                  
                                                                  j
                                                                  =
                                                                  3
                                                                  .
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              In other words, product 1 is refundable, product 2 only refunds half the price, and product 3 is non-refundable. Assume that overbooking is allowed but is bounded by 20 percent of the capacity, such that 
                                 
                                    
                                       C
                                       max
                                    
                                    =
                                    
                                       ⌊
                                       C
                                       
                                          
                                             6
                                             5
                                          
                                       
                                       ⌋
                                    
                                 
                              . If we have ∑
                                 j ∈ N
                              
                              xj
                               − C > 0 overbookings, then ∑
                                 j ∈ N
                              
                              xj
                               − C reservations are chosen at random and relocated to another hotel. The costs for relocating a customer is 170. Hence the penalty for overbooking q(x) at the arrival day in state x equals

                                 
                                    
                                       
                                          
                                             
                                                
                                                   {
                                                   
                                                      
                                                         
                                                            
                                                               170
                                                               
                                                                  (
                                                                  
                                                                     ∑
                                                                     
                                                                        j
                                                                        ∈
                                                                        N
                                                                     
                                                                  
                                                                  
                                                                     x
                                                                     j
                                                                  
                                                                  −
                                                                  C
                                                                  )
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               if
                                                               
                                                               
                                                                  ∑
                                                                  
                                                                     j
                                                                     ∈
                                                                     N
                                                                  
                                                               
                                                               
                                                                  x
                                                                  j
                                                               
                                                               −
                                                               C
                                                               >
                                                               0
                                                               ,
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            0
                                                         
                                                         
                                                            
                                                               otherwise
                                                               .
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

The hotel wants to sell the rooms in a period of T days. The purchase probabilities Pj
                              (S) are given in Table 1
                              . We assume that the purchase probabilities are the same for all time periods. The probability that a reservation for product j is cancelled is

                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      γ
                                                      j
                                                   
                                                   
                                                      (
                                                      x
                                                      )
                                                   
                                                   =
                                                   
                                                      γ
                                                      j
                                                   
                                                   
                                                      x
                                                      j
                                                   
                                                   ,
                                                
                                             
                                          
                                       
                                    
                                 
                              with γj
                               ∈ [0, 1] for all j.

In this section we provide solution methods for the models derived in Section 2. First we provide an exact solution method based on dynamic programming for the model with no restrictions on cancellation behaviour. Unfortunately this problem faces the curse of dimensionality. To overcome this we provide heuristics for each model described in Section 2. In particular we provide a tractable solution method that solves the model under the linear and equal cancellations Assumption 2.3 exactly. Finally we provide a heuristic that is applicable to a hotel with multiple room types.

Let Vt
                        (x) be the maximal expected revenue from time t to the arrival day. To solve this problem we use the following Bellman equation:

                           
                              (1)
                              
                                 
                                    
                                       
                                          
                                             
                                                V
                                                t
                                             
                                             
                                                (
                                                x
                                                )
                                             
                                             =
                                             
                                                {
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  max
                                                                  
                                                                     S
                                                                     ⊂
                                                                     N
                                                                  
                                                               
                                                               {
                                                               λ
                                                               
                                                                  ∑
                                                                  
                                                                     j
                                                                     ∈
                                                                     S
                                                                  
                                                               
                                                               
                                                                  P
                                                                  j
                                                               
                                                               
                                                                  (
                                                                  S
                                                                  )
                                                               
                                                               
                                                                  (
                                                                  
                                                                     r
                                                                     j
                                                                  
                                                                  +
                                                                  
                                                                     V
                                                                     
                                                                        t
                                                                        −
                                                                        1
                                                                     
                                                                  
                                                                  
                                                                     (
                                                                     x
                                                                     +
                                                                     
                                                                        e
                                                                        j
                                                                     
                                                                     )
                                                                  
                                                                  )
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            if
                                                            
                                                            t
                                                            >
                                                            0
                                                            ,
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               
                                                               +
                                                               
                                                                  ∑
                                                                  
                                                                     j
                                                                     ∈
                                                                     N
                                                                  
                                                               
                                                               
                                                                  γ
                                                                  j
                                                               
                                                               
                                                                  (
                                                                  x
                                                                  )
                                                               
                                                               
                                                                  (
                                                                  −
                                                                  
                                                                     c
                                                                     j
                                                                  
                                                                  
                                                                     (
                                                                     t
                                                                     )
                                                                  
                                                                  +
                                                                  
                                                                     V
                                                                     
                                                                        t
                                                                        −
                                                                        1
                                                                     
                                                                  
                                                                  
                                                                     (
                                                                     x
                                                                     −
                                                                     
                                                                        e
                                                                        j
                                                                     
                                                                     )
                                                                  
                                                                  )
                                                               
                                                            
                                                         
                                                      
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               
                                                               +
                                                               
                                                                  (
                                                                  1
                                                                  −
                                                                  λ
                                                                  
                                                                     ∑
                                                                     
                                                                        j
                                                                        ∈
                                                                        S
                                                                     
                                                                  
                                                                  
                                                                     P
                                                                     j
                                                                  
                                                                  
                                                                     (
                                                                     S
                                                                     )
                                                                  
                                                                  −
                                                                  
                                                                     ∑
                                                                     
                                                                        j
                                                                        ∈
                                                                        N
                                                                     
                                                                  
                                                                  
                                                                     γ
                                                                     j
                                                                  
                                                                  
                                                                     (
                                                                     x
                                                                     )
                                                                  
                                                                  )
                                                               
                                                               
                                                                  V
                                                                  
                                                                     t
                                                                     −
                                                                     1
                                                                  
                                                               
                                                               
                                                                  (
                                                                  x
                                                                  )
                                                               
                                                               }
                                                            
                                                         
                                                      
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            q
                                                            (
                                                            x
                                                            )
                                                         
                                                      
                                                      
                                                         
                                                            if
                                                            
                                                            t
                                                            =
                                                            0
                                                            ,
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

for all x ∈ X with where 
                           
                              
                                 e
                                 j
                              
                              ∈
                              
                                 R
                                 n
                              
                           
                         is the jth unit vector. With dynamic programming we can find an optimal strategy. Unfortunately, this solution methods bears the burden of the curse of dimensionality. The size of the state space X is O(Cn
                        ), so it increases exponentially if the number of fare products increases. For a small number of fare products the exact solution can be computed, like in Example 2.1. Obviously, in practice the number of fare products is larger than in our small example. Hence this problem can not be solved for all practical purposes. To overcome this problem we propose several options. First we show in Theorem 3.1 that under certain conditions the problem can be solved exactly. Second we propose several heuristics in case the conditions of Theorem 3.1 are not satisfied. It will turn out that each heuristic has its own advantages and disadvantages and is appropriate in a different setting.

                           Remark
                           In contrast to the dynamic programming formulation of Subramanian et al. (Lautenbacher et al., 1999) the structure of an optimal policy is not clear beforehand. The main difference between the models is that we also consider customer choice behaviour. However, if the purchase probabilties follow an independent model, as described by Talluri and van Ryzin (2004), we do get similar admission control policies. More precisely, if the purchase probabilities are given by

                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      P
                                                      j
                                                   
                                                   
                                                      (
                                                      S
                                                      )
                                                   
                                                   =
                                                   
                                                      {
                                                      
                                                         
                                                            
                                                               
                                                                  p
                                                                  j
                                                               
                                                            
                                                            
                                                               
                                                                  if
                                                                  
                                                                  j
                                                                  ∈
                                                                  S
                                                                  ,
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               0
                                                            
                                                            
                                                               
                                                                  otherwise
                                                                  ,
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              then an optimal policy of Eq. (1) will have the form

                                 
                                    accept a fare-product j request if and only if rj
                                     + V
                                    
                                       t − 1(x + ej
                                    ) > V
                                    
                                       t − 1(x).
                              
                           

In the remainder of this paper we focus on dependent demand models.

The customer choice cancellation model can be reformulated such that the costs are incorporated in the rewards. We do this by adding the expected costs caused by cancellations to the value function. This reasoning is borrowed from Lautenbacher et al. (1999), who use it in their revenue management model which does not take customer choice behaviour into account. We show in Theorem 3.1 below that under certain conditions the customer choice cancellation model is equivalent to a one-dimensional problem.

Let H(x, t) be the expected costs from cancellations from the reservations in state (x, t). The costs are fixed because we do not have control over the reservations. Then H(x, t) is given by the recursive formula

                           
                              
                                 
                                    
                                       
                                          
                                             H
                                             
                                                (
                                                x
                                                ,
                                                t
                                                )
                                             
                                             =
                                             
                                                {
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  ∑
                                                                  
                                                                     j
                                                                     ∈
                                                                     N
                                                                  
                                                               
                                                               
                                                                  γ
                                                                  j
                                                               
                                                               
                                                                  (
                                                                  x
                                                                  )
                                                               
                                                               
                                                                  (
                                                                  
                                                                     c
                                                                     j
                                                                  
                                                                  
                                                                     (
                                                                     t
                                                                     )
                                                                  
                                                                  +
                                                                  H
                                                                  
                                                                     (
                                                                     x
                                                                     −
                                                                     
                                                                        e
                                                                        j
                                                                     
                                                                     ,
                                                                     t
                                                                     −
                                                                     1
                                                                     )
                                                                  
                                                                  )
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                            +
                                                            
                                                               (
                                                               1
                                                               −
                                                               
                                                                  ∑
                                                                  
                                                                     j
                                                                     ∈
                                                                     N
                                                                  
                                                               
                                                               
                                                                  γ
                                                                  j
                                                               
                                                               
                                                                  (
                                                                  x
                                                                  )
                                                               
                                                               )
                                                            
                                                            H
                                                            
                                                               (
                                                               x
                                                               ,
                                                               t
                                                               −
                                                               1
                                                               )
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            if
                                                            
                                                            t
                                                            >
                                                            0
                                                            ,
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            0
                                                         
                                                      
                                                      
                                                         
                                                            if
                                                            
                                                            t
                                                            =
                                                            0
                                                            .
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        Define the value function 
                           
                              
                                 
                                    V
                                    ˜
                                 
                                 t
                              
                              
                                 (
                                 x
                                 )
                              
                           
                         by

                           
                              (2)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   V
                                                   ˜
                                                
                                                t
                                             
                                             
                                                (
                                                x
                                                )
                                             
                                             :
                                             =
                                             
                                                V
                                                t
                                             
                                             
                                                (
                                                x
                                                )
                                             
                                             +
                                             H
                                             
                                                (
                                                x
                                                ,
                                                t
                                                )
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        The value function 
                           
                              
                                 
                                    V
                                    ˜
                                 
                                 t
                              
                              
                                 (
                                 x
                                 )
                              
                           
                         can be interpreted as the maximal expected revenue to go from reservations without costs from current cancellations. These costs are unavoidable and have no influence on future profits. Note that cancellations still occur, but it will turn out that this reformulation alters the cancellation term in a preferable way.

Define ΔHj
                        (x, t) ≔ H(x, t − 1) − H(x + ej, t − 1) for all x ∈ X and for all t > 0. Then we can rewrite 
                           
                              
                                 
                                    V
                                    ˜
                                 
                                 t
                              
                              
                                 (
                                 x
                                 )
                              
                           
                         as follows:

                           
                              (3)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   V
                                                   ˜
                                                
                                                t
                                             
                                             
                                                (
                                                x
                                                )
                                             
                                             =
                                             
                                                {
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  max
                                                                  
                                                                     S
                                                                     ⊂
                                                                     N
                                                                  
                                                               
                                                               {
                                                               λ
                                                               
                                                                  ∑
                                                                  
                                                                     j
                                                                     ∈
                                                                     S
                                                                  
                                                               
                                                               
                                                                  P
                                                                  j
                                                               
                                                               
                                                                  (
                                                                  S
                                                                  )
                                                               
                                                               
                                                                  (
                                                                  
                                                                     r
                                                                     j
                                                                  
                                                                  +
                                                                  Δ
                                                                  
                                                                     H
                                                                     j
                                                                  
                                                                  
                                                                     (
                                                                     x
                                                                     ,
                                                                     t
                                                                     )
                                                                  
                                                                  +
                                                                  
                                                                     
                                                                        V
                                                                        ˜
                                                                     
                                                                     
                                                                        t
                                                                        −
                                                                        1
                                                                     
                                                                  
                                                                  
                                                                     (
                                                                     x
                                                                     +
                                                                     
                                                                        e
                                                                        j
                                                                     
                                                                     )
                                                                  
                                                                  )
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            if
                                                            
                                                            t
                                                            >
                                                            0
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               
                                                               +
                                                               
                                                                  ∑
                                                                  
                                                                     j
                                                                     ∈
                                                                     N
                                                                  
                                                               
                                                               
                                                                  γ
                                                                  j
                                                               
                                                               
                                                                  (
                                                                  x
                                                                  )
                                                               
                                                               
                                                                  (
                                                                  
                                                                     
                                                                        V
                                                                        ˜
                                                                     
                                                                     
                                                                        t
                                                                        −
                                                                        1
                                                                     
                                                                  
                                                                  
                                                                     (
                                                                     x
                                                                     −
                                                                     
                                                                        e
                                                                        j
                                                                     
                                                                     )
                                                                  
                                                                  )
                                                               
                                                            
                                                         
                                                      
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               
                                                               +
                                                               
                                                                  (
                                                                  1
                                                                  −
                                                                  λ
                                                                  
                                                                     ∑
                                                                     
                                                                        j
                                                                        ∈
                                                                        S
                                                                     
                                                                  
                                                                  
                                                                     P
                                                                     j
                                                                  
                                                                  
                                                                     (
                                                                     S
                                                                     )
                                                                  
                                                                  −
                                                                  
                                                                     ∑
                                                                     
                                                                        j
                                                                        ∈
                                                                        N
                                                                     
                                                                  
                                                                  
                                                                     γ
                                                                     j
                                                                  
                                                                  
                                                                     (
                                                                     x
                                                                     )
                                                                  
                                                                  )
                                                               
                                                               
                                                                  
                                                                     V
                                                                     ˜
                                                                  
                                                                  
                                                                     t
                                                                     −
                                                                     1
                                                                  
                                                               
                                                               
                                                                  (
                                                                  x
                                                                  )
                                                               
                                                               }
                                                               ,
                                                            
                                                         
                                                      
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            q
                                                            (
                                                            x
                                                            )
                                                         
                                                      
                                                      
                                                         
                                                            if
                                                            
                                                            t
                                                            =
                                                            0
                                                            .
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        Eq. (3) is equivalent to Eq. (1) in the sense that it leads to the same policy. This follows from Eq. (2) and the fact that the policy to go has no influence on H(x, t).
                     

The customer choice base model has some elegant properties described in Talluri and van Ryzin (2004) which reduce the action space and therefore the computation time. Unfortunately, these properties do not hold in the customer choice cancellation model. To show this, we introduce the concept of efficient sets in Definition 3.1 below (Definition 1 in Talluri & van Ryzin, 2004). We will show later on that some heuristics do satisfy some of the elegant properties described in Talluri and van Ryzin (2004).

                           Definition 3.1
                           For each S ⊂ N, x ∈ X and t ∈ {0, …, T} define Q(S) and R(S) by

                                 
                                    
                                       
                                          
                                             
                                                
                                                   Q
                                                   
                                                      (
                                                      S
                                                      )
                                                   
                                                   :
                                                   =
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         S
                                                      
                                                   
                                                   
                                                      P
                                                      j
                                                   
                                                   
                                                      (
                                                      S
                                                      )
                                                   
                                                   ,
                                                   
                                                   R
                                                   
                                                      (
                                                      S
                                                      ,
                                                      x
                                                      ,
                                                      t
                                                      )
                                                   
                                                
                                             
                                             
                                                
                                                   :
                                                   =
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         S
                                                      
                                                   
                                                   
                                                      P
                                                      j
                                                   
                                                   
                                                      (
                                                      S
                                                      )
                                                   
                                                   
                                                      (
                                                      
                                                         r
                                                         j
                                                      
                                                      +
                                                      Δ
                                                      
                                                         H
                                                         j
                                                      
                                                      
                                                         (
                                                         x
                                                         ,
                                                         t
                                                         )
                                                      
                                                      )
                                                   
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              A set S
                              * is called inefficient at (x, t), with x ∈ X and t ∈ {0, …, T}, if there exist α(S) > 0 for all S ⊂ N with ∑
                                 S ⊂ N
                              
                              α(S) = 1 such that both of the following inequalities hold:

                                 
                                    
                                       
                                          
                                             
                                             
                                                
                                                   Q
                                                   
                                                      (
                                                      
                                                         S
                                                         *
                                                      
                                                      )
                                                   
                                                   ≥
                                                   
                                                      ∑
                                                      
                                                         S
                                                         ⊂
                                                         N
                                                      
                                                   
                                                   α
                                                   
                                                      (
                                                      S
                                                      )
                                                   
                                                   Q
                                                   
                                                      (
                                                      S
                                                      )
                                                   
                                                   ,
                                                
                                             
                                          
                                          
                                             
                                             
                                                
                                                   R
                                                   
                                                      (
                                                      
                                                         S
                                                         *
                                                      
                                                      ,
                                                      x
                                                      ,
                                                      t
                                                      )
                                                   
                                                   <
                                                   
                                                      ∑
                                                      
                                                         S
                                                         ⊂
                                                         N
                                                      
                                                   
                                                   α
                                                   
                                                      (
                                                      S
                                                      )
                                                   
                                                   R
                                                   
                                                      (
                                                      S
                                                      ,
                                                      x
                                                      ,
                                                      t
                                                      )
                                                   
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              Otherwise S
                              * is called efficient at (x, t).

The intuition behind efficient sets is as follows. An offer set S
                        * ⊂ N is efficient if there is no randomisation of other offer sets S ⊂ N such that the expected reward is strictly greater than R(S
                        *, x, t) and the probability of a purchase is at most Q(S
                        *). Efficient sets are on the efficient frontier of the trade-off between the expected revenue R(S
                        *, x, t) and the probability of purchase Q(S
                        *).

Efficient sets can be identified using the largest marginal revenue procedure described by Talluri and van Ryzin (2004), which is the following: Initialise with the first efficient set S
                        0 = ∅. Then iteratively proceed as follows: Suppose Si
                         is the i-th efficient set found by the procedure. Then the (i + 1)th efficient set S
                        
                           i+1 is equal to

                           
                              
                                 
                                    
                                       
                                          
                                             
                                                S
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                             =
                                             
                                                
                                                   arg
                                                   
                                                   max
                                                
                                                
                                                   S
                                                   :
                                                   
                                                      
                                                         
                                                            
                                                               Q
                                                               
                                                                  (
                                                                  S
                                                                  )
                                                               
                                                               ≥
                                                               Q
                                                               
                                                                  (
                                                                  
                                                                     S
                                                                     i
                                                                  
                                                                  )
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               R
                                                               
                                                                  (
                                                                  S
                                                                  ,
                                                                  x
                                                                  ,
                                                                  t
                                                                  )
                                                               
                                                               ≥
                                                               R
                                                               
                                                                  (
                                                                  
                                                                     S
                                                                     i
                                                                  
                                                                  ,
                                                                  x
                                                                  ,
                                                                  t
                                                                  )
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   R
                                                   
                                                      (
                                                      S
                                                      ,
                                                      x
                                                      ,
                                                      t
                                                      )
                                                   
                                                   −
                                                   R
                                                   
                                                      (
                                                      
                                                         S
                                                         i
                                                      
                                                      ,
                                                      x
                                                      ,
                                                      t
                                                      )
                                                   
                                                
                                                
                                                   Q
                                                   
                                                      (
                                                      S
                                                      )
                                                   
                                                   −
                                                   Q
                                                   
                                                      (
                                                      
                                                         S
                                                         i
                                                      
                                                      )
                                                   
                                                
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        The complexity of this procedure is O(m2
                           n
                        ), where m is the number of efficient sets, which is at most 2
                           n
                        . For large instances of n this procedure is computationally intractable, so then we need to use heuristics. One heuristic (proposed by Talluri & van Ryzin, 2004) is to use only a subset of all efficient sets and then use the largest marginal revenue procedure. By looking at the specific instance we can rule out certain offer-sets. For example, if a hotel offers the same room under the same conditions at two different prices €80 and €120 at the same time, the price-sensitive customer would almost surely purchase the room for €80.

In the base model no cancellations exist, such that ΔHj
                        (x, t) = 0 for all (x, t). Hence, the set of efficient sets is the same for each (x, t). In contrast, for the cancellation model the set of efficient sets is not necessarily the same for all (x, t), as is shown in Example 3.1.

                           Example 3.1
                           Consider Example 2.1. Let C = 5, T = 10, γ = (0.05, 0.0025, 0.001). Consider the states (x, t
                              1) and (x, t
                              2), with t
                              1 = 1, t
                              2 = 10, and x = (0, 0, 0). The efficient sets of state (x, t
                              1) and (x, t
                              1) are given in Table 2. Offer set {1, 3} is efficient in state (x, t
                              1) but not in state (x, t
                              2), and offer set {1, 2} is not efficient in state (x, t
                              1) but it is efficient in state (x, t
                              2).

An important property of the base model is that an inefficient set is never an optimal solution (see Proposition 2 in Talluri & van Ryzin, 2004). Unfortunately, this property generally does not hold for the cancellation model. To this end consider Example 3.2.

                           Example 3.2
                           Consider Example 3.1. In state x = (0, 0, 4) at time T offer set {1, 3} is an optimal offer set. However, offer set {1, 2} is not efficient in state x at time T, as was shown in Example 3.1.

The model under the linear and equal cancellation Assumption 2.3 turns out to have the elegant property that it can tractably be solved exactly. In order to see this we use some derivations similar to Lautenbacher et al. (1999).

First consider the model under the independence of cancellations Assumption 2.1. The statement in Lemma 3.1 is taken from Lautenbacher et al. (1999).

                           Lemma 3.1
                           Lemma 2 in Lautenbacher et al., 1999
                           


                           
                              Under Assumption 
                              
                                 2.1
                               
                              we have that
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   H
                                                   
                                                      (
                                                      x
                                                      ,
                                                      t
                                                      )
                                                   
                                                   =
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         N
                                                      
                                                   
                                                   
                                                      H
                                                      j
                                                   
                                                   
                                                      (
                                                      
                                                         x
                                                         j
                                                      
                                                      ,
                                                      t
                                                      )
                                                   
                                                   ,
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              where the function Hj
                              (xj, t), 1 ≤ j ≤ n, satisfy the following recursive equations:
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      H
                                                      j
                                                   
                                                   
                                                      (
                                                      
                                                         x
                                                         j
                                                      
                                                      ,
                                                      t
                                                      )
                                                   
                                                   =
                                                   
                                                      {
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        (
                                                                        1
                                                                        −
                                                                        
                                                                           γ
                                                                           j
                                                                        
                                                                        
                                                                           (
                                                                           
                                                                              x
                                                                              j
                                                                           
                                                                           )
                                                                        
                                                                        )
                                                                     
                                                                     
                                                                        H
                                                                        j
                                                                     
                                                                     
                                                                        (
                                                                        
                                                                           x
                                                                           j
                                                                        
                                                                        ,
                                                                        t
                                                                        −
                                                                        1
                                                                        )
                                                                     
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  if
                                                                  
                                                                  t
                                                                  >
                                                                  0
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  
                                                                  +
                                                                  
                                                                  
                                                                     γ
                                                                     j
                                                                  
                                                                  
                                                                     (
                                                                     
                                                                        x
                                                                        j
                                                                     
                                                                     )
                                                                  
                                                                  
                                                                     (
                                                                     
                                                                        c
                                                                        j
                                                                     
                                                                     
                                                                        (
                                                                        t
                                                                        )
                                                                     
                                                                     +
                                                                     
                                                                        H
                                                                        j
                                                                     
                                                                     
                                                                        (
                                                                        
                                                                           x
                                                                           j
                                                                        
                                                                        −
                                                                        1
                                                                        ,
                                                                        t
                                                                        −
                                                                        1
                                                                        )
                                                                     
                                                                     )
                                                                  
                                                               
                                                            
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  0
                                                               
                                                            
                                                            
                                                               
                                                                  if
                                                                  
                                                                  t
                                                                  =
                                                                  0
                                                                  .
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              for all 0 ≤ t ≤ T.

Define ΔHj
                        (xj, t) by

                           
                              
                                 
                                    
                                       
                                          
                                             Δ
                                             
                                                H
                                                j
                                             
                                             
                                                (
                                                
                                                   x
                                                   j
                                                
                                                ,
                                                t
                                                )
                                             
                                             :
                                             =
                                             
                                                H
                                                j
                                             
                                             
                                                (
                                                
                                                   x
                                                   j
                                                
                                                +
                                                1
                                                ,
                                                t
                                                −
                                                1
                                                )
                                             
                                             −
                                             
                                                H
                                                j
                                             
                                             
                                                (
                                                
                                                   x
                                                   j
                                                
                                                ,
                                                t
                                                −
                                                1
                                                )
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                        Lemma 3.2 below states that under the independence of cancellations assumption Eq. (3) can be simplified.

                           Lemma 3.2
                           
                              Under 
                              
                                 Assumption 2.1
                               
                              (
                              
                                 Eq. 3
                              
                              ) can be rewritten to
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         V
                                                         ˜
                                                      
                                                      t
                                                   
                                                   
                                                      (
                                                      x
                                                      )
                                                   
                                                   =
                                                   
                                                      {
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        max
                                                                        
                                                                           S
                                                                           ⊂
                                                                           N
                                                                        
                                                                     
                                                                     {
                                                                     λ
                                                                     
                                                                        ∑
                                                                        
                                                                           j
                                                                           ∈
                                                                           S
                                                                        
                                                                     
                                                                     
                                                                        P
                                                                        j
                                                                     
                                                                     
                                                                        (
                                                                        S
                                                                        )
                                                                     
                                                                     
                                                                        (
                                                                        
                                                                           r
                                                                           j
                                                                        
                                                                        −
                                                                        Δ
                                                                        
                                                                           H
                                                                           j
                                                                        
                                                                        
                                                                           (
                                                                           x
                                                                           ,
                                                                           t
                                                                           )
                                                                        
                                                                        +
                                                                        
                                                                           
                                                                              V
                                                                              ˜
                                                                           
                                                                           
                                                                              t
                                                                              −
                                                                              1
                                                                           
                                                                        
                                                                        
                                                                           (
                                                                           x
                                                                           +
                                                                           
                                                                              e
                                                                              j
                                                                           
                                                                           )
                                                                        
                                                                        )
                                                                     
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  if
                                                                  
                                                                  t
                                                                  >
                                                                  0
                                                                  ,
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                     +
                                                                     
                                                                        ∑
                                                                        
                                                                           j
                                                                           ∈
                                                                           N
                                                                        
                                                                     
                                                                     
                                                                        γ
                                                                        j
                                                                     
                                                                     
                                                                        (
                                                                        
                                                                           x
                                                                           j
                                                                        
                                                                        )
                                                                     
                                                                     
                                                                        (
                                                                        
                                                                           
                                                                              V
                                                                              ˜
                                                                           
                                                                           
                                                                              t
                                                                              −
                                                                              1
                                                                           
                                                                        
                                                                        
                                                                           (
                                                                           x
                                                                           −
                                                                           
                                                                              e
                                                                              j
                                                                           
                                                                           )
                                                                        
                                                                        )
                                                                     
                                                                  
                                                               
                                                            
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                     +
                                                                     
                                                                        (
                                                                        1
                                                                        −
                                                                        λ
                                                                        
                                                                           ∑
                                                                           
                                                                              j
                                                                              ∈
                                                                              S
                                                                           
                                                                        
                                                                        
                                                                           P
                                                                           j
                                                                        
                                                                        
                                                                           (
                                                                           S
                                                                           )
                                                                        
                                                                        −
                                                                        
                                                                           ∑
                                                                           
                                                                              j
                                                                              ∈
                                                                              N
                                                                           
                                                                        
                                                                        
                                                                           γ
                                                                           j
                                                                        
                                                                        
                                                                           (
                                                                           
                                                                              x
                                                                              j
                                                                           
                                                                           )
                                                                        
                                                                        )
                                                                     
                                                                     
                                                                        
                                                                           V
                                                                           ˜
                                                                        
                                                                        
                                                                           t
                                                                           −
                                                                           1
                                                                        
                                                                     
                                                                     
                                                                        (
                                                                        x
                                                                        )
                                                                     
                                                                     }
                                                                  
                                                               
                                                            
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  
                                                                     q
                                                                     (
                                                                     x
                                                                     )
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  if
                                                                  
                                                                  t
                                                                  =
                                                                  0
                                                                  .
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              where ΔHj
                              (xj, t) satisfies the following recursive formula
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   Δ
                                                   
                                                      H
                                                      j
                                                   
                                                   
                                                      (
                                                      
                                                         x
                                                         j
                                                      
                                                      ,
                                                      t
                                                      )
                                                   
                                                   =
                                                   
                                                      {
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        (
                                                                        
                                                                           γ
                                                                           j
                                                                        
                                                                        
                                                                           (
                                                                           
                                                                              x
                                                                              j
                                                                           
                                                                           +
                                                                           1
                                                                           )
                                                                        
                                                                        −
                                                                        
                                                                           γ
                                                                           j
                                                                        
                                                                        
                                                                           (
                                                                           
                                                                              x
                                                                              j
                                                                           
                                                                           )
                                                                        
                                                                        )
                                                                     
                                                                     
                                                                        c
                                                                        j
                                                                     
                                                                     
                                                                        (
                                                                        t
                                                                        )
                                                                     
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  if
                                                                  
                                                                  t
                                                                  >
                                                                  1
                                                                  ,
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                     +
                                                                     
                                                                        (
                                                                        1
                                                                        −
                                                                        
                                                                           γ
                                                                           j
                                                                        
                                                                        
                                                                           (
                                                                           
                                                                              x
                                                                              j
                                                                           
                                                                           +
                                                                           1
                                                                           )
                                                                        
                                                                        )
                                                                     
                                                                     Δ
                                                                     
                                                                        H
                                                                        j
                                                                     
                                                                     
                                                                        (
                                                                        
                                                                           x
                                                                           j
                                                                        
                                                                        ,
                                                                        t
                                                                        −
                                                                        1
                                                                        )
                                                                     
                                                                  
                                                               
                                                            
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                     +
                                                                     
                                                                        γ
                                                                        j
                                                                     
                                                                     
                                                                        (
                                                                        
                                                                           x
                                                                           j
                                                                        
                                                                        )
                                                                     
                                                                     Δ
                                                                     
                                                                        H
                                                                        j
                                                                     
                                                                     
                                                                        (
                                                                        
                                                                           x
                                                                           j
                                                                        
                                                                        −
                                                                        1
                                                                        ,
                                                                        t
                                                                        −
                                                                        1
                                                                        )
                                                                     
                                                                  
                                                               
                                                            
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  0
                                                               
                                                            
                                                            
                                                               
                                                                  if
                                                                  
                                                                  t
                                                                  =
                                                                  1
                                                                  .
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

Now consider the linear cancellations Assumption 2.2. Lemma 3.3 below simplifies the calculations of ΔHj
                        (xj, t) even further. The statement is taken from Lautenbacher et al. (1999).

                           Lemma 3.3
                           Lemma 3 in Lautenbacher et al., 1999
                           


                           
                              Under 
                              
                                 Assumption 2.2
                               
                              ΔHj
                              (xj, t) is independent of the number of reservations xj such that we can write ΔHj
                              (t) = ΔHj
                              (xj, t) for all j ∈ N. Moreover, ΔHj
                              (t) satisfies
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   Δ
                                                   
                                                      H
                                                      j
                                                   
                                                   
                                                      (
                                                      t
                                                      )
                                                   
                                                   =
                                                   
                                                      {
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        γ
                                                                        j
                                                                     
                                                                     
                                                                        c
                                                                        j
                                                                     
                                                                     
                                                                        (
                                                                        t
                                                                        )
                                                                     
                                                                     +
                                                                     
                                                                        (
                                                                        1
                                                                        −
                                                                        
                                                                           γ
                                                                           j
                                                                        
                                                                        )
                                                                     
                                                                     Δ
                                                                     
                                                                        H
                                                                        j
                                                                     
                                                                     
                                                                        (
                                                                        t
                                                                        −
                                                                        1
                                                                        )
                                                                     
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  if
                                                                  
                                                                  t
                                                                  >
                                                                  1
                                                                  ,
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  0
                                                               
                                                            
                                                            
                                                               
                                                                  if
                                                                  
                                                                  t
                                                                  =
                                                                  1
                                                                  ,
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              for all j ∈ N.

Finally, consider the model under the linear and equal cancellations Assumption 2.3. Theorem 3.1 below shows that the states of the problem is significantly reduced. The statement is an extension of Theorem 1 in Lautenbacher et al. (1999) with customer choice behaviour.

                           Theorem 3.1
                           
                              Under 
                              
                                 Assumption 2.3
                               
                              we have that
                              
                                 
                                    
                                       
                                          V
                                          ˜
                                       
                                       t
                                    
                                    
                                       (
                                       x
                                       )
                                    
                                    =
                                    
                                       
                                          W
                                          ˜
                                       
                                       t
                                    
                                    
                                       (
                                       
                                       y
                                       )
                                    
                                 
                               
                              for all (x, t), where y = ∑
                                 j∈N
                              
                              xj and
                              
                                 
                                    
                                       
                                          W
                                          ˜
                                       
                                       t
                                    
                                    
                                       (
                                       
                                       y
                                       )
                                    
                                 
                               
                              is given by the following formula:
                              
                                 
                                    (4)
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         W
                                                         ˜
                                                      
                                                      t
                                                   
                                                   
                                                      (
                                                      
                                                      y
                                                      )
                                                   
                                                   =
                                                   
                                                      {
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        max
                                                                        
                                                                           S
                                                                           ⊂
                                                                           N
                                                                        
                                                                     
                                                                     {
                                                                     λ
                                                                     
                                                                        ∑
                                                                        
                                                                           j
                                                                           ∈
                                                                           S
                                                                        
                                                                     
                                                                     
                                                                        P
                                                                        j
                                                                     
                                                                     
                                                                        (
                                                                        S
                                                                        )
                                                                     
                                                                     
                                                                        (
                                                                        
                                                                           r
                                                                           j
                                                                        
                                                                        −
                                                                        Δ
                                                                        
                                                                           H
                                                                           j
                                                                        
                                                                        
                                                                           (
                                                                           t
                                                                           )
                                                                        
                                                                        +
                                                                        
                                                                           
                                                                              W
                                                                              ˜
                                                                           
                                                                           
                                                                              t
                                                                              −
                                                                              1
                                                                           
                                                                        
                                                                        
                                                                           (
                                                                           
                                                                           y
                                                                           +
                                                                           1
                                                                           )
                                                                        
                                                                        )
                                                                     
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  if
                                                                  
                                                                  t
                                                                  >
                                                                  0
                                                                  ,
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                     +
                                                                     γ
                                                                     y
                                                                     
                                                                        
                                                                           W
                                                                           ˜
                                                                        
                                                                        
                                                                           t
                                                                           −
                                                                           1
                                                                        
                                                                     
                                                                     
                                                                        (
                                                                        
                                                                        y
                                                                        −
                                                                        1
                                                                        )
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                     +
                                                                     
                                                                        (
                                                                        1
                                                                        −
                                                                        λ
                                                                        
                                                                           ∑
                                                                           
                                                                              j
                                                                              ∈
                                                                              S
                                                                           
                                                                        
                                                                        
                                                                           P
                                                                           j
                                                                        
                                                                        
                                                                           (
                                                                           S
                                                                           )
                                                                        
                                                                        −
                                                                        γ
                                                                        y
                                                                        )
                                                                     
                                                                     
                                                                        
                                                                           W
                                                                           ˜
                                                                        
                                                                        
                                                                           t
                                                                           −
                                                                           1
                                                                        
                                                                     
                                                                     
                                                                        (
                                                                        
                                                                        y
                                                                        )
                                                                     
                                                                     }
                                                                  
                                                               
                                                            
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  
                                                                     q
                                                                     (
                                                                     
                                                                     y
                                                                     )
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  if
                                                                  
                                                                  t
                                                                  =
                                                                  0
                                                                  .
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

We proof that 
                                 
                                    
                                       
                                          V
                                          ˜
                                       
                                       t
                                    
                                    
                                       (
                                       x
                                       )
                                    
                                    =
                                    
                                       
                                          W
                                          ˜
                                       
                                       t
                                    
                                    
                                       (
                                       
                                       y
                                       )
                                    
                                 
                               by induction to t. For t = 0 we have that 
                                 
                                    
                                       V
                                       ˜
                                    
                                    
                                       (
                                       x
                                       ,
                                       0
                                       )
                                    
                                    =
                                    q
                                    
                                       (
                                       x
                                       )
                                    
                                 
                               and 
                                 
                                    
                                       W
                                       ˜
                                    
                                    
                                       (
                                       
                                       y
                                       ,
                                       0
                                       )
                                    
                                    =
                                    q
                                    
                                       (
                                       
                                       y
                                       )
                                    
                                 
                              . By Assumption 2.3 we have that

                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      V
                                                      ˜
                                                   
                                                   
                                                      (
                                                      x
                                                      ,
                                                      0
                                                      )
                                                   
                                                   =
                                                   q
                                                   
                                                      (
                                                      x
                                                      )
                                                   
                                                   =
                                                   q
                                                   
                                                      (
                                                      
                                                      y
                                                      )
                                                   
                                                   =
                                                   
                                                      W
                                                      ˜
                                                   
                                                   
                                                      (
                                                      
                                                      y
                                                      ,
                                                      0
                                                      )
                                                   
                                                   ,
                                                
                                             
                                          
                                       
                                    
                                 
                              so the statement holds for t = 0.

Suppose t > 0 and the statement holds for all values smaller than t. By Assumption 2.3, Lemma 3.2, and Lemma 3.3 we have that

                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         V
                                                         ˜
                                                      
                                                      t
                                                   
                                                   
                                                      (
                                                      x
                                                      )
                                                   
                                                
                                             
                                             
                                                
                                                   =
                                                   
                                                      max
                                                      
                                                         S
                                                         ⊂
                                                         N
                                                      
                                                   
                                                   {
                                                   λ
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         S
                                                      
                                                   
                                                   
                                                      P
                                                      j
                                                   
                                                   
                                                      (
                                                      S
                                                      )
                                                   
                                                   
                                                      (
                                                      
                                                         r
                                                         j
                                                      
                                                      −
                                                      Δ
                                                      
                                                         H
                                                         j
                                                      
                                                      
                                                         (
                                                         t
                                                         )
                                                      
                                                      +
                                                      
                                                         
                                                            V
                                                            ˜
                                                         
                                                         
                                                            t
                                                            −
                                                            1
                                                         
                                                      
                                                      
                                                         (
                                                         x
                                                         +
                                                         
                                                            e
                                                            j
                                                         
                                                         )
                                                      
                                                      )
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                                
                                                   
                                                   +
                                                   
                                                   γ
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         N
                                                      
                                                   
                                                   
                                                      x
                                                      j
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            V
                                                            ˜
                                                         
                                                         
                                                            t
                                                            −
                                                            1
                                                         
                                                      
                                                      
                                                         (
                                                         x
                                                         −
                                                         
                                                            e
                                                            j
                                                         
                                                         )
                                                      
                                                      )
                                                   
                                                
                                             
                                             
                                          
                                          
                                             
                                             
                                                
                                                   
                                                   +
                                                   
                                                   
                                                      (
                                                      1
                                                      −
                                                      λ
                                                      
                                                         ∑
                                                         
                                                            j
                                                            ∈
                                                            S
                                                         
                                                      
                                                      
                                                         P
                                                         j
                                                      
                                                      
                                                         (
                                                         S
                                                         )
                                                      
                                                      −
                                                      γ
                                                      
                                                         ∑
                                                         
                                                            j
                                                            ∈
                                                            N
                                                         
                                                      
                                                      
                                                         x
                                                         j
                                                      
                                                      )
                                                   
                                                   
                                                      
                                                         V
                                                         ˜
                                                      
                                                      
                                                         t
                                                         −
                                                         1
                                                      
                                                   
                                                   
                                                      (
                                                      x
                                                      )
                                                   
                                                   }
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              Using the induction hypothesis we can rewrite this to

                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         V
                                                         ˜
                                                      
                                                      t
                                                   
                                                   
                                                      (
                                                      x
                                                      )
                                                   
                                                
                                             
                                             
                                                
                                                   =
                                                   
                                                      max
                                                      
                                                         S
                                                         ⊂
                                                         N
                                                      
                                                   
                                                   {
                                                   λ
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         S
                                                      
                                                   
                                                   
                                                      P
                                                      j
                                                   
                                                   
                                                      (
                                                      S
                                                      )
                                                   
                                                   
                                                      (
                                                      
                                                         r
                                                         j
                                                      
                                                      −
                                                      Δ
                                                      
                                                         H
                                                         j
                                                      
                                                      
                                                         (
                                                         t
                                                         )
                                                      
                                                      +
                                                      
                                                         
                                                            W
                                                            ˜
                                                         
                                                         
                                                            t
                                                            −
                                                            1
                                                         
                                                      
                                                      
                                                         (
                                                         
                                                         y
                                                         +
                                                         1
                                                         )
                                                      
                                                      )
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                                
                                                   
                                                   
                                                   
                                                   +
                                                   γ
                                                   y
                                                   
                                                      
                                                         W
                                                         ˜
                                                      
                                                      
                                                         t
                                                         −
                                                         1
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                      y
                                                      −
                                                      1
                                                      )
                                                   
                                                   +
                                                   
                                                      (
                                                      1
                                                      −
                                                      λ
                                                      
                                                         ∑
                                                         
                                                            j
                                                            ∈
                                                            S
                                                         
                                                      
                                                      
                                                         P
                                                         j
                                                      
                                                      
                                                         (
                                                         S
                                                         )
                                                      
                                                      −
                                                      γ
                                                      y
                                                      )
                                                   
                                                   
                                                      
                                                         W
                                                         ˜
                                                      
                                                      
                                                         t
                                                         −
                                                         1
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                      y
                                                      )
                                                   
                                                   }
                                                   ,
                                                
                                             
                                          
                                       
                                    
                                 
                              and hence 
                                 
                                    
                                       
                                          V
                                          ˜
                                       
                                       t
                                    
                                    
                                       (
                                       x
                                       )
                                    
                                    =
                                    
                                       
                                          W
                                          ˜
                                       
                                       t
                                    
                                    
                                       (
                                       
                                       y
                                       )
                                    
                                 
                              .□


                        Example 3.2 showed that in general inefficient sets can be optimal. However, under Assumption 2.3 ineffcient sets are never an optimal solution, as Proposition 3.1 below states. The set of efficient sets still depends on (x, t), so unfortunately these efficient sets are not of much use to us.

                           Proposition 3.1
                           
                              An ineffcient set is never an optimal solution to (
                              
                                 Eq. 4
                              
                              ).
                           

See Appendix A.□

The Independence of Cancellations heuristic is appropriate for the model under the independence of cancellations Assumption 2.1. The goal of this heuristic is to find a solution under a model with general assumptions. In this approach we reduce the state space by only keeping track of the total number of reservations rather than the number of reservations per product. Again we make the assumption that the probability that product j is cancelled depends only on the number of reservations for product j, i.e., 
                           
                              
                                 γ
                                 j
                                 t
                              
                              
                                 (
                                 x
                                 )
                              
                              =
                              
                                 γ
                                 j
                                 t
                              
                              
                                 (
                                 
                                    x
                                    j
                                 
                                 )
                              
                           
                         (see the independence of cancellations Assumption 2.1), but we make no further assumptions. The advantage of this heuristic is that it can be applied to problems with general cancellation probability functions.

Define the one-dimensional state space Y by

                           
                              
                                 
                                    
                                       
                                          
                                             Y
                                             :
                                             =
                                             
                                                {
                                                y
                                                ∈
                                                N
                                                
                                                   |
                                                   0
                                                   ≤
                                                   y
                                                   ≤
                                                   
                                                      C
                                                      max
                                                   
                                                
                                                }
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        Each state y ∈ Y corresponds to the total number of reservations. Let γ(y, t) be the conditional probability that a reservation is cancelled in state (y, t). Let c(y, t) be the expected costs for a cancelled reservation in state (y, t). The Bellman equation corresponding to this problem is

                           
                              (5)
                              
                                 
                                    
                                       
                                          
                                             
                                                W
                                                t
                                             
                                             
                                                (
                                                
                                                y
                                                )
                                             
                                             =
                                             
                                                {
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  max
                                                                  
                                                                     S
                                                                     ⊂
                                                                     N
                                                                  
                                                               
                                                               {
                                                               λ
                                                               
                                                                  ∑
                                                                  
                                                                     j
                                                                     ∈
                                                                     S
                                                                  
                                                               
                                                               
                                                                  P
                                                                  j
                                                               
                                                               
                                                                  (
                                                                  S
                                                                  )
                                                               
                                                               
                                                                  (
                                                                  
                                                                     r
                                                                     j
                                                                  
                                                                  +
                                                                  
                                                                     W
                                                                     
                                                                        t
                                                                        −
                                                                        1
                                                                     
                                                                  
                                                                  
                                                                     (
                                                                     
                                                                     y
                                                                     +
                                                                     1
                                                                     )
                                                                  
                                                                  )
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            if
                                                            
                                                            t
                                                            >
                                                            0
                                                            ,
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               
                                                               +
                                                               γ
                                                               
                                                                  (
                                                                  
                                                                  y
                                                                  ,
                                                                  t
                                                                  )
                                                               
                                                               
                                                                  (
                                                                  
                                                                  −
                                                                  c
                                                                  
                                                                     (
                                                                     
                                                                     y
                                                                     ,
                                                                     t
                                                                     )
                                                                  
                                                                  +
                                                                  
                                                                     W
                                                                     
                                                                        t
                                                                        −
                                                                        1
                                                                     
                                                                  
                                                                  
                                                                     (
                                                                     
                                                                     y
                                                                     −
                                                                     1
                                                                     )
                                                                  
                                                                  )
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               
                                                               +
                                                               
                                                                  (
                                                                  1
                                                                  −
                                                                  λ
                                                                  
                                                                     ∑
                                                                     
                                                                        j
                                                                        ∈
                                                                        S
                                                                     
                                                                  
                                                                  
                                                                     P
                                                                     j
                                                                  
                                                                  
                                                                     (
                                                                     S
                                                                     )
                                                                  
                                                                  −
                                                                  γ
                                                                  
                                                                     (
                                                                     
                                                                     y
                                                                     ,
                                                                     t
                                                                     )
                                                                  
                                                                  )
                                                               
                                                               
                                                                  W
                                                                  
                                                                     t
                                                                     −
                                                                     1
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                  y
                                                                  )
                                                               
                                                               }
                                                               ,
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            q
                                                            (
                                                            
                                                            y
                                                            )
                                                         
                                                      
                                                      
                                                         
                                                            if
                                                            
                                                            t
                                                            =
                                                            0
                                                            .
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

The problem with using this one-dimensional state space is that we do not know the expected costs c(y, t) and the conditional cancellation probability γ(y, t). This follows from the fact that we do not know the mix of reservations on the books, since if we are in state y ∈ Y we could be in any state x ∈ X with

                           
                              
                                 
                                    
                                       
                                          
                                             
                                                ∑
                                                
                                                   j
                                                   =
                                                   1
                                                
                                                n
                                             
                                             
                                                x
                                                j
                                             
                                             =
                                             y
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        The current mix of reservations on the books depends on the past strategy and therefore c(y, t) and γ(y, t) depend on the past strategy. To overcome this problem we propose the following procedure to estimate c(y, t) and γ(y, t).

Let π be an arbitrary strategy. Let 
                           
                              
                                 x
                                 ¯
                              
                              
                                 (
                                 
                                 y
                                 ,
                                 t
                                 )
                              
                              ∈
                              
                                 R
                                 n
                              
                           
                         be the expected mix of reservations on the books in state y at time t. Let p(y, t) be the probability that we are in state y at time t. Let 
                           
                              
                                 p
                                 t
                                 y
                              
                              
                                 (
                                 
                                    x
                                    j
                                 
                                 =
                                 k
                                 )
                              
                           
                         be the probability that we have k reservations for product j in state (y, t). For strategy π we will explain a recursive procedure to calculate 
                           
                              
                                 x
                                 ¯
                              
                              
                                 (
                                 
                                 y
                                 ,
                                 t
                                 )
                              
                              ,
                           
                         
                        p(y, t), 
                           
                              
                                 p
                                 t
                                 y
                              
                              
                                 (
                                 
                                    x
                                    j
                                 
                                 =
                                 k
                                 )
                              
                              ,
                           
                         
                        γ(y, t), and c(y, t).

Let y and t be arbitrary and suppose we know 
                           
                              
                                 x
                                 ¯
                              
                              
                                 (
                                 
                                 
                                    y
                                    ′
                                 
                                 ,
                                 
                                    t
                                    ′
                                 
                                 )
                              
                              ,
                           
                         
                        p(y′, t′), γ(y′, t′), 
                           
                              
                                 p
                                 
                                    
                                       t
                                       ′
                                    
                                 
                                 
                                    y
                                    ′
                                 
                              
                              
                                 (
                                 
                                    x
                                    j
                                 
                                 =
                                 k
                                 )
                              
                              ,
                           
                         and c(y′, t′) for all t′ < t, for all k and j, and for all y′. Then we can evaluate their values as stated in Lemma 3.4 and Lemma 3.5 below.

                           Lemma 3.4
                           
                              Define
                              
                                 
                                    
                                       
                                          p
                                          ^
                                       
                                       t
                                       y
                                    
                                    
                                       (
                                       
                                          x
                                          j
                                       
                                       =
                                       k
                                       )
                                    
                                 
                               
                              by
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         p
                                                         ^
                                                      
                                                      t
                                                      y
                                                   
                                                   
                                                      (
                                                      
                                                         x
                                                         j
                                                      
                                                      =
                                                      k
                                                      )
                                                   
                                                
                                             
                                             
                                                
                                                   =
                                                   p
                                                   
                                                      (
                                                      
                                                      y
                                                      +
                                                      1
                                                      ,
                                                      t
                                                      +
                                                      1
                                                      )
                                                   
                                                   [
                                                   
                                                      p
                                                      
                                                         t
                                                         +
                                                         1
                                                      
                                                      
                                                         y
                                                         +
                                                         1
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         x
                                                         j
                                                      
                                                      =
                                                      k
                                                      +
                                                      1
                                                      )
                                                   
                                                   
                                                      γ
                                                      j
                                                      
                                                         t
                                                         +
                                                         1
                                                      
                                                   
                                                   
                                                      (
                                                      k
                                                      +
                                                      1
                                                      )
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                                
                                                   
                                                   +
                                                   
                                                      p
                                                      
                                                         t
                                                         +
                                                         1
                                                      
                                                      
                                                         y
                                                         +
                                                         1
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         x
                                                         j
                                                      
                                                      =
                                                      k
                                                      )
                                                   
                                                   
                                                      ∑
                                                      
                                                         i
                                                         ≠
                                                         j
                                                      
                                                   
                                                   
                                                      ∑
                                                      
                                                         
                                                            k
                                                            ′
                                                         
                                                         =
                                                         0
                                                      
                                                      
                                                         y
                                                         +
                                                         1
                                                         −
                                                         k
                                                      
                                                   
                                                   
                                                      p
                                                      
                                                         t
                                                         +
                                                         1
                                                      
                                                      
                                                         y
                                                         +
                                                         1
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         x
                                                         i
                                                      
                                                      =
                                                      
                                                         k
                                                         ′
                                                      
                                                      )
                                                   
                                                   
                                                      γ
                                                      i
                                                      
                                                         t
                                                         +
                                                         1
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         k
                                                         ′
                                                      
                                                      )
                                                   
                                                   ]
                                                
                                             
                                          
                                          
                                             
                                             
                                                
                                                   
                                                   +
                                                   p
                                                   
                                                      (
                                                      
                                                      y
                                                      ,
                                                      y
                                                      +
                                                      1
                                                      )
                                                   
                                                   
                                                      p
                                                      
                                                         t
                                                         +
                                                         1
                                                      
                                                      y
                                                   
                                                   
                                                      (
                                                      
                                                         x
                                                         j
                                                      
                                                      =
                                                      k
                                                      )
                                                   
                                                   [
                                                   1
                                                   −
                                                   λ
                                                   
                                                      ∑
                                                      
                                                         i
                                                         ∈
                                                         S
                                                      
                                                   
                                                   P
                                                   
                                                      (
                                                      S
                                                      ,
                                                      i
                                                      )
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                                
                                                   
                                                   −
                                                   
                                                      ∑
                                                      
                                                         i
                                                         ≠
                                                         j
                                                      
                                                   
                                                   
                                                      ∑
                                                      
                                                         
                                                            k
                                                            ′
                                                         
                                                         =
                                                         0
                                                      
                                                      
                                                         y
                                                         −
                                                         k
                                                      
                                                   
                                                   
                                                      p
                                                      
                                                         t
                                                         +
                                                         1
                                                      
                                                      y
                                                   
                                                   
                                                      (
                                                      
                                                         x
                                                         i
                                                      
                                                      =
                                                      
                                                         k
                                                         ′
                                                      
                                                      )
                                                   
                                                   
                                                      γ
                                                      i
                                                      
                                                         t
                                                         +
                                                         1
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         k
                                                         ′
                                                      
                                                      )
                                                   
                                                   −
                                                   
                                                      γ
                                                      j
                                                      
                                                         t
                                                         +
                                                         1
                                                      
                                                   
                                                   
                                                      (
                                                      k
                                                      )
                                                   
                                                   ]
                                                
                                             
                                          
                                          
                                             
                                             
                                                
                                                   
                                                   +
                                                   p
                                                   
                                                      (
                                                      
                                                      y
                                                      −
                                                      1
                                                      ,
                                                      t
                                                      +
                                                      1
                                                      )
                                                   
                                                   [
                                                   
                                                      p
                                                      
                                                         t
                                                         +
                                                         1
                                                      
                                                      
                                                         y
                                                         −
                                                         1
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         x
                                                         j
                                                      
                                                      =
                                                      k
                                                      −
                                                      1
                                                      )
                                                   
                                                   λ
                                                   
                                                      P
                                                      j
                                                   
                                                   
                                                      (
                                                      S
                                                      )
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                                
                                                   
                                                   +
                                                   
                                                      p
                                                      
                                                         t
                                                         +
                                                         1
                                                      
                                                      
                                                         y
                                                         −
                                                         1
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         x
                                                         j
                                                      
                                                      =
                                                      k
                                                      )
                                                   
                                                   λ
                                                   
                                                      ∑
                                                      
                                                         i
                                                         ∈
                                                         S
                                                         ∖
                                                         {
                                                         j
                                                         }
                                                      
                                                   
                                                   
                                                      P
                                                      j
                                                   
                                                   
                                                      (
                                                      S
                                                      )
                                                   
                                                   ]
                                                   ,
                                                
                                             
                                          
                                       
                                    
                                 
                              for all k. Then 
                                 
                                    
                                       p
                                       t
                                       y
                                    
                                    
                                       (
                                       
                                          x
                                          j
                                       
                                       =
                                       k
                                       )
                                    
                                 
                               is given by

                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      p
                                                      t
                                                      y
                                                   
                                                   
                                                      (
                                                      
                                                         x
                                                         j
                                                      
                                                      =
                                                      k
                                                      )
                                                   
                                                   =
                                                   
                                                      
                                                         
                                                            
                                                               p
                                                               ^
                                                            
                                                            t
                                                            y
                                                         
                                                         
                                                            (
                                                            
                                                               x
                                                               j
                                                            
                                                            =
                                                            k
                                                            )
                                                         
                                                      
                                                      
                                                         
                                                            ∑
                                                            
                                                               
                                                                  k
                                                                  ′
                                                               
                                                               =
                                                               0
                                                            
                                                            y
                                                         
                                                         
                                                            
                                                               p
                                                               ^
                                                            
                                                            t
                                                            y
                                                         
                                                         
                                                            (
                                                            
                                                               x
                                                               j
                                                            
                                                            =
                                                            
                                                               k
                                                               ′
                                                            
                                                            )
                                                         
                                                      
                                                   
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

See Appendix A.□

(y, t).


                              The proof that inefficient sets are never an optimal solution to 
                              
                                 Eq. (5)
                               
                              is analoguous to the proof of 
                              
                                 Proposition 3.1
                              .

The goal of the second heuristic is to be fast and efficient. To accomplish this we do the following:

                           
                              –
                              
                                 We work under the linear cancellation rates 
                                 
                                    Assumption 2.2
                                 
                                 . This way the model is restricted, but we gain computation time.


                                 We only keep track of the total number of reservations. We loose the information that we have if we keep track of the number of reservations per product, but we gain computation time.


                                 We only consider efficient sets in our policy. Then the computation time is reduced because we need to consider less solutions, but we loose some potential better solutions.


                                 We use the same set of efficient sets in each state. We gain computation time because we do not have to evaluate the efficient sets for each state, but we loose some potential better solutions.

In the second heuristic we work under the linear cancellation rates, i.e., we assume that γj
                        (xj
                        ) = γjxj
                         for all j. The heuristic can also be applied if we work under the linear and equal cancellation rates Assumption 2.3, since this assumption is a special case of the linear cancellation rates assumption. We solve a one-dimensional problem, where we only keep track of the total number of reservations and not of the reservations per product. We reformulate the problem such that the costs of cancellations are incorporated in the maximisation term of the Bellman equation, as described in Theorem 3.1. Only this time we only consider offer sets that are efficient. In particular, we choose the efficient sets that result from taking R(S, x, t) = 0 for all (x, t). The motivation for choosing only these efficient sets is that the numerical results in Section 5 show that (a) leaving out inefficient solutions does not have a great impact on performance; and (b) choosing among the efficient sets is better than choosing among an equal number of arbitrary sets. The Bellman equation that we have to solve is given by

                           
                              (6)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                
                                                   W
                                                   ˜
                                                
                                                t
                                             
                                             
                                                (
                                                
                                                y
                                                )
                                             
                                             
                                             =
                                             
                                             
                                             
                                                {
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  max
                                                                  
                                                                     
                                                                        
                                                                           
                                                                              S
                                                                              ⊂
                                                                              N
                                                                           
                                                                        
                                                                     
                                                                     
                                                                        
                                                                           
                                                                              
                                                                              efficient
                                                                           
                                                                        
                                                                     
                                                                  
                                                               
                                                               {
                                                               λ
                                                               
                                                                  ∑
                                                                  
                                                                     j
                                                                     ∈
                                                                     S
                                                                  
                                                               
                                                               
                                                                  P
                                                                  j
                                                               
                                                               
                                                                  (
                                                                  S
                                                                  )
                                                               
                                                               
                                                                  (
                                                                  
                                                                     r
                                                                     j
                                                                  
                                                                  −
                                                                  Δ
                                                                  
                                                                     H
                                                                     j
                                                                  
                                                                  
                                                                     (
                                                                     t
                                                                     )
                                                                  
                                                                  +
                                                                  
                                                                     
                                                                        W
                                                                        ˜
                                                                     
                                                                     
                                                                        t
                                                                        −
                                                                        1
                                                                     
                                                                  
                                                                  
                                                                     (
                                                                     
                                                                     y
                                                                     +
                                                                     1
                                                                     )
                                                                  
                                                                  )
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            if
                                                            
                                                            t
                                                            >
                                                            0
                                                            ,
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               +
                                                               γ
                                                               y
                                                               
                                                                  
                                                                     W
                                                                     ˜
                                                                  
                                                                  
                                                                     t
                                                                     −
                                                                     1
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                  y
                                                                  
                                                                  −
                                                                  
                                                                  1
                                                                  )
                                                               
                                                               +
                                                               
                                                                  (
                                                                  1
                                                                  
                                                                  −
                                                                  
                                                                  λ
                                                                  
                                                                     ∑
                                                                     
                                                                        j
                                                                        ∈
                                                                        S
                                                                     
                                                                  
                                                                  
                                                                     P
                                                                     j
                                                                  
                                                                  
                                                                     (
                                                                     S
                                                                     )
                                                                  
                                                                  
                                                                  −
                                                                  
                                                                  γ
                                                                  y
                                                                  )
                                                               
                                                               
                                                                  
                                                                     W
                                                                     ˜
                                                                  
                                                                  
                                                                     t
                                                                     −
                                                                     1
                                                                  
                                                               
                                                               
                                                                  (
                                                                  
                                                                  y
                                                                  )
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         }
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               q
                                                               (
                                                               
                                                               y
                                                               )
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            if
                                                            
                                                            t
                                                            =
                                                            0
                                                            .
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        However, we assume that the cancellation probabilities differ per product. We do not know the cancellation probability γ if we are in state y, since we do not know what the mix of reservations on the books is. This problem is similar to the problem we described in Section 3.3. We could use Lemma 3.5 to approximate γ iteratively, but this is computationally expensive. Moreover, numerical results show that simpler approximations outperform this method (see also Section 5). An example of a simple approximation of γ is taking the average of all γ’s:

                           
                              (7)
                              
                                 
                                    
                                       
                                          
                                             γ
                                             :
                                             =
                                             
                                                1
                                                n
                                             
                                             
                                                ∑
                                                
                                                   j
                                                   ∈
                                                   N
                                                
                                             
                                             
                                                γ
                                                j
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        The advantage of using this method over the Independence of Cancellations algorithm is that it is computationally faster and performs better under the linear cancellation rates assumption. However, the downside of this method is that it can not be applied to general cancellation probabilities. See Algorithm 3.1 for an overview of the heuristic.

                           Algorithm 3.1
                           
                              Linear Cancellation Rates Heuristic (LCR)
                              
                                 
                                    1.
                                    
                                       Estimate
                                       
                                          
                                             γ
                                             ^
                                          
                                        
                                       by using (γj
                                       ), for example by (
                                       
                                          Eq. 7
                                       
                                       ).
                                    


                                       Find an optimal strategy of (
                                       
                                          Eq. 6
                                       
                                       ).
                                    

In practice hotels often have multiple room types. However, we made the assumption that the hotel has C rooms of the same type. Expanding the solution space with multiple room types leads to an intractable problem. To solve this problem we combine the Linear Cancellation Rates heuristic of Section 3.4 with one-step improvement, i.e., one step of the well know policy iteration (see also Puterman (1994)). In this approach we first find an approximation of the value function, and then use one maximisation step of policy iteration to find a better solution.

First we consider the different room types separately. Let 
                           I
                         be the set of room types. For each room type 
                           
                              i
                              ∈
                              I
                           
                         we have a certain capacity Ci
                        . For each room type we only keep track of the total number of reservations for that room type. Under the linear and equal cancellation rates Assumption 2.3 this gives the exact solution; see Theorem 3.1. Let Si
                         be the offer set of products for room type i and let Ni
                         be the set of products for room type i. We solve the problem per room type, as if it would be the only room type we have, using the Linear Cancellation Rates Heuristic described in Section 3.4. The Bellman equation per room type 
                           
                              i
                              ∈
                              I
                           
                         is given by

                           
                              (8)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                
                                                   W
                                                   ˜
                                                
                                                t
                                                i
                                             
                                             
                                                (
                                                
                                                y
                                                )
                                             
                                             =
                                             
                                                {
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  max
                                                                  
                                                                     
                                                                        
                                                                           
                                                                              
                                                                                 S
                                                                                 i
                                                                              
                                                                              ⊂
                                                                              
                                                                                 N
                                                                                 i
                                                                              
                                                                           
                                                                        
                                                                     
                                                                     
                                                                        
                                                                           efficient
                                                                        
                                                                     
                                                                  
                                                               
                                                               {
                                                               λ
                                                               
                                                                  ∑
                                                                  
                                                                     j
                                                                     ∈
                                                                     
                                                                        S
                                                                        i
                                                                     
                                                                  
                                                               
                                                               
                                                                  P
                                                                  j
                                                               
                                                               
                                                                  (
                                                                  
                                                                     S
                                                                     i
                                                                  
                                                                  )
                                                               
                                                               
                                                                  (
                                                                  
                                                                     r
                                                                     j
                                                                  
                                                                  −
                                                                  Δ
                                                                  
                                                                     H
                                                                     j
                                                                  
                                                                  
                                                                     (
                                                                     t
                                                                     )
                                                                  
                                                                  +
                                                                  
                                                                     
                                                                        W
                                                                        ˜
                                                                     
                                                                     
                                                                        t
                                                                        −
                                                                        1
                                                                     
                                                                     i
                                                                  
                                                                  
                                                                     (
                                                                     
                                                                     y
                                                                     +
                                                                     1
                                                                     )
                                                                  
                                                                  )
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            if
                                                            
                                                            t
                                                            >
                                                            0
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               +
                                                               
                                                                  γ
                                                                  i
                                                               
                                                               y
                                                               
                                                                  
                                                                     W
                                                                     ˜
                                                                  
                                                                  
                                                                     t
                                                                     −
                                                                     1
                                                                  
                                                                  i
                                                               
                                                               
                                                                  (
                                                                  
                                                                  y
                                                                  
                                                                  −
                                                                  
                                                                  1
                                                                  )
                                                               
                                                               
                                                               +
                                                               
                                                               
                                                                  (
                                                                  1
                                                                  
                                                                  −
                                                                  
                                                                  λ
                                                                  
                                                                     ∑
                                                                     
                                                                        j
                                                                        ∈
                                                                        
                                                                           S
                                                                           i
                                                                        
                                                                     
                                                                  
                                                                  
                                                                     P
                                                                     j
                                                                  
                                                                  
                                                                     (
                                                                     
                                                                        S
                                                                        i
                                                                     
                                                                     )
                                                                  
                                                                  −
                                                                  
                                                                     γ
                                                                     i
                                                                  
                                                                  y
                                                                  )
                                                               
                                                               
                                                                  
                                                                     W
                                                                     ˜
                                                                  
                                                                  
                                                                     t
                                                                     −
                                                                     1
                                                                  
                                                                  i
                                                               
                                                               
                                                                  (
                                                                  
                                                                  y
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            )
                                                            }
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            q
                                                            (
                                                            
                                                            y
                                                            )
                                                         
                                                      
                                                      
                                                         
                                                            
                                                            
                                                            if
                                                            
                                                            t
                                                            =
                                                            0
                                                            .
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Let u be the vector containing the number of reservations per room type, such that ui
                         represents the number of reservations for room type 
                           
                              i
                              ∈
                              I
                           
                        . Then we want to solve the following recursive formula:

                           
                              
                                 
                                    
                                       
                                          
                                             
                                                U
                                                t
                                             
                                             
                                                (
                                                u
                                                )
                                             
                                             
                                             =
                                             
                                             
                                                {
                                                
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  max
                                                                  
                                                                     S
                                                                     ⊂
                                                                     N
                                                                  
                                                               
                                                               {
                                                               λ
                                                               
                                                                  ∑
                                                                  
                                                                     i
                                                                     ∈
                                                                     I
                                                                  
                                                               
                                                               
                                                                  [
                                                                  
                                                                     ∑
                                                                     
                                                                        j
                                                                        ∈
                                                                        
                                                                           S
                                                                           i
                                                                        
                                                                     
                                                                  
                                                                  
                                                                     P
                                                                     j
                                                                  
                                                                  
                                                                     (
                                                                     
                                                                        S
                                                                        i
                                                                     
                                                                     )
                                                                  
                                                                  
                                                                     (
                                                                     
                                                                        r
                                                                        j
                                                                     
                                                                     
                                                                     −
                                                                     
                                                                     Δ
                                                                     
                                                                        H
                                                                        j
                                                                     
                                                                     
                                                                        (
                                                                        t
                                                                        )
                                                                     
                                                                     
                                                                     +
                                                                     
                                                                     
                                                                        U
                                                                        
                                                                           t
                                                                           −
                                                                           1
                                                                        
                                                                     
                                                                     
                                                                        (
                                                                        u
                                                                        
                                                                        +
                                                                        
                                                                        
                                                                           e
                                                                           i
                                                                        
                                                                        )
                                                                     
                                                                     )
                                                                  
                                                                  ]
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                            
                                                            
                                                            
                                                            
                                                            if
                                                            
                                                            t
                                                            >
                                                            0
                                                            ,
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               
                                                               +
                                                               
                                                                  ∑
                                                                  
                                                                     i
                                                                     ∈
                                                                     I
                                                                  
                                                               
                                                               
                                                                  [
                                                                  
                                                                     ∑
                                                                     
                                                                        j
                                                                        ∈
                                                                        
                                                                           N
                                                                           i
                                                                        
                                                                     
                                                                  
                                                                  
                                                                     γ
                                                                     j
                                                                  
                                                                  
                                                                     u
                                                                     j
                                                                  
                                                                  
                                                                     U
                                                                     
                                                                        t
                                                                        −
                                                                        1
                                                                     
                                                                  
                                                                  
                                                                     (
                                                                     u
                                                                     −
                                                                     
                                                                        e
                                                                        i
                                                                     
                                                                     )
                                                                  
                                                                  ]
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               
                                                               +
                                                               
                                                                  (
                                                                  1
                                                                  −
                                                                  λ
                                                                  
                                                                     ∑
                                                                     
                                                                        j
                                                                        ∈
                                                                        S
                                                                     
                                                                  
                                                                  
                                                                     P
                                                                     j
                                                                  
                                                                  
                                                                     (
                                                                     S
                                                                     )
                                                                  
                                                                  −
                                                                  
                                                                     ∑
                                                                     
                                                                        j
                                                                        ∈
                                                                        N
                                                                     
                                                                  
                                                                  
                                                                     γ
                                                                     j
                                                                  
                                                                  
                                                                     u
                                                                     j
                                                                  
                                                                  )
                                                               
                                                               
                                                                  U
                                                                  
                                                                     t
                                                                     −
                                                                     1
                                                                  
                                                               
                                                               
                                                                  (
                                                                  u
                                                                  )
                                                               
                                                               }
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            q
                                                            (
                                                            u
                                                            )
                                                         
                                                      
                                                      
                                                         
                                                            
                                                            
                                                            
                                                            
                                                            if
                                                            
                                                            t
                                                            >
                                                            0
                                                            .
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        However, this problem is still too large to solve, even if we use a small number of room types. Therefore we use one-step improvement to solve this problem. Suppose u is the current state and we wish to decide which products to offer. We approximate U
                        
                           t−1(u) by the following formula:

                           
                              (9)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   U
                                                   ˜
                                                
                                                
                                                   t
                                                   −
                                                   1
                                                
                                             
                                             
                                                (
                                                u
                                                )
                                             
                                             :
                                             =
                                             
                                                ∑
                                                
                                                   i
                                                   ∈
                                                   I
                                                
                                             
                                             
                                                
                                                   W
                                                   ˜
                                                
                                                
                                                   t
                                                   −
                                                   1
                                                
                                                i
                                             
                                             
                                                (
                                                
                                                   u
                                                   i
                                                
                                                )
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              
                                 
                                    U
                                    ˜
                                 
                                 
                                    t
                                    −
                                    1
                                 
                              
                              
                                 (
                                 u
                                 +
                                 
                                    e
                                    i
                                 
                                 )
                              
                           
                         and 
                           
                              
                                 
                                    U
                                    ˜
                                 
                                 
                                    t
                                    −
                                    1
                                 
                              
                              
                                 (
                                 u
                                 −
                                 
                                    e
                                    i
                                 
                                 )
                              
                           
                         can be approximated similarly. Then we do one maximisation step to find an approximation 
                           
                              
                                 
                                    U
                                    ¯
                                 
                                 t
                              
                              
                                 (
                                 u
                                 )
                              
                           
                         for Ut
                        (u):

                           
                              (10)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   U
                                                   ¯
                                                
                                                t
                                             
                                             
                                                (
                                                u
                                                )
                                             
                                             
                                             =
                                             
                                             
                                                {
                                                
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  max
                                                                  
                                                                     S
                                                                     ∈
                                                                     N
                                                                  
                                                               
                                                               {
                                                               λ
                                                               
                                                                  ∑
                                                                  
                                                                     i
                                                                     ∈
                                                                     I
                                                                  
                                                               
                                                               
                                                                  [
                                                                  
                                                                     ∑
                                                                     
                                                                        j
                                                                        ∈
                                                                        
                                                                           S
                                                                           i
                                                                        
                                                                     
                                                                  
                                                                  
                                                                     P
                                                                     j
                                                                  
                                                                  
                                                                     (
                                                                     
                                                                        S
                                                                        i
                                                                     
                                                                     )
                                                                  
                                                                  
                                                                     (
                                                                     
                                                                        r
                                                                        j
                                                                     
                                                                     
                                                                     −
                                                                     
                                                                     Δ
                                                                     
                                                                        H
                                                                        j
                                                                     
                                                                     
                                                                        (
                                                                        t
                                                                        )
                                                                     
                                                                     
                                                                     +
                                                                     
                                                                     
                                                                        
                                                                           U
                                                                           ˜
                                                                        
                                                                        
                                                                           t
                                                                           −
                                                                           1
                                                                        
                                                                     
                                                                     
                                                                        (
                                                                        u
                                                                        +
                                                                        
                                                                           e
                                                                           i
                                                                        
                                                                        )
                                                                     
                                                                     )
                                                                  
                                                                  ]
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                            
                                                            
                                                            
                                                            if
                                                            
                                                            t
                                                            >
                                                            0
                                                            ,
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               
                                                               +
                                                               
                                                                  ∑
                                                                  
                                                                     i
                                                                     ∈
                                                                     I
                                                                  
                                                               
                                                               
                                                                  [
                                                                  
                                                                     ∑
                                                                     
                                                                        j
                                                                        ∈
                                                                        
                                                                           N
                                                                           i
                                                                        
                                                                     
                                                                  
                                                                  
                                                                     γ
                                                                     j
                                                                  
                                                                  
                                                                     x
                                                                     j
                                                                  
                                                                  
                                                                     
                                                                        U
                                                                        ˜
                                                                     
                                                                     
                                                                        t
                                                                        −
                                                                        1
                                                                     
                                                                  
                                                                  
                                                                     (
                                                                     u
                                                                     −
                                                                     
                                                                        e
                                                                        i
                                                                     
                                                                     )
                                                                  
                                                                  ]
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               
                                                               +
                                                               
                                                                  (
                                                                  1
                                                                  −
                                                                  λ
                                                                  
                                                                     ∑
                                                                     
                                                                        j
                                                                        ∈
                                                                        S
                                                                     
                                                                  
                                                                  
                                                                     P
                                                                     j
                                                                  
                                                                  
                                                                     (
                                                                     S
                                                                     )
                                                                  
                                                                  −
                                                                  
                                                                     ∑
                                                                     
                                                                        j
                                                                        ∈
                                                                        N
                                                                     
                                                                  
                                                                  
                                                                     γ
                                                                     j
                                                                  
                                                                  
                                                                     x
                                                                     j
                                                                  
                                                                  )
                                                               
                                                               
                                                                  
                                                                     U
                                                                     ˜
                                                                  
                                                                  
                                                                     t
                                                                     −
                                                                     1
                                                                  
                                                               
                                                               
                                                                  (
                                                                  u
                                                                  )
                                                               
                                                               }
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            q
                                                            (
                                                            u
                                                            )
                                                         
                                                      
                                                      
                                                         
                                                            
                                                            
                                                            
                                                            
                                                            if
                                                            
                                                            t
                                                            =
                                                            0
                                                            .
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        The multiple room type heuristic is summarised in Algorithm 3.2 below.

                           Algorithm 3.2
                           
                              Multiple Room Types
                              
                                 
                                    1.
                                    
                                       Fix state u.


                                       Evaluate
                                       
                                          
                                             
                                                
                                                   W
                                                   ˜
                                                
                                                
                                                   t
                                                   −
                                                   1
                                                
                                                i
                                             
                                             
                                                (
                                                
                                                   u
                                                   i
                                                
                                                )
                                             
                                             ,
                                          
                                       
                                       
                                          
                                             
                                                
                                                   W
                                                   ˜
                                                
                                                
                                                   t
                                                   −
                                                   1
                                                
                                                i
                                             
                                             
                                                (
                                                
                                                   u
                                                   i
                                                
                                                +
                                                1
                                                )
                                             
                                             ,
                                          
                                        
                                       and
                                       
                                          
                                             
                                                
                                                   W
                                                   ˜
                                                
                                                
                                                   t
                                                   −
                                                   1
                                                
                                                i
                                             
                                             
                                                (
                                                
                                                   u
                                                   i
                                                
                                                −
                                                1
                                                )
                                             
                                          
                                        
                                       using (
                                       
                                          Eq. 8
                                       
                                       ) for all
                                       
                                          
                                             i
                                             ∈
                                             I
                                          
                                       .


                                       Define
                                       
                                          
                                             
                                                
                                                   U
                                                   ˜
                                                
                                                
                                                   t
                                                   −
                                                   1
                                                
                                             
                                             
                                                (
                                                u
                                                )
                                             
                                             ,
                                          
                                       
                                       
                                          
                                             
                                                
                                                   U
                                                   ˜
                                                
                                                
                                                   t
                                                   −
                                                   1
                                                
                                             
                                             
                                                (
                                                u
                                                +
                                                
                                                   e
                                                   i
                                                
                                                )
                                             
                                             ,
                                          
                                        
                                       and
                                       
                                          
                                             
                                                
                                                   U
                                                   ˜
                                                
                                                
                                                   t
                                                   −
                                                   1
                                                
                                             
                                             
                                                (
                                                u
                                                −
                                                
                                                   e
                                                   i
                                                
                                                )
                                             
                                          
                                        
                                       using (
                                       
                                          Eq. 9
                                       
                                       ).
                                    


                                       Use Eq. (
                                       
                                          10
                                       
                                       ) to find an improved approximation
                                       
                                          
                                             
                                                
                                                   U
                                                   ¯
                                                
                                                t
                                             
                                             
                                                (
                                                u
                                                )
                                             
                                          
                                        of Ut
                                       (u).

The action space of this problem is still large, even though we only use efficient sets per room type. The concept of efficient sets is only defined for single-resource problems. In the context of multiple room types it is worth looking into a generalisation of efficient sets to multiple-resource problems. However, this is beyond the scope of this paper.

In this section we propose a method to estimate the parameters of the model from real data. Ideally we use an estimation model under perfect knowledge, i.e., we assume we know (a) which products were offered at what time, (b) when customers arrived, (c) when they made a purchase, and (d) when they cancelled their reservation. A maximum-likelihood estimation model under perfect knowledge is described in Appendix B. In practice not all information is available, unfortunately. For example, the no-purchase option is rarely observed. To overcome this problem we need to consider methods that deal with censored data. One method is the well-known expectation-maximisation algorithm, which is described in Appendix B. However, the expectation-maximisation algorithm is unattractive for practical purposes for two reasons. First, the computation time is notoriously long. Second, the method estimates the parameters of the discretised model instead of the continuous model, which may lead to estimation errors. To overcome these problems we propose an estimation model that is based on the excellent estimation method proposed by Newman et al. (2014). The proposed method assumes the linear cancellation rates Assumption 2.2 and that the purchase probabilties are modelled by the multinomial logit model (MNL), which is briefly explained in Appendix B.

In what follows the purchase probabilities and the offer set depend on the time period. Therefore we introduce the following notation. Let Ztj
                      be the variable containing values of the attributes of product j in time period t and let Zt
                      = {Ztj
                     }
                        j
                     . Let St
                      be the set of products that is offered in time period t. Let α be the utility of the no-purchase alternative. For convenience we introduce some notation. Let Ptj
                     (α, β, St, Zt
                     ) be the probability that product j is purchased in time period t under α, β, St
                     , and Zt
                     , i.e.,

                        
                           
                              
                                 
                                    
                                       
                                          
                                             P
                                             
                                                t
                                                j
                                             
                                          
                                          
                                             (
                                             α
                                             ,
                                             β
                                             ,
                                             
                                                S
                                                t
                                             
                                             ,
                                             
                                                Z
                                                t
                                             
                                             )
                                          
                                          :
                                          =
                                          
                                             
                                                exp
                                                (
                                                
                                                   β
                                                   ⊤
                                                
                                                
                                                   Z
                                                   
                                                      j
                                                      t
                                                   
                                                
                                                )
                                             
                                             
                                                exp
                                                
                                                   (
                                                   α
                                                   )
                                                
                                                +
                                                
                                                   ∑
                                                   
                                                      i
                                                      ∈
                                                      
                                                         S
                                                         t
                                                      
                                                   
                                                
                                                exp
                                                
                                                   (
                                                   
                                                      β
                                                      ⊤
                                                   
                                                   
                                                      Z
                                                      
                                                         i
                                                         t
                                                      
                                                   
                                                   )
                                                
                                             
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     Define the probability P
                     
                        t0(α, β, St, Zt
                     ) that the no-purchase option is chosen as

                        
                           
                              
                                 
                                    
                                       
                                          
                                             P
                                             
                                                t
                                                0
                                             
                                          
                                          
                                             (
                                             α
                                             ,
                                             β
                                             ,
                                             
                                                S
                                                t
                                             
                                             ,
                                             
                                                Z
                                                t
                                             
                                             )
                                          
                                          :
                                          =
                                          
                                             
                                                exp
                                                (
                                                α
                                                )
                                             
                                             
                                                exp
                                                
                                                   (
                                                   α
                                                   )
                                                
                                                +
                                                
                                                   ∑
                                                   
                                                      i
                                                      ∈
                                                      
                                                         S
                                                         t
                                                      
                                                   
                                                
                                                exp
                                                
                                                   (
                                                   
                                                      β
                                                      ⊤
                                                   
                                                   
                                                      Z
                                                      
                                                         i
                                                         t
                                                      
                                                   
                                                   )
                                                
                                             
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     It is convenient to use the probability P
                     
                        t
                        *
                     (α, β, St, Zt
                     ) that a product is purchased, i.e., the probability that the no-purchase alternative is not chosen. Hence P
                     
                        t
                        *
                     (α, β, St, Zt
                     ) is given by

                        
                           
                              
                                 
                                    
                                       
                                          
                                             P
                                             
                                                t
                                                *
                                             
                                          
                                          
                                             (
                                             α
                                             ,
                                             β
                                             ,
                                             
                                                S
                                                t
                                             
                                             ,
                                             
                                                Z
                                                t
                                             
                                             )
                                          
                                       
                                    
                                    
                                       
                                          :
                                          =
                                          
                                             ∑
                                             
                                                j
                                                ∈
                                                
                                                   S
                                                   t
                                                
                                             
                                          
                                          
                                             P
                                             
                                                t
                                                j
                                             
                                          
                                          
                                             (
                                             α
                                             ,
                                             β
                                             ,
                                             
                                                S
                                                t
                                             
                                             ,
                                             
                                                Z
                                                t
                                             
                                             )
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          =
                                          
                                             
                                                
                                                   ∑
                                                   
                                                      j
                                                      ∈
                                                      
                                                         S
                                                         t
                                                      
                                                   
                                                
                                                exp
                                                
                                                   (
                                                   
                                                      β
                                                      ⊤
                                                   
                                                   
                                                      Z
                                                      
                                                         j
                                                         t
                                                      
                                                   
                                                   )
                                                
                                             
                                             
                                                exp
                                                
                                                   (
                                                   α
                                                   )
                                                
                                                +
                                                
                                                   ∑
                                                   
                                                      i
                                                      ∈
                                                      
                                                         S
                                                         t
                                                      
                                                   
                                                
                                                exp
                                                
                                                   (
                                                   
                                                      β
                                                      ⊤
                                                   
                                                   
                                                      Z
                                                      
                                                         i
                                                         t
                                                      
                                                   
                                                   )
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          =
                                          1
                                          −
                                          
                                             P
                                             
                                                t
                                                0
                                             
                                          
                                          
                                             (
                                             α
                                             ,
                                             β
                                             ,
                                             
                                                S
                                                t
                                             
                                             ,
                                             
                                                Z
                                                t
                                             
                                             )
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     Finally, let P
                     
                        tj|*
                     (β, St, Zt
                     ) be the probability that product j is purchased under the condition that the customer made a purchase, i.e.,

                        
                           
                              
                                 
                                    
                                       
                                          
                                             P
                                             
                                                t
                                                j
                                                |
                                                *
                                             
                                          
                                          
                                             (
                                             β
                                             ,
                                             
                                                S
                                                t
                                             
                                             ,
                                             
                                                Z
                                                t
                                             
                                             )
                                          
                                       
                                    
                                    
                                       
                                          :
                                          =
                                          
                                             
                                                exp
                                                (
                                                
                                                   β
                                                   ⊤
                                                
                                                
                                                   Z
                                                   
                                                      j
                                                      t
                                                   
                                                
                                                )
                                             
                                             
                                                
                                                   ∑
                                                   
                                                      i
                                                      ∈
                                                      
                                                         S
                                                         t
                                                      
                                                   
                                                
                                                exp
                                                
                                                   (
                                                   
                                                      β
                                                      ⊤
                                                   
                                                   
                                                      Z
                                                      
                                                         i
                                                         t
                                                      
                                                   
                                                   )
                                                
                                             
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     
                  

We divide time into T time periods and assume that the parameters to be estimated are constant within these periods. Note that we allow more than one event to happen in one time period. The parameters that we need to estimate are: the no-purchase utility α; the weights β of the attributes of the MNL model; the parameters γj
                      of the exponential distributions that model the cancellations; and the parameter λ of the Poisson process that models the arriving customers. We do this by using maximum likelihood estimation.

Assume that the offer set St
                      does not change within this time period. Suppose we observe zjt
                      purchases for product j in time period t. Let ζj
                     (y) be the total number of cancellations for product j when there were y reservations for product j, measured over all time periods. Suppose that we observe that for a period of tj
                     (y) there were y reservations for product j, again measured over all time periods. Note that tj
                     (y) might be 0.

The maximum likelihood function L(z, ζ|α, β, γ, λ) is the probability that we observe z and ζ under given α, β, γ, and λ. Since the arrival process is independent from the cancellation process we can write

                        
                           
                              
                                 
                                    
                                       
                                          p
                                          (
                                          z
                                          ,
                                          ζ
                                          |
                                          α
                                          ,
                                          β
                                          ,
                                          γ
                                          ,
                                          λ
                                          )
                                          =
                                          p
                                          (
                                          z
                                          |
                                          α
                                          ,
                                          β
                                          ,
                                          γ
                                          ,
                                          λ
                                          )
                                          p
                                          (
                                          ζ
                                          |
                                          α
                                          ,
                                          β
                                          ,
                                          γ
                                          ,
                                          λ
                                          )
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     with p(z|α, β, γ, λ) the probability that we observe z given α, β, γ, and λ; and p(ζ|α, β, γ, λ) the probability that we observe ζ given α, β, γ, and λ. Since the cancellations are only dependent on γ we can even write

                        
                           
                              
                                 
                                    
                                       
                                          p
                                          (
                                          ζ
                                          |
                                          α
                                          ,
                                          β
                                          ,
                                          γ
                                          ,
                                          λ
                                          )
                                          =
                                          p
                                          (
                                          ζ
                                          |
                                          γ
                                          )
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     with p(ζ|γ) the probability that we observe ζ given γ. This also follows from the derivations below.

The cancellation processes are independent from each other, so we can write

                        
                           
                              
                                 
                                    
                                       
                                          p
                                          
                                             (
                                             ζ
                                             |
                                             γ
                                             )
                                          
                                          =
                                          
                                             ∏
                                             
                                                j
                                                ∈
                                                N
                                             
                                          
                                          p
                                          
                                             (
                                             
                                                ζ
                                                j
                                             
                                             |
                                             
                                                γ
                                                j
                                             
                                             )
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     with p(ζj
                     |γj
                     ) the probability that we observe ζj
                      given γj
                     . Moreover, if we consider the time intervals tj
                     (y) we can write

                        
                           
                              
                                 
                                    
                                       
                                          p
                                          
                                             (
                                             
                                                ζ
                                                j
                                             
                                             |
                                             
                                                γ
                                                j
                                             
                                             )
                                          
                                          =
                                          
                                             ∏
                                             
                                                y
                                                =
                                                0
                                             
                                             
                                                C
                                                max
                                             
                                          
                                          p
                                          
                                             (
                                             
                                                ζ
                                                j
                                             
                                             
                                                (
                                                
                                                y
                                                )
                                             
                                             |
                                             
                                                γ
                                                j
                                             
                                             )
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     Since the cancellations follow a Poisson process with parameter γjytj
                     (y) the probability p(ζj
                     (y)|γj
                     ) that we observe ζj
                     (y) cancellations in time period t conditional on γj
                      is equal to

                        
                           
                              
                                 
                                    
                                       
                                          p
                                          
                                             (
                                             
                                                ζ
                                                j
                                             
                                             
                                                (
                                                
                                                y
                                                )
                                             
                                             |
                                             
                                                γ
                                                j
                                             
                                             )
                                          
                                       
                                    
                                    
                                       
                                          =
                                          
                                             
                                                (
                                                
                                                   γ
                                                   j
                                                
                                                y
                                                
                                                   t
                                                   j
                                                
                                                
                                                   (
                                                   
                                                   y
                                                   )
                                                
                                                )
                                             
                                             
                                                
                                                   ζ
                                                   j
                                                
                                                
                                                   (
                                                   
                                                   y
                                                   )
                                                
                                             
                                          
                                          
                                             
                                                e
                                                
                                                   −
                                                   
                                                      γ
                                                      j
                                                   
                                                   y
                                                   
                                                      t
                                                      j
                                                   
                                                   
                                                      (
                                                      
                                                      y
                                                      )
                                                   
                                                
                                             
                                             
                                                
                                                   ζ
                                                   j
                                                
                                                
                                                   (
                                                   
                                                   y
                                                   )
                                                
                                                !
                                             
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     If we take the natural logarithm of p(ζj
                     (y)|γj
                     ) we get

                        
                           
                              
                                 
                                    
                                       
                                          log
                                          
                                             (
                                             p
                                             (
                                             
                                                ζ
                                                j
                                             
                                             
                                                (
                                                
                                                y
                                                )
                                             
                                             |
                                             
                                                γ
                                                j
                                             
                                             )
                                             )
                                          
                                       
                                    
                                    
                                       =
                                    
                                    
                                       
                                          
                                             ζ
                                             j
                                          
                                          
                                             (
                                             
                                             y
                                             )
                                          
                                          log
                                          
                                             (
                                             
                                                γ
                                                j
                                             
                                             )
                                          
                                          +
                                          
                                             ζ
                                             j
                                          
                                          
                                             (
                                             
                                             y
                                             )
                                          
                                          log
                                          
                                             (
                                             
                                             y
                                             
                                                t
                                                j
                                             
                                             
                                                (
                                                
                                                y
                                                )
                                             
                                             )
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                    
                                       
                                          −
                                          
                                          
                                             γ
                                             j
                                          
                                          y
                                          
                                             t
                                             j
                                          
                                          
                                             (
                                             
                                             y
                                             )
                                          
                                          −
                                          log
                                          
                                             (
                                             
                                                ζ
                                                j
                                             
                                             
                                                (
                                                
                                                y
                                                )
                                             
                                             !
                                             )
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     Combining all equations we find

                        
                           
                              
                                 
                                    
                                       
                                          log
                                          
                                             (
                                             p
                                             (
                                             ζ
                                             |
                                             γ
                                             )
                                             )
                                          
                                          =
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                             
                                                j
                                                ∈
                                                N
                                             
                                          
                                          
                                             ∑
                                             
                                                y
                                                =
                                                0
                                             
                                             
                                                C
                                                max
                                             
                                          
                                          [
                                          
                                             {
                                             
                                                ζ
                                                j
                                             
                                             
                                                (
                                                
                                                y
                                                )
                                             
                                             log
                                             
                                                (
                                                
                                                   γ
                                                   j
                                                
                                                )
                                             
                                             −
                                             
                                                γ
                                                j
                                             
                                             y
                                             
                                                t
                                                j
                                             
                                             
                                                (
                                                
                                                y
                                                )
                                             
                                             }
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          +
                                          
                                          
                                             {
                                             
                                                ζ
                                                j
                                             
                                             
                                                (
                                                
                                                y
                                                )
                                             
                                             log
                                             
                                                (
                                                
                                                y
                                                
                                                   t
                                                   j
                                                
                                                
                                                   (
                                                   
                                                   y
                                                   )
                                                
                                                )
                                             
                                             −
                                             log
                                             
                                                (
                                                
                                                   ζ
                                                   j
                                                
                                                
                                                   (
                                                   
                                                   y
                                                   )
                                                
                                                !
                                                )
                                             
                                             }
                                          
                                          ]
                                          .
                                       
                                    
                                 
                              
                           
                        
                     If we want to maximise this with respect to γ we can solve the following equations separately for each j ∈ N:

                        
                           (11)
                           
                              
                                 
                                    
                                       
                                          
                                             ∑
                                             
                                                y
                                                =
                                                0
                                             
                                             
                                                C
                                                max
                                             
                                          
                                          
                                             ζ
                                             j
                                          
                                          
                                             (
                                             
                                             y
                                             )
                                          
                                          log
                                          
                                             (
                                             
                                                γ
                                                j
                                             
                                             )
                                          
                                          −
                                          
                                             γ
                                             j
                                          
                                          y
                                          
                                             t
                                             j
                                          
                                          
                                             (
                                             
                                             y
                                             )
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     If we take the first derivative with respect to γj
                      we find

                        
                           
                              
                                 
                                    
                                       
                                          
                                             1
                                             
                                                γ
                                                j
                                             
                                          
                                          
                                             ∑
                                             
                                                y
                                                =
                                                0
                                             
                                             
                                                C
                                                max
                                             
                                          
                                          
                                             ζ
                                             j
                                          
                                          
                                             (
                                             
                                             y
                                             )
                                          
                                          −
                                          
                                             ∑
                                             
                                                y
                                                =
                                                0
                                             
                                             
                                                C
                                                max
                                             
                                          
                                          y
                                          
                                             t
                                             j
                                          
                                          
                                             (
                                             
                                             y
                                             )
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     The optimum can be found by setting this equation to zero. This gives

                        
                           
                              
                                 
                                    
                                       
                                          
                                             γ
                                             j
                                          
                                          =
                                          
                                             
                                                
                                                   ∑
                                                   
                                                      y
                                                      =
                                                      0
                                                   
                                                   
                                                      C
                                                      max
                                                   
                                                
                                                ζ
                                                
                                                   (
                                                   
                                                   y
                                                   )
                                                
                                             
                                             
                                                
                                                   ∑
                                                   
                                                      y
                                                      =
                                                      0
                                                   
                                                   
                                                      C
                                                      max
                                                   
                                                
                                                y
                                                
                                                   t
                                                   j
                                                
                                                
                                                   (
                                                   
                                                   y
                                                   )
                                                
                                             
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     Let 
                        
                           
                              ζ
                              j
                           
                           :
                           =
                           
                              ∑
                              
                                 y
                                 =
                                 0
                              
                              
                                 C
                                 max
                              
                           
                           ζ
                           
                              (
                              
                              y
                              )
                           
                           ,
                        
                      i.e., ζj
                      is the total number of cancellations for product j. Then we have that

                        
                           (12)
                           
                              
                                 
                                    
                                       
                                          
                                             γ
                                             j
                                          
                                          =
                                          
                                             
                                                ζ
                                                j
                                             
                                             
                                                
                                                   ∑
                                                   
                                                      y
                                                      =
                                                      0
                                                   
                                                   
                                                      C
                                                      max
                                                   
                                                
                                                y
                                                
                                                   t
                                                   j
                                                
                                                
                                                   (
                                                   
                                                   y
                                                   )
                                                
                                             
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     
                  

By taking the second derivative of Eq. (11) we find

                        
                           
                              
                                 
                                    
                                       
                                          −
                                          
                                             1
                                             
                                                γ
                                                j
                                                2
                                             
                                          
                                          
                                             ∑
                                             
                                                y
                                                =
                                                0
                                             
                                             
                                                C
                                                max
                                             
                                          
                                          
                                             ζ
                                             j
                                          
                                          
                                             (
                                             
                                             y
                                             )
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     which is negative, such that the optimum found in Eq. (12) is a maximum.

For completeness we below present the derivations of the results by Newman et al. (2014), which can directly be applied to our model.

The expression for p(z|α, β, γ, λ) does not depend on γ so we can write p(z|α, β, λ). Conditioning to the number of reservations mt
                      in time period t gives

                        
                           
                              
                                 
                                    
                                       
                                          p
                                          (
                                          z
                                          |
                                          α
                                          ,
                                          β
                                          ,
                                          λ
                                          )
                                          =
                                          p
                                          (
                                          z
                                          |
                                          m
                                          ,
                                          β
                                          ,
                                          λ
                                          )
                                          p
                                          (
                                          m
                                          |
                                          α
                                          ,
                                          β
                                          ,
                                          λ
                                          )
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     where m = (m
                     1, …, mT
                     ). Note that p(z|m, β, λ) does not depend on the no-purchase alternative parameter α. The probability p(z|m, β, λ) that we observe z under the conditions that we observe mt
                      reservations with parameter β and λ is equal to

                        
                           
                              
                                 
                                    
                                       
                                          p
                                          
                                             (
                                             z
                                             |
                                             m
                                             ,
                                             β
                                             ,
                                             λ
                                             )
                                          
                                          =
                                          
                                             ∏
                                             
                                                t
                                                =
                                                1
                                             
                                             T
                                          
                                          
                                             (
                                             
                                                
                                                   m
                                                   t
                                                
                                                
                                                   
                                                      z
                                                      
                                                         1
                                                         t
                                                      
                                                   
                                                   ,
                                                   …
                                                   ,
                                                   
                                                      z
                                                      
                                                         n
                                                         t
                                                      
                                                   
                                                
                                             
                                             )
                                          
                                          
                                             ∏
                                             
                                                j
                                                ∈
                                                N
                                             
                                          
                                          
                                             
                                                [
                                                
                                                   P
                                                   
                                                      t
                                                      j
                                                      |
                                                      *
                                                   
                                                
                                                
                                                   (
                                                   β
                                                   ,
                                                   
                                                      S
                                                      t
                                                   
                                                   ,
                                                   
                                                      Z
                                                      t
                                                   
                                                   )
                                                
                                                ]
                                             
                                             
                                                z
                                                
                                                   j
                                                   t
                                                
                                             
                                          
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     Note that since ∑
                        j ∈ N
                     
                     zjt
                      = mt
                      and zjt
                      = 0 for j ∉ St
                      we have that

                        
                           
                              
                                 
                                    
                                       
                                          
                                             ∏
                                             
                                                j
                                                ∈
                                                N
                                             
                                          
                                          
                                             
                                                [
                                                
                                                   P
                                                   
                                                      t
                                                      j
                                                      |
                                                      *
                                                   
                                                
                                                
                                                   (
                                                   β
                                                   ,
                                                   
                                                      S
                                                      t
                                                   
                                                   ,
                                                   
                                                      Z
                                                      t
                                                   
                                                   )
                                                
                                                ]
                                             
                                             
                                                z
                                                
                                                   j
                                                   t
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          =
                                          
                                             ∏
                                             
                                                j
                                                ∈
                                                
                                                   S
                                                   t
                                                
                                             
                                          
                                          
                                             
                                                [
                                                
                                                   
                                                      exp
                                                      (
                                                      
                                                         β
                                                         ⊤
                                                      
                                                      
                                                         Z
                                                         
                                                            j
                                                            t
                                                         
                                                      
                                                      )
                                                   
                                                   
                                                      
                                                         ∑
                                                         
                                                            i
                                                            ∈
                                                            
                                                               S
                                                               t
                                                            
                                                         
                                                      
                                                      exp
                                                      
                                                         (
                                                         
                                                            β
                                                            ⊤
                                                         
                                                         
                                                            Z
                                                            
                                                               i
                                                               t
                                                            
                                                         
                                                         )
                                                      
                                                   
                                                
                                                ]
                                             
                                             
                                                z
                                                
                                                   j
                                                   t
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          =
                                          
                                             
                                                
                                                   ∏
                                                   
                                                      j
                                                      ∈
                                                      
                                                         S
                                                         t
                                                      
                                                   
                                                
                                                
                                                   
                                                      [
                                                      exp
                                                      (
                                                      
                                                         β
                                                         ⊤
                                                      
                                                      
                                                         Z
                                                         
                                                            j
                                                            t
                                                         
                                                      
                                                      )
                                                      ]
                                                   
                                                   
                                                      z
                                                      
                                                         j
                                                         t
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   [
                                                   
                                                      ∑
                                                      
                                                         i
                                                         ∈
                                                         
                                                            S
                                                            t
                                                         
                                                      
                                                   
                                                   exp
                                                   
                                                      (
                                                      
                                                         β
                                                         ⊤
                                                      
                                                      
                                                         Z
                                                         
                                                            i
                                                            t
                                                         
                                                      
                                                      )
                                                   
                                                   ]
                                                
                                                
                                                   m
                                                   t
                                                
                                             
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     
                  

By taking the natural logarithm we find

                        
                           
                              
                                 
                                    
                                       
                                          log
                                          
                                             (
                                             p
                                             (
                                             z
                                             |
                                             m
                                             ,
                                             α
                                             ,
                                             β
                                             ,
                                             λ
                                             )
                                             )
                                          
                                       
                                    
                                    
                                       
                                          =
                                          
                                             ∑
                                             
                                                t
                                                =
                                                1
                                             
                                             T
                                          
                                          log
                                          
                                             (
                                             
                                                
                                                   
                                                      m
                                                      t
                                                   
                                                   !
                                                
                                                
                                                   
                                                      z
                                                      
                                                         1
                                                         t
                                                      
                                                   
                                                   !
                                                   ·
                                                   …
                                                   ·
                                                   
                                                      z
                                                      
                                                         n
                                                         t
                                                      
                                                   
                                                   !
                                                
                                             
                                             )
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          +
                                          
                                             ∑
                                             
                                                j
                                                ∈
                                                
                                                   S
                                                   t
                                                
                                             
                                          
                                          
                                             z
                                             
                                                j
                                                t
                                             
                                          
                                          
                                             β
                                             ⊤
                                          
                                          
                                             Z
                                             
                                                j
                                                t
                                             
                                          
                                          −
                                          
                                             m
                                             t
                                          
                                          log
                                          
                                             (
                                             
                                                ∑
                                                
                                                   i
                                                   ∈
                                                   
                                                      S
                                                      t
                                                   
                                                
                                             
                                             exp
                                             
                                                (
                                                
                                                   β
                                                   ⊤
                                                
                                                
                                                   Z
                                                   
                                                      i
                                                      t
                                                   
                                                
                                                )
                                             
                                             )
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     If we want to maximise this with respect to β we only have to consider

                        
                           (13)
                           
                              
                                 
                                    
                                       
                                          
                                             ∑
                                             
                                                t
                                                =
                                                1
                                             
                                             T
                                          
                                          
                                             [
                                             
                                                ∑
                                                
                                                   j
                                                   ∈
                                                   
                                                      S
                                                      t
                                                   
                                                
                                             
                                             
                                                z
                                                
                                                   j
                                                   t
                                                
                                             
                                             
                                                β
                                                ⊤
                                             
                                             
                                                Z
                                                
                                                   j
                                                   t
                                                
                                             
                                             −
                                             
                                                m
                                                t
                                             
                                             log
                                             
                                                (
                                                
                                                   ∑
                                                   
                                                      i
                                                      ∈
                                                      
                                                         S
                                                         t
                                                      
                                                   
                                                
                                                exp
                                                
                                                   (
                                                   
                                                      β
                                                      ⊤
                                                   
                                                   
                                                      Z
                                                      
                                                         i
                                                         t
                                                      
                                                   
                                                   )
                                                
                                                )
                                             
                                             ]
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     
                  

On the other hand, mt
                      follows a Poisson distribution with parameter λ∑
                        i ∈ S
                     
                     P
                     
                        t
                        *
                     (α, β, St, Zt
                     ). Therefore the probability p(m|α, β, λ) that we observe mt
                      reservations in time period t is given by

                        
                           
                              
                                 
                                    
                                       
                                          p
                                          
                                             (
                                             m
                                             |
                                             α
                                             ,
                                             β
                                             ,
                                             λ
                                             )
                                          
                                          =
                                          
                                             ∏
                                             
                                                t
                                                =
                                                1
                                             
                                             T
                                          
                                          
                                             
                                                
                                                   
                                                      [
                                                      λ
                                                      
                                                         ∑
                                                         
                                                            i
                                                            ∈
                                                            S
                                                         
                                                      
                                                      
                                                         P
                                                         
                                                            t
                                                            *
                                                         
                                                      
                                                      
                                                         (
                                                         α
                                                         ,
                                                         β
                                                         ,
                                                         
                                                            S
                                                            t
                                                         
                                                         ,
                                                         
                                                            Z
                                                            t
                                                         
                                                         )
                                                      
                                                      ]
                                                   
                                                   
                                                      m
                                                      t
                                                   
                                                
                                                
                                                   e
                                                   
                                                      −
                                                      λ
                                                      
                                                         P
                                                         
                                                            t
                                                            *
                                                         
                                                      
                                                      
                                                         (
                                                         α
                                                         ,
                                                         β
                                                         ,
                                                         
                                                            S
                                                            t
                                                         
                                                         ,
                                                         
                                                            Z
                                                            t
                                                         
                                                         )
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   m
                                                   t
                                                
                                                !
                                             
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     Taking the logarithm gives

                        
                           (14)
                           
                              
                                 
                                    
                                       
                                          log
                                          
                                             (
                                             p
                                             (
                                             m
                                             |
                                             α
                                             ,
                                             β
                                             ,
                                             λ
                                             )
                                             )
                                          
                                          =
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                             
                                                t
                                                =
                                                1
                                             
                                             T
                                          
                                          
                                             m
                                             t
                                          
                                          
                                             [
                                             log
                                             
                                                (
                                                λ
                                                
                                                   P
                                                   
                                                      t
                                                      *
                                                   
                                                
                                                
                                                   (
                                                   α
                                                   ,
                                                   β
                                                   ,
                                                   
                                                      S
                                                      t
                                                   
                                                   ,
                                                   
                                                      Z
                                                      t
                                                   
                                                   )
                                                
                                                )
                                             
                                             ]
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          −
                                          λ
                                          
                                             P
                                             
                                                t
                                                *
                                             
                                          
                                          
                                             (
                                             α
                                             ,
                                             β
                                             ,
                                             
                                                S
                                                t
                                             
                                             ,
                                             
                                                Z
                                                t
                                             
                                             )
                                          
                                          −
                                          log
                                          
                                             (
                                             
                                                m
                                                t
                                             
                                             !
                                             )
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     Note that if we maximise Eq. (14) with respect to α and λ we can ignore the last term. The first partial derivative with respect to λ equals

                        
                           
                              
                                 
                                    
                                       
                                          
                                             1
                                             λ
                                          
                                          
                                             ∑
                                             
                                                t
                                                =
                                                1
                                             
                                             T
                                          
                                          
                                             m
                                             t
                                          
                                          −
                                          
                                             ∑
                                             
                                                t
                                                =
                                                1
                                             
                                             T
                                          
                                          
                                             P
                                             
                                                t
                                                *
                                             
                                          
                                          
                                             (
                                             α
                                             ,
                                             β
                                             ,
                                             
                                                S
                                                t
                                             
                                             ,
                                             
                                                Z
                                                t
                                             
                                             )
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     The optimum is attained at

                        
                           (15)
                           
                              
                                 
                                    
                                       
                                          λ
                                          =
                                          
                                             
                                                
                                                   ∑
                                                   
                                                      t
                                                      =
                                                      1
                                                   
                                                   T
                                                
                                                
                                                   m
                                                   t
                                                
                                             
                                             
                                                
                                                   ∑
                                                   
                                                      t
                                                      =
                                                      1
                                                   
                                                   T
                                                
                                                
                                                   P
                                                   
                                                      t
                                                      *
                                                   
                                                
                                                
                                                   (
                                                   α
                                                   ,
                                                   β
                                                   ,
                                                   
                                                      S
                                                      t
                                                   
                                                   ,
                                                   
                                                      Z
                                                      t
                                                   
                                                   )
                                                
                                             
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     where 
                        
                           
                              ∑
                              
                                 t
                                 =
                                 1
                              
                              T
                           
                           
                              m
                              t
                           
                        
                      is the total number of observed reservations. The second partial derivative with respect to λ equals

                        
                           
                              
                                 
                                    
                                       
                                          −
                                          
                                             1
                                             
                                                λ
                                                2
                                             
                                          
                                          
                                             ∑
                                             
                                                t
                                                =
                                                1
                                             
                                             T
                                          
                                          
                                             m
                                             t
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     which is negative for λ ≠ 0, so the optimum from Eq. (15) is a maximum. We can replace λ in Eq. (14) by Eq. (15), which gives

                        
                           (16)
                           
                              
                                 
                                    
                                    
                                       
                                          log
                                          
                                             (
                                             p
                                             (
                                             
                                                m
                                                t
                                             
                                             |
                                             α
                                             ,
                                             β
                                             ,
                                             λ
                                             )
                                             )
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          =
                                          
                                             ∑
                                             
                                                t
                                                =
                                                1
                                             
                                             T
                                          
                                          
                                             m
                                             t
                                          
                                          log
                                          
                                             (
                                             
                                                
                                                   
                                                      ∑
                                                      
                                                         t
                                                         =
                                                         1
                                                      
                                                      T
                                                   
                                                   
                                                      m
                                                      t
                                                   
                                                
                                                
                                                   
                                                      ∑
                                                      
                                                         t
                                                         =
                                                         1
                                                      
                                                      T
                                                   
                                                   
                                                      P
                                                      
                                                         t
                                                         *
                                                      
                                                   
                                                   
                                                      (
                                                      α
                                                      ,
                                                      β
                                                      ,
                                                      
                                                         S
                                                         t
                                                      
                                                      ,
                                                      
                                                         Z
                                                         t
                                                      
                                                      )
                                                   
                                                
                                             
                                             
                                                P
                                                
                                                   t
                                                   *
                                                
                                             
                                             
                                                (
                                                α
                                                ,
                                                β
                                                ,
                                                
                                                   S
                                                   t
                                                
                                                ,
                                                
                                                   Z
                                                   t
                                                
                                                )
                                             
                                             )
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          
                                          −
                                          
                                             
                                                
                                                   ∑
                                                   
                                                      t
                                                      =
                                                      1
                                                   
                                                   T
                                                
                                                
                                                   m
                                                   t
                                                
                                             
                                             
                                                
                                                   ∑
                                                   
                                                      t
                                                      =
                                                      1
                                                   
                                                   T
                                                
                                                
                                                   P
                                                   
                                                      t
                                                      *
                                                   
                                                
                                                
                                                   (
                                                   α
                                                   ,
                                                   β
                                                   ,
                                                   
                                                      S
                                                      t
                                                   
                                                   ,
                                                   
                                                      Z
                                                      t
                                                   
                                                   )
                                                
                                             
                                          
                                          
                                             P
                                             
                                                t
                                                *
                                             
                                          
                                          
                                             (
                                             α
                                             ,
                                             β
                                             ,
                                             
                                                S
                                                t
                                             
                                             ,
                                             
                                                Z
                                                t
                                             
                                             )
                                          
                                          −
                                          log
                                          
                                             (
                                             
                                                m
                                                t
                                             
                                             !
                                             )
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     
                  

If β is given we can find α by maximising Eq. (16) with respect to α. Then we can find λ by using Eq. (15).

The estimation procedure is summarised in Algorithm 4.1.

                        Algorithm 4.1
                        
                           Three-Step Continuous
                           
                              
                                 1.
                                 
                                    Find
                                    
                                       
                                          γ
                                          ^
                                       
                                     
                                    using (
                                    
                                       Eq. 12
                                    
                                    ).
                                 


                                    Find
                                    
                                       
                                          β
                                          ^
                                       
                                     
                                    using (
                                    
                                       Eq. 13
                                    
                                    ).
                                 


                                    Use the estimate
                                    
                                       
                                          β
                                          ^
                                       
                                     
                                    to find
                                    
                                       
                                          α
                                          ^
                                       
                                     
                                    using (
                                    
                                       Eq. 16
                                    
                                    ). Then use
                                    
                                       
                                          β
                                          ^
                                       
                                     
                                    and
                                    
                                       
                                          α
                                          ^
                                       
                                     
                                    to find
                                    
                                       
                                          λ
                                          ^
                                       
                                     
                                    using (
                                    
                                       Eq. 15
                                    
                                    ).
                                 


                     Theorem 4.1 below states that Algorithm 4.1 provides consistent estimators. Moreover, the estimator for the cancellation parameters γ is an unbiased estimator.

                        Theorem 4.1
                        
                           As the sample size increases, 
                           
                              Algorithm 4.1
                            
                           leads to consistent estimators. Moreover, the estimator for γ found by (
                           
                              Eq. 12
                           
                           ) is unbiased.
                        

Theorem 1 and Theorem 2 in Newman et al. (2014) show that the estimators of β and (α, λ) are consistent, respectively.

To show that the estimator 
                              
                                 γ
                                 ^
                              
                            of the cancellation parameter found by Eq. (12) is a consistent estimator, we consider the cancellation parameters separately per product. Consider a product j ∈ N. Let 
                              
                                 γ
                                 j
                                 *
                              
                            be the true parameter and let 
                              
                                 γ
                                 j
                                 k
                              
                            be the parameter obtained using Eq. (12) with sample size k. In other words,

                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   γ
                                                   j
                                                   k
                                                
                                                =
                                                
                                                   
                                                      
                                                         ∑
                                                         
                                                            y
                                                            =
                                                            0
                                                         
                                                         
                                                            C
                                                            max
                                                         
                                                      
                                                      
                                                         ζ
                                                         j
                                                         k
                                                      
                                                      
                                                         (
                                                         
                                                         y
                                                         )
                                                      
                                                   
                                                   
                                                      
                                                         ∑
                                                         
                                                            y
                                                            =
                                                            0
                                                         
                                                         
                                                            C
                                                            max
                                                         
                                                      
                                                      y
                                                      
                                                         t
                                                         j
                                                         k
                                                      
                                                      
                                                         (
                                                         
                                                         y
                                                         )
                                                      
                                                   
                                                
                                                ,
                                             
                                          
                                       
                                    
                                 
                              
                           with 
                              
                                 
                                    ζ
                                    j
                                    k
                                 
                                 
                                    (
                                    
                                    y
                                    )
                                 
                              
                            the observed number of cancellations in state y and 
                              
                                 
                                    t
                                    j
                                    k
                                 
                                 
                                    (
                                    
                                    y
                                    )
                                 
                              
                            the observed time spend in state y with k observations. We can think of one observation as an arrival day with all booking history. The expected number of cancellations when the state is y is equal to 
                              
                                 
                                    γ
                                    j
                                    *
                                 
                                 y
                                 
                                    t
                                    j
                                    k
                                 
                                 
                                    (
                                    
                                    y
                                    )
                                 
                              
                           . Note that 
                              
                                 
                                    t
                                    j
                                    k
                                 
                                 
                                    (
                                    
                                    y
                                    )
                                 
                              
                            is the sum of k i.i.d. random variables tj
                           (y), where tj
                           (y) is the time spend in state y for one observation. As the sample size increases, we have that

                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   lim
                                                   
                                                      k
                                                      →
                                                      ∞
                                                   
                                                
                                                
                                                   
                                                      y
                                                      
                                                         t
                                                         j
                                                         k
                                                      
                                                      
                                                         (
                                                         
                                                         y
                                                         )
                                                      
                                                   
                                                   k
                                                
                                                =
                                                
                                                   γ
                                                   j
                                                   *
                                                
                                                y
                                                E
                                                
                                                   [
                                                   
                                                      t
                                                      j
                                                   
                                                   
                                                      (
                                                      
                                                      y
                                                      )
                                                   
                                                   ]
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           On the other hand, 
                              
                                 
                                    ζ
                                    j
                                    k
                                 
                                 
                                    (
                                    
                                    y
                                    )
                                 
                              
                            is the sum of k i.i.d. random variables ζj
                           (y), where ζj
                           (y) is the number of cancellations for one observation. As the sample size increases, we have that

                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   lim
                                                   
                                                      k
                                                      ←
                                                      ∞
                                                   
                                                
                                                
                                                   
                                                      
                                                         ζ
                                                         j
                                                         k
                                                      
                                                      
                                                         (
                                                         
                                                         y
                                                         )
                                                      
                                                   
                                                   k
                                                
                                             
                                          
                                          
                                             
                                                
                                                =
                                                
                                                E
                                                
                                                   [
                                                   
                                                      ζ
                                                      j
                                                   
                                                   
                                                      (
                                                      
                                                      y
                                                      )
                                                   
                                                   ]
                                                
                                                
                                                =
                                                
                                                E
                                                
                                                   [
                                                   E
                                                   
                                                      [
                                                      
                                                         ζ
                                                         j
                                                      
                                                      
                                                         (
                                                         
                                                         y
                                                         )
                                                      
                                                      |
                                                      
                                                         t
                                                         j
                                                      
                                                      
                                                         (
                                                         
                                                         y
                                                         )
                                                      
                                                      ]
                                                   
                                                   ]
                                                
                                                
                                                =
                                                
                                                E
                                                
                                                   [
                                                   
                                                      γ
                                                      j
                                                      *
                                                   
                                                   y
                                                   
                                                      t
                                                      j
                                                   
                                                   
                                                      (
                                                      
                                                      y
                                                      )
                                                   
                                                   ]
                                                
                                                
                                                =
                                                
                                                
                                                   γ
                                                   j
                                                   *
                                                
                                                y
                                                E
                                                
                                                   [
                                                   
                                                      t
                                                      j
                                                   
                                                   
                                                      (
                                                      
                                                      y
                                                      )
                                                   
                                                   ]
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           Hence we have that

                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   lim
                                                   
                                                      k
                                                      →
                                                      ∞
                                                   
                                                
                                                
                                                   γ
                                                   j
                                                   k
                                                
                                             
                                          
                                          
                                             
                                                =
                                                
                                                   lim
                                                   
                                                      k
                                                      →
                                                      ∞
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            1
                                                            k
                                                         
                                                         
                                                            ∑
                                                            
                                                               y
                                                               =
                                                               0
                                                            
                                                            
                                                               C
                                                               max
                                                            
                                                         
                                                         
                                                            ζ
                                                            j
                                                            k
                                                         
                                                         
                                                            (
                                                            
                                                            y
                                                            )
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            1
                                                            k
                                                         
                                                         
                                                            ∑
                                                            
                                                               y
                                                               =
                                                               0
                                                            
                                                            
                                                               C
                                                               max
                                                            
                                                         
                                                         y
                                                         
                                                            t
                                                            j
                                                            k
                                                         
                                                         
                                                            (
                                                            
                                                            y
                                                            )
                                                         
                                                      
                                                   
                                                
                                                =
                                                
                                                   
                                                      
                                                         
                                                            γ
                                                            j
                                                            *
                                                         
                                                         
                                                            ∑
                                                            
                                                               y
                                                               =
                                                               0
                                                            
                                                            
                                                               C
                                                               max
                                                            
                                                         
                                                         y
                                                         E
                                                         
                                                            [
                                                            
                                                               t
                                                               j
                                                            
                                                            
                                                               (
                                                               
                                                               y
                                                               )
                                                            
                                                            ]
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            ∑
                                                            
                                                               y
                                                               =
                                                               0
                                                            
                                                            
                                                               C
                                                               max
                                                            
                                                         
                                                         y
                                                         E
                                                         
                                                            [
                                                            
                                                               t
                                                               j
                                                            
                                                            
                                                               (
                                                               
                                                               y
                                                               )
                                                            
                                                            ]
                                                         
                                                      
                                                   
                                                
                                                =
                                                
                                                   γ
                                                   j
                                                   *
                                                
                                                ,
                                             
                                          
                                       
                                    
                                 
                              
                           so Eq. (12) provides a consistent estimator. Moreover, using conditional expectation it follows that

                              
                                 
                                    
                                       
                                          
                                             
                                                E
                                                
                                                   [
                                                   
                                                      γ
                                                      j
                                                      k
                                                   
                                                   ]
                                                
                                                =
                                                E
                                                
                                                   [
                                                   E
                                                   
                                                      {
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     ∑
                                                                     
                                                                        y
                                                                        =
                                                                        0
                                                                     
                                                                     
                                                                        C
                                                                        max
                                                                     
                                                                  
                                                                  
                                                                     ζ
                                                                     j
                                                                     k
                                                                  
                                                                  
                                                                     (
                                                                     
                                                                     y
                                                                     )
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     ∑
                                                                     
                                                                        y
                                                                        =
                                                                        0
                                                                     
                                                                     
                                                                        C
                                                                        max
                                                                     
                                                                  
                                                                  y
                                                                  
                                                                     t
                                                                     j
                                                                     k
                                                                  
                                                                  
                                                                     (
                                                                     
                                                                     y
                                                                     )
                                                                  
                                                               
                                                            
                                                         
                                                         |
                                                      
                                                      
                                                         t
                                                         j
                                                         k
                                                      
                                                      
                                                         (
                                                         ·
                                                         )
                                                      
                                                      }
                                                   
                                                   ]
                                                
                                                =
                                                E
                                                
                                                   [
                                                   
                                                      
                                                         
                                                            
                                                               ∑
                                                               
                                                                  y
                                                                  =
                                                                  0
                                                               
                                                               
                                                                  C
                                                                  max
                                                               
                                                            
                                                            
                                                               γ
                                                               j
                                                               *
                                                            
                                                            y
                                                            
                                                               t
                                                               j
                                                               k
                                                            
                                                            
                                                               (
                                                               
                                                               y
                                                               )
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               ∑
                                                               
                                                                  y
                                                                  =
                                                                  0
                                                               
                                                               
                                                                  C
                                                                  max
                                                               
                                                            
                                                            y
                                                            
                                                               t
                                                               j
                                                               k
                                                            
                                                            
                                                               (
                                                               
                                                               y
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                   ]
                                                
                                                =
                                                
                                                   γ
                                                   *
                                                
                                                ,
                                             
                                          
                                       
                                    
                                 
                              
                           so Eq. (12) provides an unbiased estimator.□

In this section numerical results are provided to validate the customer choice cancellation model. The four main results that are provided are: (1) the fast computation time of the estimation method described in Section 4; (2) the fast computation time of the heuristics; (3) the good performance of the heuristics; and (4) the performance of the heuristics under estimated parameters. The parameters that are used are based on Simulation Example 2 in Talluri and van Ryzin (2004). Let n = 10 be the number of products sold with corresponding price vector

                        
                           
                              
                                 
                                    
                                       
                                          r
                                          =
                                          (
                                          240
                                          ,
                                          220
                                          ,
                                          190
                                          ,
                                          160
                                          ,
                                          120
                                          ,
                                          112
                                          ,
                                          96
                                          ,
                                          80
                                          ,
                                          74
                                          ,
                                          70
                                          )
                                          .
                                       
                                    
                                 
                              
                           
                        
                     Demand, cancellation rates, and purchase probabilities are independent from the time period t. To allow the study of the effect of high volume in demand and low volume in demand the load factor l is introduced. In our studies we use l ∈ {0.6, 0.8, 1, 1.2, 1.4}. Demand λ per time unit is then defined as

                        
                           
                              
                                 
                                    
                                       
                                          λ
                                          
                                             (
                                             C
                                             ,
                                             l
                                             ,
                                             T
                                             )
                                          
                                          =
                                          
                                             
                                                C
                                                l
                                             
                                             T
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     A low value of l implies a low demand relative to the capacity C and a high value of l implies a high demand relative to the capacity C.

Purchase probabilities are modelled by the MNL model. The only attribute that we consider is price, but we assume that there exist high price-sensitive and low price-sensitive customers which have different parameters βH
                      = −0.005 and βL
                      = −0.0015, respectively (as in Talluri & van Ryzin, 2004). The no-purchase parameter is set to α = 0 such that the MNL model is the same as in Talluri and van Ryzin (2004). We allow overbooking up to 20 percent of the total capacity C. Cancellation rates are assumed linear and the parameters 
                        
                           γ
                           ∈
                           
                              R
                              n
                           
                        
                      depend on l and T in the following way:

                        
                           
                              
                                 
                                    
                                       γ
                                    
                                    
                                       
                                          =
                                          (
                                          0.720
                                          ,
                                          0.320
                                          ,
                                          0.560
                                          ,
                                          0.280
                                          ,
                                          0.200
                                          ,
                                          0.360
                                          ,
                                          0.160
                                          ,
                                          0.080
                                          ,
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          
                                             
                                             
                                             
                                             0.008
                                             ,
                                             0.040
                                             )
                                          
                                          
                                             l
                                             T
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          =
                                          (
                                          18
                                          /
                                          25
                                          ,
                                          8
                                          /
                                          25
                                          ,
                                          14
                                          /
                                          25
                                          ,
                                          7
                                          /
                                          25
                                          ,
                                          1
                                          /
                                          5
                                          ,
                                          9
                                          /
                                          25
                                          ,
                                          4
                                          /
                                          25
                                          ,
                                          2
                                          /
                                          25
                                          ,
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          
                                             
                                             
                                             
                                             1
                                             /
                                             125
                                             ,
                                             1
                                             /
                                             25
                                             )
                                          
                                          
                                             l
                                             T
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     
                  

The policies that follow from the heuristics need to be compared using the corresponding revenue. For small problem instances the exact solution method can be used, but for larger instances the problem instance is intractable. In that case simulation is used to estimate the revenue corresponding to a policy. The estimation errors are between 0.1 percent and 0.4 percent.

An estimation method only has value for practical applications if it can finish in reasonable time. The three-step continuous estimation method (3SC) described in Section 4 has this property.

In Table 3
                         the computation time of 3SC is compared with the computation time of EM for different sample sizes. The results show that the computation time of the EM-algorithm increases drastically when the sample size increases, while the computation time of the 3SC-method does not. This is only for a small example with C = 20 rooms, so the results will be worse for practical instances. Fortunately, the 3SC-method can be used also for larger instances, with more capacity. In Table 4
                         the computation time of 3SC is given for a hotel with C = 200 rooms for different sample sizes. The computation time increases but it stays reasonable.

In the analysis of the cancellation model it was stated that the model suffers from the curse of dimensionality. The state space of the Markov decision process is too large, such that solving the exact problem takes too much time. In Table 5
                        
                         the computation times of the solution methods are presented for a small example, where C = 10, T = 20, l = 1, and the number of products n varies from 2 to 10. Evaluating instances with n > 6 using the exact solution method causes system to be out of memory and the exact solution can therefore not be computed.

This example shows that when the number of products increases the computation time increases drastically, while the computation times for the heuristic stay more or less constant. In Table 6 below the computation times of the heuristics are presented for a larger instance, where C = 200, T = 1000, and n = 10. Even in this case the computation time is very small.

The cancellation model is only useful if the tractable heuristics outperform the base model. To this end, consider a large instance, with C = 200 rooms and T = 1000 time periods. The load factors l that are considered are {0.6, 0.8, 1, 1.2, 1.4}. In Table 6 the results are presented.

There are several noteworthy observations from Table 6. First and foremost, using the policies found by the IOC and LCR heuristics lead to solutions with higher revenue compared the TvR solution method (except for the case that l = 0.6, when LCR still outperforms TvR, but IOC is slightly outperformed by TvR). Therefore it is reasonable to consider cancellations in the decision making process. Taking cancellation into account leads to a revenue gain of up to 20 percent.

Second, the IOC algorithm performs better than the TvR algorithm, but worse than the LCR algorithm. This is the motivation for choosing LCR over IOC if we work under the linear cancellation rates Assumption 2.2, but choosing IOC over TvR if we work with general probability rates under the independence of cancellations Assumption 2.1.

Third, the effects of taking cancellations into account increase when the arrival volume increases. This is intuitively clear: if the arrival rate is higher, the gap caused by a cancelled reservation will be filled quickly. If you do not take cancellations into account, the gap caused by the cancelled reservation will not be filled, which implies a loss in revenue.

Estimation errors potentially lead to bad performance of the optimisation model. Depending on the sample size the estimation error might be small or large. In the next simulation the performance of the solution method using estimated parameters is measured. Again a large instance is considered, where C = 200, T = 1000, and n = 10. The load factor l is given different values, namely {0.6, 0.8, 1, 1.2, 1.4}, to consider the effect of different demand volumes. For each load factor a dataset of size 100 (arrival days) is created, from which the parameters are estimated. The estimated parameters are used by all heuristics to find the corresponding policy and revenue. In Table 8 the results of the estimation are presented. The true values as well as the estimated values are presented.

In Table 7
                         the revenues corresponding to load factor l, heuristic, and estimated or true parameter set is given. From this table several observations can be made. Firstly, the heuristics outperforms the TvR method in all cases: for all load factors, for all parameter sets, true or estimated. This fact suggests that choosing a heuristic that takes cancellations into account is prefered over the TvR model, even if the parameters are estimated and thus contain errors.

Second, the model using the estimated parameters might outperform the model with the true parameters, or it might not. It seems that in this instance the extreme load factors (l = 0.6 and 1.4) lead to a better performance of the model under estimated parameters for all heuristics, while with the other load factors the model under the true parameters performs better.

@&#DISCUSSION@&#

In this paper we analysed the customer choice cancellation model in Section 2, including simplified versions that result from Assumptions 2.1, 2.2, and 2.3. Moreover, we introduced several solution methods in Section 3 and estimation methods in Appendix B. In this section we briefly describe some guidelines for selecting a model, a solution method, and an estimation method. Moreover, we briefly discuss an extension of the cancellation model to a more realistic choice-based network cancellation model.

In practice one needs to make a choice which model to use before deciding about the solution method and estimation method. To this end, a balance must be established for the trade-off between a good model, a good estimation method, and a good solution method. If little restriction is put on the cancellation probabilities, heuristics need to be used unless the problem is small. Subsequently, complex cancellation rate functions need to be estimated. On the other hand, under the linear and equal cancellation rates Assumption 2.3 the problem can be solved exactly in an efficient way, if the action space small. However, the assumption that cancellation probabilities are equal for all products is rather strong and not realistic in many cases.

For different model instances different solution methods and estimation methods may be appropriate. There are three dimensions that have to be considered when choosing a solution method: the model choice, the size of the state space, and the size of the action space. When choosing an estimation method we need to consider the model choice and in particular the model choice for the purchase probabilities and cancellation rates.

The efficient three-step estimation Algorithm 4.1 can only be applied to a model that satisfies Assumption 2.2 or 2.3 and the purchase probabilities are modelled by the multinomial logit model. In all other cases the expectation-maximisation algorithm described in Appendix B can be used.

If none of the Assumptions 2.1, 2.2, or 2.3 is satisfied, we can only use the exact solution method to solve the problem. The computation time of this method may be prohibitively long if the state space or the action space is large.

Under the independence of cancellations Assumption 2.1 only (the reformulation of) the exact method described by Eq. (3) or the Independence of Cancellations heuristic (IOC) described by Algorithm 3.1 are appropriate. If the state space or the action space is large we use the IOC heuristic and if the state space and the action space are small we can use the exact solution method.

Under the linear cancellation rates Assumption 2.2 we can apply the exact method, the IOC heuristic, and the Linear Cancellation Rates Heuristic (LCR). However, numerical results show that LCR outperforms IOC under the linear cancellation rates assumption, so we will not consider IOC here. If both the action space and the state space are small, we will use the exact method. If however either the action space is large or the state space is large we prefer LCR because the exact method is intractable. The action space can be small when the state space is large if n is small but C is large.

Under the linear and equal cancellation rates assumption the problem can be solved exactly using Eq. (4). However, if the action space is too large we have to use the LCR heuristic.

In practice it is common that fare products consist of multiple night stays/multiple flight legs, so it is worth looking at network revenue management problems. The theory described in this paper is not sufficient to solve these complex problems. However, we provide an outline of a way to approach this problem. The choice-based network model by Liu and van Ryzin (2008) could be extended to include cancellations. The network consists of m legs and n fare products, where a fare product is now not only a combination of a price rj
                         and conditions, but also a combination of legs consumed by the product, e.g. several nights for a hotel stay.

As in the single-resource case we can write the dynamic programming formulation to solve the problem. In the network base model (without cancellations) we have to keep track of the available resources, which is at most a vector of size m. Liu and van Ryzin (2008) argue that this problem is intractable and provide a choice-based linear programming heuristic (CDLP) to solve the problem in reasonable time. Now if we also consider cancellations we have to keep track of the number of reservations per product. This is a vector of size at most 2
                           m
                         − 1, so we need to consider heuristics. One heuristic is to use state space reduction techniques similar to methods described in this paper. Instead of keeping track of purchases of all products we can keep track of the availability of each resource, which reduces the state-space to an m-dimensional vector, as in the network base model. A heuristic similar to CDLP could be used to solve the remaining problem. However, cancellations contribute to the complexity of modelling and solving such heuristic. More research is necessary to investigate an efficient method to model and solve the choice-based network cancellation model. This topic would enrich the choice-modelling literature, but this is beyond the scope of this paper.

Cancellations have a big impact on revenue. Our model incorporates cancellations in the customer choice behaviour setting of revenue management. Policies that are optimal in a setting where cancellations are not considered can lead to a revenue loss of up to 20 percent compared to an optimal policy in our setting where cancellations are considered.

The exact solution can not be evaluated for all practical purposes because of the curse of dimensionality. To overcome this problem we introduced three heuristics: (1) the Independence of Cancellations heuristic 3.1, which reduces the state space and can be applied to models with general cancellation rates; (2) the Linear Cancellation Rates Heuristic 3.1, which also reduces the state space and is appropriate under the linear cancellations Assumption 2.2; and (3) heuristic 3.2, which is an extension of the Linear Cancellation Rates algorithm and can be used for a hotel with several room types.

Two key results in this paper ensure that the customer choice cancellation model can be an effective method for practitioners. First, the Linear Cancellation Rates Heuristic from Section 3.4 is fast and gives a solution close to optimal. Second, the parameters of the model can be estimated in a consistent and fast way using Algorithm 4.1.

The results of this paper can function as a foundation for several topics of further research. First of all, the effects of cancellation conditions and overbooking policies in combination with customer choice behaviour can now be studied with our customer choice cancellation model. Second, our customer choice cancellation model can be extended to include group bookings and multiple night stays/multiple flight legs, which are also very common in practice. Finally, cancellations can be embedded in other revenue management models to improve performance.

@&#ACKNOWLEDGEMENTS@&#

This research was partly funded by the Ministry of Education, Culture and Science (OCW) via the Regional Attention and Action for Knowledge circulation (RAAK) grant no. 2011-3-13int, Foundation Innovation Alliance (SIA). We would like to thank the anonymous referees for their constructive input. Their comments on among others the discussion on efficient sets and the estimation method improved the presentation of the manuscript indeed.


                     
                        Proof of Proposition 3.1.
                        First we rewrite Eq. (3) by taking all terms that do not depend on S out of the maximisation part. This gives us the following equation:

                              
                                 (A.1)
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      W
                                                      ˜
                                                   
                                                   t
                                                
                                                
                                                   (
                                                   
                                                   y
                                                   )
                                                
                                             
                                          
                                          
                                             
                                                =
                                                
                                                   max
                                                   
                                                      S
                                                      ⊂
                                                      N
                                                   
                                                
                                                
                                                   {
                                                   λ
                                                   
                                                      (
                                                      R
                                                      
                                                         (
                                                         S
                                                         ,
                                                         y
                                                         ,
                                                         t
                                                         )
                                                      
                                                      −
                                                      Q
                                                      
                                                         (
                                                         S
                                                         )
                                                      
                                                      Δ
                                                      
                                                         
                                                            W
                                                            ˜
                                                         
                                                         
                                                            t
                                                            −
                                                            1
                                                         
                                                      
                                                      
                                                         (
                                                         
                                                         y
                                                         )
                                                      
                                                      )
                                                   
                                                   }
                                                
                                             
                                          
                                       
                                       
                                          
                                          
                                             
                                                
                                                +
                                                γ
                                                y
                                                Δ
                                                
                                                   
                                                      W
                                                      ˜
                                                   
                                                   
                                                      t
                                                      −
                                                      1
                                                   
                                                
                                                
                                                   (
                                                   
                                                   y
                                                   −
                                                   1
                                                   )
                                                
                                                +
                                                
                                                   
                                                      W
                                                      ˜
                                                   
                                                   
                                                      t
                                                      −
                                                      1
                                                   
                                                
                                                
                                                   (
                                                   
                                                   y
                                                   )
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           with 
                              
                                 Δ
                                 
                                    
                                       W
                                       ˜
                                    
                                    
                                       t
                                       −
                                       1
                                    
                                 
                                 
                                    (
                                    
                                    y
                                    )
                                 
                                 :
                                 =
                                 
                                    
                                       W
                                       ˜
                                    
                                    
                                       t
                                       −
                                       1
                                    
                                 
                                 
                                    (
                                    
                                    y
                                    )
                                 
                                 −
                                 
                                    
                                       W
                                       ˜
                                    
                                    
                                       t
                                       −
                                       1
                                    
                                 
                                 
                                    (
                                    
                                    y
                                    +
                                    1
                                    )
                                 
                              
                           .

Let S
                           * ⊂ N be an inefficient set, i.e., there exist α(S) ≥ 0 for all S ⊂ (N) with ∑ 
                              S ⊂ N
                           
                           α(S) = 1 and

                              
                                 
                                    
                                       
                                          
                                             
                                                Q
                                                (
                                                
                                                   S
                                                   *
                                                
                                                )
                                             
                                          
                                          
                                             
                                                ≥
                                                
                                                   ∑
                                                   
                                                      S
                                                      ⊂
                                                      N
                                                   
                                                
                                                α
                                                
                                                   (
                                                   S
                                                   )
                                                
                                                Q
                                                
                                                   (
                                                   S
                                                   )
                                                
                                                ,
                                             
                                          
                                          
                                             
                                                R
                                                (
                                                
                                                   S
                                                   *
                                                
                                                ,
                                                y
                                                ,
                                                t
                                                )
                                             
                                          
                                          
                                             
                                                <
                                                
                                                   ∑
                                                   
                                                      S
                                                      ⊂
                                                      N
                                                   
                                                
                                                α
                                                
                                                   (
                                                   S
                                                   )
                                                
                                                R
                                                
                                                   (
                                                   S
                                                   ,
                                                   y
                                                   ,
                                                   t
                                                   )
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           Then we have that

                              
                                 
                                    
                                       
                                          
                                          
                                             
                                                λ
                                                
                                                   (
                                                   R
                                                   
                                                      (
                                                      
                                                         S
                                                         *
                                                      
                                                      ,
                                                      y
                                                      ,
                                                      t
                                                      )
                                                   
                                                   −
                                                   Q
                                                   
                                                      (
                                                      
                                                         S
                                                         *
                                                      
                                                      )
                                                   
                                                   Δ
                                                   
                                                      
                                                         W
                                                         ˜
                                                      
                                                      
                                                         t
                                                         −
                                                         1
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                      y
                                                      )
                                                   
                                                   )
                                                
                                             
                                          
                                       
                                       
                                          
                                          
                                             
                                                
                                                <
                                                
                                                λ
                                                
                                                   (
                                                   
                                                      ∑
                                                      
                                                         S
                                                         ⊂
                                                         N
                                                      
                                                   
                                                   α
                                                   
                                                      (
                                                      S
                                                      )
                                                   
                                                   R
                                                   
                                                      (
                                                      S
                                                      ,
                                                      y
                                                      ,
                                                      t
                                                      )
                                                   
                                                   −
                                                   
                                                      ∑
                                                      
                                                         S
                                                         ⊂
                                                         N
                                                      
                                                   
                                                   α
                                                   
                                                      (
                                                      S
                                                      )
                                                   
                                                   Q
                                                   
                                                      (
                                                      S
                                                      )
                                                   
                                                   Δ
                                                   
                                                      
                                                         W
                                                         ˜
                                                      
                                                      
                                                         t
                                                         −
                                                         1
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                      y
                                                      )
                                                   
                                                   )
                                                
                                             
                                          
                                       
                                       
                                          
                                          
                                             
                                                
                                                =
                                                
                                                
                                                   ∑
                                                   
                                                      S
                                                      ⊂
                                                      N
                                                   
                                                
                                                α
                                                
                                                   (
                                                   S
                                                   )
                                                
                                                λ
                                                
                                                   (
                                                   R
                                                   
                                                      (
                                                      S
                                                      ,
                                                      y
                                                      ,
                                                      t
                                                      )
                                                   
                                                   −
                                                   Q
                                                   
                                                      (
                                                      S
                                                      )
                                                   
                                                   Δ
                                                   
                                                      
                                                         W
                                                         ˜
                                                      
                                                      
                                                         t
                                                         −
                                                         1
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                      y
                                                      )
                                                   
                                                   )
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           Since α(S) defines a probability, there is at least one S ⊂ N such that

                              
                                 
                                    
                                       
                                          
                                             
                                                R
                                                
                                                   (
                                                   
                                                      S
                                                      *
                                                   
                                                   ,
                                                   y
                                                   ,
                                                   t
                                                   )
                                                
                                                −
                                                Q
                                                
                                                   (
                                                   
                                                      S
                                                      *
                                                   
                                                   )
                                                
                                                Δ
                                                
                                                   
                                                      W
                                                      ˜
                                                   
                                                   
                                                      t
                                                      −
                                                      1
                                                   
                                                
                                                
                                                   (
                                                   
                                                   y
                                                   )
                                                
                                                <
                                                R
                                                
                                                   (
                                                   S
                                                   ,
                                                   y
                                                   ,
                                                   t
                                                   )
                                                
                                                −
                                                Q
                                                
                                                   (
                                                   S
                                                   )
                                                
                                                Δ
                                                
                                                   
                                                      W
                                                      ˜
                                                   
                                                   
                                                      t
                                                      −
                                                      1
                                                   
                                                
                                                
                                                   (
                                                   
                                                   y
                                                   )
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           Hence S
                           * is not optimal.□

The probability that xj
                            ∈ {0, …, y} in state (y, t) is equal to 1. Therefore the probability 
                              
                                 
                                    p
                                    t
                                    y
                                 
                                 
                                    (
                                    
                                       x
                                       j
                                    
                                    =
                                    k
                                    )
                                 
                              
                            that xj
                            = k for some k ∈ {0, …, y} if we are in state (y, t) is equal to the probability 
                              
                                 
                                    
                                       p
                                       ^
                                    
                                    
                                       t
                                    
                                    y
                                 
                                 
                                    (
                                    
                                       x
                                       j
                                    
                                    =
                                    k
                                    )
                                 
                              
                            that xj
                            = k and we are in state y if we are at time t divided by the probability that we are in state y at time t. The latter is equal to

                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ∑
                                                   
                                                      k
                                                      =
                                                      0
                                                   
                                                   y
                                                
                                                
                                                   
                                                      p
                                                      ^
                                                   
                                                   t
                                                   y
                                                
                                                
                                                   (
                                                   
                                                      x
                                                      j
                                                   
                                                   =
                                                   k
                                                   )
                                                
                                                ,
                                             
                                          
                                       
                                    
                                 
                              
                           so we only have to find 
                              
                                 
                                    
                                       p
                                       ^
                                    
                                    t
                                    y
                                 
                                 
                                    (
                                    
                                       x
                                       j
                                    
                                    =
                                    k
                                    )
                                 
                              
                            for all k ∈ {0, …, y}.

There are three ways to get to state (y, t). First, we could come from state (y + 1, t + 1) and a product was cancelled. The probability that we get to state (y + 1, t + 1) is p(y + 1, t + 1). There are two possible values for xj
                            at time t + 1 that can lead to xj
                            = k at time t, namely xj
                            = k + 1 at time t + 1 and product j is cancelled or xj
                            = k at time t + 1 and product i ≠ j is cancelled. The probability that the former event occurs is equal to

                              
                                 
                                    
                                       
                                          
                                             
                                                p
                                                
                                                   (
                                                   
                                                   y
                                                   +
                                                   1
                                                   ,
                                                   t
                                                   +
                                                   1
                                                   )
                                                
                                                
                                                   p
                                                   
                                                      t
                                                      +
                                                      1
                                                   
                                                   
                                                      y
                                                      +
                                                      1
                                                   
                                                
                                                
                                                   (
                                                   
                                                      x
                                                      j
                                                   
                                                   =
                                                   k
                                                   +
                                                   1
                                                   )
                                                
                                                
                                                   γ
                                                   j
                                                   
                                                      t
                                                      +
                                                      1
                                                   
                                                
                                                
                                                   (
                                                   k
                                                   +
                                                   1
                                                   )
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           The probability that the latter event occurs is equal to

                              
                                 
                                    
                                       
                                          
                                             
                                                p
                                                
                                                   (
                                                   
                                                   y
                                                   +
                                                   1
                                                   ,
                                                   t
                                                   +
                                                   1
                                                   )
                                                
                                                
                                                   p
                                                   
                                                      t
                                                      +
                                                      1
                                                   
                                                   
                                                      y
                                                      +
                                                      1
                                                   
                                                
                                                
                                                   (
                                                   
                                                      x
                                                      j
                                                   
                                                   =
                                                   k
                                                   )
                                                
                                                
                                                   ∑
                                                   
                                                      i
                                                      ≠
                                                      j
                                                   
                                                
                                                
                                                   ∑
                                                   
                                                      
                                                         k
                                                         ′
                                                      
                                                      =
                                                      0
                                                   
                                                   
                                                      y
                                                      +
                                                      1
                                                      −
                                                      k
                                                   
                                                
                                                
                                                   p
                                                   
                                                      t
                                                      +
                                                      1
                                                   
                                                   
                                                      y
                                                      +
                                                      1
                                                   
                                                
                                                
                                                   (
                                                   
                                                      x
                                                      i
                                                   
                                                   =
                                                   
                                                      k
                                                      ′
                                                   
                                                   )
                                                
                                                
                                                   γ
                                                   i
                                                   
                                                      t
                                                      +
                                                      1
                                                   
                                                
                                                
                                                   (
                                                   
                                                      k
                                                      ′
                                                   
                                                   )
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           
                        

The second possible state that we could come from to end up in state (y, t) is state (y, t + 1) and neither a product was cancelled nor a product was bought. The probability that we get to state (y, t + 1) is equal to p(y, t + 1). The only possibility to get to xj
                            = k in state (y, t) if nothing happens is that xj
                            = k in state (y, t + 1). The probability for this event is 
                              
                                 
                                    p
                                    
                                       t
                                       +
                                       1
                                    
                                    y
                                 
                                 
                                    (
                                    
                                       x
                                       j
                                    
                                    =
                                    k
                                    )
                                 
                              
                           . The probability that nothing happens in state (y, t + 1) under the condition that xj
                            = k is then equal to

                              
                                 
                                    
                                       
                                          
                                             
                                                1
                                                −
                                                λ
                                                
                                                   ∑
                                                   
                                                      j
                                                      ∈
                                                      S
                                                   
                                                
                                                
                                                   P
                                                   j
                                                
                                                
                                                   (
                                                   S
                                                   )
                                                
                                                −
                                                
                                                   ∑
                                                   
                                                      i
                                                      ≠
                                                      j
                                                   
                                                
                                                
                                                   ∑
                                                   
                                                      
                                                         k
                                                         ′
                                                      
                                                      =
                                                      0
                                                   
                                                   
                                                      y
                                                      −
                                                      k
                                                   
                                                
                                                
                                                   p
                                                   
                                                      t
                                                      +
                                                      1
                                                   
                                                   y
                                                
                                                
                                                   (
                                                   
                                                      x
                                                      i
                                                   
                                                   =
                                                   
                                                      k
                                                      ′
                                                   
                                                   )
                                                
                                                
                                                   γ
                                                   i
                                                   
                                                      t
                                                      +
                                                      1
                                                   
                                                
                                                
                                                   (
                                                   
                                                      k
                                                      ′
                                                   
                                                   )
                                                
                                                −
                                                
                                                   γ
                                                   j
                                                   
                                                      t
                                                      +
                                                      1
                                                   
                                                
                                                
                                                   (
                                                   k
                                                   )
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           
                        

The third possible state that we could come from to end up in state (y, t) is state (y − 1, t + 1) and a product was bought. The probability that we get to state (y − 1, t + 1) is equal to p(y − 1, t + 1). There are two possible values for xj
                            at time t + 1 that can lead to xj
                            = k at time t, namely xj
                            = k − 1 at time t + 1 and product j is bought or xj
                            = k at time t + 1 and product i ≠ j is bought. The probability that the former event occurs is equal to

                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   p
                                                   
                                                      t
                                                      +
                                                      1
                                                   
                                                   
                                                      y
                                                      −
                                                      1
                                                   
                                                
                                                
                                                   (
                                                   
                                                      x
                                                      j
                                                   
                                                   =
                                                   k
                                                   −
                                                   1
                                                   )
                                                
                                                λ
                                                
                                                   P
                                                   j
                                                
                                                
                                                   (
                                                   S
                                                   )
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           The probability that the latter event occurs is equal to

                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   p
                                                   
                                                      t
                                                      +
                                                      1
                                                   
                                                   
                                                      y
                                                      −
                                                      1
                                                   
                                                
                                                
                                                   (
                                                   
                                                      x
                                                      j
                                                   
                                                   =
                                                   k
                                                   )
                                                
                                                λ
                                                
                                                   ∑
                                                   
                                                      i
                                                      ∈
                                                      S
                                                      ∖
                                                      {
                                                      j
                                                      }
                                                   
                                                
                                                P
                                                
                                                   (
                                                   S
                                                   ,
                                                   i
                                                   )
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           
                        

Combining all events shows that 
                              
                                 
                                    
                                       p
                                       ^
                                    
                                    t
                                    y
                                 
                                 
                                    (
                                    
                                       x
                                       j
                                    
                                    =
                                    k
                                    )
                                 
                              
                            is equal to the stated formula for all k.□


                           
                              
                                 
                                    
                                       x
                                       ¯
                                    
                                    j
                                 
                                 
                                    (
                                    
                                    y
                                    ,
                                    t
                                    )
                                 
                              
                            is the expected number of reservations for product j in state (y, t), which is equal to

                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      x
                                                      ¯
                                                   
                                                   j
                                                
                                                
                                                   (
                                                   
                                                   y
                                                   ,
                                                   t
                                                   )
                                                
                                             
                                          
                                          
                                             
                                                =
                                                
                                                   ∑
                                                   
                                                      k
                                                      =
                                                      0
                                                   
                                                   y
                                                
                                                
                                                   p
                                                   t
                                                   y
                                                
                                                
                                                   (
                                                   
                                                      x
                                                      j
                                                   
                                                   =
                                                   k
                                                   )
                                                
                                                k
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           
                           γ(y, t) is the probability that a product is cancelled in state (y, t). This is a combination of the cancellation probabilities of individual products. The cancellation probability of product j is equal to

                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ∑
                                                   
                                                      k
                                                      =
                                                      0
                                                   
                                                   y
                                                
                                                
                                                   p
                                                   t
                                                   y
                                                
                                                
                                                   (
                                                   
                                                      x
                                                      j
                                                   
                                                   =
                                                   k
                                                   )
                                                
                                                
                                                   γ
                                                   j
                                                   t
                                                
                                                
                                                   (
                                                   k
                                                   )
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           Therefore γ(y, t) is equal to

                              
                                 
                                    
                                       
                                          
                                             
                                                γ
                                                
                                                   (
                                                   
                                                   y
                                                   ,
                                                   t
                                                   )
                                                
                                                =
                                                
                                                   ∑
                                                   
                                                      j
                                                      =
                                                      1
                                                   
                                                   n
                                                
                                                
                                                   ∑
                                                   
                                                      k
                                                      =
                                                      0
                                                   
                                                   y
                                                
                                                
                                                   p
                                                   t
                                                   y
                                                
                                                
                                                   (
                                                   
                                                      x
                                                      j
                                                   
                                                   =
                                                   k
                                                   )
                                                
                                                
                                                   γ
                                                   j
                                                   t
                                                
                                                
                                                   (
                                                   k
                                                   )
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           Moreover, under the linear and equal cancellation rates Assumption 2.3 we have that

                              
                                 
                                    
                                       
                                          
                                             
                                                γ
                                                (
                                                
                                                y
                                                ,
                                                t
                                                )
                                             
                                          
                                          
                                             
                                                =
                                                
                                                   ∑
                                                   
                                                      j
                                                      =
                                                      1
                                                   
                                                   n
                                                
                                                
                                                   γ
                                                   j
                                                   t
                                                
                                                
                                                   ∑
                                                   
                                                      k
                                                      =
                                                      0
                                                   
                                                   y
                                                
                                                
                                                   p
                                                   t
                                                   y
                                                
                                                
                                                   (
                                                   
                                                      x
                                                      j
                                                   
                                                   =
                                                   k
                                                   )
                                                
                                                k
                                                =
                                                
                                                   ∑
                                                   
                                                      j
                                                      =
                                                      1
                                                   
                                                   n
                                                
                                                
                                                   γ
                                                   j
                                                   t
                                                
                                                
                                                   
                                                      x
                                                      ¯
                                                   
                                                   j
                                                
                                                
                                                   (
                                                   
                                                   y
                                                   ,
                                                   t
                                                   )
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           
                        


                           c(y, t) are the costs of a cancellation in state (y, t). If xj
                            = k then the expected costs are rj
                           (t). The expected costs for product j are thus

                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ∑
                                                   
                                                      k
                                                      =
                                                      0
                                                   
                                                   y
                                                
                                                
                                                   p
                                                   t
                                                   y
                                                
                                                
                                                   (
                                                   
                                                      x
                                                      j
                                                   
                                                   =
                                                   k
                                                   )
                                                
                                                
                                                   γ
                                                   j
                                                   t
                                                
                                                
                                                   (
                                                   k
                                                   )
                                                
                                                
                                                   r
                                                   j
                                                
                                                
                                                   (
                                                   t
                                                   )
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           The expected costs for all products are thus

                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ∑
                                                   
                                                      j
                                                      =
                                                      1
                                                   
                                                   n
                                                
                                                
                                                   ∑
                                                   
                                                      k
                                                      =
                                                      0
                                                   
                                                   y
                                                
                                                
                                                   p
                                                   t
                                                   y
                                                
                                                
                                                   (
                                                   
                                                      x
                                                      j
                                                   
                                                   =
                                                   k
                                                   )
                                                
                                                
                                                   γ
                                                   j
                                                   t
                                                
                                                
                                                   (
                                                   k
                                                   )
                                                
                                                
                                                   r
                                                   j
                                                
                                                
                                                   (
                                                   t
                                                   )
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           If we condition to the event that a cancellation occurs in state (y, t) we see that the expected costs for a cancellation are equal to

                              
                                 
                                    
                                       
                                          
                                             
                                                c
                                                (
                                                
                                                y
                                                ,
                                                t
                                                )
                                             
                                          
                                          
                                             
                                                =
                                                
                                                   
                                                      
                                                         ∑
                                                         
                                                            j
                                                            =
                                                            1
                                                         
                                                         n
                                                      
                                                      
                                                         ∑
                                                         
                                                            k
                                                            =
                                                            0
                                                         
                                                         y
                                                      
                                                      
                                                         p
                                                         t
                                                         y
                                                      
                                                      
                                                         (
                                                         
                                                            x
                                                            j
                                                         
                                                         =
                                                         k
                                                         )
                                                      
                                                      
                                                         γ
                                                         j
                                                         t
                                                      
                                                      
                                                         (
                                                         k
                                                         )
                                                      
                                                      
                                                         r
                                                         j
                                                      
                                                      
                                                         (
                                                         t
                                                         )
                                                      
                                                   
                                                   
                                                      
                                                         ∑
                                                         
                                                            j
                                                            =
                                                            1
                                                         
                                                         n
                                                      
                                                      
                                                         ∑
                                                         
                                                            k
                                                            =
                                                            0
                                                         
                                                         y
                                                      
                                                      
                                                         p
                                                         t
                                                         y
                                                      
                                                      
                                                         (
                                                         
                                                            x
                                                            j
                                                         
                                                         =
                                                         k
                                                         )
                                                      
                                                      
                                                         γ
                                                         j
                                                         t
                                                      
                                                      
                                                         (
                                                         k
                                                         )
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                          
                                             
                                                =
                                                
                                                   
                                                      
                                                         ∑
                                                         
                                                            j
                                                            =
                                                            1
                                                         
                                                         n
                                                      
                                                      
                                                         ∑
                                                         
                                                            k
                                                            =
                                                            0
                                                         
                                                         y
                                                      
                                                      
                                                         p
                                                         t
                                                         y
                                                      
                                                      
                                                         (
                                                         
                                                            x
                                                            j
                                                         
                                                         =
                                                         k
                                                         )
                                                      
                                                      
                                                         γ
                                                         j
                                                         t
                                                      
                                                      
                                                         (
                                                         k
                                                         )
                                                      
                                                      
                                                         r
                                                         j
                                                      
                                                      
                                                         (
                                                         t
                                                         )
                                                      
                                                   
                                                   
                                                      γ
                                                      (
                                                      
                                                      y
                                                      ,
                                                      t
                                                      )
                                                   
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           Moreover, under the linear and equal cancellation rates Assumption 2.3 we have that

                              
                                 
                                    
                                       
                                          
                                             
                                                c
                                                
                                                   (
                                                   
                                                   y
                                                   ,
                                                   t
                                                   )
                                                
                                                =
                                                
                                                   
                                                      
                                                         ∑
                                                         
                                                            j
                                                            =
                                                            1
                                                         
                                                         n
                                                      
                                                      
                                                         r
                                                         j
                                                      
                                                      
                                                         (
                                                         t
                                                         )
                                                      
                                                      
                                                         γ
                                                         j
                                                         t
                                                      
                                                      
                                                         
                                                            x
                                                            ¯
                                                         
                                                         j
                                                      
                                                      
                                                         (
                                                         
                                                         y
                                                         ,
                                                         t
                                                         )
                                                      
                                                   
                                                   
                                                      γ
                                                      (
                                                      
                                                      y
                                                      ,
                                                      t
                                                      )
                                                   
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           Finally, p(y, t) is the probability that we are in state (y, t) at time t. First, we could come from state (y + 1, t + 1) and we have a cancellation. The probability that this occurs is equal to

                              
                                 
                                    
                                       
                                          
                                          
                                             
                                                p
                                                
                                                   (
                                                   
                                                   y
                                                   +
                                                   1
                                                   ,
                                                   t
                                                   +
                                                   1
                                                   )
                                                
                                                
                                                   ∑
                                                   
                                                      j
                                                      =
                                                      1
                                                   
                                                   n
                                                
                                                
                                                   ∑
                                                   
                                                      k
                                                      =
                                                      0
                                                   
                                                   
                                                      y
                                                      +
                                                      1
                                                   
                                                
                                                
                                                   p
                                                   t
                                                   
                                                      y
                                                      +
                                                      1
                                                   
                                                
                                                
                                                   (
                                                   
                                                      x
                                                      j
                                                   
                                                   =
                                                   k
                                                   )
                                                
                                                
                                                   γ
                                                   j
                                                   t
                                                
                                                
                                                   (
                                                   k
                                                   )
                                                
                                             
                                          
                                       
                                       
                                          
                                          
                                             
                                                
                                                =
                                                p
                                                (
                                                
                                                y
                                                +
                                                1
                                                ,
                                                t
                                                +
                                                1
                                                )
                                                γ
                                                (
                                                
                                                y
                                                +
                                                1
                                                ,
                                                t
                                                +
                                                1
                                                )
                                             
                                          
                                       
                                    
                                 
                              
                           Second, we could come from state (y, t + 1) and there was no event. This occurs with probability

                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   (
                                                   1
                                                   −
                                                   λ
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         S
                                                      
                                                   
                                                   
                                                      P
                                                      j
                                                   
                                                   
                                                      (
                                                      S
                                                      )
                                                   
                                                   −
                                                   γ
                                                   
                                                      (
                                                      
                                                      y
                                                      ,
                                                      t
                                                      +
                                                      1
                                                      )
                                                   
                                                   )
                                                
                                                p
                                                
                                                   (
                                                   
                                                   y
                                                   ,
                                                   t
                                                   +
                                                   1
                                                   )
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           Third, we could come from state (y − 1, t + 1) and we have a reservation. This occurs with probability

                              
                                 
                                    
                                       
                                          
                                             
                                                λ
                                                
                                                   ∑
                                                   
                                                      j
                                                      ∈
                                                      S
                                                   
                                                
                                                
                                                   P
                                                   j
                                                
                                                
                                                   (
                                                   S
                                                   )
                                                
                                                p
                                                
                                                   (
                                                   
                                                   y
                                                   −
                                                   1
                                                   ,
                                                   t
                                                   +
                                                   1
                                                   )
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           Combined this gives

                              
                                 
                                    
                                       
                                          
                                             
                                                p
                                                (
                                                
                                                y
                                                ,
                                                t
                                                )
                                             
                                          
                                          
                                             
                                                =
                                                p
                                                
                                                   (
                                                   
                                                   y
                                                   +
                                                   1
                                                   ,
                                                   t
                                                   +
                                                   1
                                                   )
                                                
                                                γ
                                                
                                                   (
                                                   
                                                   y
                                                   +
                                                   1
                                                   ,
                                                   t
                                                   +
                                                   1
                                                   )
                                                
                                                +
                                                λ
                                                
                                                   ∑
                                                   
                                                      j
                                                      ∈
                                                      S
                                                   
                                                
                                                
                                                   P
                                                   j
                                                
                                                
                                                   (
                                                   S
                                                   )
                                                
                                                p
                                                
                                                   (
                                                   
                                                   y
                                                   −
                                                   1
                                                   ,
                                                   t
                                                   +
                                                   1
                                                   )
                                                
                                             
                                          
                                       
                                       
                                          
                                          
                                             
                                                
                                                +
                                                
                                                   (
                                                   1
                                                   −
                                                   λ
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         S
                                                      
                                                   
                                                   
                                                      P
                                                      j
                                                   
                                                   
                                                      (
                                                      S
                                                      )
                                                   
                                                   −
                                                   γ
                                                   
                                                      (
                                                      
                                                      y
                                                      ,
                                                      t
                                                      +
                                                      1
                                                      )
                                                   
                                                   )
                                                
                                                p
                                                
                                                   (
                                                   
                                                   y
                                                   ,
                                                   t
                                                   +
                                                   1
                                                   )
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           
                           □

The multinomial logit model (MNL) is a method to describe a discrete probability distribution, given a set of independent variables. It is commonly used to predict the outcome of statistical classification problems, such as political elections (see for example Dow & Endersby, 2004).

Assume that customers can choose among n products and the no-purchase alternative. Each product j provides a utility Uj
                         for each customer, i.e., the value of product j to the customer. The no-purchase alternative provides a utility U
                        0. Each customer chooses alternative j ∈ N∪{0} such that his utility is maximised. The MNL assumes that the utilities are random variables of the form

                           
                              
                                 
                                    
                                       
                                          
                                             
                                                U
                                                j
                                             
                                             =
                                             
                                                u
                                                j
                                             
                                             +
                                             
                                                ξ
                                                j
                                             
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        where uj
                         is the expected value of Uj
                         and ξj
                         is a random draw from the Gumbel distribution
                           2
                        
                        
                           2
                           The cumulative distribution function of the Gumbel distribution is given by

                                 
                                    
                                       
                                          F
                                          
                                             (
                                             x
                                             |
                                             μ
                                             ,
                                             β
                                             )
                                          
                                          =
                                          
                                             e
                                             
                                                −
                                                
                                                   e
                                                   
                                                      −
                                                      (
                                                      x
                                                      −
                                                      μ
                                                      )
                                                      /
                                                      β
                                                   
                                                
                                             
                                          
                                          ,
                                       
                                    
                                 
                              where μ is called the location and β is called the scale parameter. The expected value is equal to μ + γβ, where γ ≈ 0.5772 is Euler’s constant.
                         with location equal to Euler’s constant and scale equal to one, such that the expected value is zero. Under these assumptions it can be shown (see Ben-Akiva & Lerman, 1985) that the choice probabilities are equal to

                           
                              
                                 
                                    
                                       
                                          
                                             
                                                P
                                                j
                                             
                                             
                                                (
                                                S
                                                )
                                             
                                             =
                                             
                                                
                                                   e
                                                   
                                                      u
                                                      j
                                                   
                                                
                                                
                                                   
                                                      ∑
                                                      
                                                         i
                                                         ∈
                                                         S
                                                      
                                                   
                                                   
                                                      e
                                                      
                                                         u
                                                         i
                                                      
                                                   
                                                   +
                                                   
                                                      e
                                                      
                                                         u
                                                         0
                                                      
                                                   
                                                
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        The mean utility uj
                         of a product or the no-purchase option depends on 
                           
                              k
                              ∈
                              N
                           
                         different attributes. The values of the attributes are stored in the k-dimensional vector Zj
                        . The corresponding weights of each attribute are stored in the k-dimensional vector β. Hence the mean utility uj
                         for product j is given by

                           
                              
                                 
                                    
                                       
                                          
                                             
                                                u
                                                j
                                             
                                             =
                                             
                                                β
                                                ⊤
                                             
                                             
                                                Z
                                                j
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Suppose that we have complete knowledge on arrivals, purchases and no-purchases, offer sets, and cancellations. Then we can estimate the parameters in the following way. Define aλ
                        (t), {aj
                        (t)}
                           j ∈ N
                        , and a(t) by

                           
                              
                                 
                                    
                                       
                                          
                                             
                                                a
                                                λ
                                             
                                             
                                                (
                                                t
                                                )
                                             
                                          
                                       
                                       
                                          
                                             =
                                             
                                                {
                                                
                                                   
                                                      
                                                         1
                                                      
                                                      
                                                         
                                                            arrival
                                                            
                                                            at
                                                            
                                                            time
                                                            
                                                            t
                                                            ,
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         0
                                                      
                                                      
                                                         
                                                            otherwise
                                                            .
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             a
                                             (
                                             t
                                             )
                                          
                                       
                                       
                                          
                                             =
                                             
                                                {
                                                
                                                   
                                                      
                                                         1
                                                      
                                                      
                                                         
                                                            no
                                                            
                                                            arrival
                                                            
                                                            or
                                                            
                                                            cancellation
                                                            
                                                            at
                                                            
                                                            time
                                                            
                                                            t
                                                            ,
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         0
                                                      
                                                      
                                                         
                                                            otherwise
                                                            .
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                a
                                                j
                                             
                                             
                                                (
                                                t
                                                )
                                             
                                          
                                       
                                       
                                          
                                             =
                                             
                                                {
                                                
                                                   
                                                      
                                                         1
                                                      
                                                      
                                                         
                                                            product
                                                            
                                                            j
                                                            
                                                            cancelled
                                                            
                                                            at
                                                            
                                                            time
                                                            
                                                            t
                                                            ,
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         0
                                                      
                                                      
                                                         
                                                            otherwise
                                                            .
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             =
                                             
                                                (
                                                1
                                                −
                                                
                                                   a
                                                   
                                                      λ
                                                      (
                                                      t
                                                      )
                                                   
                                                
                                                )
                                             
                                             
                                                ∏
                                                
                                                   j
                                                   ∈
                                                   N
                                                
                                             
                                             
                                                (
                                                1
                                                −
                                                
                                                   a
                                                   j
                                                
                                                
                                                   (
                                                   t
                                                   )
                                                
                                                )
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        The parameters defined above are indicators to specify which event happened in time period t. Note that exactly one indicator is equal to 1 at time t and that this is in agreement with the assumption that only one event happens in each time period. In order to ensure a unique solution we set α = 0 for convenience. Let j(t) be the product that is purchased at time t under the condition that a customer arrived and j(t) = 0 if we observed an arrival but no purchase. Then λP
                        
                           tj(t)(0, β, St, Zt
                        ) is the probability that j(t) is purchased at time t, or the probability that a customer arrived and purchased nothing if j(t) = 0. If product j was cancelled at time t then the probability that this occurs is γj
                        (xj
                        ). If no event took place this occurs with probability 1 − λ − ∑
                           j ∈ N
                        
                        γj
                        (xj
                        ). Let D be the set of time periods. Then the likelihood function L is given by

                           
                              
                                 
                                    
                                       
                                          
                                             L
                                             (
                                             
                                             β
                                             ,
                                             γ
                                             ,
                                             λ
                                             |
                                             a
                                             ,
                                             x
                                             ,
                                             
                                                S
                                                t
                                             
                                             ,
                                             
                                                Z
                                                t
                                             
                                             )
                                             =
                                          
                                       
                                       
                                          
                                             
                                                ∏
                                                
                                                   t
                                                   ∈
                                                   D
                                                
                                             
                                             
                                                
                                                   [
                                                   λ
                                                   
                                                      P
                                                      
                                                         t
                                                         j
                                                         (
                                                         t
                                                         )
                                                      
                                                   
                                                   
                                                      (
                                                      0
                                                      ,
                                                      β
                                                      ,
                                                      
                                                         S
                                                         t
                                                      
                                                      ,
                                                      
                                                         Z
                                                         t
                                                      
                                                      )
                                                   
                                                   ]
                                                
                                                
                                                   
                                                      a
                                                      λ
                                                   
                                                   
                                                      (
                                                      t
                                                      )
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             ×
                                             
                                             
                                                ∏
                                                
                                                   j
                                                   ∈
                                                   N
                                                
                                             
                                             
                                                γ
                                                j
                                             
                                             
                                                
                                                   (
                                                   
                                                      x
                                                      j
                                                   
                                                   )
                                                
                                                
                                                   
                                                      a
                                                      j
                                                   
                                                   
                                                      (
                                                      t
                                                      )
                                                   
                                                
                                             
                                             ·
                                             
                                                
                                                   [
                                                   1
                                                   −
                                                   λ
                                                   −
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         N
                                                      
                                                   
                                                   
                                                      γ
                                                      j
                                                   
                                                   
                                                      (
                                                      
                                                         x
                                                         j
                                                      
                                                      )
                                                   
                                                   ]
                                                
                                                
                                                   a
                                                   (
                                                   t
                                                   )
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        The log-likelihood function LL is then

                           
                              
                                 
                                    
                                       
                                       
                                          
                                             L
                                             L
                                             (
                                             β
                                             ,
                                             γ
                                             ,
                                             λ
                                             |
                                             a
                                             ,
                                             x
                                             ,
                                             
                                                S
                                                t
                                             
                                             ,
                                             
                                                Z
                                                t
                                             
                                             )
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             =
                                             log
                                             
                                                (
                                                L
                                                )
                                             
                                             =
                                             
                                                ∑
                                                
                                                   t
                                                   ∈
                                                   D
                                                
                                             
                                             [
                                             
                                                a
                                                λ
                                             
                                             
                                                (
                                                t
                                                )
                                             
                                             log
                                             
                                                (
                                                
                                                   P
                                                   
                                                      t
                                                      j
                                                      (
                                                      t
                                                      )
                                                   
                                                
                                                
                                                   (
                                                   α
                                                   ,
                                                   β
                                                   ,
                                                   
                                                      S
                                                      t
                                                   
                                                   ,
                                                   
                                                      Z
                                                      t
                                                   
                                                   )
                                                
                                                )
                                             
                                             +
                                             
                                                a
                                                λ
                                             
                                             
                                                (
                                                t
                                                )
                                             
                                             log
                                             
                                                (
                                                λ
                                                )
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             +
                                             
                                                ∑
                                                
                                                   j
                                                   ∈
                                                   N
                                                
                                             
                                             
                                                a
                                                j
                                             
                                             
                                                (
                                                t
                                                )
                                             
                                             log
                                             
                                                (
                                                
                                                   γ
                                                   j
                                                
                                                
                                                   (
                                                   
                                                      x
                                                      j
                                                   
                                                   )
                                                
                                                )
                                             
                                             +
                                             a
                                             
                                                (
                                                t
                                                )
                                             
                                             log
                                             
                                                (
                                                1
                                                −
                                                λ
                                                −
                                                
                                                   ∑
                                                   
                                                      j
                                                      ∈
                                                      N
                                                   
                                                
                                                
                                                   γ
                                                   j
                                                
                                                
                                                   (
                                                   
                                                      x
                                                      j
                                                   
                                                   )
                                                
                                                )
                                             
                                             ]
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        Note that LL is separable in β and (γ, λ). Maximising the separated log-likelihood functions with respect to β and (γ, λ) gives estimates 
                           
                              β
                              ^
                           
                         and 
                           
                              (
                              
                                 γ
                                 ^
                              
                              ,
                              
                                 λ
                                 ^
                              
                              )
                              ,
                           
                         respectively.

Suppose we can not observe the event that a customer arrives but does not make a purchase. Then we do not know the values of aλ
                        (t) and a(t). One way to overcome this problem is to apply the well known expectation maximisation algorithm (see Dempster, Laird, & Rubin, 1977). Define 
                           P
                         as the set of time periods where a purchase is observed and 
                           
                              C
                              j
                           
                         the set of time periods where a cancellation for product j is observed. Then we can rewrite LL to

                           
                              
                                 
                                    
                                       
                                          
                                             L
                                             L
                                             (
                                             β
                                             ,
                                             γ
                                             ,
                                             λ
                                             |
                                             x
                                             ,
                                             
                                                S
                                                t
                                             
                                             ,
                                             
                                                Z
                                                t
                                             
                                             )
                                          
                                       
                                       
                                          
                                             =
                                             
                                                ∑
                                                
                                                   t
                                                   ∈
                                                   P
                                                
                                             
                                             
                                                [
                                                log
                                                
                                                   (
                                                   λ
                                                   )
                                                
                                                +
                                                log
                                                
                                                   (
                                                   
                                                      P
                                                      
                                                         t
                                                         j
                                                         (
                                                         t
                                                         )
                                                      
                                                   
                                                   
                                                      (
                                                      0
                                                      ,
                                                      β
                                                      ,
                                                      
                                                         S
                                                         t
                                                      
                                                      ,
                                                      
                                                         Z
                                                         t
                                                      
                                                      )
                                                   
                                                   )
                                                
                                                ]
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                             +
                                             
                                                ∑
                                                
                                                   j
                                                   ∈
                                                   N
                                                
                                             
                                             
                                                ∑
                                                
                                                   t
                                                   ∈
                                                   
                                                      C
                                                      j
                                                   
                                                
                                             
                                             log
                                             
                                                (
                                                
                                                   γ
                                                   j
                                                
                                                
                                                   (
                                                   
                                                      x
                                                      j
                                                   
                                                   )
                                                
                                                )
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                             +
                                             
                                                ∑
                                                
                                                   t
                                                   ∉
                                                   P
                                                   ,
                                                   t
                                                   ∉
                                                   
                                                      C
                                                      j
                                                   
                                                
                                             
                                             log
                                             
                                                (
                                                1
                                                −
                                                λ
                                                −
                                                
                                                   ∑
                                                   
                                                      j
                                                      ∈
                                                      N
                                                   
                                                
                                                
                                                   γ
                                                   j
                                                
                                                
                                                   (
                                                   
                                                      x
                                                      j
                                                   
                                                   )
                                                
                                                )
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                             +
                                             
                                                a
                                                λ
                                             
                                             
                                                (
                                                t
                                                )
                                             
                                             
                                                [
                                                
                                                   
                                                      
                                                         ∑
                                                         
                                                            j
                                                            ∈
                                                            N
                                                         
                                                      
                                                   
                                                
                                                log
                                                
                                                   (
                                                   λ
                                                   )
                                                
                                                +
                                                log
                                                
                                                   (
                                                   
                                                      P
                                                      
                                                         t
                                                         0
                                                      
                                                   
                                                   
                                                      (
                                                      0
                                                      ,
                                                      β
                                                      ,
                                                      
                                                         S
                                                         t
                                                      
                                                      ,
                                                      
                                                         Z
                                                         t
                                                      
                                                      )
                                                   
                                                   )
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                             
                                                −
                                                log
                                                
                                                   (
                                                   1
                                                   −
                                                   λ
                                                   −
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         N
                                                      
                                                   
                                                   
                                                      γ
                                                      j
                                                   
                                                   
                                                      (
                                                      
                                                         x
                                                         j
                                                      
                                                      )
                                                   
                                                   )
                                                
                                                ]
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        We know the values for aλ
                        (t) for 
                           
                              t
                              ∈
                              P
                           
                         and 
                           
                              t
                              ∈
                              
                                 C
                                 j
                              
                           
                         for all j. However, we do not know the values for aλ
                        (t) for t ∉ P and 
                           
                              t
                              ∉
                              
                                 C
                                 j
                              
                           
                         for all j. If we have estimates 
                           
                              
                                 β
                                 ^
                              
                              ,
                           
                        
                        
                           
                              
                                 γ
                                 ^
                              
                              ,
                           
                         and 
                           
                              λ
                              ^
                           
                         we can use Bayes theorem to calculate 
                           
                              
                                 
                                    a
                                    ^
                                 
                                 λ
                              
                              
                                 (
                                 t
                                 )
                              
                           
                         (similar to Talluri & van Ryzin, 2004):

                           
                              (B.1)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   a
                                                   ^
                                                
                                                λ
                                             
                                             
                                                (
                                                t
                                                )
                                             
                                          
                                       
                                       
                                          
                                             =
                                             E
                                             [
                                             
                                                a
                                                λ
                                             
                                             
                                                (
                                                t
                                                )
                                             
                                             |
                                             t
                                             ∉
                                             P
                                             ,
                                             t
                                             ∉
                                             
                                                C
                                                j
                                             
                                             ,
                                             
                                                β
                                                ^
                                             
                                             ,
                                             
                                                λ
                                                ^
                                             
                                             ,
                                             
                                                γ
                                                ^
                                             
                                             ]
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             =
                                             P
                                             [
                                             
                                                a
                                                λ
                                             
                                             
                                                (
                                                t
                                                )
                                             
                                             =
                                             1
                                             |
                                             t
                                             ∉
                                             P
                                             ,
                                             t
                                             ∉
                                             
                                                C
                                                j
                                             
                                             ,
                                             
                                                β
                                                ^
                                             
                                             ,
                                             
                                                λ
                                                ^
                                             
                                             ,
                                             
                                                γ
                                                ^
                                             
                                             ]
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             =
                                             
                                                
                                                   P
                                                   
                                                      [
                                                      t
                                                      ∉
                                                      P
                                                      ,
                                                      t
                                                      ∉
                                                      
                                                         C
                                                         j
                                                      
                                                      |
                                                      
                                                         a
                                                         λ
                                                      
                                                      
                                                         (
                                                         t
                                                         )
                                                      
                                                      =
                                                      1
                                                      ,
                                                      
                                                         λ
                                                         ^
                                                      
                                                      ,
                                                      
                                                         β
                                                         ^
                                                      
                                                      ,
                                                      
                                                         γ
                                                         ^
                                                      
                                                      ]
                                                   
                                                   ·
                                                   P
                                                   
                                                      [
                                                      
                                                         a
                                                         λ
                                                      
                                                      
                                                         (
                                                         t
                                                         )
                                                      
                                                      =
                                                      1
                                                      |
                                                      
                                                         λ
                                                         ^
                                                      
                                                      ,
                                                      
                                                         β
                                                         ^
                                                      
                                                      ,
                                                      
                                                         γ
                                                         ^
                                                      
                                                      ]
                                                   
                                                
                                                
                                                   P
                                                   [
                                                   t
                                                   ∉
                                                   P
                                                   ,
                                                   t
                                                   ∉
                                                   
                                                      C
                                                      j
                                                   
                                                   |
                                                   
                                                      λ
                                                      ^
                                                   
                                                   ,
                                                   
                                                      β
                                                      ^
                                                   
                                                   ,
                                                   
                                                      γ
                                                      ^
                                                   
                                                   ]
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             =
                                             
                                                
                                                   
                                                      P
                                                      
                                                         t
                                                         0
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         0
                                                         ^
                                                      
                                                      ,
                                                      
                                                         β
                                                         ^
                                                      
                                                      ,
                                                      
                                                         S
                                                         t
                                                      
                                                      ,
                                                      
                                                         Z
                                                         t
                                                      
                                                      )
                                                   
                                                   ·
                                                   
                                                      λ
                                                      ^
                                                   
                                                
                                                
                                                   1
                                                   −
                                                   
                                                      λ
                                                      ^
                                                   
                                                   
                                                      P
                                                      
                                                         t
                                                         *
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         0
                                                         ^
                                                      
                                                      ,
                                                      
                                                         β
                                                         ^
                                                      
                                                      ,
                                                      
                                                         S
                                                         t
                                                      
                                                      ,
                                                      Z
                                                      )
                                                   
                                                   −
                                                   
                                                      ∑
                                                      
                                                         j
                                                         ∈
                                                         N
                                                      
                                                   
                                                   
                                                      
                                                         γ
                                                         ^
                                                      
                                                      j
                                                   
                                                   
                                                      (
                                                      
                                                         x
                                                         j
                                                      
                                                      )
                                                   
                                                
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        With 
                           
                              
                                 a
                                 ^
                              
                              λ
                           
                         we can approximate a(t) by

                           
                              
                                 
                                    
                                       
                                          
                                             
                                                a
                                                ^
                                             
                                             
                                                (
                                                t
                                                )
                                             
                                          
                                       
                                       
                                          
                                             =
                                             
                                                (
                                                1
                                                −
                                                
                                                   
                                                      a
                                                      ^
                                                   
                                                   λ
                                                
                                                
                                                   (
                                                   t
                                                   )
                                                
                                                )
                                             
                                             
                                                ∏
                                                
                                                   j
                                                   ∈
                                                   N
                                                
                                             
                                             
                                                (
                                                1
                                                −
                                                
                                                   a
                                                   j
                                                
                                                
                                                   (
                                                   t
                                                   )
                                                
                                                )
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             =
                                             
                                                {
                                                
                                                   
                                                      
                                                         0
                                                      
                                                      
                                                         
                                                            if
                                                            
                                                            a
                                                            
                                                            product
                                                            
                                                            was
                                                            
                                                            cancelled
                                                            
                                                            in
                                                            
                                                            time
                                                            
                                                            period
                                                            
                                                            t
                                                            ,
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            1
                                                            −
                                                            
                                                               
                                                                  a
                                                                  ^
                                                               
                                                               λ
                                                            
                                                            
                                                               (
                                                               t
                                                               )
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            otherwise
                                                            .
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        Under 
                           
                              
                                 
                                    a
                                    ^
                                 
                                 λ
                              
                              
                                 (
                                 t
                                 )
                              
                           
                         the expected log-likelihood function is

                           
                              (B.2)
                              
                                 
                                    
                                       
                                          
                                             E
                                             [
                                             L
                                             L
                                             |
                                             
                                                β
                                                ^
                                             
                                             ,
                                             
                                                λ
                                                ^
                                             
                                             ,
                                             
                                                γ
                                                ^
                                             
                                             ]
                                          
                                       
                                       
                                          
                                             =
                                             
                                                ∑
                                                
                                                   t
                                                   ∈
                                                   P
                                                
                                             
                                             [
                                             log
                                             
                                                (
                                                λ
                                                )
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                             +
                                             log
                                             
                                                (
                                                
                                                   P
                                                   
                                                      t
                                                      j
                                                      (
                                                      t
                                                      )
                                                   
                                                
                                                
                                                   (
                                                   β
                                                   ,
                                                   Z
                                                   ,
                                                   
                                                      S
                                                      t
                                                   
                                                   )
                                                
                                                )
                                             
                                             ]
                                             +
                                             
                                                ∑
                                                
                                                   j
                                                   ∈
                                                   N
                                                
                                             
                                             
                                                ∑
                                                
                                                   t
                                                   ∈
                                                   
                                                      C
                                                      j
                                                   
                                                
                                             
                                             log
                                             
                                                (
                                                
                                                   γ
                                                   j
                                                
                                                
                                                   (
                                                   
                                                      x
                                                      j
                                                   
                                                   )
                                                
                                                )
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                             +
                                             
                                                ∑
                                                
                                                   t
                                                   ∉
                                                   P
                                                   ,
                                                   t
                                                   ∉
                                                   
                                                      C
                                                      j
                                                   
                                                
                                             
                                             log
                                             
                                                (
                                                1
                                                −
                                                λ
                                                −
                                                
                                                   ∑
                                                   
                                                      j
                                                      ∈
                                                      N
                                                   
                                                
                                                
                                                   γ
                                                   j
                                                
                                                
                                                   (
                                                   
                                                      x
                                                      j
                                                   
                                                   )
                                                
                                                )
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                             +
                                             
                                                
                                                   a
                                                   ^
                                                
                                                λ
                                             
                                             
                                                (
                                                t
                                                )
                                             
                                             [
                                             log
                                             
                                                (
                                                λ
                                                )
                                             
                                             +
                                             log
                                             
                                                (
                                                
                                                   P
                                                   
                                                      t
                                                      0
                                                   
                                                
                                                
                                                   (
                                                   β
                                                   ,
                                                   Z
                                                   ,
                                                   
                                                      S
                                                      t
                                                   
                                                   )
                                                
                                                )
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                             −
                                             log
                                             
                                                (
                                                1
                                                −
                                                λ
                                                −
                                                
                                                   ∑
                                                   
                                                      j
                                                      ∈
                                                      N
                                                   
                                                
                                                
                                                   γ
                                                   j
                                                
                                                
                                                   (
                                                   
                                                      x
                                                      j
                                                   
                                                   )
                                                
                                                )
                                             
                                             ]
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        Maximising this function with respect to (β, λ, γ) gives new estimates 
                           
                              (
                              
                                 β
                                 ^
                              
                              ,
                              
                                 λ
                                 ^
                              
                              ,
                              
                                 γ
                                 ^
                              
                              )
                           
                        . These values in turn can be used to find a new estimate 
                           
                              
                                 
                                    a
                                    ^
                                 
                                 λ
                              
                              
                                 (
                                 t
                                 )
                              
                              ,
                           
                         etc. The algorithm is summarised in Algorithm B.1.

                           Algorithm B.1
                           
                              Expectation-maximisation
                              
                                 
                                    1.
                                    
                                       Start with initial parameters
                                       
                                          
                                             (
                                             
                                                λ
                                                ^
                                             
                                             ,
                                             
                                                β
                                                ^
                                             
                                             ,
                                             
                                                γ
                                                ^
                                             
                                             )
                                          
                                       .


                                       Expectation estimate
                                       
                                          
                                             
                                                
                                                   a
                                                   ^
                                                
                                                λ
                                             
                                             
                                                (
                                                t
                                                )
                                             
                                          
                                        
                                       using (
                                       
                                          Eq. B.1
                                       
                                       ).
                                    


                                       Maximisation estimate
                                       
                                          
                                             (
                                             
                                                λ
                                                ^
                                             
                                             ,
                                             
                                                β
                                                ^
                                             
                                             ,
                                             
                                                γ
                                                ^
                                             
                                             )
                                          
                                        
                                       using
                                       
                                          
                                             
                                                
                                                   a
                                                   ^
                                                
                                                λ
                                             
                                             
                                                (
                                                t
                                                )
                                             
                                          
                                        
                                       and (
                                       
                                          Eq. B.2
                                       
                                       ).
                                    


                                       Go to step 2 unless we hit a stopping criterion.
                                    

@&#REFERENCES@&#

