@&#MAIN-TITLE@&#A matheuristic approach for the Pollution-Routing Problem

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           We introduce an efficient matheuristic algorithm for the Pollution-Routing Problem.


                        
                        
                           
                           Two new sets of instances were proposed.


                        
                        
                           
                           New improved solutions are reported.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Combinatorial optimization

Green logistics

Vehicle routing

Time windows

Speed optimization

@&#ABSTRACT@&#


               
               
                  This paper deals with the Pollution-Routing Problem (PRP), a Vehicle Routing Problem (VRP) with environmental considerations, recently introduced in the literature by Bektaş and Laporte (2011) [Transportation Research Part B: Methodological 45 (8), 1232–1250]. The objective is to minimize operational and environmental costs while respecting capacity constraints and service time windows. Costs are based on driver wages and fuel consumption, which depends on many factors, such as travel distance and vehicle load. The vehicle speeds are considered as decision variables. They complement routing decisions, impacting the total cost, the travel time between locations, and thus the set of feasible routes. We propose a method which combines a local search-based metaheuristic with an integer programming approach over a set covering formulation and a recursive speed-optimization algorithm. This hybridization enables to integrate more tightly route and speed decisions. Moreover, two other “green” VRP variants, the Fuel Consumption VRP (FCVRP) and the Energy Minimizing VRP (EMVRP), are addressed, as well as the VRP with time windows (VRPTW) with distance minimization. The proposed method compares very favorably with previous algorithms from the literature, and new improved solutions are reported for all considered problems.
               
            

@&#INTRODUCTION@&#

The Vehicle Routing Problem (VRP) and its variants have been the subject of considerable research efforts in the past year, mostly due to the growing number of additional constraints and objectives arising from real-world applications (Vidal, Crainic, Gendreau, and Prins, 2013a). Given the growing global concern about environmental issues, VRPs have recently started to incorporate “green” aspects such as pollution and alternative fuels, among others (see, e.g., the recent review of Lin, Choy, Ho, Chung, and Lam 2014 on VRPs with environmental issues).

Environmental costs due to greenhouse gas (GHG) emissions are not usually paid directly by the companies. Nevertheless, some countries are developing emissions trading schemes (e.g., the European Union Emissions Trading System) to make the companies responsible for their environmental impacts. The trend is that more and more countries will start to adopt emission-reducing actions, enhancing the importance of VRPs with environmental considerations. Furthermore, CO2 is the most prominent transportation GHG, and its emission is closely related to fuel consumption (ICF, 2006).

In this work we turn our attention to the Pollution-Routing Problem (PRP), recently introduced by Bektaş and Laporte (2011). This problem seeks to jointly optimize travel itinerary and speed subject to time constraints, and thus poses significant methodological challenges due to the combination of two intricate sets of decisions. The PRP is 
                        NP
                     -hard since it includes the VRP with Time Windows (VRPTW) as a particular case, and most current exact procedures cannot address problems of practical sizes. A recent metaheuristic (Demir, Bektaş, and Laporte, 2012) has thus been proposed for the problem. This method is sequential, in the sense that routing decision variables are first optimized by solving a VRP with some fixed initial speeds and time windows, and speed optimization is only done during a post-optimization procedure. As highlighted by our computational experiments, this kind of approach may in some cases lead to solutions of lower quality.

To cope with this significant challenge, this paper introduces a new hybrid Iterated Local Search (ILS) for the PRP, specially designed to address the two families of decisions variables by means of adaptive travel time matrices, new tailored perturbation mechanisms and a Speed Optimization Algorithm (SOA) used at very specific steps of the search. This ILS follows the general structure of Subramanian, Penna, Uchoa, and Ochi (2012) and Subramanian, Uchoa, and Ochi (2013), and thus includes a further improvement procedure based on integer programming over a Set Partitioning (SP) formulation. Move evaluations are performed in amortized 
                        
                           O
                           (
                           1
                           )
                        
                      time by means of efficient incremental move evaluation procedures, and some infeasible solutions are used during shaking. Beyond its contribution on a key routing application, this paper proposes a methodology to jointly optimize both decision sets without necessarily relying on a systematic speed optimization during all move evaluations.

Extensive computational experiments demonstrate the high performance of the method on the existing PRP benchmark instances, characterized by large time windows, as well as on newer difficult instances with tighter time windows. We also consider a wider scope of application, demonstrating how two other “green” vehicle routing problems, the Fuel Consumption Vehicle Routing Problem (FCVRP; Xiao, Zhao, Kaku, and Xu, 2012) and the Energy Minimizing Vehicle Routing Problem (EMVRP; Kara, Kara, and Yetis, 2007) can be viewed as specific PRP instances. As a proof of concept, the proposed method is also tested on these problems, and on the VRPTW, leading to new state-of-the-art results.

The remainder of this paper is organized as follows. Section 2 presents some works that integrate VRPs with environmental aspects. Section 3 formally defines the PRP, EMVRP and FCVRP. Section 4 describes the proposed approach. Computational results are provided in Section 5, while Section 6 concludes.


                     Palmer (2007) was the first to incorporate environmental issues to the VRP. Different from the previous works that estimated the environmental costs based on the total duration or distance of the routes, the author considered other issues such as road topography, congestion and vehicle speeds to generate a CO2 emissions matrix. Experiments suggested that the CO2 minimization model compared with the distance-minimizing and duration-minimizing models led to a CO2 reduction of 5.20 percent and 5.02 percent, respectively, on average.

Later on, Kara et al. (2007) proposed a mathematical formulation for the so-called Energy Minimizing Vehicle Routing Problem (EMVRP), which aims at minimizing the sum of the product between load and distance for each arc. Similar approaches, i.e., those that make use of the vehicle load to minimize the fuel consumption or CO2 emissions, were presented by Peng and Wang (2009), Scott, Urquhart, and Hart (2010), Ubeda, Arcelus, and Faulin (2011) and Xiao et al. (2012). The latter introduced the Fuel Consumption Vehicle Routing Problem (FCVRP). Kara, Kara, and Yetis (2008) presented a VRP with cumulative costs, which generalizes the EMVRP as well as the Minimum Latency Problem and the m-Traveling Repairman Problem. Kopfer, Schnberger, and Kopfer (2014) took the load into account for CO2 emissions evaluations in the presence of heterogeneous vehicle types.

Minimizing the fuel consumption considering only the load and distance can be insufficient since the travel speed plays a major role. This speed is directly affected by the road congestion. In view of this, Kuo (2010) proposed a model for minimizing the total fuel consumption where the speeds are time-dependent and the load is used to estimate the cost. A Simulated Annealing algorithm was implemented to solve a set of instances from the Solomon benchmark (Solomon, 1987). Later, Kuo and Wang (2011) devised a Tabu Search algorithm for the same problem. Other time-dependent problems with emission minimization can be found in Figliozzi (2011), Saberi and Verbas (2012) and Jabali, Van Woensel, and de Kok (2012), and many other references relevant to green logistics are mentioned in the surveys of Dekker, Bloemhof, and Mallidis (2012), Salimifard, Shahbandarzadeh, and Raeesi (2012), Lin et al. (2014) and Demir, Bektaş, and Laporte (2014b).


                     Bektaş and Laporte (2011) proposed the Pollution-Routing Problem (PRP), which seeks to minimize both operational and environmental costs, taking into account the customers time-window constraints. The total travel distance, the amount of load carried per distance unit, the vehicle speeds and the duration of the routes are the main cost components. Three different variants were also presented, considering either distance, weighted load and energy minimization. The authors performed an extensive experimental analysis to capture the trade-off between each variation, as well as the effect of the speed and time-window constraints on the distance, energy and costs.

The PRP was addressed with a two-phase heuristic in Demir et al. (2012). In the first phase, the VRPTW is solved by means of an Adaptive Large Neighborhood Search (ALNS), including five insertion operators and twelve removal operators. In a second phase, vehicle speeds are optimized using a recursive algorithm. Computational experiments were carried out for instances with up to 200 customers. Other recent developments consider generalizations of the problem. A bi-objective variant considering fuel and driving time minimization is presented in Demir, Bektaş, and Laporte (2014a), and Franceschetti, Honhon, van Woensel, Bektaş, and Laporte (2013) consider the time-dependent PRP.

It should be noted that several aspects of the PRP are conflicting. Higher speeds imply routes with shorter durations, but at the same time result in a larger amount of emissions and vice-versa. Hence, to reduce pollution, speed on arcs may be decreased to be closer to the speed which minimizes emissions. Yet with lower speed, the set of feasible VRP routes may be empty or drastically smaller. As a consequence, an optimal solution of the reduced speed VRP can have longer distance and even more emissions in some cases. One main goal of our study was to better integrate route and speed decisions in order to find quickly a suitable balance between these antagonist aspects.

The PRP can be defined as follows. Let 
                        
                           G
                           =
                           (
                           V
                           ,
                           A
                           )
                        
                      be a complete and directed graph with a set 
                        
                           V
                           =
                           {
                           0
                           ,
                           1
                           ,
                           2
                           ,
                           …
                           ,
                           n
                           }
                        
                      of vertices and a set 
                        
                           A
                           =
                           {
                           
                              (
                              i
                              ,
                              j
                              )
                           
                           ∈
                           
                              V
                              2
                           
                           ,
                           i
                           ≠
                           j
                           }
                        
                      of arcs. Vertex 0 represents the depot where a fleet of m identical vehicles with capacity Q is based. Vertices 
                        
                           V
                           −
                           {
                           0
                           }
                        
                      correspond to customers, characterized by a non-negative demand qi
                      for a single product, a service time τi
                      and a specified time-window interval [ai, bi
                     ] for service. We assume that q
                     0 = 0 and τ
                     0 = 0. Each arc 
                        
                           (
                           i
                           ,
                           j
                           )
                           ∈
                           A
                        
                      represents a travel possibility from node i to j for a distance dij
                     .

A particularity of the PRP is that the speed vij
                      on each (i, j) is itself a decision variable, valued between 
                        
                           [
                           
                              v
                              m
                           
                           i
                           n
                           ,
                           
                              v
                              m
                           
                           a
                           x
                           ]
                        
                     . Indeed, each vehicle emits on a certain amount of GHG which depends of weight and speed, among other factors. The PRP aims to find a speed matrix (v)
                        ij
                      and a set of routes R (such that |R| ≤ m) to serve all customers while minimizing environmental and operational costs. Each route 
                        σ
                      ∈ R, σ
                      = (σ
                     1, …, σ
                     |σ|) starts and ends at the depot, i.e., σ
                     1 = 0 and σ
                     |σ| = 0, the total demand on each route should not exceed the vehicle capacity, and every customer must be visited within its time window.

Let 
                        
                           f
                           
                              
                                 σ
                                 i
                              
                              
                                 σ
                                 
                                    i
                                    +
                                    1
                                 
                              
                           
                        
                      be the vehicle load on a route 
                        σ
                      when traveling on arc (σi, σ
                     
                        i + 1). Let 
                        
                           t
                           
                              σ
                              i
                           
                        
                      be the arrival time at customer σi
                      knowing that each route starts at time zero, an early arrival to a customer i is permitted but triggers a waiting time to reach the start of the time window ai
                     , finally a late arrival is not permitted. The fuel consumption function presented in Bektaş and Laporte (2011) can be rewritten as Equation (1), where w
                     1, w
                     2, w
                     3, w
                     4 are parameters based on fuel properties, vehicle and network characteristics (Appendix A). Considering both the fuel consumption and the driving costs, the overall objective of the PRP is given in Equation (2).
                     
                        
                           (1)
                           
                              
                                 
                                    F
                                    
                                       
                                          σ
                                          i
                                       
                                       
                                          σ
                                          
                                             i
                                             +
                                             1
                                          
                                       
                                    
                                    f
                                 
                                 
                                    (
                                    
                                       v
                                       
                                          
                                             σ
                                             i
                                          
                                          
                                             σ
                                             
                                                i
                                                +
                                                1
                                             
                                          
                                       
                                    
                                    )
                                 
                                 =
                                 
                                    d
                                    
                                       
                                          σ
                                          i
                                       
                                       
                                          σ
                                          
                                             i
                                             +
                                             1
                                          
                                       
                                    
                                 
                                 
                                    (
                                    
                                       
                                          w
                                          1
                                       
                                       
                                          v
                                          
                                             
                                                σ
                                                i
                                             
                                             
                                                σ
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                          
                                       
                                    
                                    +
                                    
                                       w
                                       2
                                    
                                    +
                                    
                                       w
                                       3
                                    
                                    
                                       f
                                       
                                          
                                             σ
                                             i
                                          
                                          
                                             σ
                                             
                                                i
                                                +
                                                1
                                             
                                          
                                       
                                    
                                    +
                                    
                                       w
                                       4
                                    
                                    
                                       v
                                       
                                          
                                             σ
                                             i
                                          
                                          
                                             σ
                                             
                                                i
                                                +
                                                1
                                             
                                          
                                       
                                       2
                                    
                                    )
                                 
                              
                           
                        
                     
                     
                        
                           (2)
                           
                              
                                 
                                    Z
                                    
                                       p
                                       r
                                       p
                                    
                                 
                                 
                                    (
                                    
                                       R
                                    
                                    ,
                                    
                                       v
                                    
                                    )
                                 
                                 =
                                 
                                    ∑
                                    
                                       
                                          σ
                                       
                                       ∈
                                       
                                          R
                                       
                                    
                                 
                                 
                                    (
                                    
                                       ω
                                       
                                          f
                                          c
                                       
                                    
                                    
                                       ∑
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          |
                                          σ
                                          |
                                          −
                                          1
                                       
                                    
                                    
                                       F
                                       
                                          
                                             σ
                                             i
                                          
                                          
                                             σ
                                             
                                                i
                                                +
                                                1
                                             
                                          
                                       
                                       f
                                    
                                    
                                       (
                                       
                                          v
                                          
                                             
                                                σ
                                                i
                                             
                                             
                                                σ
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                          
                                       
                                       )
                                    
                                    +
                                    
                                       ω
                                       
                                          f
                                          d
                                       
                                    
                                    
                                    
                                       t
                                       
                                          σ
                                          
                                             |
                                             σ
                                             |
                                          
                                       
                                    
                                    )
                                 
                              
                           
                        
                     
                  

The fuel consumption 
                        
                           
                              F
                              
                                 
                                    σ
                                    i
                                 
                                 
                                    σ
                                    
                                       i
                                       +
                                       1
                                    
                                 
                              
                              f
                           
                           
                              (
                              
                                 v
                                 
                                    
                                       σ
                                       i
                                    
                                    
                                       σ
                                       
                                          i
                                          +
                                          1
                                       
                                    
                                 
                              
                              )
                           
                        
                      is convex. The minimum 
                        
                           v
                           f
                           *
                        
                      on this function, i.e., the speed value that minimizes fuel costs, is given in Equation (3).

                        
                           (3)
                           
                              
                                 
                                    
                                       d
                                       
                                          F
                                          
                                             
                                                σ
                                                i
                                             
                                             
                                                σ
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                          
                                          f
                                       
                                    
                                    
                                       d
                                       
                                          v
                                          
                                             
                                                σ
                                                i
                                             
                                             
                                                σ
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    (
                                    
                                       v
                                       f
                                       *
                                    
                                    )
                                 
                                 =
                                 0
                                 ⇔
                                 
                                    v
                                    f
                                    *
                                 
                                 =
                                 
                                    
                                       (
                                       
                                          
                                             w
                                             1
                                          
                                          
                                             2
                                             
                                                w
                                                4
                                             
                                          
                                       
                                       )
                                    
                                    
                                       1
                                       /
                                       3
                                    
                                 
                              
                           
                        
                     
                  

Similarly, for any arc (σi, σ
                     
                        i + 1), assuming that there is no waiting time in the route after σi
                     , the travel cost 
                        
                           
                              F
                              f
                           
                           
                              d
                              
                                 
                                    σ
                                    i
                                 
                                 
                                    σ
                                    
                                       i
                                       +
                                       1
                                    
                                 
                              
                           
                           
                              (
                              
                                 v
                                 
                                    
                                       σ
                                       i
                                    
                                    
                                       σ
                                       
                                          i
                                          +
                                          1
                                       
                                    
                                 
                              
                              )
                           
                        
                      including driver wages is given in Equation (4). The speed value that minimizes fuel and driver costs is then expressed in Equation (5). Both values, 
                        
                           v
                           f
                           *
                        
                      and 
                        
                           
                              v
                              f
                              *
                           
                           d
                           ,
                        
                      are independent of the arc under consideration.

                        
                           (4)
                           
                              
                                 
                                    
                                       
                                          
                                             F
                                             f
                                          
                                          
                                             d
                                             
                                                
                                                   σ
                                                   i
                                                
                                                
                                                   σ
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                             
                                          
                                          
                                             (
                                             
                                                v
                                                
                                                   
                                                      σ
                                                      i
                                                   
                                                   
                                                      σ
                                                      
                                                         i
                                                         +
                                                         1
                                                      
                                                   
                                                
                                             
                                             )
                                          
                                       
                                    
                                    
                                       =
                                    
                                    
                                       
                                          
                                             ω
                                             
                                                f
                                                c
                                             
                                          
                                          
                                             d
                                             
                                                
                                                   σ
                                                   i
                                                
                                                
                                                   σ
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                             
                                          
                                          
                                             (
                                             
                                                
                                                   w
                                                   1
                                                
                                                
                                                   v
                                                   
                                                      
                                                         σ
                                                         i
                                                      
                                                      
                                                         σ
                                                         
                                                            i
                                                            +
                                                            1
                                                         
                                                      
                                                   
                                                
                                             
                                             +
                                             
                                                w
                                                2
                                             
                                             +
                                             
                                                w
                                                3
                                             
                                             
                                                f
                                                
                                                   
                                                      σ
                                                      i
                                                   
                                                   
                                                      σ
                                                      
                                                         i
                                                         +
                                                         1
                                                      
                                                   
                                                
                                             
                                             +
                                             
                                                w
                                                4
                                             
                                             
                                                v
                                                
                                                   
                                                      σ
                                                      i
                                                   
                                                   
                                                      σ
                                                      
                                                         i
                                                         +
                                                         1
                                                      
                                                   
                                                
                                                2
                                             
                                             )
                                          
                                       
                                    
                                 
                                 
                                    
                                    
                                    
                                       
                                          +
                                          
                                          
                                             ω
                                             
                                                f
                                                d
                                             
                                          
                                          
                                             
                                                d
                                                
                                                   
                                                      σ
                                                      i
                                                   
                                                   
                                                      σ
                                                      
                                                         i
                                                         +
                                                         1
                                                      
                                                   
                                                
                                             
                                             
                                                v
                                                
                                                   
                                                      σ
                                                      i
                                                   
                                                   
                                                      σ
                                                      
                                                         i
                                                         +
                                                         1
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (5)
                           
                              
                                 
                                    
                                       d
                                       
                                          F
                                          f
                                       
                                       
                                          d
                                          
                                             
                                                σ
                                                i
                                             
                                             
                                                σ
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                          
                                       
                                    
                                    
                                       d
                                       
                                          v
                                          
                                             
                                                σ
                                                i
                                             
                                             
                                                σ
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    (
                                    
                                       v
                                       f
                                       *
                                    
                                    d
                                    )
                                 
                                 =
                                 0
                                 ⇔
                                 
                                    v
                                    f
                                    *
                                 
                                 d
                                 =
                                 
                                    
                                       (
                                       
                                          
                                             
                                                
                                                   
                                                      ω
                                                      f
                                                   
                                                   d
                                                
                                                
                                                   
                                                      ω
                                                      f
                                                   
                                                   c
                                                
                                             
                                             +
                                             
                                                w
                                                1
                                             
                                          
                                          
                                             2
                                             
                                                w
                                                4
                                             
                                          
                                       
                                       )
                                    
                                    
                                       1
                                       /
                                       3
                                    
                                 
                              
                           
                        
                     
                  

Reviewing the literature, we came across two other “green” routing problems, the EMVRP (Kara et al., 2007) and FCVRP (Xiao et al., 2012), which can be viewed as simpler cases of PRP. These problems do not take into account time-window constraints and speed decisions, but include contributions from distance and load × distance over the route. These objective functions are expressed in Equations (6) and (7), respectively, where ω represents the weight of a vehicle without cargo.

                        
                           (6)
                           
                              
                                 
                                    
                                       
                                          
                                             Z
                                             
                                                e
                                                m
                                                v
                                                r
                                                p
                                             
                                          
                                          
                                             (
                                             
                                                R
                                             
                                             ,
                                             
                                                v
                                             
                                             )
                                          
                                       
                                    
                                    
                                       
                                          =
                                          
                                             ∑
                                             
                                                
                                                   σ
                                                
                                                ∈
                                                
                                                   R
                                                
                                             
                                          
                                          
                                             ∑
                                             
                                                i
                                                =
                                                1
                                             
                                             
                                                |
                                                σ
                                                |
                                                −
                                                1
                                             
                                          
                                          
                                             d
                                             
                                                
                                                   σ
                                                   i
                                                
                                                
                                                   σ
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                             
                                          
                                          
                                             (
                                             ω
                                             +
                                             
                                                f
                                                
                                                   
                                                      σ
                                                      i
                                                   
                                                   
                                                      σ
                                                      
                                                         i
                                                         +
                                                         1
                                                      
                                                   
                                                
                                             
                                             )
                                          
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (7)
                           
                              
                                 
                                    
                                       
                                          
                                             Z
                                             
                                                f
                                                c
                                                v
                                                r
                                                p
                                             
                                          
                                          
                                             (
                                             
                                                R
                                             
                                             ,
                                             
                                                v
                                             
                                             )
                                          
                                       
                                    
                                    
                                       
                                          =
                                          
                                             ∑
                                             
                                                
                                                   σ
                                                
                                                ∈
                                                
                                                   R
                                                
                                             
                                          
                                          
                                             ∑
                                             
                                                i
                                                =
                                                1
                                             
                                             
                                                |
                                                σ
                                                |
                                                −
                                                1
                                             
                                          
                                          
                                             d
                                             
                                                
                                                   σ
                                                   i
                                                
                                                
                                                   σ
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                             
                                          
                                          
                                             (
                                             1
                                             +
                                             
                                                1
                                                Q
                                             
                                             
                                                f
                                                
                                                   
                                                      σ
                                                      i
                                                   
                                                   
                                                      σ
                                                      
                                                         i
                                                         +
                                                         1
                                                      
                                                   
                                                
                                             
                                             )
                                          
                                       
                                    
                                 
                              
                           
                        
                     These two problems can be viewed as special cases of the PRP objective function of Equations (1) and (2), when 
                        
                           
                              ω
                              1
                           
                           =
                           
                              ω
                              4
                           
                           =
                           
                              ω
                              
                                 f
                                 d
                              
                           
                           =
                           0
                        
                     .

The proposed algorithm, called ILS-SP-SOA, combines an iterated local search with speed optimization procedures and integer programming optimization over a set partitioning formulation. As a blend of metaheuristic and exact procedures, this category of method is usually called matheuristic 
                     (Maniezzo, Stützle, and Voß, 2009).

In ILS-SP-SOA, the initial solution construction and local search, as well as three perturbation procedures aim at minimizing the cost by considering routing decisions without changing the speeds. This sub-problem can be seen as a VRPTW with the objective of Equation (2). We demonstrate in Section 4.1 how local-search moves can be evaluated in O(1) time for this setting. The search is complemented by a recursive speed-optimization procedure, described in Section 4.3, which is applied on each local minimum of the “routing” local search. New speed decisions are included in a dynamic speed matrix, which is in turn used in the subsequent VRPTW sub-problems. Finally, the routes associated to local minimums are stored in a pool, and used by an integer optimization procedure over a set partitioning formulation to generate possible better solutions composed of a different recombination of routes. In this process, each route may be associated to a different speed matrix, and thus this exact procedure adds an additional level of integration between route and speed decisions.

The outline of ILS-SP-SOA is presented in Algorithm 1
                     . The method performs 
                        
                           n
                           r
                        
                      restarts (Lines 3–23) of a hybrid procedure combining ILS, SOA and SP. At each restart, the speed matrix v is first initialized with the maximum speed, 
                        
                           
                              v
                              
                                 i
                                 j
                              
                           
                           =
                           
                              v
                              m
                           
                           a
                           x
                        
                      for all 
                        
                           (
                           i
                           ,
                           j
                           )
                           ∈
                           A
                        
                     . A solution S is obtained by applying local search and SOA on an initial solution (Line 8). This initial solution is generated using the modified cheapest insertion heuristic of Penna, Subramanian, and Ochi (2013), considering the PRP objective and the time-window relaxation of Section 4.1. The speed of arcs associated to S is then updated in the matrix v.

The ILS is then run until 
                        
                           
                              n
                              i
                           
                           l
                           s
                        
                      successive iterations of local search and perturbation are reached without improvement. At each iteration (Lines 10–18) the local optimal solution is modified by one of the three perturbation mechanisms, selected at random with different probabilities as described in Section 4.2. Time-window constraints are relaxed when performing a perturbation move. This modified solution is possibly improved by applying local search and SOA (Line 12), and the speed matrix is updated (Line 13). A temporary pool of routes is updated during the ILS loop by adding routes associated to local optimal solutions (Line 14). If the number of ILS iterations without improvement is equal to n, the perturbation Change Speeds is applied, as explained later in Section 4.2. Finally, the speed matrix v is reinitialized when the number of ILS iterations without improvement is greater than 
                        
                           
                              n
                              i
                           
                           l
                           s
                           /
                           2
                        
                     . (Lines 17–18).

If the size of the instance is smaller than a given parameter 
                        
                           
                              n
                              s
                           
                           p
                           ,
                        
                      then the SP method is called only after the last restart phase; otherwise, it is called after every restart. The SP method attempts to create a new solution from routes of a temporary pool of routes 
                        
                           
                              P
                              t
                           
                           e
                           m
                           p
                        
                      derived from local optimums of the local search, which is cleared after each 
                        
                           
                              n
                              p
                           
                           o
                           o
                           l
                        
                      restarts (Lines 24–25), and from a permanent pool of routes 
                        
                           
                              P
                              p
                           
                           e
                           r
                           m
                        
                      which contains the routes associated to the best solutions 
                        
                           
                              S
                              b
                           
                           e
                           s
                           t
                        
                      of each restart phase (Line 23). The SP problems are solved using a Mixed Integer Programming (MIP) solver which calls the ILS scheme every time a new incumbent solution is found (Line 20). This collaborative approach, described in Subramanian et al. (2013), not only potentially speeds up the solver runtime, but also may contribute to find better solutions than the best possible combination of routes in the pools. If this happens, the pool 
                        
                           
                              P
                              t
                           
                           e
                           m
                           p
                        
                      is also updated. The MIP solver is run several consecutive times until no improvement is found over 
                        
                           
                              S
                              b
                           
                           e
                           s
                           t
                           ,
                        
                      and a time limit 
                        
                           
                              T
                              m
                           
                           i
                           p
                        
                      is imposed to each MIP execution to avoid any unpredictable excessive CPU time. Finally, the algorithm returns the best solution found among all restarts (Line 26).

The local search procedure is based on the Randomized Variable Neighborhood Descent (RVND) of Subramanian, Drummond, Bentes, Ochi, and Farias (2010). It relies on five inter-route neighborhoods, namely: Shift(1,0), Shift(2,0), Swap(1,1), Swap(2,2), 2-opt* and five intra-route neighborhoods, namely: Reinsertion, Or-opt2, Or-opt3, Exchange and 2-opt. The neighborhood structures based on Shift operators move one or more consecutive customers from a route to another one. Those based on Swap consists of interchanging one or more customers from one route with one or more customers from another. Reinsertion and Or-opt follow the idea of Shift, but involving customers of a single route. Exchange is the intra-route version of Swap(1,1). Finally, 2-opt is the classical Traveling Salesman Problem (TSP) intra-route operator, whereas 2-opt* is the inter-route version of 2-opt. A detailed description of these neighborhoods, as well as the Auxiliary Data Structures (ADSs) used to enhance the performance the local search can be found in Subramanian (2012), Penna et al. (2013) and Vidal, Crainic, Gendreau, and Prins (2013b).

A local search for the VRPTW may have difficulties to generate feasible solutions, possibly compromising the convergence toward good solutions. To circumvent this issue, penalized infeasible solutions w.r.t. time windows are considered, and the objective includes “time-warp” penalties as in Vidal et al. (2013b). To compute the cost of new routes generated by the local search in amortized constant time, other ADSs based on subsequences concatenation were implemented. For any subsequence σ the algorithm stores and maintains:

                           
                              •
                              minimum duration T(σ),

minimum time-warp use TW(σ),

earliest E(σ) and latest visit L(σ) to the first vertex allowing a schedule with minimum duration and minimum time-warp use,

cumulated load Q(σ),

distance D(σ),

travel time TT(σ),

load × distance QD(σ),

and speed2 × distance SSD(σ).

For a subsequence 
                           
                              σ
                              ¯
                           
                         involving a single customer, i, these ADSs are computed as follows: 
                           
                              T
                              
                                 (
                                 
                                    σ
                                    ¯
                                 
                                 )
                              
                              =
                              
                                 τ
                                 i
                              
                           
                        ; 
                           
                              TW
                              (
                              
                                 σ
                                 ¯
                              
                              )
                              =
                              0
                           
                        ; 
                           
                              E
                              
                                 (
                                 
                                    σ
                                    ¯
                                 
                                 )
                              
                              =
                              
                                 a
                                 i
                              
                           
                        ; 
                           
                              L
                              
                                 (
                                 
                                    σ
                                    ¯
                                 
                                 )
                              
                              =
                              
                                 b
                                 i
                              
                           
                        ; 
                           
                              Q
                              
                                 (
                                 
                                    σ
                                    ¯
                                 
                                 )
                              
                              =
                              
                                 q
                                 i
                              
                           
                        ; 
                           
                              D
                              (
                              
                                 σ
                                 ¯
                              
                              )
                              =
                              0
                           
                        ; 
                           
                              TT
                              (
                              
                                 σ
                                 ¯
                              
                              )
                              =
                              0
                           
                        ; 
                           
                              QD
                              (
                              
                                 σ
                                 ¯
                              
                              )
                              =
                              0
                           
                        ; 
                           
                              SSD
                              (
                              
                                 σ
                                 ¯
                              
                              )
                              =
                              0
                           
                        . If the first node in the sequence is a depot, e.g., if 
                           
                              
                                 σ
                                 ¯
                              
                              =
                              0
                              ,
                           
                         then 
                           
                              E
                              
                                 (
                                 
                                    σ
                                    ¯
                                 
                                 )
                              
                              =
                              L
                              
                                 (
                                 
                                    σ
                                    ¯
                                 
                                 )
                              
                              =
                              0
                           
                        . This prevents a delayed departure. The following equations enable then to derive ADSs for larger subsequences obtained by concatenation ⊕:

                           
                              (8)
                              
                                 
                                    
                                       
                                          Δ
                                       
                                       
                                          =
                                       
                                       
                                          
                                             T
                                             
                                                (
                                                σ
                                                )
                                             
                                             −
                                             TW
                                             
                                                (
                                                σ
                                                )
                                             
                                             +
                                             
                                                δ
                                                
                                                   
                                                      σ
                                                      
                                                         |
                                                         σ
                                                         |
                                                      
                                                   
                                                   
                                                      σ
                                                      1
                                                      ′
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (9)
                              
                                 
                                    
                                       
                                          
                                             Δ
                                             WT
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             max
                                             {
                                             E
                                             
                                                (
                                                
                                                   σ
                                                   ′
                                                
                                                )
                                             
                                             −
                                             Δ
                                             −
                                             L
                                             
                                                (
                                                σ
                                                )
                                             
                                             ,
                                             0
                                             }
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (10)
                              
                                 
                                    
                                       
                                          
                                             Δ
                                             TW
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             max
                                             {
                                             E
                                             
                                                (
                                                σ
                                                )
                                             
                                             +
                                             Δ
                                             −
                                             L
                                             
                                                (
                                                
                                                   σ
                                                   ′
                                                
                                                )
                                             
                                             ,
                                             0
                                             }
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (11)
                              
                                 
                                    
                                       
                                          
                                             T
                                             (
                                             σ
                                             ⊕
                                             
                                                σ
                                                ′
                                             
                                             )
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             T
                                             
                                                (
                                                σ
                                                )
                                             
                                             +
                                             T
                                             
                                                (
                                                
                                                   σ
                                                   ′
                                                
                                                )
                                             
                                             +
                                             
                                                δ
                                                
                                                   
                                                      σ
                                                      
                                                         |
                                                         σ
                                                         |
                                                      
                                                   
                                                   
                                                      σ
                                                      1
                                                      ′
                                                   
                                                
                                             
                                             +
                                             
                                                Δ
                                                WT
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (12)
                              
                                 
                                    
                                       
                                          
                                             TW
                                             (
                                             σ
                                             ⊕
                                             
                                                σ
                                                ′
                                             
                                             )
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             TW
                                             
                                                (
                                                σ
                                                )
                                             
                                             +
                                             TW
                                             
                                                (
                                                
                                                   σ
                                                   ′
                                                
                                                )
                                             
                                             +
                                             
                                                Δ
                                                TW
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (13)
                              
                                 
                                    
                                       
                                          
                                             E
                                             (
                                             σ
                                             ⊕
                                             
                                                σ
                                                ′
                                             
                                             )
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             max
                                             
                                                {
                                                E
                                                
                                                   (
                                                   
                                                      σ
                                                      ′
                                                   
                                                   )
                                                
                                                −
                                                Δ
                                                ,
                                                E
                                                
                                                   (
                                                   σ
                                                   )
                                                
                                                }
                                             
                                             −
                                             
                                                Δ
                                                WT
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (14)
                              
                                 
                                    
                                       
                                          
                                             L
                                             (
                                             σ
                                             ⊕
                                             
                                                σ
                                                ′
                                             
                                             )
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             min
                                             
                                                {
                                                L
                                                
                                                   (
                                                   
                                                      σ
                                                      ′
                                                   
                                                   )
                                                
                                                −
                                                Δ
                                                ,
                                                L
                                                
                                                   (
                                                   σ
                                                   )
                                                
                                                }
                                             
                                             +
                                             
                                                Δ
                                                TW
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (15)
                              
                                 
                                    
                                       
                                          
                                             Q
                                             (
                                             σ
                                             ⊕
                                             
                                                σ
                                                ′
                                             
                                             )
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             Q
                                             
                                                (
                                                σ
                                                )
                                             
                                             +
                                             Q
                                             
                                                (
                                                
                                                   σ
                                                   ′
                                                
                                                )
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (16)
                              
                                 
                                    
                                       
                                          
                                             D
                                             (
                                             σ
                                             ⊕
                                             
                                                σ
                                                ′
                                             
                                             )
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             D
                                             
                                                (
                                                σ
                                                )
                                             
                                             +
                                             D
                                             
                                                (
                                                
                                                   σ
                                                   ′
                                                
                                                )
                                             
                                             +
                                             
                                                d
                                                
                                                   
                                                      σ
                                                      
                                                         |
                                                         σ
                                                         |
                                                      
                                                   
                                                   
                                                      σ
                                                      1
                                                      ′
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (17)
                              
                                 
                                    
                                       
                                          
                                             TT
                                             (
                                             σ
                                             ⊕
                                             
                                                σ
                                                ′
                                             
                                             )
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             TT
                                             
                                                (
                                                σ
                                                )
                                             
                                             +
                                             TT
                                             
                                                (
                                                
                                                   σ
                                                   ′
                                                
                                                )
                                             
                                             +
                                             
                                                δ
                                                
                                                   
                                                      σ
                                                      
                                                         |
                                                         σ
                                                         |
                                                      
                                                   
                                                   
                                                      σ
                                                      1
                                                      ′
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (18)
                              
                                 
                                    
                                       
                                          
                                             QD
                                             (
                                             σ
                                             ⊕
                                             
                                                σ
                                                ′
                                             
                                             )
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             QD
                                             
                                                (
                                                σ
                                                )
                                             
                                             +
                                             QD
                                             
                                                (
                                                
                                                   σ
                                                   ′
                                                
                                                )
                                             
                                             +
                                             Q
                                             
                                                (
                                                
                                                   σ
                                                   ′
                                                
                                                )
                                             
                                             
                                                (
                                                D
                                                
                                                   (
                                                   σ
                                                   )
                                                
                                                +
                                                
                                                   d
                                                   
                                                      
                                                         σ
                                                         
                                                            |
                                                            σ
                                                            |
                                                         
                                                      
                                                      
                                                         σ
                                                         1
                                                         ′
                                                      
                                                   
                                                
                                                )
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (19)
                              
                                 
                                    
                                       
                                          
                                             SSD
                                             (
                                             σ
                                             ⊕
                                             
                                                σ
                                                ′
                                             
                                             )
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             SSD
                                             
                                                (
                                                σ
                                                )
                                             
                                             +
                                             SSD
                                             
                                                (
                                                
                                                   σ
                                                   ′
                                                
                                                )
                                             
                                             +
                                             
                                                v
                                                
                                                   
                                                      σ
                                                      
                                                         |
                                                         σ
                                                         |
                                                      
                                                   
                                                   
                                                      σ
                                                      1
                                                      ′
                                                   
                                                
                                                2
                                             
                                             
                                                d
                                                
                                                   
                                                      σ
                                                      
                                                         |
                                                         σ
                                                         |
                                                      
                                                   
                                                   
                                                      σ
                                                      1
                                                      ′
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        The penalized cost of a route σ can be derived from these structures as shown in Equation (20) where 
                           
                              
                                 ω
                                 t
                              
                              w
                           
                         is the penalty for one unit of time warp.

                           
                              (20)
                              
                                 
                                    
                                       
                                          
                                             Z
                                             (
                                             σ
                                             )
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             
                                                ω
                                                
                                                   f
                                                   c
                                                
                                             
                                             
                                                (
                                                
                                                   w
                                                   1
                                                
                                                TT
                                                
                                                   (
                                                   σ
                                                   )
                                                
                                                +
                                                
                                                   w
                                                   2
                                                
                                                D
                                                
                                                   (
                                                   σ
                                                   )
                                                
                                                +
                                                
                                                   w
                                                   3
                                                
                                                Q
                                                D
                                                
                                                   (
                                                   σ
                                                   )
                                                
                                                +
                                                
                                                   w
                                                   4
                                                
                                                SSD
                                                
                                                   (
                                                   σ
                                                   )
                                                
                                                )
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             +
                                             
                                             
                                                ω
                                                
                                                   f
                                                   d
                                                
                                             
                                             T
                                             
                                                (
                                                σ
                                                )
                                             
                                             +
                                             
                                                ω
                                                t
                                             
                                             w
                                             TW
                                             
                                                (
                                                σ
                                                )
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

The three mechanisms applied during the perturbation phase are described as follows.

                           
                              •
                              
                                 Shift to end—Shifts one customer from one route to the end of other route, randomly with uniform distribution.


                                 Merge routes—The two routes with the smallest accumulated load are merged if the vehicle capacity is not exceeded in the process. Given two routes σ and σ′, the new merged route will be 
                                    
                                       
                                          σ
                                          ^
                                       
                                       =
                                       
                                          (
                                          0
                                          ,
                                          
                                             σ
                                             2
                                          
                                          ,
                                          ⋯
                                          ,
                                          
                                             σ
                                             
                                                n
                                                −
                                                1
                                             
                                          
                                          ,
                                          
                                             σ
                                             2
                                             ′
                                          
                                          ,
                                          ⋯
                                          ,
                                          
                                             σ
                                             
                                                n
                                                −
                                                1
                                             
                                             ′
                                          
                                          ,
                                          0
                                          )
                                       
                                    
                                 .


                                 Change speeds—This perturbation modifies the speed matrix by changing the speeds associated to arcs of one random route in the current best solution 
                                    
                                       
                                          S
                                          b
                                       
                                       e
                                       s
                                       t
                                    
                                  with one random speed from the set 
                                    
                                       {
                                       
                                          v
                                          f
                                          *
                                       
                                       ,
                                       
                                          v
                                          f
                                          *
                                       
                                       d
                                       ,
                                       
                                          v
                                          m
                                       
                                       a
                                       x
                                       }
                                       ,
                                    
                                  with uniform distribution.

During the perturbation phase, Shift to end and Merge routes are randomly selected with different probabilities, 90 percent and 10 percent, respectively. Any perturbation leading to an infeasible solution w.r.t. capacity constraints is undone and a new perturbation is attempted. Finally, the additional Change speeds perturbation is applied after n consecutive ILS iterations without improvement, e.g., when 
                           
                              
                                 i
                                 i
                              
                              l
                              s
                              =
                              n
                           
                        .

Speeds have a direct impact on customers’ arrival time, i.e., in meeting their time windows. When routes are fixed, the PRP leads to a speed optimization problem which consists of finding the optimal speeds for each arc while respecting customers’ time windows. This problem is solved by a recursive algorithm (Algorithm 2
                        ). This method generalizes the RSA procedure of Norstad, Fagerholt, and Laporte (2011) and Hvattum, Norstad, Fagerholt, and Laporte (2013) by considering drivers wages, possible waiting times, and a non-fixed arrival time at the last customer.


                        Algorithm 2 is applied on the complete route, by setting s = 1 and e = |σ|. Let 
                           
                              t
                              
                                 σ
                                 i
                              
                              ′
                           
                         be the time to start the service of customer σi
                        . Early and late arrivals are not considered in the course of the RSA procedure such that 
                           
                              t
                              
                                 σ
                                 
                                    |
                                    σ
                                    |
                                 
                              
                              ′
                           
                         is also the arrival time at customer σi
                        . The algorithm first computes the arrival time 
                           
                              t
                              
                                 σ
                                 
                                    |
                                    σ
                                    |
                                 
                              
                              ′
                           
                         at the last customer when traveling at speed 
                           
                              
                                 v
                                 f
                                 *
                              
                              d
                           
                         (minimizing fuel consumption plus driver costs). If this time 
                           
                              t
                              
                                 σ
                                 
                                    |
                                    σ
                                    |
                                 
                              
                              ′
                           
                         is greater or lower than the time windows bounds, it is updated to the nearest bound (Line 6). Then, the necessary speed 
                           
                              
                                 v
                                 r
                              
                              e
                              f
                           
                         to arrive at time 
                           
                              t
                              
                                 σ
                                 e
                              
                              ′
                           
                         is computed (Line 7), and the algorithm finds the customer σp
                         with greatest time-window violation when using this speed (Lines 10–13). If no violation is found, the solution is returned. Otherwise, the arrival time 
                           
                              t
                              
                                 σ
                                 p
                              
                              ′
                           
                         is updated to the nearest time window bound (Line 15) and SOA is called recursively on two subproblems: from s to p (Line 16), and from p to e (Line 17). Once times 
                           
                              
                                 t
                                 
                                    σ
                                    i
                                 
                                 ′
                              
                              ,
                              ∀
                              i
                              =
                              1
                              ,
                              …
                              ,
                              
                                 |
                                 σ
                                 |
                              
                              ,
                           
                         are computed, the associated speeds are revised in such a way that any speed below the optimal speed 
                           
                              v
                              f
                              *
                           
                         which minimizes fuel consumption is replaced by a speed 
                           
                              v
                              f
                              *
                           
                         and a waiting time (Lines 18–22). The final arrival dates ti
                         at route nodes are obtained (Line 22).


                        Algorithm 2 is illustrated in Fig. 1
                         on a problem with eight stops. The horizontal axis represents the time, while the vertical axis indicates sequence of customers from bottom to top. The brackets correspond to the time windows and the dots denote the customers’ arrival times. Round black dots are related to feasible arrival times; diamond gray dots indicate an early or late arrival time; and square dots indicate the new times after correction. For simplicity, the service times are assumed to be zero.


                        Fig. 1 a illustrates the arrival times at each customer when the vehicle travels with the optimal speed (
                           
                              
                                 v
                                 f
                                 *
                              
                              d
                           
                        ) starting from σ
                        1 = 0 at time 
                           
                              
                                 t
                                 
                                    σ
                                    1
                                 
                                 ′
                              
                              =
                              
                                 a
                                 
                                    σ
                                    1
                                 
                              
                           
                        . There are two violations and σ
                        7 is the customer with the greatest violation (p = 7). The arrival time at σ
                        7 is thus adjusted to 
                           
                              
                                 t
                                 
                                    σ
                                    7
                                 
                                 ′
                              
                              =
                              
                                 b
                                 
                                    σ
                                    7
                                 
                              
                           
                         (Fig. 1b) and two subproblems, P1 and P2, are solved, where P1 considers the subsequence from σ
                        1 until σ
                        7, whereas P2 considers the subsequence from σ
                        7 until σ
                        |σ|. In P1, the 
                           
                              
                                 v
                                 r
                              
                              e
                              f
                           
                         is computed to arrive at σ
                        7 at time 
                           
                              t
                              
                                 σ
                                 7
                              
                              ′
                           
                        . A new violation is observed at customer σ
                        4 (p = 4). This violation is corrected (Fig. 1c) and two new subproblems, from σ
                        1 to σ
                        4 (P1.1), and from σ
                        4 to σ
                        7 (P1.2) are solved. When solving P1.1 and P1.2, no violations are identified (Fig. 1c and d), and thus the recursion is not applied further. This leads to a feasible solution to P1. Subproblem P2 is solved using almost the same rationale of P1 (see Fig. 1e), except that the customers’ arrival times are computed using the optimal speed 
                           
                              
                                 v
                                 f
                                 *
                              
                              d
                           
                         (see Line 6 of Algorithm 2). Again, no violation is found, thus completing the whole solution for the problem. At the end, speeds are revised to insert waiting time whenever a speed 
                           
                              v
                              <
                              
                                 v
                                 f
                                 *
                              
                           
                         is encountered (Lines 18–22 of Algorithm 2).

In this section we report the computational experiments for the three environmental variants considered in this work and also for the VRPTW with distance minimization, but first we describe the benchmark instances used for evaluating the performance of our algorithm.

The first set of instances considered in this work (Set A) is the one from the PRPLIB, suggested by Demir et al. (2012) and available at http://www.apollo.management.soton.ac.uk/prplib.htm. This set consists of nine different groups, ranging from 10 to 200 customers, each one containing 20 instances. For these instances, the same objective parameter values as in Demir et al. (2012) have been used, that is:

                           
                              
                                 
                                    
                                       
                                          
                                             w
                                             1
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             1.01763908
                                             ×
                                             
                                                10
                                                
                                                   −
                                                   3
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             w
                                             2
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             5.33605218
                                             ×
                                             
                                                10
                                                
                                                   −
                                                   5
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             w
                                             3
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             8.40323178
                                             ×
                                             
                                                10
                                                
                                                   −
                                                   9
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             w
                                             4
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             1.41223439
                                             ×
                                             
                                                10
                                                
                                                   −
                                                   7
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             ω
                                             
                                                f
                                                c
                                             
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             1.4
                                             £
                                             /
                                             l
                                          
                                       
                                    
                                    
                                       
                                          
                                             ω
                                             
                                                f
                                                d
                                             
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             2.22222222
                                             ×
                                             
                                                10
                                                
                                                   −
                                                   3
                                                
                                             
                                             £
                                             /
                                             s
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                     

However, these instances have a large time windows width, such that it is possible to visit many customers within their respective time windows when traveling at optimal speed as further discussed in Section 5.2. In view of this, we created two additional sets of instances (available at http://w1.cirrelt.ca/~vidalt/en/VRP-resources.html) with tighter time windows by modifying those of the PRPLIB. The time horizon of these new sets is 32, 400. The time-window width of each customer in Set B is randomly selected between the interval 2000 and 5000 with uniform probability, whereas in Set C it is randomly selected between 2000 and 15000. Once the time windows width are defined, the time window lower bound is randomly selected with uniform probability in the time interval Ii
                         which allows to feasibly reach the customer and return to the depot before the end of the time horizon. For a customer i, let Wi
                         be the chosen width, and let 
                           
                              
                                 δ
                                 
                                    0
                                    i
                                 
                                 m
                              
                              i
                              n
                              =
                              
                                 d
                                 
                                    0
                                    i
                                 
                              
                              /
                              
                                 v
                                 m
                              
                              a
                              x
                           
                         and 
                           
                              
                                 δ
                                 
                                    i
                                    0
                                 
                                 m
                              
                              i
                              n
                              =
                              
                                 d
                                 
                                    i
                                    0
                                 
                              
                              /
                              
                                 v
                                 m
                              
                              a
                              x
                           
                         be the minimum driving time from and to the depot, respectively. Then,

                           
                              (21)
                              
                                 
                                    
                                       I
                                       i
                                    
                                    =
                                    
                                       [
                                       
                                          a
                                          0
                                       
                                       +
                                       
                                          ⌊
                                          
                                             δ
                                             
                                                0
                                                
                                                   i
                                                   m
                                                
                                                i
                                                n
                                             
                                          
                                          ⌋
                                       
                                       ,
                                       
                                          b
                                          0
                                       
                                       −
                                       
                                          ⌈
                                          
                                             δ
                                             
                                                i
                                                
                                                   0
                                                   m
                                                
                                                i
                                                n
                                             
                                          
                                          ⌉
                                       
                                       −
                                       
                                          τ
                                          i
                                       
                                       −
                                       
                                          W
                                          i
                                       
                                       ]
                                    
                                    .
                                 
                              
                           
                        
                     

For the FCVRP and the EMVRP, the well-known benchmark instances of Christofides, Mingozzi, and Toth (1979) and Golden, Wasil, Kelly, and Chao (1998) are used. As in Kara et al. (2007), we use ω = 0.15Q for the EMVRP. Finally, the instances of Solomon (1987) are considered for the VRPTW.

The proposed matheuristic algorithm was coded in C + + and executed on an Intel Core i7 3.40 GHz with 16 GB of RAM, running under Linux Mint 13. CPLEX 12.4 was used to solve the SP problems. Only a single thread was used, and the algorithm was run 10 times for each instance with different random seeds.

The following parameter values were adopted: 
                           
                              
                                 n
                                 r
                              
                              =
                              20
                              ,
                           
                        
                        
                           
                              
                                 n
                                 i
                              
                              l
                              s
                              =
                              n
                              +
                              5
                              m
                              ,
                           
                        
                        
                           
                              
                                 n
                                 s
                              
                              p
                              =
                              150
                              ,
                           
                        
                        
                           
                              
                                 n
                                 p
                              
                              o
                              o
                              l
                              =
                              2
                              ,
                           
                        
                        
                           
                              
                                 T
                                 m
                              
                              i
                              p
                              =
                              360
                           
                         s, and 
                           
                              
                                 ω
                                 t
                              
                              w
                              =
                              
                                 10
                                 8
                              
                           
                        . The first four parameter values directly follow from Subramanian (2012) and Subramanian et al. (2013), whereas the latter is a large number to prevent infeasible solutions due to late arrivals. A higher value of 
                           
                              
                                 T
                                 m
                              
                              i
                              p
                           
                         than Subramanian et al. (2013) is used, as more time seems to be needed by the SP solver to produce improved solutions.

To investigate the interaction between the local search components, the SP solver, and the speed optimization procedure, we performed further experiments with a static version called ILS-SP-SOA-Stat. For a fair comparison, the CPU time limit for each instance has been set to the average CPU time of the dynamic method for the corresponding instance. In ILS-SP-SOA-Stat, v does not change during an iteration of the algorithm, i.e., the “UpdateSpeedMatrix” function and the Change speeds perturbation is not used in Algorithm 1. Hence, the task of intelligently recombining routes with different speed distributions is exclusively operated by the SP solver.

The performance of each method is reported in Table 1
                        . Each line corresponds to averaged results on a set of 20 instances. The columns report for each method and instance set the average Gap(%) and CPU time. The Gap(%) for each instance is computed as 
                           
                              100
                              
                                 (
                                 Z
                                 −
                                 
                                    Z
                                    b
                                 
                                 k
                                 s
                                 )
                              
                              /
                              
                                 Z
                                 b
                              
                              k
                              s
                              ,
                           
                         where Z is the objective value of the solution and 
                           
                              
                                 Z
                                 b
                              
                              k
                              s
                           
                         is the value of the Best Known Solution (BKS) ever found. Detailed results on each problem instance are provided in Appendix B.

It appears that both versions of the proposed algorithm largely outperform the ALNS heuristic of Demir et al. (2012) in terms of solution quality. The new methods also appear to be significantly faster than ALNS, with a speed-up ranging from × 2 to × 50. Note that ALNS experiments have been conducted on a different computing environment and a 3.00 GHz CPU. The speed difference between computers of the same generation remains moderate. It can be observed that instances of Sets B and C require more CPU time for convergence, and solution improvements are found more continuously as the search progresses. This is due to tighter time windows. The increased interplay between route and speed optimization leads to a longer sequence of solution improvements, and thus a slower convergence. This aspect is further developed in the next section.

Comparing the results obtained with the two versions of ILS-SP-SOA, the average solutions obtained with the dynamic version are better than those from the static version in all sets of instances but 200-B and 200-C. The dynamic version examines a wider diversity of speed choices. For smaller instances—here up to 100 customers—this allows to converge toward better solutions within the allowed termination criteria. For larger instances with tighter time windows, the benefits of enhanced speed optimization and diversity seems to be counterbalanced by a slower convergence, and the static method, more focused on intensification, may perform marginally better. A longer termination criterion may thus benefit more to the dynamic version that to the static version.

To better understand what makes a difficult PRP instance, and how these instances can be better addressed, we further analyze instance characteristics and study how often the optimal speeds are used in the best known solutions. As shown in the following, higher occurrences of “exotic” speeds in the BKS, i.e., speeds that are neither 
                           
                              v
                              f
                              *
                           
                         nor 
                           
                              
                                 v
                                 f
                                 *
                              
                              d
                              ,
                           
                         seem to translate into increased problem difficulty.


                        Fig. 2
                         shows the percentage of the number of arcs in which the vehicle travels at a certain speed in the BKS of each group of instances. Three speed categories are discerned: 
                           
                              
                                 v
                                 f
                                 *
                              
                              ,
                           
                        
                        
                           
                              
                                 v
                                 f
                                 *
                              
                              d
                              ,
                           
                         and other speeds 
                           
                              
                                 v
                                 o
                              
                              t
                              h
                              e
                              r
                           
                        . It can be seen that 
                           
                              
                                 v
                                 f
                                 *
                              
                              d
                           
                         appears to be used more often than the other speeds in Set A, regardless of the size of the instance. As expected, 
                           
                              v
                              f
                              *
                           
                         tends to be used much more often in Set B, which is the one with the tightest time windows. Finally, in Set C, where the time windows are larger than those in Set B, 
                           
                              
                                 v
                                 f
                                 *
                              
                              d
                           
                         is the most common in the 10-customer instances, but there is an equilibrium in the 50-, 100- and 200-customer instances between 
                           
                              v
                              f
                              *
                           
                         and 
                           
                              
                                 v
                                 f
                                 *
                              
                              d
                           
                        .

Let %Dist be the percentage of the total distance in which the vehicles are traveling with other speeds than 
                           
                              v
                              f
                              *
                           
                         and 
                           
                              
                                 v
                                 f
                                 *
                              
                              d
                           
                         in the BKS of a given instance. Fig. 3
                         displays the average gaps of ILS-SP-SOA-Dyn and ILS-SP-SOA-Stat on the 50-, 100- and 200-customer instances of Sets A, B and C and of ALNS (Demir, 2012; Demir et al., 2012) on the 50-, 100- and 200-customer instances of Set A, relatively to the %Dist of the associated instance. As noticed earlier, the Gap(%) obtained by the proposed methods are smaller than those of ALNS. It is also clearly visible that the first set of instances (the only one on which ALNS are reported) required a lower variety of speed values in the BKS. Finally, there is a tendency for larger gaps when %Dist increases, which may reflect a higher problem difficulty. It should be noted that 
                           
                              v
                              f
                              *
                           
                         and 
                           
                              
                                 v
                                 o
                              
                              t
                              h
                              e
                              r
                           
                         can only arise as a consequence of an active time-window constraint, otherwise 
                           
                              
                                 v
                                 f
                                 *
                              
                              d
                           
                         would be used throughout all the route. Therefore, problems with the largest number of active time-window constraints seem also more difficult.

A similar analysis is performed in Fig. 4
                         considering the CPU time of ILS-SP-SOA-Dyn, and thus the convergence speed of the method. Overall, the CPU time needed to converge toward a final solution tends to increase for problems with higher %Dist. This suggests that the instance difficultly is correlated with the need of a variety of speeds in the solutions.

This analysis shows that, even if instances with large time-windows are reasonably well solved by methods with separate phases such as the ALNS of Demir et al. (2012) or ILS-SP-SOA-Stat, there is still a notable research effort to be done for more intricate problems, when a larger diversity of speeds must be used to fulfill the time constraints. Because of the variety of antagonist interplays between, speed, distance, and feasibility, more integrated methods that consider jointly speed and route optimization within the neighborhoods are likely to be necessary. ILS-SP-SOA-Dyn is already a first step in this direction, and has demonstrated increased performance on some of the most difficult instances.

Computational experiments have been conducted on two additional problems with environmental considerations, the FCVRP and EMVRP, in order to assess the performance of ILS-SP-SOA on a wider variety of settings. As previously, a single thread was used and 10 executions were performed for each instance. For a fair comparison with previous methods developed for the FCVRP, we reduced the termination criterion by setting 
                           
                              
                                 n
                                 r
                              
                              =
                              4
                              ,
                           
                        
                        
                           
                              
                                 n
                                 i
                              
                              l
                              s
                              =
                              n
                              /
                              5
                              +
                              5
                              m
                           
                         and 
                           
                              
                                 T
                                 m
                              
                              i
                              p
                              =
                              60
                           
                         s. For the EMVRP we only changed the MIP solver time limit to 
                           
                              
                                 T
                                 m
                              
                              i
                              p
                              =
                              60
                           
                         s.

For the FCVRP, the results obtained by ILS-SP-SOA were compared with those of Xiao et al. (2012), as can be observed in Table 2
                        . The values highlighted only in boldface indicate that the BKS found by our algorithm equaled the best one reported by Xiao et al. (2012), whereas those in boldface and underline indicate that the BKS found by ILS-SP-SOA improved the one presented by the same authors. To our knowledge, no results on the instances of Christofides et al. (1979) were available for the EMVRP. Hence, Table 3
                         reports the gap between the average solutions and the BKS found by ILS-SP-SOA.

These results show that ILS-SP-SOA consistently produces solutions of high quality on these two problems. We observe that 22 new BKS solutions were found for the FCVRP, and the average gaps between the average solutions of ILS-SP-SOA and the BKSs is 0.16 percent for the set of instances of Christofides et al. (1979) and 0.31 percent for the one of Golden et al. (1998). This gap is much smaller than Xiao et al. (2012), which attained gaps of 2.20 percent and 1.95 percent. Note that the seven instances that include service times and route duration constraints, namely C6–C10 and C13–C14 were not solved by Xiao et al. (2012). When comparing the solution cost between each of the seven pair of instances, i.e, C1 and C6; C2 and C7; C3 and C8; C4 and C9; C5 and C10; C11 and C13; C12 and C14; where the first instance of the pair does not consider service times and route duration constraints, while the second one does, it can be observed that the solution costs increase dramatically when these characteristics are considered. Regarding the CPU time, Xiao et al. (2012) only reported the mean of the average times, which was approximately 78 seconds for the set of instances of Christofides et al. (1979) and 198 seconds for the one of Golden et al. (1998). Our algorithm spent, on average, 9.06 seconds and 156.95 seconds, respectively, as shown in Table 2. It should be pointed out that Xiao et al. (2012) ran their experiments on a slower 1.6 GHz notebook.

For the EMVRP, and in contrast to the FCVRP, service times and route duration constraints do not have a dramatic impact in the solution cost when compared to the associated instances that do not consider these characteristics. Overall, the gaps between the average solutions and the BKS are small, more precisely 0.09 percent and 0.08 percent, on the instances of Christofides et al. (1979) and Golden et al. (1998), respectively. When observing such a small variance for VRP problems we can reasonably conjecture that the problem is fairly-well solved.

To obtain even further elements of comparison with the existing literature, the performance of the proposed algorithm was finally tested on the VRPTW, considering the Solomon (1987) benchmark instances with distance minimization. Previous authors have used different conventions for distance computation, and thus two sets of experiments were conducted. Table 4
                         displays a summary of the results, reporting average and best solution on 10 runs for each class of instances, and truncating the distances to the first digit. Table 5
                         reports the results obtained when using “double” precision distances. In both cases, ILS-SP solutions are compared with those of the current state-of-the-art approaches that use the same rounding conventions (Alvarenga, Mateus, and de Tomi, 2007; Demir et al., 2012; Labadi, Prins, and Reghioui, 2008; Muter, Birbil, and Sahin, 2010), and the best solutions are highlighted in boldface. The last lines of the tables report the average CPU time per run and per instance (the total time for methods that report the best solutions must thus be multiplied by the number of runs), and the type of processor used during the tests. Detailed results on separate instances are presented in Appendix C.

These experiments confirm the fact that, in addition to producing good quality results for the PRP and its variants, the proposed algorithm systematically finds the best solutions for every group of VRPTW instances and rounding conventions, in less CPU time than other algorithms (e.g. three time faster than ALNS using CPUs of similar generation). Furthermore, from Table C.11
                        , it can be seen that the proposed method found all optimal solutions, except for one instance. New breakthroughs on the PRP are more thus likely to arise from better combined speed and route optimization rather than improved VRPTW solutions.

This paper dealt with the Pollution-Routing Problem (PRP), a “green”-oriented variant of the Vehicle Routing Problem (VRP). In order to solve it, we proposed a matheuristic approach, called ILS-SOA-SP, that effectively integrates Iterated Local Search (ILS) with a Set Partitioning (SP) procedure and a Speed Optimization Algorithm (SOA). This approach was also used to solve two other environmental based VRPs, namely the Fuel Consumption Vehicle Routing Problem (FCVRP) and the Energy Minimizing Vehicle Routing Problem (EMVRP), as well as the well-known Vehicle Routing Problem with Time Windows (VRPTW) with distance minimization. The results of extensive computational experiments demonstrate that ILS-SP-SOA is capable of generating high-quality solutions in a very consistent manner, outperforming previous methods from the literature.

Two new sets of PRP instances were introduced, and our computational experiments show that they are more challenging than the previous one available in the literature. We also showed that the level of difficulty of an instance tends to increase when the vehicles are likely to travel at speeds other than the optimal ones. In other words, good (or even feasible) routing solutions are not easily obtained without using non-optimal speeds, and choosing the correct ones can be a challenging task. The proposed method has the advantage to perform joint route and speed optimization within several local search and integer programming components, and thus performs much better on difficult instances than previously available algorithms.

As a promising line of research, we believe that further efforts are still necessary to incorporate speed decisions more tightly within the local search. This can be done, for example, by developing larger neighborhood structures that are capable of exploring promising regions of the solution space by considering different speeds during the local search. The exploration of these combined neighborhoods is likely to be highly time-consuming, and thus very clever move selection and move evaluation methods may need to be developed.

@&#ACKNOWLEDGMENTS@&#

This research was partially supported by the Conselho Nacional de Desenvolvimento Científico e Tecnolgico (CNPq), grant 471158/ 2012-7.

The fuel consumption model used in the PRP formulation, given by Equation (A.1), is based on the comprehensive emissions model described by Barth, Younglove, and Scora (2005), Scora and Barth (2006) and Barth and Boriboonsomsin (2008). It is given by

                        
                           (A.1)
                           
                              
                                 
                                    
                                       
                                          
                                          
                                             Z
                                             
                                                i
                                                j
                                             
                                          
                                          
                                             (
                                             
                                                v
                                                
                                                   i
                                                   j
                                                
                                             
                                             )
                                          
                                          =
                                          λ
                                          
                                             (
                                             k
                                             N
                                             V
                                             +
                                             w
                                             γ
                                             
                                                α
                                                
                                                   i
                                                   j
                                                
                                             
                                             
                                                v
                                                
                                                   i
                                                   j
                                                
                                             
                                             +
                                             γ
                                             
                                                α
                                                
                                                   i
                                                   j
                                                
                                             
                                             
                                                f
                                                
                                                   i
                                                   j
                                                
                                             
                                             
                                                v
                                                
                                                   i
                                                   j
                                                
                                             
                                             +
                                             β
                                             γ
                                             
                                                v
                                                
                                                   i
                                                   j
                                                
                                                3
                                             
                                             )
                                          
                                          
                                             d
                                             
                                                i
                                                j
                                             
                                          
                                          /
                                          
                                             v
                                             
                                                i
                                                j
                                             
                                          
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     where λ = ξ/κψ and γ = 1/1000ηtfη are constants related to the fuel properties, β = 0, 5CdρA and w are constants associated with the vehicle characteristics and αij
                      is constant that depends on the road characteristics and on the vehicle acceleration. More precisely, αij
                      = τij
                      + gsin θij
                      + gCr
                     cos θij
                     , where τij
                      is the acceleration and θij
                      is the road angle inclination. The meaning and value of all parameters is given in Table A.6
                     . Assuming that acceleration and road inclination are null, the fuel consumption can alternatively be written as

                        
                           (A.2)
                           
                              
                                 
                                    Z
                                    
                                       i
                                       j
                                    
                                 
                                 
                                    (
                                    
                                       v
                                       
                                          i
                                          j
                                       
                                    
                                    )
                                 
                                 =
                                 
                                    (
                                    
                                       w
                                       1
                                    
                                    /
                                    
                                       v
                                       
                                          i
                                          j
                                       
                                    
                                    +
                                    
                                       w
                                       2
                                    
                                    +
                                    
                                       w
                                       3
                                    
                                    
                                       f
                                       
                                          i
                                          j
                                       
                                    
                                    +
                                    
                                       w
                                       4
                                    
                                    
                                       v
                                       
                                          i
                                          j
                                       
                                       2
                                    
                                    )
                                 
                                 
                                    d
                                    
                                       i
                                       j
                                    
                                 
                                 ,
                              
                           
                        
                     where w
                     1 = λkNV, w
                     2 = λwγgCr, w
                     3 = λγgCr
                      and w
                     4 = λβγ.

In the Tables B.7–B.10
                     
                     
                     
                      presented hereafter, Instance denotes the name of the instance, Cost indicates the value of the objective function, |R| is the number of vehicles, CPU T(s) represents the computing time in seconds, Gap(%) is the gap between the solution cost and CPLEX for the 10-customer instances or the best known solution obtained among all experiments for the other instances, given in the column BKS. Note that the approximate optimal solutions for the 10-customer instances were computed with the MIP formulation of Demir et al. (2012). It is impractical to consider all possible speed values in the model, and thus a speed-discretization was operated with 500 levels ranging from 
                        
                           v
                           f
                           *
                        
                      to 
                        
                           
                              v
                              f
                              *
                           
                           d
                        
                     . This leads in general to very high-quality upper bounds.

Detailed results for the VRPTW are presented in Tables C.11 and C.12
                     , using the same conventions as previously. Bold values refer to

solutions equal to the BKS, while the bold and underlined values refer to improved solutions. Column Gap(%) indicates the gap between the best solution and the BKS.

@&#REFERENCES@&#

