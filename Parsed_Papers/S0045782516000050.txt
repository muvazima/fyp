@&#MAIN-TITLE@&#Nonlinear structural design using multiscale topology optimization. Part II: Transient formulation

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           Adjoint sensitivity analysis for nonlinear elastodynamics.


                        
                        
                           
                           Composite design for desired energy propagation.


                        
                        
                           
                           Multiscale topology optimization.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Topology optimization

Elastodynamics

Energy management

Computational homogenization

@&#ABSTRACT@&#


               
               
                  We extend the hierarchical multiscale design framework of Nakshatrala et al. (2013) to nonlinear elastodynamics wherein we use topology optimization to design material micro-structures to achieve desired energy propagation in nonlinear elastic material systems subjected to impact loading. As in Part I, a well-posed topology optimization problem is obtained via (a) relaxation to design the macroscale which requires homogenization theory to relate the macroscopic homogenized response to its micro-structure and (b) via restriction to design the microscale to obtain a well-defined micro-structural length scale. It is assumed that the primary wavelengths of interest are much longer than the micro-structural length scale and hence the effective properties are computed using the static homogenization theory. An adjoint sensitivity analysis is performed to compute the derivatives of the objective function with respect to the micro-structural design parameters and a gradient-based optimization algorithm is used to update the design. The numerical implementation of the computationally challenging terminal-value adjoint problems is discussed and a structural design example for tailored energy propagation is provided.
               
            

@&#INTRODUCTION@&#

Wave propagation in highly heterogeneous media with gradually changing macroscopic material properties must be considered in many situations, e.g. for crashworthiness, acoustic and electromagnetic cloaking, impact mitigation and others. Towards this end, Le et al.  [1] use topology optimization to design structures with spatially varying material micro-structures comprised of linear elastic sequentially ranked laminates to tailor energy propagation. In the present work, we extend this study to the nonlinear elastic regime wherein the material micro-structure parameters are related to macroscopic effective properties via homogenization theory  [2–8]. To do this we extend the computational framework developed in Nakshatrala et al.  [9] to the dynamic regime.

Initial research on tailoring wave propagation is focused on electromagnetic cloaking [10–12] and acoustic cloaking [13–15] where gradually changing material properties are used to cloak objects at certain wavelengths. Elastodynamic applications are later explored in Milton et al.  [16], Brun et al.  [17], Norris and Shuvalov  [18] and Amirkhizi et al.  [19] by imposing gradual changes in the anisotropy of the material elasticity tensor. All these approaches introduce a prescribed spatial variation in the constitutive properties based on coordinate transformations surrounding the cloaking region.

As an alternative to the aforementioned analytical approaches, various computational frameworks based on topology optimization have been developed. Early approaches in topology optimization related to “dynamic loading” maximized the structure’s natural frequency  [20–22]. Similar approaches use the Floquet–Bloch wave theory to design both micro- and macro-structures, refer to Bendsøe and Sigmund  [23] and the references cited within. Topology optimization via inverse homogenization has been used to obtain periodic unit cell micro-structures for photonic  [24] and phononic  [25–28] bandgap structures. Also, multiple materials are optimally distributed in the macro-structure to design wave guides  [25,29]. The above approaches are based on frequency domain analysis. Topology optimization based on time domain analysis is addressed by Dahl et al.  [30], Min et al.  [31], Turteltaub  [32], Le et al.  [1]. In our work, we generate the desired nonlinear elastodynamic macroscopic trajectory by optimizing the micro-structure throughout the structure, i.e. the micro-structure at every point in the structure is optimized thus creating an optimized heterogeneous composite structure.

Optimal design of structures subjected to impact loads has been analyzed under the one-dimensional assumption by Bruck  [33], Velo and Gazonas  [34], where the objective was to reduce the amplitude of the stress waves. Le et al.  [1] design the optimal layer volume fractions and orientations in sequentially ranked laminates to obtain desired macroscopic energy trajectories in linear elastic two-dimensional structures subjected to impact loads. At each macroscopic material point, the laminate parameters are assigned and closed form homogenization expressions are used to compute the macroscopic effective properties. Sensitivities computed by an adjoint method are combined with nonlinear programming to optimize the laminate parameters.

Many of these studies assume linear elastic behavior; our work studies nonlinear elastodynamics by extending the multiscale topology optimization framework we discussed in Nakshatrala et al.  [9]. Specifically, we design the optimal micro-structural morphologies to obtain effective energy propagation in structures subject to impact loadings. The homogenization theory described in Nakshatrala et al.  [9] is again used to compute the “averaged” coarse scale response without fully resolving the high frequency oscillations corresponding to the fine scale. Indeed the static homogenization theory holds since we assume the primary wavelengths are much longer than the unit cell length scale  [2] whereby the material is considered homogeneous at the scale of the considered wavelengths even though microscopically it is highly heterogeneous.

We also use the numerical approach of Nakshatrala et al.  [9] wherein the macroscopic domain is discretized by finite elements; and each integration point of each macroscopic finite element is assigned a distinct micro-structure that is defined by its unit cell which itself is discretized by finite elements. Again as in Nakshatrala et al.  [9] our design variables are the material constituent volume fractions for each finite element in each unit cell corresponding to each integration point of each macroscopic finite element. And again like  [9] the response for a given design and time instant is computed using a multilevel nested Newton strategy where the outer iterations resolve the macroscopic momentum balance equation of the macro-structure while the inner iterations resolve the equilibrium equation of the micro-structural unit cells. As an extension of Nakshatrala et al.  [9] we consider dynamic response which is a straightforward extension for the analysis, but not the sensitivity analysis. Following  [35], a motivation for the choice of the discretize and then differentiate sensitivity analysis is provided through a linear oscillator example. The numerical implementation of the discrete adjoint sensitivity analysis is discussed and then combined with our optimality criteria based optimization algorithm  [23,1] to iteratively update the micro-structural design parameters. To do this we enhance the parallel framework as described in Nakshatrala et al.  [9] and apply the resulting framework to design an optimal material microstructure at each point in the macroscopic structure to achieve controlled energy propagation.

The organization of this manuscript is as follows. Section  2 presents the transient dynamic optimization problem, motivation for the adjoint sensitivity analysis is provided in Section  3, the sensitivity analysis is detailed in Section  4 and numerical examples and conclusions are provided in Sections  5 and 6.

Using the notation described in Nakshatrala et al.  [9], the elastodynamic governing equation of motion is 
                        
                           (1)
                           
                              div
                              
                                 (
                                 
                                    
                                       
                                          P
                                       
                                    
                                    
                                       ϵ
                                    
                                 
                                 )
                              
                              +
                              
                                 
                                    
                                       b
                                    
                                 
                                 
                                    ϵ
                                 
                              
                              =
                              
                                 
                                    ρ
                                 
                                 
                                    ϵ
                                 
                              
                              
                                 
                                    
                                       a
                                    
                                 
                                 
                                    ϵ
                                 
                              
                              ,
                              
                              
                                 x
                              
                              ∈
                              
                                 
                                    Ω
                                 
                                 
                                    ϵ
                                 
                              
                              ,
                           
                        
                      where 
                        
                           
                              
                                 a
                              
                           
                           
                              ϵ
                           
                        
                     , 
                        
                           
                              ρ
                           
                           
                              ϵ
                           
                        
                     , 
                        
                           
                              
                                 P
                              
                           
                           
                              ϵ
                           
                        
                     , 
                        
                           
                              
                                 b
                              
                           
                           
                              ϵ
                           
                        
                      and 
                        
                           x
                        
                      are the acceleration, mass density, first Piola–Kirchhoff stress, body force and material point location in the reference configuration 
                        
                           
                              Ω
                           
                           
                              ϵ
                           
                        
                      of the heterogeneous macro-structure, respectively.

We are concerned with the averaged response over the lengthscale 
                        ϵ
                      and not the fine scale oscillations. We compute this averaged (homogenized) response by replacing (1) with the homogenized equation 
                        
                           (2)
                           
                              div
                              
                                 (
                                 
                                    
                                       
                                          P
                                       
                                    
                                    
                                       M
                                    
                                 
                                 )
                              
                              +
                              
                                 
                                    
                                       b
                                    
                                 
                                 
                                    M
                                 
                              
                              =
                              
                                 
                                    ρ
                                 
                                 
                                    M
                                 
                              
                              
                                 
                                    
                                       a
                                    
                                 
                                 
                                    M
                                 
                              
                              ,
                              
                              
                                 x
                              
                              ∈
                              
                                 
                                    Ω
                                 
                                 
                                    M
                                 
                              
                              ,
                           
                        
                      with 
                        
                           
                              
                                 a
                              
                           
                           
                              M
                           
                        
                     , 
                        
                           
                              ρ
                           
                           
                              M
                           
                        
                     , 
                        
                           
                              
                                 P
                              
                           
                           
                              M
                           
                        
                      and 
                        
                           
                              
                                 b
                              
                           
                           
                              M
                           
                        
                      denoting the homogenized acceleration, mass density, first Piola–Kirchhoff stress and body force fields in the homogenized macro-structure 
                        
                           
                              Ω
                           
                           
                              M
                           
                        
                     . The homogenized density is trivially computed by volume averaging the densities of the constituent phases over the unit cell. Using the long wavelength assumption, we compute the homogenized stress 
                        
                           
                              
                                 P
                              
                           
                           
                              M
                           
                        
                      using the static homogenization theory, cf.  [2,9]. And while convergence proofs exist to show the displacement 
                        
                           
                              
                                 u
                              
                           
                           
                              ϵ
                           
                        
                        
                        ⇀
                        
                        
                           
                              
                                 u
                              
                           
                           
                              M
                           
                        
                        
                        
                        weakly in
                        
                        
                        U
                        
                           (
                           
                              
                                 Ω
                              
                              
                                 M
                              
                           
                           )
                        
                        ×
                        
                           [
                           0
                           ,
                           T
                           ]
                        
                      where 
                        U
                        =
                        
                           {
                           
                              u
                           
                           
                           ∈
                           
                              
                                 H
                              
                              
                                 1
                              
                           
                           
                              (
                              Ω
                              )
                           
                           ,
                           
                              u
                           
                           =
                           
                              0
                           
                           
                           on
                           
                           
                              
                                 Γ
                              
                              
                                 D
                              
                           
                           }
                        
                      with 
                        
                           
                              Γ
                           
                           
                              D
                           
                        
                      the portion of 
                        ∂
                        
                           
                              Ω
                           
                           
                              M
                           
                        
                      over which displacement is fixed and 
                        T
                      is the total simulation time, it is known that the energy corresponding to 
                        
                           
                              
                                 u
                              
                           
                           
                              ϵ
                           
                        
                      does not in general converge to the energy corresponding to 
                        
                           
                              
                                 u
                              
                           
                           
                              M
                           
                        
                     , cf.  [36]. Corrector problems can be introduced to ensure convergence but such a choice would complicate our optimization. However, the need for such correctors is not necessary if zero initial conditions are prescribed  [36]. As such we assign zero initial data in all our examples. This subtle point is critical to accurately evaluate the response.

The weak formulation for the macroscopic problem is to find 
                        
                           
                              
                                 u
                              
                           
                           
                              M
                           
                        
                        ∈
                        U
                        ×
                        
                           [
                           0
                           ,
                           T
                           ]
                        
                      such that at any given time 
                        t
                     
                     
                        
                           (3)
                           
                              
                                 
                                    r
                                 
                                 
                                    M
                                 
                              
                              
                                 (
                                 
                                    
                                       
                                          u
                                       
                                    
                                    
                                       M
                                    
                                 
                                 )
                              
                              ≔
                              
                                 
                                    ∫
                                 
                                 
                                    
                                       
                                          Ω
                                       
                                       
                                          M
                                       
                                    
                                 
                              
                              
                                 (
                                 
                                    
                                       ϱ
                                    
                                    
                                       M
                                    
                                 
                                 
                                    w
                                 
                                 ⋅
                                 
                                    
                                       
                                          a
                                       
                                    
                                    
                                       M
                                    
                                 
                                 +
                                 ∇
                                 
                                    w
                                 
                                 ⋅
                                 
                                    
                                       
                                          P
                                       
                                    
                                    
                                       M
                                    
                                 
                                 −
                                 
                                    w
                                 
                                 ⋅
                                 
                                    b
                                 
                                 )
                              
                              
                              
                                 d
                              
                              Ω
                              =
                              0
                              
                              ∀
                              
                              
                                 w
                              
                              
                              ∈
                              
                              U
                              ,
                           
                        
                      where, without loss of generality, we assume zero applied traction. We use the 
                        a
                        −
                     form of Newmark’s implicit time-stepping scheme  [37] coupled with Newton’s method to solve (3). To this end, (3) is discretized in time to obtain 
                        
                           (4)
                           
                              
                                 
                                    r
                                 
                                 
                                    M
                                 
                                 
                                    
                                       (
                                       n
                                       )
                                    
                                 
                              
                              
                                 (
                                 
                                    
                                       
                                          a
                                       
                                    
                                    
                                       M
                                    
                                    
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 
                                 )
                              
                              ≔
                              
                                 
                                    ∫
                                 
                                 
                                    Ω
                                 
                              
                              
                                 (
                                 
                                    
                                       ϱ
                                    
                                    
                                       
                                          
                                          
                                             M
                                          
                                       
                                    
                                 
                                 
                                    w
                                 
                                 ⋅
                                 
                                    
                                       
                                          a
                                       
                                    
                                    
                                       M
                                    
                                    
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 
                                 +
                                 ∇
                                 
                                    w
                                 
                                 ⋅
                                 
                                    
                                       
                                          P
                                       
                                    
                                    
                                       M
                                    
                                    
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 
                                 −
                                 
                                    w
                                 
                                 ⋅
                                 
                                    
                                       
                                          b
                                       
                                    
                                    
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 
                                 )
                              
                              
                              
                                 d
                              
                              Ω
                              =
                              0
                              ,
                           
                        
                      where 
                        
                           
                              
                                 a
                              
                           
                           
                              M
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                        =
                        
                           
                              
                                 a
                              
                           
                           
                              M
                           
                        
                        
                           (
                           
                              
                                 t
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                           )
                        
                      etc. and 
                        
                           
                              t
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                      denotes the time. The argument switch from 
                        
                           
                              
                                 u
                              
                           
                           
                              M
                           
                        
                      to 
                        
                           
                              
                                 a
                              
                           
                           
                              M
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                      in the residuals of (3) and (4) is justified by the Newmark update equations that relate acceleration 
                        
                           
                              
                                 a
                              
                           
                           
                              M
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                      to displacement 
                        
                           
                              
                                 u
                              
                           
                           
                              M
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                      and velocity 
                        
                           
                              
                                 v
                              
                           
                           
                              M
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                     , viz. 
                        
                           
                              (5)
                              
                                 
                                    
                                       
                                          u
                                       
                                    
                                    
                                       M
                                    
                                    
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 
                                 =
                                 
                                    
                                       
                                          u
                                       
                                    
                                    
                                       M
                                    
                                    
                                       
                                          (
                                          n
                                          −
                                          1
                                          )
                                       
                                    
                                 
                                 +
                                 Δ
                                 t
                                 
                                 
                                    
                                       
                                          v
                                       
                                    
                                    
                                       M
                                    
                                    
                                       
                                          (
                                          n
                                          −
                                          1
                                          )
                                       
                                    
                                 
                                 +
                                 
                                    
                                       
                                          (
                                          1
                                          −
                                          2
                                          β
                                          )
                                       
                                    
                                    
                                       2
                                    
                                 
                                 
                                 Δ
                                 
                                    
                                       t
                                    
                                    
                                       2
                                    
                                 
                                 
                                 
                                    
                                       
                                          a
                                       
                                    
                                    
                                       M
                                    
                                    
                                       
                                          (
                                          n
                                          −
                                          1
                                          )
                                       
                                    
                                 
                                 +
                                 β
                                 Δ
                                 
                                    
                                       t
                                    
                                    
                                       2
                                    
                                 
                                 
                                 
                                    
                                       
                                          a
                                       
                                    
                                    
                                       M
                                    
                                    
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 
                                 ,
                              
                           
                           
                              (6)
                              
                                 
                                    
                                       
                                          v
                                       
                                    
                                    
                                       M
                                    
                                    
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 
                                 =
                                 
                                    
                                       
                                          v
                                       
                                    
                                    
                                       M
                                    
                                    
                                       
                                          (
                                          n
                                          −
                                          1
                                          )
                                       
                                    
                                 
                                 +
                                 
                                    (
                                    1
                                    −
                                    γ
                                    )
                                 
                                 Δ
                                 t
                                 
                                 
                                    
                                       
                                          a
                                       
                                    
                                    
                                       M
                                    
                                    
                                       
                                          (
                                          n
                                          −
                                          1
                                          )
                                       
                                    
                                 
                                 +
                                 γ
                                 Δ
                                 t
                                 
                                 
                                    
                                       
                                          a
                                       
                                    
                                    
                                       M
                                    
                                    
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 
                                 ,
                              
                           
                        
                      where 
                        β
                      and 
                        γ
                      are the Newmark stability parameters and 
                        Δ
                        t
                        =
                        
                           
                              t
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                        −
                        
                           
                              t
                           
                           
                              
                                 (
                                 n
                                 −
                                 1
                                 )
                              
                           
                        
                      is the time increment  [37].

At each time 
                        
                           
                              t
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                     , we solve (4) via Newton’s method to compute 
                        
                           
                              
                                 a
                              
                           
                           
                              M
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                      and subsequently update the values of 
                        
                           
                              
                                 u
                              
                           
                           
                              M
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                      and 
                        
                           
                              
                                 v
                              
                           
                           
                              M
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                      via (5)–(6). Each Newton iteration requires us to compute the response correction 
                        δ
                        
                           
                              
                                 a
                              
                           
                           
                              M
                           
                        
                      such that 
                        
                           (7)
                           
                              δ
                              
                                 
                                    r
                                 
                                 
                                    M
                                 
                                 
                                    
                                       (
                                       n
                                       )
                                    
                                 
                              
                              
                                 (
                                 
                                    
                                       
                                          a
                                       
                                    
                                    
                                       M
                                    
                                    
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 
                                 ;
                                 δ
                                 
                                    
                                       
                                          a
                                       
                                    
                                    
                                       M
                                    
                                    
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 
                                 )
                              
                              +
                              
                                 
                                    r
                                 
                                 
                                    M
                                 
                                 
                                    
                                       (
                                       n
                                       )
                                    
                                 
                              
                              
                                 (
                                 
                                    
                                       
                                          a
                                       
                                    
                                    
                                       M
                                    
                                    
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 
                                 )
                              
                              =
                              0
                              ,
                           
                        
                      where the variation of (3) is 
                        
                           (8)
                           
                              δ
                              
                                 
                                    r
                                 
                                 
                                    M
                                 
                                 
                                    
                                       (
                                       n
                                       )
                                    
                                 
                              
                              
                                 (
                                 
                                    
                                       
                                          a
                                       
                                    
                                    
                                       M
                                    
                                    
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 
                                 ;
                                 δ
                                 
                                    
                                       
                                          a
                                       
                                    
                                    
                                       M
                                    
                                    
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 
                                 )
                              
                              =
                              
                                 
                                    ∫
                                 
                                 
                                    Ω
                                 
                              
                              
                                 (
                                 
                                    
                                       ϱ
                                    
                                    
                                       
                                          
                                          
                                             M
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          w
                                       
                                    
                                    
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 
                                 ⋅
                                 δ
                                 
                                    
                                       
                                          a
                                       
                                    
                                    
                                       M
                                    
                                    
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 
                                 +
                                 β
                                 Δ
                                 
                                    
                                       t
                                    
                                    
                                       2
                                    
                                 
                                 ∇
                                 
                                    w
                                 
                                 ⋅
                                 
                                    
                                       A
                                    
                                    
                                       M
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             F
                                          
                                       
                                       
                                          M
                                       
                                       
                                          
                                             (
                                             n
                                             )
                                          
                                       
                                    
                                    )
                                 
                                 
                                    [
                                    ∇
                                    δ
                                    
                                       
                                          
                                             a
                                          
                                       
                                       
                                          M
                                       
                                       
                                          
                                             (
                                             n
                                             )
                                          
                                       
                                    
                                    ]
                                 
                                 )
                              
                              
                              
                                 d
                              
                              Ω
                              ,
                           
                        
                      in which we use (5) to obtain 
                        ∇
                        δ
                        
                           
                              
                                 u
                              
                           
                           
                              M
                           
                        
                        =
                        β
                        Δ
                        
                           
                              t
                           
                           
                              2
                           
                        
                        ∇
                        δ
                        
                           
                              
                                 a
                              
                           
                           
                              M
                           
                        
                      and see the appearance of the incremental elasticity tensor 
                        
                           
                              A
                           
                           
                              M
                           
                        
                        
                           (
                           
                              
                                 
                                    F
                                 
                              
                              
                                 M
                              
                           
                           )
                        
                        =
                        ∂
                        
                           
                              
                                 P
                              
                           
                           
                              M
                           
                        
                        
                           (
                           
                              
                                 
                                    F
                                 
                              
                              
                                 M
                              
                           
                           )
                        
                        /
                        ∂
                        
                           
                              
                                 F
                              
                           
                           
                              M
                           
                        
                      derived in Nakshatrala et al.  [9]. After finite element discretization (7) takes the familiar form 
                        
                           (9)
                           
                              
                                 (
                                 
                                    M
                                 
                                 +
                                 β
                                 Δ
                                 
                                    
                                       t
                                    
                                    
                                       2
                                    
                                 
                                 
                                 
                                    
                                       
                                          K
                                       
                                    
                                    
                                       T
                                    
                                    
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 
                                 )
                              
                              
                              δ
                              
                                 
                                    
                                       a
                                    
                                 
                                 
                                    
                                       (
                                       n
                                       )
                                    
                                 
                              
                              =
                              −
                              
                                 
                                    
                                       R
                                    
                                 
                                 
                                    
                                       (
                                       n
                                       )
                                    
                                 
                              
                           
                        
                      where 
                        
                           M
                        
                      and 
                        
                           
                              
                                 K
                              
                           
                           
                              T
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                      are the mass and tangent stiffness matrices and 
                        δ
                        
                           
                              
                                 a
                              
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                      and 
                        
                           
                              
                                 R
                              
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                      are the nodal update acceleration and residual vectors.
                        1
                     
                     
                        1
                        Henceforth sans-serif font denotes finite element quantities that result after parameterizing the response and integrating over the domain 
                              Ω
                            in the usual manner.
                      The formation of 
                        
                           
                              
                                 K
                              
                           
                           
                              T
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                      is identical to that discussed in Nakshatrala et al.  [9] and the formation of 
                        
                           
                              
                                 R
                              
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                      is also the same sans the added dynamic term 
                        
                           M
                        
                        
                        
                           
                              
                                 a
                              
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                      which is standard. Upon updating the 
                        
                           
                              
                                 a
                              
                           
                           
                              M
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                        =
                        
                           
                              
                                 a
                              
                           
                           
                              M
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                        +
                        δ
                        
                           
                              
                                 a
                              
                           
                           
                              M
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                     , we update the displacement 
                        
                           
                              
                                 u
                              
                           
                           
                              M
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                        =
                        
                           
                              
                                 u
                              
                           
                           
                              M
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                        +
                        β
                        
                        Δ
                        
                           
                              t
                           
                           
                              2
                           
                        
                        
                        δ
                        
                           
                              
                                 a
                              
                           
                           
                              M
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                      and velocity 
                        
                           
                              
                                 v
                              
                           
                           
                              M
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                        =
                        
                           
                              
                                 v
                              
                           
                           
                              M
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                        +
                        γ
                        
                        Δ
                        t
                        
                        δ
                        
                           
                              
                                 a
                              
                           
                           
                              M
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                      via (5) and (6). Iterations continue until (4) is satisfied to within a specified convergence tolerance whereupon the time 
                        
                           
                              t
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                      is incremented to 
                        
                           
                              t
                           
                           
                              
                                 (
                                 n
                                 +
                                 1
                                 )
                              
                           
                        
                        =
                        
                           
                              t
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                        +
                        Δ
                        t
                      and the process begins anew.

In order to motivate the subsequent adjoint sensitivity analysis for our multiscale problem, we first consider a spring mass system with two degrees of freedom (see Fig. 1
                     ). The equation of motion for this system is 
                        
                           (10)
                           
                              
                                 M
                              
                              
                                 a
                              
                              +
                              
                                 K
                              
                              
                                 u
                              
                              =
                              
                                 f
                              
                              ,
                           
                        
                      where 
                        
                           M
                        
                        =
                        
                           [
                           
                              
                                 
                                    
                                       
                                          m
                                       
                                       
                                          1
                                       
                                    
                                 
                                 
                                    0
                                 
                              
                              
                                 
                                    0
                                 
                                 
                                    
                                       
                                          m
                                       
                                       
                                          2
                                       
                                    
                                 
                              
                           
                           ]
                        
                      is the mass matrix, 
                        
                           K
                        
                        =
                        
                           [
                           
                              
                                 
                                    
                                       (
                                       
                                          
                                             k
                                          
                                          
                                             1
                                          
                                       
                                       +
                                       
                                          
                                             k
                                          
                                          
                                             2
                                          
                                       
                                       )
                                    
                                 
                                 
                                    −
                                    
                                       
                                          k
                                       
                                       
                                          2
                                       
                                    
                                 
                              
                              
                                 
                                    −
                                    
                                       
                                          k
                                       
                                       
                                          2
                                       
                                    
                                 
                                 
                                    
                                       (
                                       
                                          
                                             k
                                          
                                          
                                             2
                                          
                                       
                                       +
                                       
                                          
                                             k
                                          
                                          
                                             3
                                          
                                       
                                       )
                                    
                                 
                              
                           
                           ]
                        
                      is the stiffness matrix and 
                        
                           f
                        
                      is the time varying forcing function. Here and for future reference we recall that 
                        
                           u
                        
                     , 
                        
                           v
                        
                      and 
                        
                           a
                        
                      are the displacement, velocity and acceleration vectors. For the sensitivity analysis, we treat 
                        
                           M
                        
                      and 
                        
                           K
                        
                      as explicit functions of the design parameter vector 
                        
                           d
                        
                      making 
                        
                           u
                        
                     , 
                        
                           v
                        
                      and 
                        
                           a
                        
                      implicit functions of 
                        
                           d
                        
                     .

For our sensitivity analysis we consider a general response function of the displacement, velocity, acceleration and the design parameter 
                        d
                      (a component of 
                        
                           d
                        
                     ) i.e.,  
                        
                           (11)
                           
                              Θ
                              
                                 (
                                 d
                                 )
                              
                              =
                              
                                 
                                    ∫
                                 
                                 
                                    0
                                 
                                 
                                    T
                                 
                              
                              π
                              
                                 (
                                 
                                    u
                                 
                                 
                                    (
                                    t
                                    ,
                                    d
                                    )
                                 
                                 ,
                                 
                                    v
                                 
                                 
                                    (
                                    t
                                    ,
                                    d
                                    )
                                 
                                 ,
                                 
                                    a
                                 
                                 
                                    (
                                    t
                                    ,
                                    d
                                    )
                                 
                                 ,
                                 d
                                 ,
                                 t
                                 )
                              
                              
                              d
                              t
                              ,
                           
                        
                      where 
                        
                           [
                           0
                           ,
                           T
                           ]
                        
                      is the time interval of interest. The derivative of (11) with respect to 
                        d
                      is 
                        
                           (12)
                           
                              ∇
                              Θ
                              =
                              
                                 
                                    ∫
                                 
                                 
                                    0
                                 
                                 
                                    T
                                 
                              
                              
                                 (
                                 
                                    
                                       ∂
                                       π
                                    
                                    
                                       ∂
                                       
                                          u
                                       
                                    
                                 
                                 
                                 D
                                 
                                    u
                                 
                                 +
                                 
                                    
                                       ∂
                                       π
                                    
                                    
                                       ∂
                                       
                                          v
                                       
                                    
                                 
                                 
                                 D
                                 
                                    v
                                 
                                 +
                                 
                                    
                                       ∂
                                       π
                                    
                                    
                                       ∂
                                       
                                          a
                                       
                                    
                                 
                                 
                                 D
                                 
                                    a
                                 
                                 +
                                 
                                    
                                       ∂
                                       π
                                    
                                    
                                       ∂
                                       d
                                    
                                 
                                 )
                              
                              
                              d
                              t
                              ,
                           
                        
                      where 
                        D
                        
                           u
                        
                     , 
                        D
                        
                           v
                        
                      and 
                        D
                        
                           a
                        
                      are the derivatives of 
                        
                           u
                        
                     , 
                        
                           v
                        
                      and 
                        
                           a
                        
                      with respect to 
                        d
                     . For this simple system, it is easy to compute the analytical solution to (10) and thusly evaluate the derivative 
                        ∇
                        Θ
                      in (12). Bearing in mind the forthcoming nonlinear finite element applications, we solve (10) numerically via the aforementioned implicit Newmark scheme. Using the computed response, 
                        Θ
                        
                           (
                           d
                           )
                        
                      is approximated via, e.g the rectangular summation rule as 
                        
                           (13)
                           
                              
                                 
                                    Θ
                                 
                                 
                                    a
                                 
                              
                              
                                 (
                                 d
                                 )
                              
                              =
                              
                                 
                                    ∑
                                 
                                 
                                    n
                                    =
                                    1
                                 
                                 
                                    N
                                 
                              
                              
                                 
                                    π
                                 
                                 
                                    
                                       (
                                       n
                                       )
                                    
                                 
                              
                              
                                 (
                                 
                                    
                                       
                                          u
                                       
                                    
                                    
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 
                                 
                                    (
                                    d
                                    )
                                 
                                 ,
                                 
                                    
                                       
                                          v
                                       
                                    
                                    
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 
                                 
                                    (
                                    d
                                    )
                                 
                                 ,
                                 
                                    
                                       
                                          a
                                       
                                    
                                    
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 
                                 
                                    (
                                    d
                                    )
                                 
                                 ,
                                 d
                                 )
                              
                              
                              Δ
                              t
                              ,
                           
                        
                      where we replace the argument 
                        
                           
                              t
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                      in 
                        π
                      with the superscript, i.e.  
                        
                           
                              π
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                        
                           (
                           
                              
                                 
                                    u
                                 
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                           
                              (
                              d
                              )
                           
                           ,
                           
                              
                                 
                                    v
                                 
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                           
                              (
                              d
                              )
                           
                           ,
                           
                              
                                 
                                    a
                                 
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                           
                              (
                              d
                              )
                           
                           ,
                           d
                           )
                        
                        =
                     
                     
                        π
                        
                           (
                           
                              
                                 
                                    u
                                 
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                           
                              (
                              d
                              )
                           
                           ,
                           
                              
                                 
                                    v
                                 
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                           
                              (
                              d
                              )
                           
                           ,
                           
                              
                                 
                                    a
                                 
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                           
                              (
                              d
                              )
                           
                           ,
                           d
                           ,
                           
                              
                                 t
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                           )
                        
                     .

In most studies on dynamic topology optimization the sensitivities are computed via the differentiate and then discretize adjoint variable approach [32,38,39] with the exception of Le et al.  [1] in which a discretize and then differentiate approach is used. In what follows, we review two ways to compute numerical approximations to (12) via an adjoint method  [35]: they are the (a) differentiate and then discretize procedure; and (b) discretize and then differentiate procedure.
                        2
                     
                     
                        2
                        An additional procedure discussed in Jensen et al.  [35] is not discussed here due to its cumbersome numerical implementation.
                     ; We then compare them to motivate the approach (b) that is used in our nonlinear transient dynamic applications.

In adjoint-based sensitivity analysis, we compute the derivative of the response function by eliminating the implicit derivatives 
                           D
                           
                              u
                           
                        , 
                           D
                           
                              v
                           
                         and 
                           D
                           
                              a
                           
                         that are difficult to compute  [40]. To accomplish this annihilation we take the derivative of (10) with respect to 
                           d
                         (this is often referred to as the pseudo equation) and multiply it by an arbitrary, smooth adjoint variable 
                           
                              λ
                           
                        , integrate over the time interval 
                           
                              [
                              0
                              ,
                              T
                              ]
                           
                         and add the resulting zero i.e.,  
                           
                              
                                 ∫
                              
                              
                                 0
                              
                              
                                 T
                              
                           
                           
                              
                                 
                                    λ
                                 
                              
                              
                                 T
                              
                           
                           
                              
                                 D
                              
                              
                                 D
                                 d
                              
                           
                           
                              (
                              
                                 M
                              
                              
                                 a
                              
                              +
                              
                                 K
                              
                              
                                 u
                              
                              −
                              
                                 f
                              
                              )
                           
                           d
                           t
                           =
                           0
                        to (12). Twice integrating the resulting expression by parts and rearranging yields 
                           
                              (14)
                              
                                 ∇
                                 Θ
                                 =
                                 
                                    
                                       ∫
                                    
                                    
                                       0
                                    
                                    
                                       T
                                    
                                 
                                 
                                    (
                                    
                                       
                                          ∂
                                          π
                                       
                                       
                                          ∂
                                          
                                             u
                                          
                                       
                                    
                                    
                                    D
                                    
                                       u
                                    
                                    +
                                    
                                       
                                          ∂
                                          π
                                       
                                       
                                          ∂
                                          
                                             v
                                          
                                       
                                    
                                    
                                    D
                                    
                                       v
                                    
                                    +
                                    
                                       
                                          ∂
                                          π
                                       
                                       
                                          ∂
                                          
                                             a
                                          
                                       
                                    
                                    
                                    D
                                    
                                       a
                                    
                                    +
                                    
                                       
                                          ∂
                                          π
                                       
                                       
                                          ∂
                                          d
                                       
                                    
                                    )
                                 
                                 
                                 d
                                 t
                                 
                                 +
                                 
                                    
                                       ∫
                                    
                                    
                                       0
                                    
                                    
                                       T
                                    
                                 
                                 
                                    
                                       
                                          λ
                                       
                                    
                                    
                                       T
                                    
                                 
                                 
                                    
                                       D
                                    
                                    
                                       D
                                       d
                                    
                                 
                                 
                                    (
                                    
                                       M
                                    
                                    
                                       a
                                    
                                    +
                                    
                                       K
                                    
                                    
                                       u
                                    
                                    −
                                    
                                       f
                                    
                                    )
                                 
                                 d
                                 t
                                 =
                                 
                                    
                                       ∫
                                    
                                    
                                       0
                                    
                                    
                                       T
                                    
                                 
                                 
                                    
                                       
                                          λ
                                       
                                    
                                    
                                       T
                                    
                                 
                                 
                                    (
                                    D
                                    
                                       M
                                    
                                    
                                       a
                                    
                                    +
                                    D
                                    
                                       K
                                    
                                    
                                       u
                                    
                                    )
                                 
                                 d
                                 t
                                 +
                                 
                                    
                                       ∫
                                    
                                    
                                       0
                                    
                                    
                                       T
                                    
                                 
                                 
                                    
                                       
                                          (
                                          D
                                          
                                             u
                                          
                                          )
                                       
                                    
                                    
                                       T
                                    
                                 
                                 
                                    [
                                    
                                       M
                                    
                                    
                                       
                                          
                                             λ
                                          
                                       
                                       
                                          ̈
                                       
                                    
                                    +
                                    
                                       K
                                    
                                    
                                       λ
                                    
                                    +
                                    
                                       
                                          
                                             (
                                             
                                                
                                                   ∂
                                                   π
                                                
                                                
                                                   ∂
                                                   
                                                      u
                                                   
                                                
                                             
                                             −
                                             
                                                
                                                   d
                                                
                                                
                                                   d
                                                   t
                                                
                                             
                                             
                                                (
                                                
                                                   
                                                      ∂
                                                      π
                                                   
                                                   
                                                      ∂
                                                      
                                                         v
                                                      
                                                   
                                                
                                                )
                                             
                                             +
                                             
                                                
                                                   
                                                      
                                                         d
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                                
                                                   d
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                             
                                                (
                                                
                                                   
                                                      ∂
                                                      π
                                                   
                                                   
                                                      ∂
                                                      
                                                         a
                                                      
                                                   
                                                
                                                )
                                             
                                             )
                                          
                                       
                                       
                                          T
                                       
                                    
                                    ]
                                 
                                 d
                                 t
                                 +
                                 
                                    [
                                    
                                       
                                          
                                             (
                                             D
                                             
                                                u
                                             
                                             )
                                          
                                       
                                       
                                          T
                                       
                                    
                                    
                                       (
                                       
                                          
                                             
                                                (
                                                
                                                   
                                                      ∂
                                                      π
                                                   
                                                   
                                                      ∂
                                                      
                                                         v
                                                      
                                                   
                                                
                                                −
                                                
                                                   
                                                      d
                                                   
                                                   
                                                      d
                                                      t
                                                   
                                                
                                                
                                                   (
                                                   
                                                      
                                                         ∂
                                                         π
                                                      
                                                      
                                                         ∂
                                                         
                                                            a
                                                         
                                                      
                                                   
                                                   )
                                                
                                                )
                                             
                                          
                                          
                                             T
                                          
                                       
                                       −
                                       
                                          M
                                       
                                       
                                          
                                             
                                                λ
                                             
                                          
                                          
                                             ̇
                                          
                                       
                                       )
                                    
                                    +
                                    
                                       
                                          
                                             (
                                             D
                                             
                                                v
                                             
                                             )
                                          
                                       
                                       
                                          T
                                       
                                    
                                    
                                       (
                                       
                                          
                                             
                                                (
                                                
                                                   
                                                      ∂
                                                      π
                                                   
                                                   
                                                      ∂
                                                      
                                                         a
                                                      
                                                   
                                                
                                                )
                                             
                                          
                                          
                                             T
                                          
                                       
                                       +
                                       
                                          M
                                       
                                       
                                       
                                          λ
                                       
                                       )
                                    
                                    ]
                                 
                                 
                                    
                                       |
                                    
                                    
                                       t
                                       =
                                       T
                                    
                                 
                                 ,
                              
                           
                         where, without loss of generality, we use the simplifying assumptions 
                           ∂
                           
                              f
                           
                           /
                           ∂
                           d
                           =
                           D
                           
                              
                                 
                                    u
                                 
                              
                              
                                 
                                    (
                                    0
                                    )
                                 
                              
                           
                           =
                           D
                           
                              
                                 
                                    v
                                 
                              
                              
                                 
                                    (
                                    0
                                    )
                                 
                              
                           
                           =
                           
                              0
                           
                        . To eliminate the response derivatives 
                           D
                           
                              u
                           
                        , 
                           D
                           
                              v
                           
                         and 
                           D
                           
                              a
                           
                         from (14), we define the adjoint variable 
                           
                              λ
                           
                         such that it annihilates the terms in brackets. This would yield an adjoint problem that is similar to the primal analysis but with terminal conditions 
                           
                              M
                           
                           
                           
                              λ
                           
                           
                              (
                              T
                              )
                           
                           =
                           −
                           
                              
                                 
                                    (
                                    ∂
                                    π
                                    /
                                    ∂
                                    
                                       a
                                    
                                    )
                                 
                              
                              
                                 T
                              
                           
                         and 
                           
                              M
                           
                           
                           
                              
                                 
                                    λ
                                 
                              
                              
                                 ̇
                              
                           
                           
                              (
                              T
                              )
                           
                           =
                           
                              
                                 
                                    (
                                    ∂
                                    π
                                    /
                                    ∂
                                    
                                       v
                                    
                                    −
                                    
                                       
                                          d
                                       
                                       
                                          d
                                          t
                                       
                                    
                                    
                                       (
                                       ∂
                                       π
                                       /
                                       ∂
                                       
                                          a
                                       
                                       )
                                    
                                    )
                                 
                              
                              
                                 T
                              
                           
                           
                              
                                 |
                              
                              
                                 t
                                 =
                                 T
                              
                           
                         making the adjoint problem a terminal-value problem. To make the adjoint problem resemble the primal initial-value problem, we apply a change of variable such that 
                           t
                           =
                           τ
                           
                              (
                              s
                              )
                           
                           =
                           T
                           −
                           s
                         and introduce the composite function 
                           
                              Λ
                           
                         such that 
                           
                              Λ
                           
                           
                              (
                              s
                              )
                           
                           =
                           
                              λ
                           
                           
                              (
                              τ
                              
                                 (
                                 s
                                 )
                              
                              )
                           
                           =
                           
                              λ
                           
                           
                              (
                              T
                              −
                              s
                              )
                           
                         to transform the terms involving the response derivatives 
                           D
                           
                              u
                           
                         and 
                           D
                           
                              v
                           
                         to 
                           
                              (15)
                              
                                 ∇
                                 Θ
                                 =
                                 
                                    
                                       ∫
                                    
                                    
                                       0
                                    
                                    
                                       T
                                    
                                 
                                 
                                    
                                       ∂
                                       π
                                    
                                    
                                       ∂
                                       d
                                    
                                 
                                 
                                 d
                                 t
                                 +
                                 
                                    
                                       ∫
                                    
                                    
                                       0
                                    
                                    
                                       T
                                    
                                 
                                 
                                    
                                       
                                          λ
                                       
                                    
                                    
                                       T
                                    
                                 
                                 
                                    (
                                    D
                                    
                                       M
                                    
                                    
                                       a
                                    
                                    +
                                    D
                                    
                                       K
                                    
                                    
                                       u
                                    
                                    )
                                 
                                 d
                                 t
                                 +
                                 
                                    
                                       ∫
                                    
                                    
                                       0
                                    
                                    
                                       T
                                    
                                 
                                 
                                    
                                       
                                          (
                                          D
                                          
                                             u
                                          
                                          
                                             (
                                             τ
                                             
                                                (
                                                s
                                                )
                                             
                                             )
                                          
                                          )
                                       
                                    
                                    
                                       T
                                    
                                 
                                 
                                    [
                                    
                                       M
                                    
                                    
                                       
                                          
                                             Λ
                                          
                                       
                                       
                                          ̈
                                       
                                    
                                    
                                       (
                                       s
                                       )
                                    
                                    +
                                    
                                       K
                                    
                                    
                                       Λ
                                    
                                    
                                       (
                                       s
                                       )
                                    
                                    +
                                    
                                       
                                          
                                             (
                                             
                                                
                                                   ∂
                                                   π
                                                
                                                
                                                   ∂
                                                   
                                                      u
                                                   
                                                
                                             
                                             −
                                             
                                                
                                                   d
                                                
                                                
                                                   d
                                                   t
                                                
                                             
                                             
                                                (
                                                
                                                   
                                                      ∂
                                                      π
                                                   
                                                   
                                                      ∂
                                                      
                                                         v
                                                      
                                                   
                                                
                                                )
                                             
                                             +
                                             
                                                
                                                   
                                                      
                                                         d
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                                
                                                   d
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                             
                                                (
                                                
                                                   
                                                      ∂
                                                      π
                                                   
                                                   
                                                      ∂
                                                      
                                                         a
                                                      
                                                   
                                                
                                                )
                                             
                                             )
                                          
                                       
                                       
                                          T
                                       
                                    
                                    
                                       
                                          |
                                       
                                       
                                          t
                                          =
                                          τ
                                          
                                             (
                                             s
                                             )
                                          
                                       
                                    
                                    ]
                                 
                                 d
                                 s
                                 +
                                 
                                    
                                       
                                          (
                                          D
                                          
                                             u
                                          
                                          
                                             (
                                             T
                                             )
                                          
                                          )
                                       
                                    
                                    
                                       T
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             (
                                             
                                                
                                                   ∂
                                                   π
                                                
                                                
                                                   ∂
                                                   
                                                      v
                                                   
                                                
                                             
                                             −
                                             
                                                
                                                   d
                                                
                                                
                                                   d
                                                   t
                                                
                                             
                                             
                                                (
                                                
                                                   
                                                      ∂
                                                      π
                                                   
                                                   
                                                      ∂
                                                      
                                                         a
                                                      
                                                   
                                                
                                                )
                                             
                                             )
                                          
                                       
                                       
                                          T
                                       
                                    
                                    
                                       
                                          |
                                       
                                       
                                          t
                                          =
                                          T
                                       
                                    
                                    +
                                    
                                       M
                                    
                                    
                                       
                                          
                                             Λ
                                          
                                       
                                       
                                          ̇
                                       
                                    
                                    
                                       (
                                       0
                                       )
                                    
                                    )
                                 
                                 +
                                 
                                    
                                       
                                          (
                                          D
                                          
                                             v
                                          
                                          
                                             (
                                             T
                                             )
                                          
                                          )
                                       
                                    
                                    
                                       T
                                    
                                 
                                 
                                 
                                    [
                                    
                                       
                                          
                                             (
                                             
                                                
                                                   ∂
                                                   π
                                                
                                                
                                                   ∂
                                                   
                                                      a
                                                   
                                                
                                             
                                             )
                                          
                                       
                                       
                                          T
                                       
                                    
                                    
                                       
                                          |
                                       
                                       
                                          t
                                          =
                                          T
                                       
                                    
                                    +
                                    
                                       M
                                    
                                    
                                    
                                       Λ
                                    
                                    
                                       (
                                       0
                                       )
                                    
                                    ]
                                 
                                 .
                              
                           
                         To annihilate the response derivatives we now assign the heretofore arbitrary adjoint variable 
                           
                              Λ
                           
                         such that 
                           
                              
                                 
                                    
                                       M
                                    
                                    
                                    
                                       
                                          
                                             Λ
                                          
                                       
                                       
                                          ̈
                                       
                                    
                                    
                                       (
                                       s
                                       )
                                    
                                    +
                                    
                                       K
                                    
                                    
                                    
                                       Λ
                                    
                                    
                                       (
                                       s
                                       )
                                    
                                    =
                                    −
                                    
                                       
                                          
                                             (
                                             
                                                
                                                   ∂
                                                   π
                                                
                                                
                                                   ∂
                                                   
                                                      u
                                                   
                                                
                                             
                                             −
                                             
                                                
                                                   d
                                                
                                                
                                                   d
                                                   t
                                                
                                             
                                             
                                                (
                                                
                                                   
                                                      ∂
                                                      π
                                                   
                                                   
                                                      ∂
                                                      
                                                         v
                                                      
                                                   
                                                
                                                )
                                             
                                             +
                                             
                                                
                                                   
                                                      
                                                         d
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                                
                                                   d
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                             
                                                (
                                                
                                                   
                                                      ∂
                                                      π
                                                   
                                                   
                                                      ∂
                                                      
                                                         a
                                                      
                                                   
                                                
                                                )
                                             
                                             )
                                          
                                       
                                       
                                          T
                                       
                                    
                                    
                                       
                                          |
                                       
                                       
                                          t
                                          =
                                          τ
                                          
                                             (
                                             s
                                             )
                                          
                                       
                                    
                                    ,
                                 
                              
                              
                                 
                                    
                                       M
                                    
                                    
                                    
                                       Λ
                                    
                                    
                                       (
                                       0
                                       )
                                    
                                    =
                                    −
                                    
                                       
                                          
                                             (
                                             
                                                
                                                   ∂
                                                   π
                                                
                                                
                                                   ∂
                                                   
                                                      a
                                                   
                                                
                                             
                                             )
                                          
                                       
                                       
                                          T
                                       
                                    
                                    
                                       
                                          |
                                       
                                       
                                          t
                                          =
                                          T
                                       
                                    
                                    ,
                                 
                              
                              
                                 (16)
                                 
                                    
                                       M
                                    
                                    
                                    
                                       
                                          
                                             Λ
                                          
                                       
                                       
                                          ̇
                                       
                                    
                                    
                                       (
                                       0
                                       )
                                    
                                    =
                                    −
                                    
                                       
                                          
                                             (
                                             
                                                
                                                   ∂
                                                   π
                                                
                                                
                                                   ∂
                                                   
                                                      v
                                                   
                                                
                                             
                                             −
                                             
                                                
                                                   d
                                                
                                                
                                                   d
                                                   t
                                                
                                             
                                             
                                                (
                                                
                                                   
                                                      ∂
                                                      π
                                                   
                                                   
                                                      ∂
                                                      
                                                         a
                                                      
                                                   
                                                
                                                )
                                             
                                             )
                                          
                                       
                                       
                                          T
                                       
                                    
                                    
                                       
                                          |
                                       
                                       
                                          t
                                          =
                                          T
                                       
                                    
                                    .
                                 
                              
                           
                         Note that the adjoint transient problem closely resembles the primal problem and is typically solved using the same procedure as the primal transient analysis. Also note the efficiency of the adjoint problem in that the coefficient matrices are the same as the primal problem allowing one to store and reuse the decomposed coefficient matrices from the primal analysis, provided a constant time-step is used throughout the simulation. Upon solving the above adjoint problem, the sensitivity in (15) reduces to 
                           
                              (17)
                              
                                 ∇
                                 Θ
                                 =
                                 
                                    
                                       ∫
                                    
                                    
                                       0
                                    
                                    
                                       T
                                    
                                 
                                 
                                    
                                       ∂
                                       π
                                    
                                    
                                       ∂
                                       d
                                    
                                 
                                 
                                 d
                                 t
                                 +
                                 
                                    
                                       ∫
                                    
                                    
                                       0
                                    
                                    
                                       T
                                    
                                 
                                 
                                    
                                       
                                          λ
                                       
                                    
                                    
                                       T
                                    
                                 
                                 
                                    (
                                    D
                                    
                                       M
                                    
                                    
                                       a
                                    
                                    +
                                    D
                                    
                                       K
                                    
                                    
                                       u
                                    
                                    )
                                 
                                 d
                                 t
                                 ,
                                 =
                                 
                                    
                                       ∫
                                    
                                    
                                       0
                                    
                                    
                                       T
                                    
                                 
                                 
                                    
                                       ∂
                                       π
                                    
                                    
                                       ∂
                                       d
                                    
                                 
                                 
                                 d
                                 t
                                 +
                                 
                                    
                                       
                                          Λ
                                       
                                    
                                    
                                       T
                                    
                                 
                                 ∗
                                 
                                    (
                                    D
                                    
                                       M
                                    
                                    
                                       a
                                    
                                    +
                                    D
                                    
                                       K
                                    
                                    
                                       u
                                    
                                    )
                                 
                                 
                                    
                                       
                                          |
                                       
                                    
                                    
                                       t
                                       =
                                       T
                                    
                                 
                              
                           
                         where 
                           ∗
                         is the convolution and it is understood that the above renders the derivative with respect to any parameter 
                           d
                         of 
                           
                              d
                           
                        .

In the numerical implementation, the discrete approximation to the time continuous adjoint sensitivity expression in (17) is obtained from 
                           
                              (18)
                              
                                 ∇
                                 
                                    
                                       Θ
                                    
                                    
                                       a
                                    
                                 
                                 ≈
                                 
                                    
                                       ∑
                                    
                                    
                                       n
                                       =
                                       1
                                    
                                    
                                       N
                                    
                                 
                                 
                                    [
                                    
                                       
                                          ∂
                                          
                                             
                                                π
                                             
                                             
                                                
                                                   (
                                                   n
                                                   )
                                                
                                             
                                          
                                       
                                       
                                          ∂
                                          d
                                       
                                    
                                    +
                                    
                                       
                                          
                                             Λ
                                          
                                       
                                       
                                          
                                             
                                                
                                                   (
                                                   N
                                                   −
                                                   n
                                                   +
                                                   1
                                                   )
                                                
                                             
                                             
                                                T
                                             
                                          
                                       
                                    
                                    
                                       (
                                       D
                                       
                                          M
                                       
                                       
                                       
                                          
                                             
                                                a
                                             
                                          
                                          
                                             
                                                (
                                                n
                                                )
                                             
                                          
                                       
                                       +
                                       D
                                       
                                          K
                                       
                                       
                                       
                                          
                                             
                                                u
                                             
                                          
                                          
                                             
                                                (
                                                n
                                                )
                                             
                                          
                                       
                                       )
                                    
                                    ]
                                 
                                 
                                 Δ
                                 t
                                 .
                              
                           
                         Due to the order of the computations in this approach wherein we differentiated the time continuous equation (11) and then introduced the time discretization to obtain (18), it is characterized as the differentiate and then discretize approach. Though this method is simple and the derivation is straightforward, as soon seen, it suffers from consistency errors.

In the previous approach, we derived the sensitivity expressions in the time-continuous form and discretized the final expression to numerically evaluate them. However, in the discretize and then differentiate approach, the sensitivities are computed by differentiating the discretized response, cf. (13)   [1].

To begin, the response 
                           
                              
                                 
                                    a
                                 
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                         at each time 
                           
                              
                                 t
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                         is evaluated by solving 
                           
                              (19)
                              
                                 
                                    (
                                    
                                       M
                                    
                                    +
                                    β
                                    Δ
                                    
                                       
                                          t
                                       
                                       
                                          2
                                       
                                    
                                    
                                    
                                       K
                                    
                                    )
                                 
                                 
                                 
                                    
                                       
                                          a
                                       
                                    
                                    
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 
                                 =
                                 
                                    
                                       
                                          f
                                       
                                    
                                    
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 
                                 −
                                 
                                    K
                                 
                                 
                                    (
                                    
                                       
                                          
                                             u
                                          
                                       
                                       
                                          M
                                       
                                       
                                          
                                             (
                                             n
                                             −
                                             1
                                             )
                                          
                                       
                                    
                                    +
                                    Δ
                                    t
                                    
                                    
                                       
                                          
                                             v
                                          
                                       
                                       
                                          M
                                       
                                       
                                          
                                             (
                                             n
                                             −
                                             1
                                             )
                                          
                                       
                                    
                                    +
                                    
                                       
                                          
                                             (
                                             1
                                             −
                                             2
                                             β
                                             )
                                          
                                       
                                       
                                          2
                                       
                                    
                                    Δ
                                    
                                       
                                          t
                                       
                                       
                                          2
                                       
                                    
                                    
                                       
                                          
                                             a
                                          
                                       
                                       
                                          M
                                       
                                       
                                          
                                             (
                                             n
                                             −
                                             1
                                             )
                                          
                                       
                                    
                                    )
                                 
                                 
                              
                           
                         whereafter 
                           
                              
                                 
                                    u
                                 
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                         and 
                           
                              
                                 
                                    v
                                 
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                         are computed from (5) and (6). Next the discretized function (13) is evaluated and subsequently differentiated to give the sensitivity 
                           
                              (20)
                              
                                 ∇
                                 Θ
                                 =
                                 
                                    
                                       ∑
                                    
                                    
                                       n
                                       =
                                       1
                                    
                                    
                                       N
                                    
                                 
                                 
                                    (
                                    
                                       
                                          ∂
                                          
                                             
                                                π
                                             
                                             
                                                
                                                   (
                                                   n
                                                   )
                                                
                                             
                                          
                                       
                                       
                                          ∂
                                          
                                             
                                                
                                                   u
                                                
                                             
                                             
                                                
                                                   (
                                                   n
                                                   )
                                                
                                             
                                          
                                       
                                    
                                    
                                    D
                                    
                                       
                                          
                                             u
                                          
                                       
                                       
                                          
                                             (
                                             n
                                             )
                                          
                                       
                                    
                                    +
                                    
                                       
                                          ∂
                                          
                                             
                                                π
                                             
                                             
                                                
                                                   (
                                                   n
                                                   )
                                                
                                             
                                          
                                       
                                       
                                          ∂
                                          
                                             
                                                
                                                   v
                                                
                                             
                                             
                                                
                                                   (
                                                   n
                                                   )
                                                
                                             
                                          
                                       
                                    
                                    
                                    D
                                    
                                       
                                          
                                             v
                                          
                                       
                                       
                                          
                                             (
                                             n
                                             )
                                          
                                       
                                    
                                    +
                                    
                                       
                                          ∂
                                          
                                             
                                                π
                                             
                                             
                                                
                                                   (
                                                   n
                                                   )
                                                
                                             
                                          
                                       
                                       
                                          ∂
                                          
                                             
                                                
                                                   a
                                                
                                             
                                             
                                                
                                                   (
                                                   n
                                                   )
                                                
                                             
                                          
                                       
                                    
                                    
                                    D
                                    
                                       
                                          
                                             a
                                          
                                       
                                       
                                          
                                             (
                                             n
                                             )
                                          
                                       
                                    
                                    +
                                    
                                       
                                          ∂
                                          
                                             
                                                π
                                             
                                             
                                                
                                                   (
                                                   n
                                                   )
                                                
                                             
                                          
                                       
                                       
                                          ∂
                                          d
                                       
                                    
                                    )
                                 
                                 Δ
                                 t
                                 .
                              
                           
                         As above 
                           D
                           
                              
                                 
                                    u
                                 
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                        , 
                           D
                           
                              
                                 
                                    v
                                 
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                         and 
                           D
                           
                              
                                 
                                    a
                                 
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                         are implicit quantities defined via the governing equations; we eliminate them using the adjoint approach.

Mimicking the derivation of (14) we add a zero to (20). And by noting the convolution operation in the sensitivity expression (17), we anticipate the same need here. Hence, the added zero to (20) is obtained by multiplying a “discrete convolved” arbitrary adjoint variable 
                           
                              
                                 
                                    λ
                                 
                              
                              
                                 
                                    (
                                    N
                                    −
                                    n
                                    +
                                    1
                                    )
                                 
                              
                           
                         (rather than 
                           
                              
                                 
                                    λ
                                 
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                        ) with an identity obtained from the derivative of (19) at time 
                           
                              
                                 t
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                         i.e., the discrete pseudo equation. In the differentiate and then discretize derivation of (14) integration-by-parts is used to convert the derivatives 
                           D
                           
                              v
                           
                           
                              (
                              t
                              )
                           
                         and 
                           D
                           
                              a
                           
                           
                              (
                              t
                              )
                           
                         to 
                           D
                           
                              u
                           
                           
                              (
                              t
                              )
                           
                         and some additional terms at times 
                           t
                           =
                           0
                         and 
                           t
                           =
                           T
                        . In the discretize and differentiate approach we do not have this luxury. Thusly, to annihilate the derivatives 
                           D
                           
                              
                                 
                                    u
                                 
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                         and 
                           D
                           
                              
                                 
                                    v
                                 
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                        , identities obtained from the derivatives of (5) and (6) at time 
                           
                              
                                 t
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                         are “convolved” with additional adjoint variables 
                           
                              
                                 
                                    μ
                                 
                              
                              
                                 
                                    (
                                    N
                                    −
                                    n
                                    +
                                    1
                                    )
                                 
                              
                           
                         and 
                           
                              
                                 
                                    η
                                 
                              
                              
                                 
                                    (
                                    N
                                    −
                                    n
                                    +
                                    1
                                    )
                                 
                              
                           
                        . These additional variables can be viewed as the adjoint displacement and velocity that appear in a Newmark-Beta like time-stepping for the adjoint simulation. By adjoining these three zero expressions, the sensitivity (13) is equivalently written as 
                           
                              (21)
                              
                                 ∇
                                 Θ
                                 =
                                 
                                    
                                       ∑
                                    
                                    
                                       n
                                       =
                                       1
                                    
                                    
                                       N
                                    
                                 
                                 
                                    (
                                    
                                       
                                          ∂
                                          
                                             
                                                π
                                             
                                             
                                                
                                                   (
                                                   n
                                                   )
                                                
                                             
                                          
                                       
                                       
                                          ∂
                                          
                                             
                                                
                                                   u
                                                
                                             
                                             
                                                
                                                   (
                                                   n
                                                   )
                                                
                                             
                                          
                                       
                                    
                                    
                                    D
                                    
                                       
                                          
                                             u
                                          
                                       
                                       
                                          
                                             (
                                             n
                                             )
                                          
                                       
                                    
                                    +
                                    
                                       
                                          ∂
                                          
                                             
                                                π
                                             
                                             
                                                
                                                   (
                                                   n
                                                   )
                                                
                                             
                                          
                                       
                                       
                                          ∂
                                          
                                             
                                                
                                                   v
                                                
                                             
                                             
                                                
                                                   (
                                                   n
                                                   )
                                                
                                             
                                          
                                       
                                    
                                    
                                    D
                                    
                                       
                                          
                                             v
                                          
                                       
                                       
                                          
                                             (
                                             n
                                             )
                                          
                                       
                                    
                                    +
                                    
                                       
                                          ∂
                                          
                                             
                                                π
                                             
                                             
                                                
                                                   (
                                                   n
                                                   )
                                                
                                             
                                          
                                       
                                       
                                          ∂
                                          
                                             
                                                
                                                   a
                                                
                                             
                                             
                                                
                                                   (
                                                   n
                                                   )
                                                
                                             
                                          
                                       
                                    
                                    
                                    D
                                    
                                       
                                          
                                             a
                                          
                                       
                                       
                                          
                                             (
                                             n
                                             )
                                          
                                       
                                    
                                    +
                                    
                                       
                                          ∂
                                          
                                             
                                                π
                                             
                                             
                                                
                                                   (
                                                   n
                                                   )
                                                
                                             
                                          
                                       
                                       
                                          ∂
                                          d
                                       
                                    
                                    )
                                 
                                 
                                 Δ
                                 t
                                 +
                                 
                                    
                                       ∑
                                    
                                    
                                       n
                                       =
                                       1
                                    
                                    
                                       N
                                    
                                 
                                 
                                    
                                       
                                          λ
                                       
                                    
                                    
                                       
                                          
                                             
                                                (
                                                N
                                                −
                                                n
                                                +
                                                1
                                                )
                                             
                                          
                                          
                                             T
                                          
                                       
                                    
                                 
                                 
                                    
                                       D
                                    
                                    
                                       D
                                       d
                                    
                                 
                                 
                                    [
                                    
                                       (
                                       
                                          M
                                       
                                       +
                                       β
                                       
                                       Δ
                                       
                                          
                                             t
                                          
                                          
                                             2
                                          
                                       
                                       
                                       
                                          K
                                       
                                       )
                                    
                                    
                                    
                                       
                                          
                                             a
                                          
                                       
                                       
                                          
                                             (
                                             n
                                             )
                                          
                                       
                                    
                                    −
                                    
                                       
                                          
                                             f
                                          
                                       
                                       
                                          
                                             (
                                             n
                                             )
                                          
                                       
                                    
                                    +
                                    
                                       K
                                    
                                    
                                       (
                                       
                                          
                                             
                                                u
                                             
                                          
                                          
                                             
                                                (
                                                n
                                                −
                                                1
                                                )
                                             
                                          
                                       
                                       +
                                       Δ
                                       t
                                       
                                       
                                          
                                             
                                                v
                                             
                                          
                                          
                                             
                                                (
                                                n
                                                −
                                                1
                                                )
                                             
                                          
                                       
                                       +
                                       
                                          
                                             
                                                (
                                                1
                                                −
                                                2
                                                β
                                                )
                                             
                                          
                                          
                                             2
                                          
                                       
                                       Δ
                                       
                                          
                                             t
                                          
                                          
                                             2
                                          
                                       
                                       
                                          
                                             
                                                a
                                             
                                          
                                          
                                             
                                                (
                                                n
                                                −
                                                1
                                                )
                                             
                                          
                                       
                                       )
                                    
                                    ]
                                 
                                 
                                 Δ
                                 t
                                 +
                                 
                                    
                                       ∑
                                    
                                    
                                       n
                                       =
                                       1
                                    
                                    
                                       N
                                    
                                 
                                 
                                    
                                       
                                          μ
                                       
                                    
                                    
                                       
                                          
                                             
                                                (
                                                N
                                                −
                                                n
                                                +
                                                1
                                                )
                                             
                                          
                                          
                                             T
                                          
                                       
                                    
                                 
                                 
                                    
                                       D
                                    
                                    
                                       D
                                       d
                                    
                                 
                                 
                                    (
                                    −
                                    
                                       
                                          
                                             u
                                          
                                       
                                       
                                          
                                             (
                                             n
                                             )
                                          
                                       
                                    
                                    +
                                    
                                       
                                          
                                             u
                                          
                                       
                                       
                                          
                                             (
                                             n
                                             −
                                             1
                                             )
                                          
                                       
                                    
                                    +
                                    Δ
                                    t
                                    
                                    
                                       
                                          
                                             v
                                          
                                       
                                       
                                          
                                             (
                                             n
                                             −
                                             1
                                             )
                                          
                                       
                                    
                                    +
                                    
                                       
                                          
                                             (
                                             1
                                             −
                                             2
                                             β
                                             )
                                          
                                       
                                       
                                          2
                                       
                                    
                                    Δ
                                    
                                       
                                          t
                                       
                                       
                                          2
                                       
                                    
                                    
                                       
                                          
                                             a
                                          
                                       
                                       
                                          
                                             (
                                             n
                                             −
                                             1
                                             )
                                          
                                       
                                    
                                    +
                                    β
                                    Δ
                                    
                                       
                                          t
                                       
                                       
                                          2
                                       
                                    
                                    
                                    
                                       
                                          
                                             a
                                          
                                       
                                       
                                          
                                             (
                                             n
                                             )
                                          
                                       
                                    
                                    )
                                 
                                 
                                 Δ
                                 t
                                 +
                                 
                                    
                                       ∑
                                    
                                    
                                       n
                                       =
                                       1
                                    
                                    
                                       N
                                    
                                 
                                 
                                    
                                       
                                          η
                                       
                                    
                                    
                                       
                                          
                                             
                                                (
                                                N
                                                −
                                                n
                                                +
                                                1
                                                )
                                             
                                          
                                          
                                             T
                                          
                                       
                                    
                                 
                                 
                                    
                                       D
                                    
                                    
                                       D
                                       d
                                    
                                 
                                 
                                    (
                                    −
                                    
                                       
                                          
                                             v
                                          
                                       
                                       
                                          
                                             (
                                             n
                                             )
                                          
                                       
                                    
                                    +
                                    
                                       
                                          
                                             v
                                          
                                       
                                       
                                          
                                             (
                                             n
                                             −
                                             1
                                             )
                                          
                                       
                                    
                                    +
                                    
                                       (
                                       1
                                       −
                                       γ
                                       )
                                    
                                    Δ
                                    t
                                    
                                    
                                       
                                          
                                             a
                                          
                                       
                                       
                                          
                                             (
                                             n
                                             −
                                             1
                                             )
                                          
                                       
                                    
                                    +
                                    γ
                                    Δ
                                    t
                                    
                                    
                                       
                                          
                                             a
                                          
                                       
                                       
                                          
                                             (
                                             n
                                             )
                                          
                                       
                                    
                                    )
                                 
                                 
                                 Δ
                                 t
                                 ,
                              
                           
                         since each of the last three summations equal zero. We now do some rearranging to isolate the response derivatives 
                           D
                           
                              
                                 
                                    u
                                 
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                        , 
                           D
                           
                              
                                 
                                    v
                                 
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                         and 
                           D
                           
                              
                                 
                                    a
                                 
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                        , cf. (15), to obtain 
                           
                              (22)
                              
                                 ∇
                                 Θ
                                 =
                                 
                                    
                                       ∑
                                    
                                    
                                       n
                                       =
                                       1
                                    
                                    
                                       N
                                    
                                 
                                 
                                    [
                                    
                                       
                                          ∂
                                          
                                             
                                                π
                                             
                                             
                                                
                                                   (
                                                   n
                                                   )
                                                
                                             
                                          
                                       
                                       
                                          ∂
                                          d
                                       
                                    
                                    +
                                    
                                       
                                          
                                             λ
                                          
                                       
                                       
                                          
                                             
                                                
                                                   (
                                                   N
                                                   −
                                                   n
                                                   +
                                                   1
                                                   )
                                                
                                             
                                             
                                                T
                                             
                                          
                                       
                                    
                                    
                                       (
                                       D
                                       
                                          M
                                       
                                       
                                       
                                          
                                             
                                                a
                                             
                                          
                                          
                                             
                                                (
                                                n
                                                )
                                             
                                          
                                       
                                       +
                                       D
                                       
                                          K
                                       
                                       
                                       
                                          
                                             
                                                u
                                             
                                          
                                          
                                             
                                                (
                                                n
                                                )
                                             
                                          
                                       
                                       )
                                    
                                    ]
                                 
                                 
                                 Δ
                                 t
                                 +
                                 
                                    
                                       ∑
                                    
                                    
                                       n
                                       =
                                       1
                                    
                                    
                                       N
                                    
                                 
                                 
                                    
                                       
                                          (
                                          D
                                          
                                             
                                                
                                                   u
                                                
                                             
                                             
                                                
                                                   (
                                                   n
                                                   )
                                                
                                             
                                          
                                          )
                                       
                                    
                                    
                                       T
                                    
                                 
                                 
                                    [
                                    
                                       
                                          
                                             (
                                             
                                                
                                                   ∂
                                                   
                                                      
                                                         π
                                                      
                                                      
                                                         
                                                            (
                                                            n
                                                            )
                                                         
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         
                                                            u
                                                         
                                                      
                                                      
                                                         
                                                            (
                                                            n
                                                            )
                                                         
                                                      
                                                   
                                                
                                             
                                             )
                                          
                                       
                                       
                                          T
                                       
                                    
                                    −
                                    
                                       
                                          
                                             μ
                                          
                                       
                                       
                                          
                                             (
                                             N
                                             −
                                             n
                                             +
                                             1
                                             )
                                          
                                       
                                    
                                    +
                                    H
                                    
                                       (
                                       N
                                       −
                                       n
                                       )
                                    
                                    
                                       (
                                       
                                          K
                                       
                                       
                                       
                                          
                                             
                                                λ
                                             
                                          
                                          
                                             
                                                (
                                                N
                                                −
                                                n
                                                )
                                             
                                          
                                       
                                       +
                                       
                                          
                                             
                                                μ
                                             
                                          
                                          
                                             
                                                (
                                                N
                                                −
                                                n
                                                )
                                             
                                          
                                       
                                       )
                                    
                                    ]
                                 
                                 +
                                 
                                    
                                       ∑
                                    
                                    
                                       n
                                       =
                                       1
                                    
                                    
                                       N
                                    
                                 
                                 
                                    
                                       
                                          (
                                          D
                                          
                                             
                                                
                                                   v
                                                
                                             
                                             
                                                
                                                   (
                                                   n
                                                   )
                                                
                                             
                                          
                                          )
                                       
                                    
                                    
                                       T
                                    
                                 
                                 
                                    [
                                    
                                       
                                          
                                             (
                                             
                                                
                                                   ∂
                                                   
                                                      
                                                         π
                                                      
                                                      
                                                         
                                                            (
                                                            n
                                                            )
                                                         
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         
                                                            v
                                                         
                                                      
                                                      
                                                         
                                                            (
                                                            n
                                                            )
                                                         
                                                      
                                                   
                                                
                                             
                                             )
                                          
                                       
                                       
                                          T
                                       
                                    
                                    −
                                    
                                       
                                          
                                             η
                                          
                                       
                                       
                                          
                                             (
                                             N
                                             −
                                             n
                                             +
                                             1
                                             )
                                          
                                       
                                    
                                    +
                                    H
                                    
                                       (
                                       N
                                       −
                                       n
                                       )
                                    
                                    
                                       [
                                       Δ
                                       t
                                       
                                          (
                                          
                                             K
                                          
                                          
                                          
                                             
                                                
                                                   λ
                                                
                                             
                                             
                                                
                                                   (
                                                   N
                                                   −
                                                   n
                                                   )
                                                
                                             
                                          
                                          +
                                          
                                             
                                                
                                                   μ
                                                
                                             
                                             
                                                
                                                   (
                                                   N
                                                   −
                                                   n
                                                   )
                                                
                                             
                                          
                                          )
                                       
                                       +
                                       
                                          
                                             
                                                η
                                             
                                          
                                          
                                             
                                                (
                                                N
                                                −
                                                n
                                                )
                                             
                                          
                                       
                                       ]
                                    
                                    ]
                                 
                                 +
                                 
                                    
                                       ∑
                                    
                                    
                                       n
                                       =
                                       1
                                    
                                    
                                       N
                                    
                                 
                                 
                                    
                                       
                                          (
                                          D
                                          
                                             
                                                
                                                   a
                                                
                                             
                                             
                                                
                                                   (
                                                   n
                                                   )
                                                
                                             
                                          
                                          )
                                       
                                    
                                    
                                       T
                                    
                                 
                                 
                                    [
                                    
                                       (
                                       
                                          M
                                       
                                       +
                                       β
                                       Δ
                                       
                                          
                                             t
                                          
                                          
                                             2
                                          
                                       
                                       
                                          K
                                       
                                       )
                                    
                                    
                                    
                                       
                                          
                                             λ
                                          
                                       
                                       
                                          
                                             (
                                             N
                                             −
                                             n
                                             +
                                             1
                                             )
                                          
                                       
                                    
                                    +
                                    
                                       
                                          
                                             (
                                             
                                                
                                                   ∂
                                                   
                                                      
                                                         π
                                                      
                                                      
                                                         
                                                            (
                                                            n
                                                            )
                                                         
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         
                                                            a
                                                         
                                                      
                                                      
                                                         
                                                            (
                                                            n
                                                            )
                                                         
                                                      
                                                   
                                                
                                             
                                             )
                                          
                                       
                                       
                                          T
                                       
                                    
                                    +
                                    β
                                    Δ
                                    
                                       
                                          t
                                       
                                       
                                          2
                                       
                                    
                                    
                                    
                                       
                                          
                                             μ
                                          
                                       
                                       
                                          
                                             (
                                             N
                                             −
                                             n
                                             +
                                             1
                                             )
                                          
                                       
                                    
                                    +
                                    γ
                                    Δ
                                    t
                                    
                                    
                                       
                                          
                                             η
                                          
                                       
                                       
                                          
                                             (
                                             N
                                             −
                                             n
                                             +
                                             1
                                             )
                                          
                                       
                                    
                                    +
                                    H
                                    
                                       (
                                       N
                                       −
                                       n
                                       )
                                    
                                    
                                       [
                                       
                                          
                                             
                                                (
                                                1
                                                −
                                                2
                                                
                                                β
                                                )
                                             
                                          
                                          
                                             2
                                          
                                       
                                       Δ
                                       
                                          
                                             t
                                          
                                          
                                             2
                                          
                                       
                                       
                                       
                                          (
                                          
                                             K
                                          
                                          
                                          
                                             
                                                
                                                   λ
                                                
                                             
                                             
                                                
                                                   (
                                                   N
                                                   −
                                                   n
                                                   )
                                                
                                             
                                          
                                          +
                                          
                                             
                                                
                                                   μ
                                                
                                             
                                             
                                                
                                                   (
                                                   N
                                                   −
                                                   n
                                                   )
                                                
                                             
                                          
                                          )
                                       
                                       +
                                       
                                          (
                                          1
                                          −
                                          γ
                                          )
                                       
                                       Δ
                                       t
                                       
                                       
                                          
                                             
                                                η
                                             
                                          
                                          
                                             
                                                (
                                                N
                                                −
                                                n
                                                )
                                             
                                          
                                       
                                       ]
                                    
                                    ]
                                 
                              
                           
                         where we again assume that the load and initial condition derivatives are zero, we use (5) (on the first line of the above) and we introduce the Heaviside step function 
                           H
                         (which is defined such that 
                           H
                           
                              (
                              x
                              )
                           
                           =
                           0
                         if 
                           x
                           ≤
                           0
                         and 
                           H
                           
                              (
                              x
                              )
                           
                           =
                           1
                         if 
                           x
                           >
                           0
                        ). The terms that contain the response derivatives are annihilated by requiring adjoint responses 
                           
                              
                                 
                                    λ
                                 
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                        , 
                           
                              
                                 
                                    μ
                                 
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                         and 
                           
                              
                                 
                                    η
                                 
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                         to satisfy 
                           
                              
                                 (23)
                                 
                                    
                                       
                                          
                                             μ
                                          
                                       
                                       
                                          
                                             (
                                             n
                                             )
                                          
                                       
                                    
                                    =
                                    
                                       
                                          
                                             (
                                             
                                                
                                                   ∂
                                                   
                                                      
                                                         π
                                                      
                                                      
                                                         
                                                            (
                                                            N
                                                            −
                                                            n
                                                            +
                                                            1
                                                            )
                                                         
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         
                                                            u
                                                         
                                                      
                                                      
                                                         
                                                            (
                                                            N
                                                            −
                                                            n
                                                            +
                                                            1
                                                            )
                                                         
                                                      
                                                   
                                                
                                             
                                             )
                                          
                                       
                                       
                                          T
                                       
                                    
                                    +
                                    H
                                    
                                       (
                                       n
                                       −
                                       1
                                       )
                                    
                                    
                                       (
                                       
                                          K
                                       
                                       
                                       
                                          
                                             
                                                λ
                                             
                                          
                                          
                                             
                                                (
                                                n
                                                −
                                                1
                                                )
                                             
                                          
                                       
                                       +
                                       
                                          
                                             
                                                μ
                                             
                                          
                                          
                                             
                                                (
                                                n
                                                −
                                                1
                                                )
                                             
                                          
                                       
                                       )
                                    
                                    ,
                                 
                              
                              
                                 (24)
                                 
                                    
                                       
                                          
                                             η
                                          
                                       
                                       
                                          
                                             (
                                             n
                                             )
                                          
                                       
                                    
                                    =
                                    
                                       
                                          
                                             (
                                             
                                                
                                                   ∂
                                                   
                                                      
                                                         π
                                                      
                                                      
                                                         
                                                            (
                                                            N
                                                            −
                                                            n
                                                            +
                                                            1
                                                            )
                                                         
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         
                                                            v
                                                         
                                                      
                                                      
                                                         
                                                            (
                                                            N
                                                            −
                                                            n
                                                            +
                                                            1
                                                            )
                                                         
                                                      
                                                   
                                                
                                             
                                             )
                                          
                                       
                                       
                                          T
                                       
                                    
                                    +
                                    H
                                    
                                       (
                                       n
                                       −
                                       1
                                       )
                                    
                                    
                                       [
                                       Δ
                                       t
                                       
                                          (
                                          
                                             K
                                          
                                          
                                          
                                             
                                                
                                                   λ
                                                
                                             
                                             
                                                
                                                   (
                                                   n
                                                   −
                                                   1
                                                   )
                                                
                                             
                                          
                                          +
                                          
                                             
                                                
                                                   μ
                                                
                                             
                                             
                                                
                                                   (
                                                   n
                                                   −
                                                   1
                                                   )
                                                
                                             
                                          
                                          )
                                       
                                       +
                                       
                                          
                                             
                                                η
                                             
                                          
                                          
                                             
                                                (
                                                n
                                                −
                                                1
                                                )
                                             
                                          
                                       
                                       ]
                                    
                                    ,
                                 
                              
                              
                                 (25)
                                 
                                    
                                       (
                                       
                                          M
                                       
                                       +
                                       β
                                       Δ
                                       
                                          
                                             t
                                          
                                          
                                             2
                                          
                                       
                                       
                                          K
                                       
                                       )
                                    
                                    
                                    
                                       
                                          
                                             λ
                                          
                                       
                                       
                                          
                                             (
                                             n
                                             )
                                          
                                       
                                    
                                    =
                                    −
                                    
                                       
                                          
                                             (
                                             
                                                
                                                   ∂
                                                   
                                                      
                                                         π
                                                      
                                                      
                                                         
                                                            (
                                                            N
                                                            −
                                                            n
                                                            +
                                                            1
                                                            )
                                                         
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         
                                                            a
                                                         
                                                      
                                                      
                                                         
                                                            (
                                                            N
                                                            −
                                                            n
                                                            +
                                                            1
                                                            )
                                                         
                                                      
                                                   
                                                
                                             
                                             )
                                          
                                       
                                       
                                          T
                                       
                                    
                                    −
                                    β
                                    Δ
                                    
                                       
                                          t
                                       
                                       
                                          2
                                       
                                    
                                    
                                    
                                       
                                          
                                             μ
                                          
                                       
                                       
                                          
                                             (
                                             n
                                             )
                                          
                                       
                                    
                                    −
                                    γ
                                    Δ
                                    t
                                    
                                    
                                       
                                          
                                             η
                                          
                                       
                                       
                                          
                                             (
                                             n
                                             )
                                          
                                       
                                    
                                    −
                                    H
                                    
                                       (
                                       n
                                       −
                                       1
                                       )
                                    
                                    
                                       [
                                       
                                          
                                             
                                                (
                                                1
                                                −
                                                2
                                                
                                                β
                                                )
                                             
                                          
                                          
                                             2
                                          
                                       
                                       Δ
                                       
                                          
                                             t
                                          
                                          
                                             2
                                          
                                       
                                       
                                       
                                          (
                                          
                                             K
                                          
                                          
                                          
                                             
                                                
                                                   λ
                                                
                                             
                                             
                                                
                                                   (
                                                   n
                                                   −
                                                   1
                                                   )
                                                
                                             
                                          
                                          +
                                          
                                             
                                                
                                                   μ
                                                
                                             
                                             
                                                
                                                   (
                                                   n
                                                   −
                                                   1
                                                   )
                                                
                                             
                                          
                                          )
                                       
                                       +
                                       
                                          (
                                          1
                                          −
                                          γ
                                          )
                                       
                                       Δ
                                       t
                                       
                                       
                                          
                                             
                                                η
                                             
                                          
                                          
                                             
                                                (
                                                n
                                                −
                                                1
                                                )
                                             
                                          
                                       
                                       ]
                                    
                                    ,
                                 
                              
                           
                         for 
                           n
                           =
                           1
                           ,
                           …
                           ,
                           N
                        .

The auxiliary equations (23) and (24) are explicit equations (i.e., they do not involve a linear solve) and 
                           
                              
                                 
                                    μ
                                 
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                         and 
                           
                              
                                 
                                    η
                                 
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                         are computed before solving the adjoint matrix equation (25) for 
                           
                              
                                 
                                    λ
                                 
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                        . This is in contrast to the primal analysis where we solve the primal matrix equation (19) for 
                           
                              
                                 
                                    a
                                 
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                         prior to evaluating 
                           
                              
                                 
                                    u
                                 
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                         and 
                           
                              
                                 
                                    v
                                 
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                         from the auxiliary equations (5) and (6). This “reordering” is to be expected in the adjoint analysis in which the order of the computations is dictated by the discrete convolution. We also note that the coefficient matrices in the primal and adjoint analyses for 
                           
                              
                                 
                                    a
                                 
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                         and 
                           
                              
                                 
                                    λ
                                 
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                         are identical (assuming equal time-steps) and that the adjoint “displacement” 
                           
                              
                                 
                                    μ
                                 
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                         and “velocity” 
                           
                              
                                 
                                    η
                                 
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                         are obtained from explicit expressions akin to the primal displacement 
                           
                              
                                 
                                    u
                                 
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                         and velocity 
                           
                              
                                 
                                    v
                                 
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                         computations.

The final sensitivity expression obtained after eliminating the implicit derivatives reduces to 
                           
                              (26)
                              
                                 ∇
                                 
                                    
                                       Θ
                                    
                                    
                                       b
                                    
                                 
                                 =
                                 
                                    
                                       ∑
                                    
                                    
                                       n
                                       =
                                       1
                                    
                                    
                                       N
                                    
                                 
                                 
                                    [
                                    
                                       
                                          ∂
                                          
                                             
                                                π
                                             
                                             
                                                
                                                   (
                                                   n
                                                   )
                                                
                                             
                                          
                                       
                                       
                                          ∂
                                          d
                                       
                                    
                                    +
                                    
                                       
                                          
                                             λ
                                          
                                       
                                       
                                          
                                             
                                                
                                                   (
                                                   N
                                                   −
                                                   n
                                                   +
                                                   1
                                                   )
                                                
                                             
                                             
                                                T
                                             
                                          
                                       
                                    
                                    
                                       (
                                       D
                                       
                                          M
                                       
                                       
                                       
                                          
                                             
                                                a
                                             
                                          
                                          
                                             
                                                (
                                                n
                                                )
                                             
                                          
                                       
                                       +
                                       D
                                       
                                          K
                                       
                                       
                                       
                                          
                                             
                                                u
                                             
                                          
                                          
                                             
                                                (
                                                n
                                                )
                                             
                                          
                                       
                                       )
                                    
                                    ]
                                 
                                 
                                 Δ
                                 t
                                 .
                              
                           
                        
                     

@&#DISCUSSION@&#

We demonstrate the accuracy of the adjoint sensitivities computed via the above described methods for the model shown in Fig. 1 in which 
                           
                              
                                 m
                              
                              
                                 1
                              
                           
                           =
                           
                              
                                 m
                              
                              
                                 2
                              
                           
                           =
                           25
                         and 
                           
                              
                                 k
                              
                              
                                 1
                              
                           
                           =
                           2000
                        , 
                           
                              
                                 k
                              
                              
                                 2
                              
                           
                           =
                           1000
                         and 
                           
                              
                                 k
                              
                              
                                 3
                              
                           
                           =
                           2000
                        . There is no external force acting, so only the nonzero initial conditions with 
                           
                              
                                 u
                              
                              
                                 1
                              
                           
                           
                              (
                              0
                              )
                           
                           =
                           
                              
                                 v
                              
                              
                                 1
                              
                           
                           
                              (
                              0
                              )
                           
                           =
                           1
                         and 
                           
                              
                                 u
                              
                              
                                 2
                              
                           
                           
                              (
                              0
                              )
                           
                           =
                           
                              
                                 v
                              
                              
                                 2
                              
                           
                           
                              (
                              0
                              )
                           
                           =
                           0
                         induce the motion.

The chosen response function is the integrated strain energy in the first spring over the simulation time 
                           T
                           =
                           5
                        , i.e.,  
                           
                              (27)
                              
                                 Θ
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       ∫
                                    
                                    
                                       0
                                    
                                    
                                       T
                                    
                                 
                                 
                                    
                                       k
                                    
                                    
                                       1
                                    
                                 
                                 
                                 
                                    
                                       u
                                    
                                    
                                       1
                                    
                                    
                                       2
                                    
                                 
                                 
                                 d
                                 t
                                 ,
                              
                           
                         so that 
                           π
                           
                              (
                              
                                 u
                              
                              
                                 (
                                 t
                                 ,
                                 d
                                 )
                              
                              ,
                              
                                 v
                              
                              
                                 (
                                 t
                                 ,
                                 d
                                 )
                              
                              ,
                              
                                 a
                              
                              
                                 (
                                 t
                                 ,
                                 d
                                 )
                              
                              ,
                              d
                              ,
                              t
                              )
                           
                           =
                           1
                           /
                           2
                           
                           
                              
                                 k
                              
                              
                                 1
                              
                           
                           
                           
                              
                                 u
                              
                              
                                 1
                              
                              
                                 2
                              
                           
                           
                              (
                              t
                              ,
                              d
                              )
                           
                        . For the chosen parameters, the analytical values of the response function and its sensitivity with respect to the design variable 
                           d
                           =
                           
                              
                                 k
                              
                              
                                 1
                              
                           
                         are 
                           
                              
                                 Θ
                              
                              
                                 o
                              
                           
                           =
                           702.578
                         and 
                           
                              
                                 ∇
                              
                              
                                 o
                              
                           
                           Θ
                           =
                           0.62907
                        .

A rather subtle but critical point to note is that in the computer implementation, one uses a discrete approximation of (13) to evaluate the objective and constraint functions for the optimization. For this reason the numerical, gradient-based update algorithms require sensitivities that are consistent with this discrete approximation. Indeed, the computed values of 
                           Θ
                           
                              (
                              
                                 d
                              
                              )
                           
                         are used by the optimizer to evaluate the objective and constraint functions corresponding to a design 
                           
                              d
                           
                         while the computed values of 
                           ∇
                           Θ
                           
                              (
                              
                                 d
                              
                              )
                           
                         are used by the optimizer to verify the optimality conditions and determine the search direction. Thusly, if the computed values of 
                           ∇
                           Θ
                           
                              (
                              
                                 d
                              
                              )
                           
                         are not consistent with the those of 
                           Θ
                           
                              (
                              
                                 d
                              
                              )
                           
                         one can neither verify optimality conditions nor determine effective search directions. One way to verify whether or not the computed values of 
                           ∇
                           Θ
                           
                              (
                              
                                 d
                              
                              )
                           
                         are consistent is to compare them to those obtained by using the computationally expensive finite difference approach i.e., for a particular parameter 
                           d
                         we have 
                           ∇
                           
                              
                                 Θ
                              
                              
                                 f
                                 d
                              
                           
                           
                              (
                              d
                              )
                           
                           =
                           
                              
                                 1
                              
                              
                                 Δ
                                 d
                              
                           
                           
                              (
                              Θ
                              
                                 (
                                 d
                                 +
                                 Δ
                                 d
                                 )
                              
                              −
                              Θ
                              
                                 (
                                 d
                                 )
                              
                              )
                           
                           ≈
                           ∇
                           Θ
                           
                              (
                              d
                              )
                           
                         for an “appropriately” chosen 
                           Δ
                           d
                        , i.e. one that is neither too large nor too small so as to limit the extent of truncation and round-off errors.

We now compare these two adjoint sensitivity approximations by using the consistency error measure evaluated as, e.g.,  
                           
                              (
                              ∇
                              
                                 
                                    Θ
                                 
                                 
                                    a
                                 
                              
                              −
                              ∇
                              
                                 
                                    Θ
                                 
                                 
                                    f
                                    d
                                 
                              
                              )
                           
                           /
                           ∇
                           
                              
                                 Θ
                              
                              
                                 f
                                 d
                              
                           
                        . For different choices of the time increments, Table 1
                         denotes the values of the computed response function 
                           
                              
                                 Θ
                              
                              
                                 a
                              
                           
                         in column two, the sensitivities in columns three through five and the consistency errors in the last two columns. As seen here, there are no consistency errors associated with the 
                           ∇
                           
                              
                                 Θ
                              
                              
                                 b
                              
                           
                         computations. However, it is evident that the differentiate and then discretize approach suffers from consistency errors. Albeit this error diminishes with decreasing time increments i.e., as the computed value 
                           
                              
                                 Θ
                              
                              
                                 a
                              
                           
                         approaches the analytical value 
                           
                              
                                 Θ
                              
                              
                                 o
                              
                           
                        . The consistency error can also be reduced if the second-order accurate trapezoidal integration rule replaces the rectangular summation rule of (13) and (18), cf.  [35]. Nonetheless, ill-conceived designs may be obtained in initial design studies, which use coarse time-steps, if the sensitivities are inaccurate.

Due to the aforementioned accuracy and implementation reasons, we adopt the discrete and then differentiate approach to compute the sensitivities of the transient dynamic multiscale problem described in Section  2. Having completed the primal analysis, we proceed to compute the response measures and their sensitivities. A typical response function upon time discretization reads 
                        
                           (28)
                           
                              Θ
                              
                                 (
                                 
                                    d
                                 
                                 )
                              
                              =
                              
                                 
                                    ∑
                                 
                                 
                                    n
                                    =
                                    1
                                 
                                 
                                    N
                                 
                              
                              
                                 {
                                 
                                    
                                       ∫
                                    
                                    
                                       Ω
                                    
                                 
                                 
                                    
                                       π
                                    
                                    
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             u
                                          
                                       
                                       
                                          M
                                       
                                       
                                          
                                             (
                                             n
                                             )
                                          
                                       
                                    
                                    
                                       (
                                       
                                          x
                                       
                                       ,
                                       
                                          d
                                       
                                       )
                                    
                                    ,
                                    
                                       
                                          
                                             v
                                          
                                       
                                       
                                          M
                                       
                                       
                                          
                                             (
                                             n
                                             )
                                          
                                       
                                    
                                    
                                       (
                                       
                                          x
                                       
                                       ,
                                       
                                          d
                                       
                                       )
                                    
                                    ,
                                    
                                       
                                          
                                             a
                                          
                                       
                                       
                                          M
                                       
                                       
                                          
                                             (
                                             n
                                             )
                                          
                                       
                                    
                                    
                                       (
                                       
                                          x
                                       
                                       ,
                                       
                                          d
                                       
                                       )
                                    
                                    ,
                                    
                                       x
                                    
                                    ,
                                    
                                       d
                                    
                                    )
                                 
                                 
                                 
                                    d
                                 
                                 Ω
                                 }
                              
                              Δ
                              t
                              ,
                           
                        
                      which takes the form of (13) after finite element discretization.

Without loss of generality, we take the derivative of the above equation with respect to an arbitrary parameter 
                        d
                      giving 
                        
                           (29)
                           
                              ∇
                              Θ
                              =
                              
                                 
                                    ∑
                                 
                                 
                                    n
                                    =
                                    1
                                 
                                 
                                    N
                                 
                              
                              
                                 {
                                 
                                    
                                       ∫
                                    
                                    
                                       Ω
                                    
                                 
                                 
                                    (
                                    
                                       
                                          ∇
                                       
                                       
                                          1
                                       
                                    
                                    
                                       
                                          π
                                       
                                       
                                          
                                             (
                                             n
                                             )
                                          
                                       
                                    
                                    ⋅
                                    D
                                    
                                       
                                          
                                             u
                                          
                                       
                                       
                                          M
                                       
                                       
                                          
                                             (
                                             n
                                             )
                                          
                                       
                                    
                                    +
                                    
                                       
                                          ∇
                                       
                                       
                                          2
                                       
                                    
                                    
                                       
                                          π
                                       
                                       
                                          
                                             (
                                             n
                                             )
                                          
                                       
                                    
                                    ⋅
                                    D
                                    
                                       
                                          
                                             v
                                          
                                       
                                       
                                          M
                                       
                                       
                                          
                                             (
                                             n
                                             )
                                          
                                       
                                    
                                    +
                                    
                                       
                                          ∇
                                       
                                       
                                          3
                                       
                                    
                                    
                                       
                                          π
                                       
                                       
                                          
                                             (
                                             n
                                             )
                                          
                                       
                                    
                                    ⋅
                                    D
                                    
                                       
                                          
                                             a
                                          
                                       
                                       
                                          M
                                       
                                       
                                          
                                             (
                                             n
                                             )
                                          
                                       
                                    
                                    +
                                    
                                       
                                          D
                                       
                                       
                                          5
                                       
                                    
                                    
                                       
                                          π
                                       
                                       
                                          
                                             (
                                             n
                                             )
                                          
                                       
                                    
                                    )
                                 
                                 
                                 
                                    d
                                 
                                 Ω
                                 }
                              
                              Δ
                              t
                              ,
                           
                        
                      where subscripts on the gradient and directional derivative indicate the argument with respect to which the derivative is defined, e.g.  
                        
                           
                              D
                           
                           
                              5
                           
                        
                        π
                        
                           (
                           
                              
                                 
                                    u
                                 
                              
                              
                                 M
                              
                           
                           
                              (
                              
                                 x
                              
                              ,
                              d
                              )
                           
                           ,
                           
                              
                                 
                                    v
                                 
                              
                              
                                 M
                              
                           
                           
                              (
                              
                                 x
                              
                              ,
                              d
                              )
                           
                           ,
                           
                              
                                 
                                    a
                                 
                              
                              
                                 M
                              
                           
                           
                              (
                              
                                 x
                              
                              ,
                              d
                              )
                           
                           ,
                           d
                           )
                        
                     
                     
                        =
                        
                           
                              d
                           
                           
                              d
                              ϵ
                           
                        
                        
                        π
                        
                           (
                           
                              
                                 
                                    u
                                 
                              
                              
                                 M
                              
                           
                           
                              (
                              
                                 x
                              
                              ,
                              d
                              )
                           
                           ,
                           
                              
                                 
                                    v
                                 
                              
                              
                                 M
                              
                           
                           
                              (
                              
                                 x
                              
                              ,
                              d
                              )
                           
                           ,
                           
                              
                                 
                                    a
                                 
                              
                              
                                 M
                              
                           
                           
                              (
                              
                                 x
                              
                              ,
                              d
                              )
                           
                           ,
                           
                              x
                           
                           ,
                           d
                           +
                           ϵ
                           )
                        
                        
                           
                              |
                           
                           
                              ϵ
                              =
                              0
                           
                        
                        =
                        ∂
                        π
                        /
                        ∂
                        d
                     . For finite element computation we discretize the above in space to obtain (20).

The implicitly defined directional derivatives 
                        D
                        
                           
                              
                                 u
                              
                           
                           
                              M
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                        ,
                        D
                        
                           
                              
                                 v
                              
                           
                           
                              M
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                      and 
                        D
                        
                           
                              
                                 a
                              
                           
                           
                              M
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                      which appear in 
                        ∇
                        Θ
                      of (20) are annihilated using an adjoint sensitivity analysis. To this end, we follow  [41] and express the residual equation in (4) as 
                        
                           (30)
                           
                              
                                 
                                    r
                                 
                                 
                                    M
                                 
                                 
                                    
                                       (
                                       n
                                       )
                                    
                                 
                              
                              
                                 (
                                 
                                    
                                       
                                          a
                                       
                                    
                                    
                                       M
                                    
                                    
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 
                                 
                                    (
                                    d
                                    )
                                 
                                 ,
                                 d
                                 )
                              
                              ≔
                              
                                 
                                    ∫
                                 
                                 
                                    Ω
                                 
                              
                              
                                 (
                                 
                                    
                                       ϱ
                                    
                                    
                                       
                                          
                                          
                                             M
                                          
                                       
                                    
                                 
                                 
                                    (
                                    d
                                    )
                                 
                                 
                                    
                                       
                                          λ
                                       
                                    
                                    
                                       
                                          (
                                          N
                                          −
                                          n
                                          +
                                          1
                                          )
                                       
                                    
                                 
                                 ⋅
                                 
                                    
                                       
                                          a
                                       
                                    
                                    
                                       M
                                    
                                    
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 
                                 
                                    (
                                    d
                                    )
                                 
                                 +
                                 ∇
                                 
                                    
                                       
                                          λ
                                       
                                    
                                    
                                       
                                          (
                                          N
                                          −
                                          n
                                          +
                                          1
                                          )
                                       
                                    
                                 
                                 ⋅
                                 
                                    
                                       
                                          P
                                       
                                    
                                    
                                       M
                                    
                                    
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             F
                                          
                                       
                                       
                                          M
                                       
                                       
                                          
                                             (
                                             n
                                             )
                                          
                                       
                                    
                                    
                                       (
                                       d
                                       )
                                    
                                    ,
                                    d
                                    )
                                 
                                 −
                                 
                                    
                                       
                                          λ
                                       
                                    
                                    
                                       
                                          (
                                          N
                                          −
                                          n
                                          +
                                          1
                                          )
                                       
                                    
                                 
                                 ⋅
                                 
                                    b
                                 
                                 )
                              
                              
                              
                                 d
                              
                              Ω
                              =
                              0
                              ,
                           
                        
                      where the spatial argument 
                        
                           x
                        
                      has been suppressed for conciseness. Taking the directional derivative of the above and further simplifying by dropping the argument 
                        d
                      gives 
                        
                           (31)
                           
                              D
                              
                                 
                                    r
                                 
                                 
                                    M
                                 
                                 
                                    
                                       (
                                       n
                                       )
                                    
                                 
                              
                              
                                 (
                                 
                                    
                                       
                                          a
                                       
                                    
                                    
                                       M
                                    
                                    
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 
                                 )
                              
                              ≔
                              
                                 
                                    ∫
                                 
                                 
                                    Ω
                                 
                              
                              
                                 {
                                 D
                                 
                                    
                                       ϱ
                                    
                                    
                                       
                                          
                                          
                                             M
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          λ
                                       
                                    
                                    
                                       
                                          (
                                          N
                                          −
                                          n
                                          +
                                          1
                                          )
                                       
                                    
                                 
                                 ⋅
                                 
                                    
                                       
                                          a
                                       
                                    
                                    
                                       M
                                    
                                    
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 
                                 +
                                 
                                    
                                       ϱ
                                    
                                    
                                       
                                          
                                          
                                             M
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          λ
                                       
                                    
                                    
                                       
                                          (
                                          N
                                          −
                                          n
                                          +
                                          1
                                          )
                                       
                                    
                                 
                                 ⋅
                                 D
                                 
                                    
                                       
                                          a
                                       
                                    
                                    
                                       M
                                    
                                    
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 
                                 +
                                 ∇
                                 
                                    
                                       
                                          λ
                                       
                                    
                                    
                                       
                                          (
                                          N
                                          −
                                          n
                                          +
                                          1
                                          )
                                       
                                    
                                 
                                 ⋅
                                 
                                    
                                       D
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       
                                          P
                                       
                                    
                                    
                                       M
                                    
                                    
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 
                                 +
                                 ∇
                                 
                                    
                                       
                                          λ
                                       
                                    
                                    
                                       
                                          (
                                          N
                                          −
                                          n
                                          +
                                          1
                                          )
                                       
                                    
                                 
                                 ⋅
                                 
                                    
                                       A
                                    
                                    
                                       M
                                    
                                    
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 
                                 
                                    [
                                    ∇
                                    
                                       (
                                       D
                                       
                                          
                                             
                                                u
                                             
                                          
                                          
                                             M
                                          
                                          
                                             
                                                (
                                                n
                                                −
                                                1
                                                )
                                             
                                          
                                       
                                       +
                                       Δ
                                       t
                                       
                                       D
                                       
                                          
                                             
                                                v
                                             
                                          
                                          
                                             M
                                          
                                          
                                             
                                                (
                                                n
                                                −
                                                1
                                                )
                                             
                                          
                                       
                                       +
                                       
                                          
                                             
                                                (
                                                1
                                                −
                                                2
                                                β
                                                )
                                             
                                          
                                          
                                             2
                                          
                                       
                                       Δ
                                       
                                          
                                             t
                                          
                                          
                                             2
                                          
                                       
                                       
                                       D
                                       
                                          
                                             
                                                a
                                             
                                          
                                          
                                             M
                                          
                                          
                                             
                                                (
                                                n
                                                −
                                                1
                                                )
                                             
                                          
                                       
                                       +
                                       β
                                       Δ
                                       
                                          
                                             t
                                          
                                          
                                             2
                                          
                                       
                                       
                                       D
                                       
                                          
                                             
                                                a
                                             
                                          
                                          
                                             M
                                          
                                          
                                             
                                                (
                                                n
                                                )
                                             
                                          
                                       
                                       )
                                    
                                    ]
                                 
                                 }
                              
                              
                              
                                 d
                              
                              Ω
                              =
                              0
                              ,
                           
                        
                      where we use (5) to express 
                        D
                        
                           
                              
                                 u
                              
                           
                           
                              M
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                        =
                        D
                        
                           
                              
                                 u
                              
                           
                           
                              M
                           
                           
                              
                                 (
                                 n
                                 −
                                 1
                                 )
                              
                           
                        
                        +
                        Δ
                        t
                        
                        D
                        
                           
                              
                                 v
                              
                           
                           
                              M
                           
                           
                              
                                 (
                                 n
                                 −
                                 1
                                 )
                              
                           
                        
                        +
                        
                           
                              
                                 (
                                 1
                                 −
                                 2
                                 β
                                 )
                              
                           
                           
                              2
                           
                        
                        Δ
                        
                           
                              t
                           
                           
                              2
                           
                        
                        
                        D
                        
                           
                              
                                 a
                              
                           
                           
                              M
                           
                           
                              
                                 (
                                 n
                                 −
                                 1
                                 )
                              
                           
                        
                        +
                        β
                        Δ
                        
                           
                              t
                           
                           
                              2
                           
                        
                        
                        D
                        
                           
                              
                                 a
                              
                           
                           
                              M
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                     . Finite element discretization and some rearranging renders 
                        
                           (32)
                           
                              D
                              
                                 
                                    r
                                 
                                 
                                    M
                                 
                                 
                                    
                                       (
                                       n
                                       )
                                    
                                 
                              
                              
                                 (
                                 
                                    
                                       
                                          a
                                       
                                    
                                    
                                       M
                                    
                                    
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 
                                 )
                              
                              ≔
                              
                                 
                                    
                                       λ
                                    
                                 
                                 
                                    
                                       
                                          
                                             (
                                             N
                                             −
                                             n
                                             +
                                             1
                                             )
                                          
                                       
                                       
                                          T
                                       
                                    
                                 
                              
                              
                                 (
                                 
                                    
                                       D
                                    
                                    
                                       d
                                    
                                 
                                 
                                    
                                       
                                          R
                                       
                                    
                                    
                                       M
                                    
                                    
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 
                                 +
                                 
                                    (
                                    
                                       M
                                    
                                    +
                                    β
                                    Δ
                                    
                                       
                                          t
                                       
                                       
                                          2
                                       
                                    
                                    
                                    
                                       
                                          
                                             K
                                          
                                       
                                       
                                          T
                                       
                                       
                                          
                                             (
                                             n
                                             )
                                          
                                       
                                    
                                    )
                                 
                                 
                                 D
                                 
                                    
                                       
                                          a
                                       
                                    
                                    
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 
                                 +
                                 
                                    
                                       
                                          K
                                       
                                    
                                    
                                       T
                                    
                                    
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 
                                 
                                 
                                    [
                                    D
                                    
                                       
                                          
                                             u
                                          
                                       
                                       
                                          M
                                       
                                       
                                          
                                             (
                                             n
                                             −
                                             1
                                             )
                                          
                                       
                                    
                                    +
                                    Δ
                                    t
                                    
                                    D
                                    
                                       
                                          
                                             v
                                          
                                       
                                       
                                          M
                                       
                                       
                                          
                                             (
                                             n
                                             −
                                             1
                                             )
                                          
                                       
                                    
                                    +
                                    
                                       
                                          
                                             (
                                             1
                                             −
                                             2
                                             β
                                             )
                                          
                                       
                                       
                                          2
                                       
                                    
                                    Δ
                                    
                                       
                                          t
                                       
                                       
                                          2
                                       
                                    
                                    
                                    D
                                    
                                       
                                          
                                             a
                                          
                                       
                                       
                                          M
                                       
                                       
                                          
                                             (
                                             n
                                             −
                                             1
                                             )
                                          
                                       
                                    
                                    ]
                                 
                                 )
                              
                              ,
                           
                        
                      where 
                        
                           
                              
                                 λ
                              
                           
                           
                              
                                 
                                    
                                       (
                                       N
                                       −
                                       n
                                       +
                                       1
                                       )
                                    
                                 
                                 
                                    T
                                 
                              
                           
                        
                        
                           
                              D
                           
                           
                              d
                           
                        
                        
                           
                              
                                 R
                              
                           
                           
                              M
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                        ≈
                        
                           
                              ∫
                           
                           
                              Ω
                           
                        
                        
                           {
                           D
                           
                              
                                 ϱ
                              
                              
                                 
                                    
                                    
                                       M
                                    
                                 
                              
                           
                           
                              
                                 
                                    λ
                                 
                              
                              
                                 
                                    (
                                    N
                                    −
                                    n
                                    +
                                    1
                                    )
                                 
                              
                           
                           ⋅
                           
                              
                                 
                                    a
                                 
                              
                              
                                 M
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                           +
                           ∇
                           
                              
                                 
                                    λ
                                 
                              
                              
                                 
                                    (
                                    N
                                    −
                                    n
                                    +
                                    1
                                    )
                                 
                              
                           
                           ⋅
                           
                              
                                 D
                              
                              
                                 2
                              
                           
                           
                              
                                 
                                    P
                                 
                              
                              
                                 M
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                           }
                        
                        
                        
                           d
                        
                        Ω
                      is the partial derivative of 
                        
                           
                              r
                           
                           
                              M
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                     ; it is obtained by varying only 
                     
                        d
                     , i.e. holding 
                        
                           
                              
                                 a
                              
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                     , 
                        
                           
                              
                                 u
                              
                           
                           
                              M
                           
                           
                              
                                 (
                                 n
                                 −
                                 1
                                 )
                              
                           
                        
                     , 
                        
                           
                              
                                 v
                              
                           
                           
                              M
                           
                           
                              
                                 (
                                 n
                                 −
                                 1
                                 )
                              
                           
                        
                      and 
                        
                           
                              
                                 a
                              
                           
                           
                              M
                           
                           
                              
                                 (
                                 n
                                 −
                                 1
                                 )
                              
                           
                        
                      
                     fixed.
                        3
                     
                     
                        3
                        The above computations of 
                              ∂
                              π
                              /
                              ∂
                              d
                            and 
                              D
                              
                                 
                                    ϱ
                                 
                                 
                                    
                                       
                                       
                                          M
                                       
                                    
                                 
                              
                            are trivial and the evaluation of 
                              
                                 
                                    D
                                 
                                 
                                    2
                                 
                              
                              
                                 
                                    
                                       P
                                    
                                 
                                 
                                    M
                                 
                                 
                                    
                                       (
                                       n
                                       )
                                    
                                 
                              
                            is discussed in Nakshatrala et al.   [9].
                     Upon comparison with (21) we see that the above 
                        D
                        
                           
                              r
                           
                           
                              M
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                        
                           (
                           
                              
                                 
                                    a
                                 
                              
                              
                                 M
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                           )
                        
                      is akin to 
                        
                           
                              
                                 λ
                              
                           
                           
                              
                                 
                                    
                                       (
                                       N
                                       −
                                       n
                                       +
                                       1
                                       )
                                    
                                 
                                 
                                    T
                                 
                              
                           
                        
                        
                           
                              D
                           
                           
                              D
                              d
                           
                        
                        
                           [
                           
                              (
                              
                                 M
                              
                              +
                              β
                              
                              Δ
                              
                                 
                                    t
                                 
                                 
                                    2
                                 
                              
                              
                              
                                 K
                              
                              )
                           
                           
                           
                              
                                 
                                    a
                                 
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                           −
                           
                              
                                 
                                    f
                                 
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                           +
                           
                              K
                           
                           
                              (
                              
                                 
                                    
                                       u
                                    
                                 
                                 
                                    
                                       (
                                       n
                                       −
                                       1
                                       )
                                    
                                 
                              
                              +
                              Δ
                              t
                              
                              
                                 
                                    
                                       v
                                    
                                 
                                 
                                    
                                       (
                                       n
                                       −
                                       1
                                       )
                                    
                                 
                              
                              +
                              
                                 
                                    
                                       (
                                       1
                                       −
                                       2
                                       β
                                       )
                                    
                                 
                                 
                                    2
                                 
                              
                              Δ
                              
                                 
                                    t
                                 
                                 
                                    2
                                 
                              
                              
                                 
                                    
                                       a
                                    
                                 
                                 
                                    
                                       (
                                       n
                                       −
                                       1
                                       )
                                    
                                 
                              
                              )
                           
                           ]
                        
                      for the linear case where we associate the above 
                        
                           
                              D
                           
                           
                              d
                           
                        
                        
                           
                              
                                 R
                              
                           
                           
                              M
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                      with the linear 
                        D
                        
                           M
                        
                        
                        
                           
                              
                                 a
                              
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                        +
                        D
                        
                           K
                        
                        
                        
                           
                              
                                 u
                              
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                     .

Using this similarity between the nonlinear and linear sensitivity analyses we replace 
                        
                           
                              
                                 λ
                              
                           
                           
                              
                                 
                                    
                                       (
                                       N
                                       −
                                       n
                                       +
                                       1
                                       )
                                    
                                 
                                 
                                    T
                                 
                              
                           
                        
                        
                           
                              D
                           
                           
                              D
                              d
                           
                        
                        
                           [
                           
                              (
                              
                                 M
                              
                              +
                              β
                              
                              Δ
                              
                                 
                                    t
                                 
                                 
                                    2
                                 
                              
                              
                              
                                 K
                              
                              )
                           
                           
                           
                              
                                 
                                    a
                                 
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                           −
                           
                              
                                 
                                    f
                                 
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                           +
                           
                              K
                           
                           
                              (
                              
                                 
                                    
                                       u
                                    
                                 
                                 
                                    
                                       (
                                       n
                                       −
                                       1
                                       )
                                    
                                 
                              
                              +
                              Δ
                              t
                              
                              
                                 
                                    
                                       v
                                    
                                 
                                 
                                    
                                       (
                                       n
                                       −
                                       1
                                       )
                                    
                                 
                              
                              +
                              
                                 
                                    
                                       (
                                       1
                                       −
                                       2
                                       β
                                       )
                                    
                                 
                                 
                                    2
                                 
                              
                              Δ
                              
                                 
                                    t
                                 
                                 
                                    2
                                 
                              
                              
                                 
                                    
                                       a
                                    
                                 
                                 
                                    
                                       (
                                       n
                                       −
                                       1
                                       )
                                    
                                 
                              
                              )
                           
                           ]
                        
                      in (21) with 
                        D
                        
                           
                              r
                           
                           
                              M
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                        
                           (
                           
                              
                                 
                                    a
                                 
                              
                              
                                 M
                              
                              
                                 
                                    (
                                    n
                                    )
                                 
                              
                           
                           )
                        
                      in (32) and proceed as in the linear case. By doing so, we arrive at the adjoint equations 
                        
                           
                              (33)
                              
                                 
                                    
                                       
                                          μ
                                       
                                    
                                    
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 
                                 =
                                 
                                    
                                       
                                          (
                                          
                                             
                                                ∂
                                                
                                                   
                                                      π
                                                   
                                                   
                                                      
                                                         (
                                                         N
                                                         −
                                                         n
                                                         +
                                                         1
                                                         )
                                                      
                                                   
                                                
                                             
                                             
                                                ∂
                                                
                                                   
                                                      
                                                         u
                                                      
                                                   
                                                   
                                                      
                                                         (
                                                         N
                                                         −
                                                         n
                                                         +
                                                         1
                                                         )
                                                      
                                                   
                                                
                                             
                                          
                                          )
                                       
                                    
                                    
                                       T
                                    
                                 
                                 +
                                 H
                                 
                                    (
                                    n
                                    −
                                    1
                                    )
                                 
                                 
                                    (
                                    
                                       
                                          
                                             K
                                          
                                       
                                       
                                          T
                                       
                                       
                                          
                                             (
                                             N
                                             −
                                             n
                                             +
                                             2
                                             )
                                          
                                       
                                    
                                    
                                    
                                       
                                          
                                             λ
                                          
                                       
                                       
                                          
                                             (
                                             n
                                             −
                                             1
                                             )
                                          
                                       
                                    
                                    +
                                    
                                       
                                          
                                             μ
                                          
                                       
                                       
                                          
                                             (
                                             n
                                             −
                                             1
                                             )
                                          
                                       
                                    
                                    )
                                 
                                 ,
                              
                           
                           
                              (34)
                              
                                 
                                    
                                       
                                          η
                                       
                                    
                                    
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 
                                 =
                                 
                                    
                                       
                                          (
                                          
                                             
                                                ∂
                                                
                                                   
                                                      π
                                                   
                                                   
                                                      
                                                         (
                                                         N
                                                         −
                                                         n
                                                         +
                                                         1
                                                         )
                                                      
                                                   
                                                
                                             
                                             
                                                ∂
                                                
                                                   
                                                      
                                                         v
                                                      
                                                   
                                                   
                                                      
                                                         (
                                                         N
                                                         −
                                                         n
                                                         +
                                                         1
                                                         )
                                                      
                                                   
                                                
                                             
                                          
                                          )
                                       
                                    
                                    
                                       T
                                    
                                 
                                 +
                                 H
                                 
                                    (
                                    n
                                    −
                                    1
                                    )
                                 
                                 
                                    [
                                    Δ
                                    t
                                    
                                       (
                                       
                                          
                                             
                                                K
                                             
                                          
                                          
                                             T
                                          
                                          
                                             
                                                (
                                                N
                                                −
                                                n
                                                +
                                                2
                                                )
                                             
                                          
                                       
                                       
                                       
                                          
                                             
                                                λ
                                             
                                          
                                          
                                             
                                                (
                                                n
                                                −
                                                1
                                                )
                                             
                                          
                                       
                                       +
                                       
                                          
                                             
                                                μ
                                             
                                          
                                          
                                             
                                                (
                                                n
                                                −
                                                1
                                                )
                                             
                                          
                                       
                                       )
                                    
                                    +
                                    
                                       
                                          
                                             η
                                          
                                       
                                       
                                          
                                             (
                                             n
                                             −
                                             1
                                             )
                                          
                                       
                                    
                                    ]
                                 
                                 ,
                              
                           
                           
                              (35)
                              
                                 
                                    (
                                    
                                       M
                                    
                                    +
                                    β
                                    Δ
                                    
                                       
                                          t
                                       
                                       
                                          2
                                       
                                    
                                    
                                       
                                          
                                             K
                                          
                                       
                                       
                                          T
                                       
                                       
                                          
                                             (
                                             N
                                             −
                                             n
                                             +
                                             1
                                             )
                                          
                                       
                                    
                                    )
                                 
                                 
                                 
                                    
                                       
                                          λ
                                       
                                    
                                    
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 
                                 =
                                 −
                                 
                                    
                                       
                                          (
                                          
                                             
                                                ∂
                                                
                                                   
                                                      π
                                                   
                                                   
                                                      
                                                         (
                                                         N
                                                         −
                                                         n
                                                         +
                                                         1
                                                         )
                                                      
                                                   
                                                
                                             
                                             
                                                ∂
                                                
                                                   
                                                      
                                                         a
                                                      
                                                   
                                                   
                                                      
                                                         (
                                                         N
                                                         −
                                                         n
                                                         +
                                                         1
                                                         )
                                                      
                                                   
                                                
                                             
                                          
                                          )
                                       
                                    
                                    
                                       T
                                    
                                 
                                 −
                                 β
                                 Δ
                                 
                                    
                                       t
                                    
                                    
                                       2
                                    
                                 
                                 
                                 
                                    
                                       
                                          μ
                                       
                                    
                                    
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 
                                 −
                                 γ
                                 Δ
                                 t
                                 
                                 
                                    
                                       
                                          η
                                       
                                    
                                    
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 
                                 −
                                 H
                                 
                                    (
                                    n
                                    −
                                    1
                                    )
                                 
                                 
                                    [
                                    
                                       
                                          
                                             (
                                             1
                                             −
                                             2
                                             
                                             β
                                             )
                                          
                                       
                                       
                                          2
                                       
                                    
                                    Δ
                                    
                                       
                                          t
                                       
                                       
                                          2
                                       
                                    
                                    
                                    
                                       (
                                       
                                          
                                             
                                                K
                                             
                                          
                                          
                                             T
                                          
                                          
                                             
                                                (
                                                N
                                                −
                                                n
                                                +
                                                2
                                                )
                                             
                                          
                                       
                                       
                                       
                                          
                                             
                                                λ
                                             
                                          
                                          
                                             
                                                (
                                                n
                                                −
                                                1
                                                )
                                             
                                          
                                       
                                       +
                                       
                                          
                                             
                                                μ
                                             
                                          
                                          
                                             
                                                (
                                                n
                                                −
                                                1
                                                )
                                             
                                          
                                       
                                       )
                                    
                                    +
                                    
                                       (
                                       1
                                       −
                                       γ
                                       )
                                    
                                    Δ
                                    t
                                    
                                    
                                       
                                          
                                             η
                                          
                                       
                                       
                                          
                                             (
                                             n
                                             −
                                             1
                                             )
                                          
                                       
                                    
                                    ]
                                 
                                 ,
                              
                           
                        
                      which we solve for 
                        
                           
                              
                                 μ
                              
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                     , 
                        
                           
                              
                                 η
                              
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                      and 
                        
                           
                              
                                 λ
                              
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                      for 
                        n
                        =
                        1
                        ,
                        …
                        ,
                        N
                      to annihilate the response derivatives. In this way the sensitivity reduces to 
                        
                           (36)
                           
                              ∇
                              Θ
                              =
                              
                                 
                                    ∑
                                 
                                 
                                    n
                                    =
                                    1
                                 
                                 
                                    N
                                 
                              
                              
                                 [
                                 
                                    
                                       ∂
                                       
                                          
                                             π
                                          
                                          
                                             
                                                (
                                                n
                                                )
                                             
                                          
                                       
                                    
                                    
                                       ∂
                                       d
                                    
                                 
                                 +
                                 
                                    
                                       
                                          λ
                                       
                                    
                                    
                                       
                                          
                                             
                                                (
                                                N
                                                −
                                                n
                                                +
                                                1
                                                )
                                             
                                          
                                          
                                             T
                                          
                                       
                                    
                                 
                                 
                                    
                                       D
                                    
                                    
                                       d
                                    
                                 
                                 
                                    
                                       
                                          R
                                       
                                    
                                    
                                       M
                                    
                                    
                                       
                                          (
                                          n
                                          )
                                       
                                    
                                 
                                 ]
                              
                              
                              Δ
                              t
                              .
                           
                        
                     
                  

As noted in Michaleris et al.  [41], the converged Jacobian matrices 
                        
                           M
                        
                        +
                        β
                        Δ
                        
                           
                              t
                           
                           
                              2
                           
                        
                        
                        
                           
                              
                                 K
                              
                           
                           
                              T
                           
                           
                              
                                 (
                                 N
                                 −
                                 n
                                 +
                                 1
                                 )
                              
                           
                        
                      from the primal analysis, cf. (9), can be used to evaluate 
                        
                           
                              
                                 λ
                              
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                      and the adjoint problem is linear (and hence no adjoint iterations are required) even though the primal analysis problem is nonlinear. However, there is no need for the microscopic adjoint analysis here which is not the case in Michaleris et al.  [41]. To hasten the computations it is recommended that the matrix–vector products on the right hand sides of (33)–(35) be performed on the element level and then assembled in the usual finite element manner. Still the time mapping belies the simplicity of this (and all transient adjoint) sensitivity analysis. As stated above, the adjoint analysis for e.g.  
                        
                           
                              
                                 λ
                              
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                      cannot immediately follow the primal analysis for e.g.  
                        
                           
                              
                                 a
                              
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                     . Indeed, the tangent matrices at times 
                        
                           
                              t
                           
                           
                              
                                 (
                                 N
                                 −
                                 n
                                 +
                                 1
                                 )
                              
                           
                        
                      and 
                        
                           
                              t
                           
                           
                              
                                 (
                                 N
                                 −
                                 n
                                 +
                                 2
                                 )
                              
                           
                        
                      that are required to evaluate the adjoint responses at time 
                        
                           
                              t
                           
                           
                              
                                 (
                                 n
                                 )
                              
                           
                        
                      preclude such a synchronous approach. In discretizations with many nodes and time-steps this is problematic since one must store the response trajectory and either store or recompute the converged Jacobians from the primal analysis before initiating the adjoint analysis. To alleviate the storage burden we use distributed computing wherein the primal response and converged element stiffness matrices are stored across the different nodes on a cluster. Thus, while we are unable to efficiently solve the adjoint equation (35) with a back-substitution, we can readily evaluate the coefficient matrix. Despite this complication, it is well known that the adjoint method is preferred over the (synchronous) direct differentiation sensitivity method in topology optimization studies because there are many more design parameters 
                        
                           d
                        
                      than objective and constraint functions 
                        Θ
                     .

@&#RESULTS@&#

As an illustrative example we apply this topology optimization framework to design the composite micro-structures of a 600 mm 
                        ×
                        100
                      mm plane strain plate that is subjected to an impact loading. The objective is to achieve desired energy propagation. As seen in Fig. 2
                     , the plate is constrained at the bottom and subjected to a uniform pressure load over its top surface that varies in time as a triangular pulse over a 
                        10
                        
                        
                           μ
                        
                        
                           s
                        
                      interval with a peak of 50 MPa. We use the unconditionally stable implicit second-order accurate trapezoidal rule, i.e. Newmark’s scheme with 
                        β
                        =
                        0.25
                     , 
                        γ
                        =
                        0.5
                      and discretize the total simulation 
                        T
                        =
                        40
                        
                        
                           μ
                        
                        
                           s
                        
                      with constant 
                        Δ
                        t
                        =
                        1
                        
                        
                           μ
                        
                        
                           s
                        
                     . The duration of the simulation is chosen to ensure the energy reaches the desired target area which we describe shortly.

The total energy density, i.e. the sum of strain energy density and kinetic energy density, at any point 
                        
                           x
                        
                        ∈
                        
                           
                              Ω
                           
                           
                              M
                           
                        
                      is given by 
                        
                           (37)
                           
                              
                                 
                                    ε
                                 
                                 
                                    e
                                 
                              
                              
                                 (
                                 
                                    x
                                 
                                 )
                              
                              =
                              
                                 
                                    Ψ
                                 
                                 
                                    
                                       M
                                    
                                 
                              
                              
                                 (
                                 
                                    x
                                 
                                 ,
                                 
                                    
                                       
                                          F
                                       
                                    
                                    
                                       M
                                    
                                 
                                 
                                    (
                                    
                                       x
                                    
                                    )
                                 
                                 )
                              
                              +
                              
                                 
                                    1
                                 
                                 
                                    2
                                 
                              
                              
                                 
                                    ϱ
                                 
                                 
                                    M
                                 
                              
                              
                                 (
                                 
                                    x
                                 
                                 )
                              
                              
                              
                              
                                 
                                    
                                       v
                                    
                                 
                                 
                                    M
                                 
                              
                              
                                 (
                                 
                                    x
                                 
                                 )
                              
                              ⋅
                              
                              
                                 
                                    
                                       v
                                    
                                 
                                 
                                    M
                                 
                              
                              
                                 (
                                 
                                    x
                                 
                                 )
                              
                              ,
                           
                        
                      where 
                        
                           
                              Ψ
                           
                           
                              
                                 M
                              
                           
                        
                      is the macroscopic stored energy response function that is obtained by homogenizing the microscopic energy over the unit cell, see  [9] for details, and 
                        
                           
                              ϱ
                           
                           
                              M
                           
                        
                      is the macroscopic mass density that is obtained by averaging the microscopic density over the unit cell. We wish to maximize the energy over a given space–time region-interval 
                        
                           
                              Ω
                           
                           
                              s
                           
                        
                        ×
                        
                           
                              I
                           
                           
                              t
                           
                        
                      in our plate. However, our gradient based optimization algorithm requires smooth functions, hence we use a 
                        p
                     -norm measure to approximate the maximum total energy as 
                        
                           (38)
                           
                              
                                 
                                    max
                                 
                                 
                                    
                                       
                                          Ω
                                       
                                       
                                          e
                                       
                                    
                                    ×
                                    
                                       
                                          I
                                       
                                       
                                          t
                                       
                                    
                                 
                              
                              
                                 (
                                 
                                    
                                       ε
                                    
                                    
                                       e
                                    
                                 
                                 )
                              
                              ≈
                              
                                 
                                    
                                       (
                                       
                                          
                                             ∫
                                          
                                          
                                             
                                                
                                                   Ω
                                                
                                                
                                                   s
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                (
                                                
                                                   
                                                      ∫
                                                   
                                                   
                                                      
                                                         
                                                            I
                                                         
                                                         
                                                            t
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         (
                                                         
                                                            
                                                               ε
                                                            
                                                            
                                                               e
                                                            
                                                         
                                                         )
                                                      
                                                   
                                                   
                                                      R
                                                   
                                                
                                                
                                                d
                                                t
                                                )
                                             
                                          
                                          
                                             S
                                             /
                                             R
                                          
                                       
                                       
                                       
                                          d
                                       
                                       Ω
                                       )
                                    
                                 
                                 
                                    1
                                    /
                                    S
                                 
                              
                              .
                           
                        
                      A large value of 
                        R
                      will improve the max approximation over the time domain 
                        
                           
                              I
                           
                           
                              t
                           
                        
                      whereas a large value of 
                        S
                      will improve the max approximation over the spatial domain 
                        
                           
                              Ω
                           
                           
                              s
                           
                        
                     . We desire to focus the energy to the center of the bottom surface of the plate, cf. Fig. 2, at no particular instant in the time interval 
                        
                           [
                           0
                           ,
                           T
                           ]
                        
                     . To achieve this, we equate 
                        
                           
                              I
                           
                           
                              t
                           
                        
                        =
                        
                           [
                           0
                           ,
                           T
                           ]
                        
                      and 
                        
                           
                              Ω
                           
                           
                              s
                           
                        
                      to the 80 mm 
                        ×
                        40
                      mm rectangular region at the plate’s bottom center. Based on the choice made in Le et al.  [1], we take 
                        S
                        =
                        1
                      and 
                        R
                        =
                        16
                      in (38) to achieve a maximum total energy over the desired region 
                        
                           
                              Ω
                           
                           
                              s
                           
                        
                      for any instant in the time interval 
                        
                           
                              I
                           
                           
                              t
                           
                        
                     .

The properties of the constituent material phases are 
                        
                           (
                           
                              
                                 λ
                              
                              
                                 1
                              
                           
                           ,
                           
                              
                                 μ
                              
                              
                                 1
                              
                           
                           )
                        
                        =
                        
                           (
                           55,000
                           ,
                           83,000
                           )
                        
                        
                        M
                        P
                        a
                      for the heavy stiff phase and 
                        
                           (
                           
                              
                                 λ
                              
                              
                                 2
                              
                           
                           ,
                           
                              
                                 μ
                              
                              
                                 2
                              
                           
                           )
                        
                        =
                        
                           (
                           1700
                           ,
                           1100
                           )
                        
                        
                        M
                        P
                        a
                      for the light compliant phase with 
                        
                           
                              ρ
                           
                           
                              1
                           
                        
                        =
                        1800
                      kg/
                        
                           
                              
                                 m
                              
                           
                           
                              3
                           
                        
                      and 
                        
                           
                              ρ
                           
                           
                              2
                           
                        
                        =
                        1400
                      kg/
                        
                           
                              
                                 m
                              
                           
                           
                              3
                           
                        
                     . Here 
                        λ
                      and 
                        μ
                      are the Lamé parameters for our neo-Hookean material. The material response at the point 
                        
                           
                              
                                 y
                              
                           
                           
                              x
                           
                        
                      in the unit cell that defines the micro-structure at a given point 
                        
                           x
                        
                        ∈
                        Ω
                      is defined such that 
                        
                           
                              
                                 Ψ
                                 
                                    (
                                    
                                       
                                          
                                             y
                                          
                                       
                                       
                                          x
                                       
                                    
                                    )
                                 
                                 =
                                 ν
                                 
                                    (
                                    
                                       
                                          
                                             y
                                          
                                       
                                       
                                          x
                                       
                                    
                                    )
                                 
                                 
                                 
                                    
                                       Ψ
                                    
                                    
                                       1
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             y
                                          
                                       
                                       
                                          x
                                       
                                    
                                    )
                                 
                                 +
                                 
                                    (
                                    1
                                    −
                                    ν
                                    
                                       (
                                       
                                          
                                             
                                                y
                                             
                                          
                                          
                                             x
                                          
                                       
                                       )
                                    
                                    )
                                 
                                 
                                 
                                    
                                       Ψ
                                    
                                    
                                       2
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             y
                                          
                                       
                                       
                                          x
                                       
                                    
                                    )
                                 
                              
                           
                           
                              (39)
                              
                                 ρ
                                 
                                    (
                                    
                                       
                                          
                                             y
                                          
                                       
                                       
                                          x
                                       
                                    
                                    )
                                 
                                 =
                                 ν
                                 
                                    (
                                    
                                       
                                          
                                             y
                                          
                                       
                                       
                                          x
                                       
                                    
                                    )
                                 
                                 
                                 
                                    
                                       ρ
                                    
                                    
                                       1
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             y
                                          
                                       
                                       
                                          x
                                       
                                    
                                    )
                                 
                                 +
                                 
                                    (
                                    1
                                    −
                                    ν
                                    
                                       (
                                       
                                          
                                             
                                                y
                                             
                                          
                                          
                                             x
                                          
                                       
                                       )
                                    
                                    )
                                 
                                 
                                 
                                    
                                       ρ
                                    
                                    
                                       2
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             y
                                          
                                       
                                       
                                          x
                                       
                                    
                                    )
                                 
                                 .
                              
                           
                        
                      In the above 
                        
                           
                              Ψ
                           
                           
                              i
                           
                        
                      is the neo-Hookean strain energy function of the phase 
                        i
                      material and 
                        ν
                      is the indicator function field of the heavy stiff phase 1 material. It is this field 
                        ν
                      that defines the micro-structure and hence the field that is optimized.

Being an indicator function we necessarily have 
                        ν
                        
                           (
                           
                              
                                 
                                    y
                                 
                              
                              
                                 x
                              
                           
                           )
                        
                        ∈
                        
                           {
                           0
                           ,
                           1
                           }
                        
                      which is a non-convex set. This leads to a non-differentiable objective function, cf. (38), and precludes the use of efficient nonlinear programming algorithms. As per usual, this issue is resolved by replacing the indicator function with a volume fraction field. Thusly the 
                        ν
                      in (39) is now understood to be the volume fraction field, cf.  [9]. Ideally the optimized 
                        ν
                      satisfies 
                        ν
                        
                           (
                           
                              
                                 
                                    y
                                 
                              
                              
                                 x
                              
                           
                           )
                        
                        =
                        0
                      or 
                        ν
                        
                           (
                           
                              
                                 
                                    y
                                 
                              
                              
                                 x
                              
                           
                           )
                        
                        =
                        1
                      throughout the unit cells and thus the volume fraction reverts to the desired indicator function. To achieve such “0–1” behavior penalization is often used wherein the material stiffness is artificially decreased versus the mass density, cf.  [23]. This penalization is effective when the structure’s compliance is minimized and its mass is constrained or vice versa, which is not the case here. As such no penalization is used and yet we achieve “0–1” designs. We conjecture that the sharp “0–1” interfaces are needed in the unit cell designs to create optimal homogenized density–anisotropic stiffness properties that cannot be achieved in unit cell designs containing material mixtures, i.e. designs containing large regions in which 
                        0
                        <
                        ν
                        
                           (
                           
                              
                                 
                                    y
                                 
                              
                              
                                 x
                              
                           
                           )
                        
                        <
                        1
                     . Unfortunately, since the homogenized properties are deformation dependent, this conjecture is difficult to prove.

To generate unit cell designs with a minimum length scale we use restriction which we accomplish by filtering the volume fraction 
                        ν
                      to define the filtered volume fraction field 
                        
                           
                              ν
                           
                           
                              ̃
                           
                        
                      within each unit cell, cf.  [9]. It is this filtered volume fraction 
                        
                           
                              ν
                           
                           
                              ̃
                           
                        
                      that is ultimately used in (39). The use of the 
                        
                           
                              ν
                           
                           
                              ̃
                           
                        
                      is problematic as it does not satisfy the 
                        
                           
                              ν
                           
                           
                              ̃
                           
                        
                        
                           (
                           
                              
                                 
                                    y
                                 
                              
                              
                                 x
                              
                           
                           )
                        
                        ∈
                        
                           {
                           0
                           ,
                           1
                           }
                        
                      condition. However, referring to our previous conjecture, we still obtain designs with reasonably sharp interfaces, i.e. designs exhibiting only thin interphasal regions for which 
                        0
                        <
                        
                           
                              ν
                           
                           
                              ̃
                           
                        
                        
                           (
                           
                              
                                 
                                    y
                                 
                              
                              
                                 x
                              
                           
                           )
                        
                        <
                        1
                     .

The half domain of the symmetric plate is discretized using 60×20 standard Q4 (macroscopic) elements and the material micro-structure is discretized as piecewise uniform over each of these elements. To these ends a 20×20 Q4 (unit cell) element mesh is associated with each of the 60×20 (macroscopic) elements. The unit cell volume fraction is similarly discretized as piecewise uniform over each of 20×20 (unit cell) elements. These 
                        
                           (
                           60
                           ×
                           20
                           )
                        
                        ×
                        
                           (
                           20
                           ×
                           20
                           )
                        
                        =
                        480,000
                      volume fractions serve as the design parameters in the optimization. An isotropic filter  [42] that spans three finite elements is used to define the 
                        
                           
                              ν
                           
                           
                              ̃
                           
                        
                      of (39). A tolerance of 0.01 for the relative change in the objective function value is chosen as the termination criteria of the optimization algorithm.

The contour for the optimized macroscopic design, cf. Fig. 3
                     , illustrates the unit cell 
                        □
                      averaged volume fractions 
                        
                           
                              ν
                           
                           
                              ̄
                           
                        
                        =
                        
                           
                              ∫
                           
                           
                              □
                           
                        
                        
                           
                              ν
                           
                           
                              ̃
                           
                        
                        
                           (
                           
                              
                                 
                                    y
                                 
                              
                              
                                 x
                              
                           
                           )
                        
                        
                        d
                        v
                      associated with each macroscopic finite element such that the red regions which contain the stiff material wherein 
                        
                           
                              ν
                           
                           
                              ̄
                           
                        
                        =
                        1
                      transitions to the blue regions which contain the compliant material wherein 
                        
                           
                              ν
                           
                           
                              ̄
                           
                        
                        =
                        0
                     . The unit cell morphologies at a few select locations 
                        
                           x
                        
                      are also shown wherein red and blue indicate the presence of stiff and compliant materials where 
                        
                           
                              ν
                           
                           
                              ̃
                           
                        
                        
                           (
                           
                              
                                 
                                    y
                                 
                              
                              
                                 x
                              
                           
                           )
                        
                        =
                        1
                      and 
                        
                           
                              ν
                           
                           
                              ̃
                           
                        
                        
                           (
                           
                              
                                 
                                    y
                                 
                              
                              
                                 x
                              
                           
                           )
                        
                        =
                        0
                     , respectively. Note that the optimized micro-structures contain only thin interphasal regions.

For this structure and loading, an isotropic homogeneous plate would generate a plane wave without any energy concentration. However, as seen in Fig. 4
                     , the optimized design effectively concentrates the energy to the desired target region. We attribute this directionality to the anisotropy of the optimal heterogeneous micro-structures which allow the energy to travel at different speeds and directions.

@&#CONCLUSIONS@&#

We have demonstrated the application of a topology optimization framework to effectively design nonlinear elastic material micro-structures for tailored energy propagation. A discretize and then differentiate sensitivity analysis using multiple adjoint variables is motivated through a two-degree of freedom spring mass system. Future work should incorporate the size effects by using higher-order homogenization theory and more complex material models, e.g. that are history dependent.

@&#REFERENCES@&#

