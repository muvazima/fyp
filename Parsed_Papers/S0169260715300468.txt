@&#MAIN-TITLE@&#A real-time method to reduce ballistocardiogram artifacts from EEG during fMRI based on optimal basis sets (OBS)

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           A real-time OBS was proposed for the real-time removal of ballistocardiogram artifacts.


                        
                        
                           
                           The real-time OBS performed better than rtAAS in the real-time removal of BCG artifacts.


                        
                        
                           
                           A real-time analysis during a simultaneous EEG–fMRI acquisition is essential to achieving neurofeedback.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Simultaneous EEG–fMRI

Ballistocardiogram artifacts

Real-time optimal basis sets

@&#ABSTRACT@&#


               
               
                  Background
                  The simultaneous acquisition of electroencephalogram (EEG) and functional magnetic resonance imaging (fMRI) provides both high temporal and spatial resolution when measuring brain activity. A real-time analysis during a simultaneous EEG–fMRI acquisition is essential when studying neurofeedback and conducting effective brain activity monitoring. However, the ballistocardiogram (BCG) artifacts which are induced by heartbeat-related electrode movements in an MRI scanner severely contaminate the EEG signals and hinder a reliable real-time analysis.
               
               
                  New method
                  The optimal basis sets (OBS) method is an effective candidate for removing BCG artifacts in a traditional offline EEG–fMRI analysis, but has yet to be applied to a real-time EEG–fMRI analysis. Here, a novel real-time technique based on OBS method (rtOBS) is proposed to remove BCG artifacts on a moment-to-moment basis. Real-time electrocardiogram R-peak detection procedure and sliding window OBS method were adopted.
               
               
                  Results
                  A series of simulated data was constructed to verify the feasibility of the rtOBS technique. Furthermore, this method was applied to real EEG–fMRI data to remove BCG artifacts. The results of both simulated data and real EEG–fMRI data from eight healthy human subjects demonstrate the effectiveness of rtOBS in both the time and frequency domains.
               
               
                  Comparison with existing methods
                  A comparison between rtOBS and real-time averaged artifact subtraction (rtAAS) was conducted. The results suggest the efficacy and advantage of rtOBS in the real-time removal of BCG artifacts.
               
               
                  Conclusions
                  In this study, a novel real-time OBS technique was proposed for the real-time removal of BCG artifacts. The proposed method was tested using simulated data and applied to real simultaneous EEG–fMRI data. The results suggest the effectiveness of this method.
               
            

@&#INTRODUCTION@&#

Simultaneous recording of electroencephalogram and functional magnetic resonance imaging (EEG–fMRI) provides high spatial and temporal resolution when examining brain activity [1] and has been applied in numerous studies [2–11]. A real-time analysis during a simultaneous EEG–fMRI acquisition is important in studying neurofeedback [12] and monitoring brain activity on a moment-to-moment basis. For example, in a study on neurofeedback, the real-time feature extraction of both EEG and fMRI data was shown to be essential to neurofeedback training [12]. However, artifacts induced by the MRI environment severely contaminate the EEG signals, making the real-time analysis of multimodal signals unviable. The removal of such artifacts is essential for a real-time fMRI-EEG analysis.

There are two major types of artifacts [13]. One is a gradient artifact caused by the MRI gradient switching and radiofrequency pulses. This type of artifact can be removed easily using some existing real-time algorithms based on the stability and strict periodicity [13,14]. The other is a ballistocardiogram (BCG) artifact induced by heartbeat-related movements of the electrodes inside the static magnetic field of the MRI scanner. BCG artifacts therefore have an evident interpersonal variance. Furthermore, BCG artifacts are time-variant because their periodicity is subject to the variability in the heart rate and the presence of drift artifacts [15]. The amplitude of a BCG artifact is scaled in proportion to the magnetic field strength inside the MRI scanner [16,17], and its shape varies considerably over time [18]. These factors make BCG artifact variations difficult to predict or characterize. Therefore, the removal of BCG artifacts is often more challenging than the removal of gradient artifacts when analyzing EEG data recorded in an MRI environment [19].

BCG artifact removal approaches mainly include spatial-pattern removal techniques and waveform removal techniques. To reduce artifacts, the spatial-pattern removal techniques use the statistic signature of the spatial pattern of the artifacts. Such spatial filtering schemes for artifact reduction are based on a principal component analysis (PCA) and an independent component analysis (ICA) [5,6]. Waveform removal techniques use the periodical nature of the heartbeat to reduce artifacts. This class includes averaged artifact subtraction (AAS) [15], optimal basis sets (OBS) [20], moving general linear models (mGLMs) [21], and adaptive filtering techniques [22]. Compared with spatial-pattern removal approaches, waveform removal approaches usually consume less time, and their performance is independent of the user experience. Furthermore, a reference-free harmonic regression technique [23], cyclostationary source extraction (CSE) [24], orthogonal matching pursuit (OMP) [25], short- and long-term linear predictor [26], and a method combining an ICA with a clustering technique [27] are also widely used to remove BCG artifacts. However, each of the above methods has been applied to the removal of BCG artifacts in offline post-processing mode.

For the real-time removal of BCG artifacts, researchers have developed a method called real-time AAS (rtAAS), which averages multiple prior artifact segments (according to the ECG data) to predict ongoing artifacts (BrainVisionRecView software of Brain Products GmbH, Munich, Germany: http://www.brainproducts.com/). Although rtAAS is popular owing to its simplicity and effectiveness, the technique of overlaying and averaging it employed to calculate BCG artifact templates may be low in sensitivity and unable to reflect the changes of BCG artifacts over time [28]. Finding better options for real-time BCG artifact removal remains a challenge in EEG–fMRI studies.

Previous studies on offline analyses have suggested that the OBS method performs better in BCG artifact removal than the AAS method [20,29]. The OBS method employs PCA to generate a BCG artifact template obtained using the optimal basis sets to effectively capture the variations in artifacts, and then subtracts this template from the original EEG trials. Namely, the OBS method employs a statistic method to construct a template used for presenting more artifact information and is robust to disturbances. Accordingly, the OBS method may also be a more effective candidate for real-time artifact removal. However, in previous studies, the OBS method has mainly been applied to offline post-processing instead of a real-time analysis. In the present work the main goal is developing a convenient real-time method for BCG artifact removal in simultaneous EEG–fMRI studies.

In this article, a novel method called real-time OBS (rtOBS) is introduced for real-time BCG artifact removal. Using real-time AAS (rtAAS) applied to simulated data as a reference, the efficacy of the rtOBS method was tested. Next, rtOBS was applied to real data. The results for both the time and frequency domains show that our rtOBS is efficient in the real-time removal of BCG artifacts from EEG data acquired simultaneously using fMRI.

The rtOBS method for BCG artifact removal includes three major steps. First, the R-peak (peak of the electrocardio signal) of the current heartbeat in an ECG signal is detected. Second, the optimal basis sets denoting the estimation of the BCG artifacts are constructed and updated on a moment-to-moment basis. This step adopts EEG segmentation according to the R-peak detection results and the sliding window technique [30]. Third, the optimal basis sets are fitted to and subtracted from the current EEG segment to remove BCG artifacts in real-time. The details of each step are as follows.

For the real-time detection of ECG R-peaks in an MR environment, simple thresholding detection methods [15] are impractical owing to their time-consumption and inaccuracy in such an environment. Thus, a combined adaptive threshold algorithm [31] is introduced here for the real-time detection of ECG R-peaks. For this detection method, three thresholds, (1) the steep-slope threshold (M), (2) the integrating threshold for high-frequency signal components (F), and (3) the beat expectation threshold (R), are used together for R-peak detection. An R-peak is defined as the local peak with the signal magnitude being greater than the sum of these three thresholds (see Eq. (1)):
                           
                              (1)
                              
                                 
                                    M
                                    F
                                    R
                                    =
                                    M
                                    +
                                    F
                                    +
                                    R
                                 
                              
                           
                        
                     

The timings of the R-peaks are detected using a real-time procedure based on the combined adaptive threshold algorithm.

For consistency of the compare between methods, we apply this R-peak detection method for both rtAAS and rtOBS for the real-time detection of ECG R-peaks. Therefore, we can exclude the possibility that the difference between rtAAS and rtOBS in performance is because of different methods of R-peak detection.

The EEG data are segmented based on the detected ECG R-peaks. PCA is then employed on these EEG segments to construct the optimal basis sets. For a real-time process, the interval of the R-peaks varies over time, and thus it is necessary to adopt an adaptive EEG segment length (L
                        
                           rt
                        ). Furthermore, to achieve a real-time analysis, a sliding buffer window is applied to the EEG segments. According to the above procedure, three parameters are critical for the real-time construction of the optimal basis sets: (1) the EEG segment length (L
                        
                           rt
                        ), (2) the buffer window size, and (3) the number of principal components (PC number). In the following, the details of these parameters are introduced.

In an offline OBS method, the EEG segment length (L), which is constructed using the entire dataset, is computed as the mean of all ECG peak intervals [20]:
                              
                                 (2)
                                 
                                    
                                       L
                                       =
                                       
                                          1
                                          
                                             n
                                             −
                                             1
                                          
                                       
                                       
                                          ∑
                                          
                                             m
                                             =
                                             2
                                          
                                          n
                                       
                                       
                                          (
                                          
                                             R
                                             m
                                          
                                          −
                                          
                                             R
                                             
                                                m
                                                −
                                                1
                                             
                                          
                                          )
                                       
                                    
                                 
                              
                           where n is the number of all ECG R-peaks, and R
                           
                              m
                            is the time point of the mth ECG R-peak. Notably, all ECG R-peaks are used in the offline OBS.

However, in real-time segmentation, the foregoing procedure is no longer valid. For a real-time analysis, the time interval between two neighboring artifacts often varies over time. BCG artifacts induced by heartbeat-related electrode movements inside the static magnetic field of the MRI scanner are time-variant because their periodicity is subject to the variability of the heart rate and the presence of drift artifacts [15]. Fixed-length segmentation will cause a mismatch between the EEG segment lengths and induce additional residual artifacts [32]. Therefore, for the rtOBS method, an adaptive segment length (L
                           
                              rt
                           ) for the real-time segmentation of EEG data is adopted. Instead of using all R-peaks detected offline, k R-peaks detected online are used to obtain the adaptive EEG segment length (L
                           
                              rt
                           ). A buffer RR (see Eq. (3)) was set to contain the k latest detected ECG R-peaks:
                              
                                 (3)
                                 
                                    
                                       R
                                       R
                                       =
                                       [
                                       
                                          R
                                          1
                                       
                                       
                                          R
                                          2
                                       
                                       
                                          R
                                          3
                                       
                                       …
                                       
                                          R
                                          
                                             k
                                             −
                                             1
                                          
                                       
                                       
                                          R
                                          k
                                       
                                       ]
                                    
                                 
                              
                           where k is the buffer size (the number of EEG segments included in the sliding window, which will be shown in next section), R
                           
                              k
                            is the time point of a newly detected ECG R-peak, and R
                           1, R
                           2, R
                           3, …, R
                           
                              k−1 are the time points of the k
                           −1 detected ECG R-peaks before the newly detected ECG R-peak. As the real-time analysis progresses, RR is updated by excluding the earliest ECG R-peak but including the currently detected ECG R-peak.

For the current RR, the lengths of the k
                           −1 peak intervals are averaged to yield L
                           
                              rt
                           :
                              
                                 (4)
                                 
                                    
                                       
                                          L
                                          
                                             r
                                             t
                                          
                                       
                                       =
                                       
                                          1
                                          
                                             k
                                             −
                                             1
                                          
                                       
                                       
                                          ∑
                                          
                                             i
                                             =
                                             2
                                          
                                          k
                                       
                                       
                                          (
                                          
                                             R
                                             i
                                          
                                          −
                                          
                                             R
                                             
                                                i
                                                −
                                                1
                                             
                                          
                                          )
                                       
                                    
                                 
                              
                           where L
                           
                              rt
                            is the updated EEG segment length. The above process is repeated once a new ECG R-peak is detected.

For the current RR, the EEG data are then divided into k EEG segments according to Eq. (5).
                              
                                 (5)
                                 
                                    
                                       
                                          
                                             
                                                R
                                                i
                                             
                                             +
                                             
                                                R
                                                
                                                   delay
                                                
                                             
                                             −
                                             
                                                1
                                                2
                                             
                                             
                                                L
                                                
                                                   r
                                                   t
                                                
                                             
                                             ,
                                              
                                             
                                                R
                                                i
                                             
                                             +
                                             
                                                R
                                                
                                                   delay
                                                
                                             
                                             +
                                             
                                                1
                                                2
                                             
                                             
                                                L
                                                
                                                   r
                                                   t
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           where L
                           
                              rt
                            is the adaptive EEG segment length, R
                           
                              i
                            is the time point of the ith R peak in RR, and R
                           delay is an empirical time delay of 210ms between the occurrence of the pulse artifact in ECG and the artifact's influence observed in EEG signals [15].

In an offline OBS, PCA is employed for the construction of the optimal basis sets using all EEG segments [20], which is impractical for a real-time analysis. To achieve a real-time analysis, we apply PCA using the k (number of EEG segments included in the window) EEG segments included in the current sliding window. The size of the sliding window also affects the construction of the optimal basis sets. An inadequate number of EEG segments may provide insufficient information regarding the BCG artifacts, whereas an excessive number may be overly time-consuming. To address this issue, different buffer sizes (5, 6, 7, …, and 60) were tested to determine an appropriate buffer size (see Section 4).

The number of principal components (PC number) selected to construct the optimal basis sets is another important factor for their real-time construction. If the PC number is too small, the components may be insufficient for extracting BCG artifacts; some information regarding such BCG artifacts may not be conveyed through the optimal basis sets. If the PC number is too large, more redundant information will be contained in the buffer window, making the buffered data larger and unnecessarily increasing the computational load, which prolongs the estimation procedure. Furthermore, the information in the original EEG signal may be included in the optimal basis sets and thus incorrectly removed. A series of simulated data with different PC number was adopted to investigate the suitable parameters (please see Section 4).

After determining the buffer size and PC number, the first n (which is the PC number) principal components are taken as the optimal basis sets denoting the estimation of BCG artifacts found through the rtOBS method.

For each update (window), after the construction of the optimal basis sets using PCA, the optimal basis sets (B) were then fitted to and subtracted from each BCG artifact occurrence [20]. A BCG artifact occurrence (Ye
                        
                           r
                        ) can be written in terms of the optimal basis sets (B) as:
                           
                              (6)
                              
                                 
                                    Y
                                    
                                       e
                                       j
                                       r
                                    
                                    =
                                    B
                                    
                                       β
                                       j
                                    
                                    +
                                    
                                       ε
                                       j
                                    
                                    ,
                                 
                              
                           
                        where β
                        
                           j
                         is a vector of weights estimated by the least squares when fitting B to 
                           
                              Y
                              
                                 e
                                 j
                                 r
                              
                           
                        , and ɛ
                        
                           j
                         is the error term for each artifact occurrence.

Next, when a new ECG R peak is detected, it indicates a new BCG artifact. The occurrence of this new BCG artifact and the occurrences of the previous k
                        −1 BCG artifacts are aligned in a matrix, and PCA is applied again. A new optimal basis set is then constructed, fitted to, and subtracted from the BCG artifact occurrence. Each step is repeated for the next detected ECG peak. In our study, the input of the rtOBS removal was based on the real-time output of the Brain Vision Analyzer 2.0.1 (Brain Products corporation) which removed the gradient artifacts (GA) using a fixed-length window setup according to the stability and strict periodicity (TR=2s) of GA. Specifically, Brain Vision Analyzer adopted a standard procedure similar to rtAAS which subtracted the averaged GA from the signals. In our work, GA removal and BCG removal were two separated procedures.

To evaluate the rtOBS method in terms of BCG artifact removal, a series of simulated data (S-Data) is generated through the addition of varying BCG artifacts to the original EEG data (see Fig. 1
                        A, and Section 3.2 for more details), and by comparing the results after BCG artifact removal with the original EEG data before adding the BCG artifacts.

There are three steps used to construct the S-Data. First, a BCG artifact template is generated through the averaging of all artifact trails from a real data set (see Fig. 1B and Section 3.2). Second, we both randomly and independently scale the BCG artifact template in terms of amplitude and time span using rates of 85–115% to simulate the varying BCG artifacts from trial to trial (Fig. 1C). Third, the scaled BCG artifacts are added to the original EEG data to generate the S-Data (Fig. 1D). In this way, both the interval between the peaks and their amplitude are randomized.

The original EEG data were recorded using a 64-channel amplifier system (BrainAmp MR, Brainproducts, Munich, Germany), which is the same system used for recording the EEG–fMRI data but in the absence of an MRI environment. The system is capable of making recordings from 63 equidistant scalp sites mounted in a cap system (Easycap, Falk Minow Services, Herrsching, Germany). The EEG electrodes are referred to as REF and are placed between Cz and Fz on the scalp according to the international 10-10 system. The ground electrode GND is placed between Fz and Fpz. The wires in the coil are fixed using plastic clips and paper tape to avoid artifacts caused by movement.

One healthy subject with no history of neurological or cardiological disorders participated in this EEG experiment. The subject was instructed to lie still and awake with their eyes closed. The subject conducted no specific tasks.

The EEG–fMRI and ECG data were recorded using a 64-channel amplifier system, which was especially designed for an MR environment (BrainAmp MR, Brainproducts, Munich, Germany, described above). Functional images were acquired on a 3T MR Siemens scanner with a T2*-weighted EPI sequence (TR=2000ms, TE=30ms, 32 slices; matrix size=64×64; acquisition voxel size=3.125mm×3.125mm×3.84mm; flip angle (FA)=90°; field of view (FOV)=190–200cm) using a standard head coil. 300 TR data were collected. The head of each subject was immobilized with a vacuum pad to reduce involuntary movement during the entire experiment.

For the simultaneous EEG–fMRI experiment, eight healthy subjects (20–35 years in age, right-handed, four females, four male) with no history of neurological or cardiological disorders were used. The subjects were instructed to lie still and awake at rest inside the scanner with their eyes closed. No specific tasks were assigned to them.

@&#EVALUATION@&#

To determine the appropriate computational parameters such as the buffer size and PC number, and to evaluate the efficacy of the rtOBS framework, several evaluation analyses were conducted, including computing the error in signal amplitude and the cumulative contribution rate as a means to assess the sensitivity and specificity of EGG R peak detection, and comparing the power spectra between the results of the different methods to assess the computational efficiency.

To determine the appropriate buffer size and PC number for the rtOBS method, the error in the signal amplitude (E
                        
                           r
                        ) and the cumulative contribution rate (C
                        
                           cr
                        ) were adopted to evaluate the performance of rtOBS with different buffer size and PC number. The error in signal amplitude (E
                        
                           r
                        ) after BCG artifact removal was defined as:
                           
                              (7)
                              
                                 
                                    
                                       E
                                       r
                                    
                                    =
                                    
                                       1
                                       n
                                    
                                    
                                       ∑
                                       
                                          i
                                          =
                                          1
                                       
                                       n
                                    
                                    
                                       |
                                       x
                                       (
                                       i
                                       )
                                       −
                                       y
                                       (
                                       i
                                       )
                                       |
                                    
                                    ,
                                 
                              
                           
                        where x(i) is the amplitude of sample i in the S-Data after BCG artifact removal when using the rtOBS method, and y(i) is the amplitude of sample i in the original EEG data used for constructing the S-Data. Here, E
                        
                           r
                         was plotted as a function of the different buffer sizes and PC numbers, and can be used for assessing the difference in the waveform of the S-Data after BCG artifact removal and of the original EEG data used for constructing the S-Data, as well as to evaluate the efficacy of the rtOBS.

The cumulative contribution rate (C
                        
                           cr
                        ) is defined as:
                           
                              (8)
                              
                                 
                                    
                                       C
                                       
                                          c
                                          r
                                       
                                    
                                    =
                                    
                                       
                                          
                                             ∑
                                             
                                                j
                                                =
                                                1
                                             
                                             m
                                          
                                          
                                             
                                                λ
                                                j
                                             
                                          
                                       
                                       
                                          
                                             ∑
                                             
                                                i
                                                =
                                                1
                                             
                                             k
                                          
                                          
                                             
                                                λ
                                                i
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where λ is the eigenvalue of the corresponding EEG segments in the sliding window, m is the PC number, and k is the number of all eigenvalues. In addition, C
                        
                           cr
                         was also plotted as a function of different buffer sizes and PC numbers.

A higher value of C
                        
                           cr
                         indicates that less redundant information was carried in the data, and a lower E
                        
                           r
                         value indicates a small difference between the S-Data after BCG artifact removal and the original EEG data used for constructing the S-Data, suggesting the high efficacy of the algorithm. Therefore, the suitable PC number and buffer size were determined by achieving a small E
                        
                           r
                         and high C
                        
                           cr
                         
                        [33].

The sensitivity (S
                        
                           e
                        ) and specificity (S
                        
                           p
                        ) were used to test the accuracy of the ECG R-peak detection. For each ECG recording, the ECG R-peak was detected automatically using the combined adaptive threshold algorithm [31]. The number of correctly detected ECG R-peaks was considered the true positive rate, T
                        
                           p
                        , whereas the number of non-detected ECG R-peaks was considered the false negative rate, F
                        
                           N
                        . The number of detection in the absence of an actual ECG R-peak was considered the false positive rate, F
                        
                           p
                        . The occurrence of actual ECG R-peaks was determined through a visual inspection. In addition, S
                        
                           e
                         and S
                        
                           p
                         were calculated for each data-set as follows:
                           
                              (9)
                              
                                 
                                    S
                                    e
                                    =
                                    
                                       
                                          T
                                          p
                                       
                                       
                                          T
                                          p
                                          +
                                          F
                                          N
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (10)
                              
                                 
                                    S
                                    p
                                    =
                                    
                                       
                                          T
                                          p
                                       
                                       
                                          T
                                          p
                                          +
                                          F
                                          p
                                       
                                    
                                 
                              
                           
                        
                     

To further evaluate the performance of the rtOBS method, for each EEG channel, we calculated and compared the power spectra of the signals before and after applying the rtOBS method. The power spectrum was calculated as
                           
                              (11)
                              
                                 
                                    S
                                    (
                                    
                                       e
                                       
                                          j
                                          w
                                       
                                    
                                    )
                                    =
                                    
                                       1
                                       n
                                    
                                    
                                       
                                          
                                             
                                                
                                                   ∑
                                                   
                                                      l
                                                      =
                                                      1
                                                   
                                                   n
                                                
                                                
                                                   
                                                      x
                                                      l
                                                   
                                                   
                                                      e
                                                      
                                                         −
                                                         j
                                                         w
                                                         l
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       2
                                    
                                 
                              
                           
                        where 
                           
                              S
                              (
                              
                                 e
                                 
                                    j
                                    w
                                 
                              
                              )
                           
                         is the power spectrum, and x
                        
                           l
                         is the value of sample l in each EEG channel.

To evaluate the computational efficiency of this rtOBS algorithm, the time consumed during the real-time processing for the removal of each BCG artifact was calculated (Our computer configuration: CPU=3.4GHz (8 cores), RAM=4 GB, Windows 7), and the results (shown in Table 1
                        ), suggest the viability of this method for real-time EEG–fMRI use.

@&#RESULTS@&#

We plotted E
                           
                              r
                            of the S-Data after applying BCG artifact removal using rtOBS as a function of the PC number for buffer window sizes of 10, 20, 30, 40, 50, and 60 (Fig. 2
                           ). For all buffer sizes, the suitable PC number was determined to be 4 when detecting the inflection point of the E
                           
                              r
                            curve (Fig. 2).

Fixing the PC number to 4, C
                           
                              cr
                            and E
                           
                              r
                            were calculated when the buffer size was set to 10, 20, 30, 40, 50, and 60, respectively. When the buffer window size increased, more redundant information would be contained, leading to decreased C
                           
                              cr
                            because the PC number was fixed. Namely, this would increase the computational load and prolong the estimation procedure. Therefore, for real-time analysis, an appropriate buffer size can be determined by achieving a high C
                           
                              cr
                            and low E
                           
                              r
                            at the same time.


                           Table 2
                            shows the values of E
                           
                              r
                            and C
                           
                              cr
                           , for different buffer sizes when the PC number of 4 was applied. The results show that when using a buffer size of either 30 or 40, a higher C
                           
                              cr
                            and lower E
                           
                              r
                            can be achieved. Considering the computational efficiency required in some real-time scenario, we chose 30 as the buffer size. It is worth noting that because the fast increasing capability of the computational hardware, a larger buffer size such as 60 may be acceptable in calculating speed and offer lower E
                           
                              r
                            at the same time.

The performances between the rtOBS and rtAAS methods were compared. The results are shown in Fig. 3
                           . Fig. 3a shows the original EEG data, which were used for constructing the S-Data. Fig. 3b and c show the signals before and after BCG artifact removal using the rtAAS and rtOBS methods, respectively. The red curves denote the signals after BCG artifact removal when using rtAAS (Fig. 3b) or rtOBS (Fig. 3c). The blue curves in Fig. 3b and c denote the S-Data. A quantitative comparison of the accuracy of rtAAS and rtOBS was displayed in Table 3
                            and the results showed that rtOBS provided cleaner signals after artifacts removal.

The real-time ECG R-peak detection algorithm was applied to the ECG data collected simultaneously using fMRI. In Fig. 4
                           , an example ECG signal is plotted. The red stars mark the ECG R-peaks that were successfully detected.


                           Table 4
                            illustrates the sensitivity (S
                           
                              e
                           ) and specificity (S
                           
                              p
                           ) of the ECG R peak detection algorithm. The average S
                           
                              e
                            was 99.75% (±0.25%), and the average S
                           
                              p
                            was 97.00% (±2.6%), suggesting the validity of the combined adaptive threshold algorithm in detecting ECG R-peaks in a real-time analysis.

The rtOBS method was applied to EEG data acquired from an MRI scanner while the subject was in a resting state with their eyes closed. Fig. 5
                            shows an example of the real-time BCG artifact removal from the EEG occurrences using the rtOBS method. Signals from ten EEG channels (PO8, P6, O2, O1, Fp1, FC5, CP2, C3, AF7, and AF3) and one ECG channel (ECG) are shown. The red dashed lines denote the detected ECG R-peaks. This figure displays an in-progress scenario in which the first three ECG R-peaks were detected and the three corresponding BCG artifacts were removed from all EEG channels at the current moment. After the BCG artifact removal, a significant reduction of the BCG artifact peaks of the first three EEG occurrences in all channels was observed.

The time consumed for the removal of BCG artifacts from each EEG sample is summarized in Table 1. In general, the progress took less than 2s (the fMRI repetition time), suggesting its feasibility for use in real-time EEG–fMRI analysis.

The spectral power in EEG harmonic frequencies was computed for each subject before and after BCG artifact removal using the rtOBS method. Twenty-three electrodes were examined for all eight subjects (Fig. 6
                           ). Fig. 6 shows the power spectra of the first ten harmonics before (black bars) and after (white bars) the rtOBS method was employed. These histograms are the average results of all subjects, suggesting a significant decrease of the BCG fundamental (approximately 1Hz) and harmonic powers after using the rtOBS method, namely, the contamination of the BCG artifacts was effectively suppressed.


                           Fig. 7
                            illustrates the average power of the harmonic frequencies (the first ten harmonics) after using the rtOBS (gray bars), OBS (black bars) and AAS (white bars) methods to remove BCG artifacts. The results shown are the average of eight datasets.

To further test the effectiveness of the rtOBS method, we compare the power of EEG spectra before and after BCG removal using rtAAS and rtOBS respectively. The averaged results of the eight datasets showed that for the occipital electrodes such as O1/O2, both rtOBS and rtAAS preserve the alpha component but rtOBS is more effective in suppressing the BCG artifact components (Fig. 8
                           ).

@&#DISCUSSION@&#

In this paper, an rtOBS method for removing BCG artifacts from EEG data recorded inside an MRI scanner was introduced. To achieve the real-time removal of BCG artifacts, we first improved the offline OBS algorithm by applying a combined adaptive threshold algorithm [31] for real-time ECG R-peak detection. Second, a sliding window applied to the EEG signals for the construction of optimal basis sets was employed, and determined the suitable buffer size and PC number adopted in the rtOBS algorithm based on the S-Data. Finally, the optimal basis sets were fitted to and subtracted from each BCG artifact occurrence. This rtOBS framework is fast and was shown to remove BCG artifacts in real-time (the real-time ECG detection and BCG artifact removal process are shown in Fig. 5). The results demonstrate the effectiveness of rtOBS in both the time and frequency domains. Furthermore, quantitative comparisons between rtOBS and rtAAS also showed that the rtOBS algorithm offers better results than the rtAAS algorithm.

Robust ECG R-peak detection is crucial in any subtraction-based method for BCG artifact removal [20]. Many ECG R-peak detectors have been proposed. In general, ECG R-peak detection methods can be classified into three main categories: threshold algorithms [31,34], matching algorithms [35,36], and syntactical algorithms [37,38]. Like BCG artifacts, ECG varies over time [20]. The rtAAS method (Brain Products GmbH, Munich, Germany) uses a matching algorithm that yields a fixed pattern-matching template to detect ECG R-peaks. However, the fixed pattern-matching template relies on prior knowledge, and is unable to accurately capture ECG R-peaks when the ECG waveforms vary over time. In contrast to the rtAAS approach, the rtOBS method employs a combined adaptive threshold algorithm as the ECG R-peak detector. The results of the rtOBS method demonstrate that it can accurately determine ECG R-peaks in real-time even when the ECG waveforms are changing temporally. The detection procedure for a real-time application is not only adaptive and independent of the thresholds settings (see Section 2 for more details) but also self-synchronized to an ECG steep slope [31]. Additionally, during a real situation, the variations in the intervals between adjacent ECG peaks should also be considered. The real-time ECG R-peak detection algorithm was applied to real data (shown in Fig. 4). Further, S
                     
                        e
                      and S
                     
                        p
                      of the real-time ECG R-peak detection (shown in Table 4) were calculated. The average S
                     
                        e
                      was 99.75% (±0.25%), and the average S
                     
                        p
                      was 97.00% (±2.6%), suggesting the validity of the real-time ECG R-peak detection algorithm. In addition, the adaptive EEG segment length based on the detected ECG R-peaks was adopted to construct the real-time EEG segments for calculation of the optimal basis sets.

The reason for using a sliding window in our real-time BCG artifact removal was because, during online processing, it is impossible to acquire all ECG R-peaks to calculate a fixed ECG matching template. A suitable buffer size is important for real-time BCG artifact removal. A sliding window containing too few EEG segments may not provide sufficient BCG artifact information, whereas a window containing too many segments will be time-consuming. Our results show that a buffer size of around 30–40 is appropriate for both the accuracy and efficiency.

PCA was applied during the construction of the optimal basis sets. Therefore, in addition to the buffer size, the PC number is also an important factor in this process [20]. To determine the suitable combination of buffer size and PC number, different buffer sizes (5, 6, 7, …, 60) and PC numbers (for each buffer size, from the smallest PC number to the number equaling the buffer size) were applied during the rtOBS test. Fig. 2 illustrates the error (E
                     
                        r
                     ) after BCG artifact removal using rtOBS, as functions of different PC numbers and sliding windows (representative buffer sizes of 10, 20, 30, 40, 50, and 60). The suitable PC number used in the rtOBS method was determined by detecting the inflection point of the E
                     
                        r
                      curve. The results show that for all combinations of PC number and buffer size, the inflection point consistently occurred when the PC number was 4. In addition, when the PC number was 4, C
                     
                        cr
                      in the results attained a level higher than 90% for the different buffer size. Accordingly, 4 is a reasonable setting for the PC number (this setting, which is not the optimal option, was only for reference). After determining 4 as the PC number, the buffer size could be determined by changing the buffer size and finding an optimal combination that can yield both a high C
                     
                        cr
                      and low E
                     
                        r
                     . A high C
                     
                        cr
                      indicates that the less redundant information was carried in the data, and a low E
                     
                        r
                      indicates the high efficacy of the algorithm. The results show that a larger buffer size leads to a lower E
                     
                        r
                      but a higher C
                     
                        cr
                      (Table 2). We selected an appropriate combination of buffer size (30) and PC number (4), which was determined by achieving a smaller E
                     
                        r
                      (less than 10μv) and larger C
                     
                        cr
                      (larger than 95%). It is worth noting that this combination produced preferable results and can be used as a reference for other data-sets; however, it is not always the only or most optimal combination. The data length, sampling rate, and requirements of computational efficiency and accuracy should be considered for the practical situations faced by different researches.

A performance comparison between the rtOBS and rtAAS methods using the same parameters (buffer size=30, PC number=4) was conducted, the results of which are shown in Fig. 3. The results show that the difference between the S-Data after BCG artifact removal and the original EEG data is significantly less when using rtOBS than when using rtAAS, indicating that the rtOBS algorithm may provide better results for the current settings. After a sliding window was employed to EEG signals in constructing a BCG artifact template, the performance of rtOBS was shown to be significantly superior to that of rtAAS for the same settings. Compared with rtAAS, rtOBS has a higher real-time performance. In addition, the spectral power in the EEG harmonic frequencies (the first ten harmonics) before and after BCG artifact removal using the rtOBS method (shown in Fig. 6) suggest a significant decrease in the BCG fundamental. A comparison among rtOBS, OBS, and AAS methods based on the real data was also conducted (shown in Fig. 7). These results are in line with the previous findings that OBS offered better results than AAS did [20]. Furthermore the results show that for all channels, rtOBS is better than both OBS and AAS in removing the BCG artifact. The differences between rtOBS and AAS are all significant (P
                     <0.005, two-tailed paired t test). Consistently, comparing the resultant power spectra of rtOBS and of rtAAS, we demonstrate an obvious further reduction in the power at the fundamental and harmonic frequencies by using rtOBS. These results suggest that rtOBS method may be a better option to preserve the meaningful EEG components, such as the alpha rhythm, and effectively suppress the influence of BCG artifacts components at the same time.

In our real-time BCG artifact removal methods, the BCG artifact template was updated along with the newly obtained EEG data. On the other hand, in the rtAAS method, the BCG artifact template was constructed by averaging the EEG segment data (Brain Products GmbH, Munich, Germany). In this way, the BCG artifact variance cannot be reflected in the constructed BCG artifact template [28]. Our rtOBS algorithm used PCA to construct the optimal basis sets, which denotes the estimation of the BCG artifacts. The process took variances in the BCG artifacts into account. Therefore, compared with the rtAAS method, our rtOBS algorithm provides a more accurate artifact estimation and improves the quality of artifact removal, whereas the fixed pattern-matching template used by the rtAAS method is insufficient for accurately capturing ECG peaks across the temporal-variation of ECG data [28].

Many other strategies were also presented to real-time BCG artifact removal. Such as application of the optical motion-tracking system [39] and subject motion recording in the MR scanner [40]. In our study, we adopted this postulated model (OBS) because it had been accepted and yielded meaningful results [20]. Using this model, our rtOBS show efficacy in removing BCG artifact in real data, further demonstrating its validity. Possible more complex methods [6,26] to modeling the artifacts may benefit the real time artifact removal in future studies.

@&#LIMITATIONS@&#

The current study shows that our rtOBS method is viable and efficient for a real-time analysis. Its performance is comparable to or better than the commonly used rtAAS method. However, it is worth noting that the proposed rtOBS algorithm may have potential limitations. For example, when the ECG data recorded are severely distorted, the accuracy of the R-peak detection may be impaired, degrading the outcome of the BCG artifact removal. In addition, the procedure used for determining a suitable buffer size is subjective; as mentioned in other researches, factors including the data length, sampling rate, and requirements of computational efficiency and accuracy should be considered according to the actual situation at hand. Therefore, a method for an objective selection of the optimal parameters may need to be further investigated. Furthermore, some typical artifacts (muscle movements, eye-blinks, etc.) are not added into simulated data because the interaction between the BCG and typical artifacts (muscle movements, eye-blink, etc.) is complex, remain unclear, and require further investigation.

@&#CONCLUSIONS@&#

In this study, a novel real-time OBS technique was introduced for the real-time removal of BCG artifacts. In this framework, a real-time ECG R-peak detection procedure was employed, and a sliding window was adopted; in addition, by applying the sliding window, the artifacts were removed using the OBS in real-time. The results of both simulated data and real EEG–fMRI data demonstrate the effectiveness of rtOBS in both the time and frequency domains. A comparison between the rtOBS and rtAAS methods also suggests the efficacy and advantage of rtOBS for real-time BCG artifact removal.

@&#ACKNOWLEDGEMENTS@&#

This work was supported by the Key Program of National Natural Science Foundation of China (6121001), General Program of National Natural Science Foundation of China (61571047), Open Project Funding of the State Key Laboratory of Networking and Switching Technology (Beijing University of Posts and Telecommunications) (SKLNST-2013-1-03), the Youth Program of National Natural Science Foundation of China (31400973), and the Fundamental Research Funds for the Central Universities, and the Research Funds of Renmin University of China (14XNLF11, 15XNQ037, 15XNLQ05).

@&#REFERENCES@&#

